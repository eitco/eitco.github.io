<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configure Storage Locations :: arveo Documentation</title>
    <link rel="canonical" href="https://eitco.github.io/arveo-docu/17.0.0/arveo-administration/content-elements-storage.html">
    <link rel="prev" href="db-access.html">
    <link rel="next" href="renditions.html">
    <meta name="generator" content="Antora 3.2.0-alpha.4">
    <link rel="stylesheet" href="../../ui-assets/css/site.css">
    <link rel="stylesheet" href="../../ui-assets/css/custom.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand"> 
      <img src="../../ui-assets/img/arveo_WortBildmarke_NEG_500px.png" id="arveoLogo" style="vertical-align:middle;margin:10px 0px">
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://eitco.github.io">Home</a>
        <!--<div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>-->
        <!--<div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>-->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="arveo-docu" data-version="17.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-general/product-summary.html">What is <em>arveo</em> - Content Services Platform (CSP)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Architecture Overview</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/content-services.html">Content Services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/technology-stack.html">Opensource Technology Stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/application-security.html">Application security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/gobd.html">Compliance recommendations (GoBD)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Store</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-storage.html">Persistence architecture</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-deletion.html">Data deletion</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-getting-started/getting-started.html">Getting Started</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration und Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="installation.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="deployment-options.html">Deployment options</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="system-requirements.html">System requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="authentication-oauth2.html">OAuth Authentication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="db-access.html">Database access</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="content-elements-storage.html">Storage locations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="renditions.html">Renditions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention-container.html">Retention and Storage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="encryption.html">Encryption</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="messaging.html">Configure Active MQ</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="maintenance-mode-db-schema.html">Maintenance mode for the database schema</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="audit.html">Audit</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="solr.html">Solr</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="jobs.html">System jobs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="vault.html">Using Hashicorp Vault</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../commons/configuration-properties.html">Configuration Properties</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="monitoring.html">Monitoring</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Developer</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Access Control</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/access-rights.html">Access rights</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/attribute-based-security.html">Attribute Based Access Control (ABAC)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/permissions.html">Permissions on Type definitions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Modelling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/entity-types.html">Entity types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/entity-annotations.html">Entity annotations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/data-types.html">Data types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/system-fields.html">System fields</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/document-types.html">Document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/container-types.html">Container types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/relation-types.html">Relation types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/folder-types.html">Folder types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/metadata-types.html">Metadata types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/inheritance.html">Inheritance</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/retention-annotations.html">Retention document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/tenant-separation.html">Tenant separation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/advanced-schema-changes.html">Advanced database schema changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-developer/repo-service.html">Repository Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/repo-service-upload-data.html">Upload Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/repo-service-download-data.html">Download Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/repo-service-delete-objects.html">Delete Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/repo-service-locking.html">Locking</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/repo-service-download-links-external-users.html">Download Links for External Users</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/versioning.html">Versioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/search-service.html">Search language</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-developer/retention-introduction.html">Retention</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/retention.html">Retention periods</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/retention-cleanup-job.html">Cleanup job</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SDKs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/client-sdks-json-serialization.html">Client SDKs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/sdk-and-batch-operations.html">Java SDK for Spring applications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/non-spring-sdk.html">Java SDK for non-Spring applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Events and messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/events.html">Events</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/integration-service.html">Enterprise Integration Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archetypes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/slim-archetype.html">The Types archetype</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/full-featured-archetype.html">The full-featured archetype</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../arveo-developer/system-tables.html">System Tables</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/compatibility-list.html">Compatibility List</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/release-notes.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/glossary.html">Important Terminology</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">arveo Documentation</span>
    <span class="version">17.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../arveo-general/product-summary.html">17.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../arveo-general/product-summary.html">arveo Documentation</a></li>
    <li>Administration und Configuration</li>
    <li>Administration</li>
    <li><a href="content-elements-storage.html">Storage locations</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configure Storage Locations</h1>
<div class="sect1">
<h2 id="content_and_type_definitions"><a class="anchor" href="#content_and_type_definitions"></a>Content and type definitions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Only Documents can contain content elements. A Document in the repository can contain several content elements.
For example, a document could contain a content element with the original content (like a TIFF image or a Word document)
and a PDF rendition. Each content element has a <em>contentName</em> and some more properties like the media type.
The <em>contentName</em> is a label that uniquely identifies a single content element contained in a Document.
For example, a Document might contain two content elements that are identified by the contentNames 'content' and
'rendition'.</p>
</div>
<div class="paragraph">
<p>The contentNames are not only relevant for uniquely identifying a content element contained in a document, but serve
as reference for further customization of the repository. The repository does accept configuration options that are
directly related to contentNames and the Document type definitions define restrictions regarding the
allowed contentNames.</p>
</div>
<div class="paragraph">
<p>Type definitions define which contentNames can be contained in the entities stored in the
definition.</p>
</div>
<div class="paragraph">
<p>Each content element is stored in a storage profile, which defines the place where the actual content will
be stored. The <em>contentType</em>  parameter can be used to define what kind of content
a content element can contain. When the media type is set to <code>application/octet-stream</code>, any kind of content can be used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The name of a content element must start with a letter and can consist only of letters (upper- and lower-case),
numbers and the <code>&#95;</code> character. More formally, the name must match the regular expression <code>[a-zA-Z][a-zA-Z0-9_]*</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_types_of_content_elements"><a class="anchor" href="#_types_of_content_elements"></a>Types of content elements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is specified in the type definition, which content elements this type definition may have.</p>
</div>
<div class="paragraph">
<p>Usually, the content elements of the entities are stored in a JSON field in the database which contains the storage-ID
and additional metadata like size, media type and a hash. The actual content data is not stored in the JSON field.
If required, a content element can also be stored in a separate field of type text. The separate field will contain only the
storage-ID but no additional metadata. Additional metadata for content elements using separate fields have to be
handled by the client application, for example by storing them in a custom metadata attribute.</p>
</div>
<div class="paragraph">
<p>The following example is an object of type <em>Document</em>, for which two content elements are defined: "content" and
"LARGE_CONTENT". In this example, "separateField = true" means a separate column in the database, otherwise it is
written in the corresponding json field of the database. The name of a separate column in the database is derived
from the name of the content element.</p>
</div>
<div class="listingblock">
<div class="title">Example of a Document with two content elements</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Type(ObjectType.DOCUMENT)
@ContentElement(name = "content", separateField = true)
@ContentElement(name = "LARGE_CONTENT", separateField = true)
public interface TwoContentsDocument {

    @SystemProperty(SystemPropertyName.ID)
    DocumentId getId();

    @SystemProperty(SystemPropertyName.CONTENT)
    Map&lt;String, ContentInformation&gt; getContentInformation();

    String getName();

    void setName(String name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>contentType</code> attribute of the <code>@ContentElement</code> annotation one can define the required content type for a
content element. The content type <em>application/octet-stream</em> is used as a wildcard type for any type of content.
For example, if the value of the contentType attribute is set to <em>application/pdf</em>, only PDF files can be stored in the
content element.</p>
</div>
<div class="paragraph">
<p>It is possible to define the content type of a new content element when it is uploaded. The server will trust this
information, so the client is responsible to send the correct content type. If the client does not define the content
type, the server will automatically detect the content type of the uploaded binary data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the_default_content_element"><a class="anchor" href="#the_default_content_element"></a>The default content element</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If a type definition of type DOCUMENT does not contain any <code>@ContentElement</code> annotations, the server will automatically
assign a content element with the name <code>content</code> to it. This content element&#8217;s metadata will be stored in the JSON
field of the type definition and it accepts any kind of content type.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the_contentelement_annotation"><a class="anchor" href="#the_contentelement_annotation"></a>The ContentElement annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following Table contains an Overview of the available attributes of the <code>@ContentElement</code> annotation.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Attributes of the ContentElement annotation</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the content element. This attribute is mandatory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">profile</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the storage profile used to store the content element. This attribute is optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/octet-stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of content supported by the content element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">separateField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to store only the content ID and no additional metadata in a separate database field.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fulltextExtraction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the fulltext content of the content element will be extracted and stored in the NOSQL database.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="storage_profiles"><a class="anchor" href="#storage_profiles"></a>Storage profiles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A StorageProfile defines on which storage the content elements are saved. Access to the storage backends (like
filesystem or S3) is handled by storage plugins.</p>
</div>
<div class="paragraph">
<p>A StoragePlugin is defined in the StorageProfile, which is used to access the connected storage.
The same plugin can be used in several StorageProfiles. Each StorageProfile can have a different set of parameters (access
data, URls, &#8230;&#8203;) for the plugin.</p>
</div>
<div class="listingblock">
<div class="title">StorageProfile definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ecr:
  server:
    storage:
      profiles:
        fileSystemProfile: <i class="conum" data-value="1"></i><b>(1)</b>
          defaultProfile: true <i class="conum" data-value="4"></i><b>(4)</b>
          pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin <i class="conum" data-value="2"></i><b>(2)</b>
          pluginSettings: <i class="conum" data-value="3"></i><b>(3)</b>
            storagePath: /storage
        s3Profile: <i class="conum" data-value="1"></i><b>(1)</b>
          pluginClassName: de.eitco.ecr.storage.plugin.s3.S3Plugin <i class="conum" data-value="2"></i><b>(2)</b>
          pluginSettings: <i class="conum" data-value="3"></i><b>(3)</b>
            pathStyleAccessEnabled: true
            serviceEndpoint: "http://localhost:49999"
            region: us-west-2
            accessKey: myaccesskey
            secretAccessKey: mysecretaccesskey
            bucket: testbucket</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>profile name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>class name of the plugin</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>plugin specific configuration data like the path for the filesystem plugin or the bucket for the S3 plugin</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>defines this profile as the default profile (see <a href="#_mapping_content_elements_to_storage_profiles">Mapping content elements to storage profiles</a>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each profile is identified by name and defines the storage plugin to use. Plugin-specific settings can be configured
in the <code>pluginSettings</code> map. So the plugin class name determines the storage technology and the plugin settings.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not rename a storage profile after data was stored in it. The name of the profile is part of the identifier of a
content element. Renaming the profile would make it impossible to load the data stored in it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a content element has been saved using the named StoragePlugin, the plugin defined in the profile will return a
contentID, with which the stored data can be retrieved later. This id, which is usually of type String, is saved with
the document. It is a task of the storage plugin to implement, which contents this id has. Usually it is a UUID, but
it may also be a text string.</p>
</div>
<div class="paragraph">
<p>A plugin is assigned to each profile based on the fully qualified class name. Any name-value pairs can be
specified for the configuration of the plug-in. The profiles are identified by their name.</p>
</div>
<div class="sect2">
<h3 id="using_aliases_for_storage_profiles"><a class="anchor" href="#using_aliases_for_storage_profiles"></a>Using aliases for storage profiles</h3>
<div class="paragraph">
<p>It is possible to assign aliases to storage profile names. This might be required when storage profiles are mapped
to content elements by configuration as described below. Assigning aliases can be done in the configuration by defining
<code>alias: profileName</code> entries as shown below:</p>
</div>
<div class="listingblock">
<div class="title">Storage profile aliases</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ecr:
  server:
    storage:
      profile-aliases:
        alias1: encryptedProfile
        another_alias: encryptedProfile</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to define more than one alias for a storage profile.
Aliases are resolved before a content element is saved. The resulting <code>ContentId</code> will contain the resolved profile, not
the alias name.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The bucket selector plugin does not support aliases when selection rules are evaluated.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mapping_content_elements_to_storage_profiles"><a class="anchor" href="#_mapping_content_elements_to_storage_profiles"></a>Mapping content elements to storage profiles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two ways to map a specific content element to a storage profile.</p>
</div>
<div class="sect2">
<h3 id="mapping_by_code"><a class="anchor" href="#mapping_by_code"></a>Mapping by code</h3>
<div class="paragraph">
<p>To define the mapping of the content elements to storage profiles in the application code, the storage profile name
can be set in the <code>@ContentElement</code> annotation using the <code>profile</code> attribute.</p>
</div>
<div class="listingblock">
<div class="title">Defining the storage profile of a content element in the code</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Type(ObjectType.DOCUMENT)
@ContentElement(name = "content", profile = "fileSystemProfile")
public interface MyDocument {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows a document type with a single named content element that will be stored in a storage profile
called <em>fileSystemProfile</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="mapping_by_configuration"><a class="anchor" href="#mapping_by_configuration"></a>Mapping by configuration</h3>
<div class="paragraph">
<p>If the mapping should be controlled by the configuration and not be defined in the code, storage profiles with auto-
matchable names must be used. The matching is based on the name of the type definition (in snake-case) and the name
of the content element separated by <code>-</code>.</p>
</div>
<div class="paragraph">
<p>The following type definition is used as an example in the following explanations. It uses one content element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Type(ObjectType.DOCUMENT)
@ContentElement(name = "rendition")
public interface MyDocument {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A matching profile for the content element named <em>rendition</em> of the interface MyDocument would be selected using the
following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check if there is a profile called <code>my_document-rendition</code>. If so, use it.</p>
</li>
<li>
<p>If not, check if there is a profile called <code>my_document</code>. If so, use it.</p>
</li>
<li>
<p>If not, check if there is a <em>default storage profile</em>. If so, use it.</p>
</li>
<li>
<p>If none of the steps above succeeded, an exception is thrown.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following example shows the simplest possible configuration. The type definition does not contain any content element.
It implicitly uses the default content element named <code>content</code>. The content element will be stored in a storage profile
called <em>my_document</em>, or, if no such profile exists, in the default storage profile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Type(ContentType.DOCUMENT)
public interface MyDocument {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example shows the same type definition, but with an annotation that defines which storage profile to use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Type(ContentType.DOCUMENT)
@ContentElement(name = ContentElement.CONTENT, profile="fileSystemProfile")
public interface MyDocument {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example shows a type definition that contains two content elements. The "rendition"
content element will support only PDF documents. The PDFs contained in the rendition content element will be stored
in an S3 storage. The content in the other element will either be stored in a profile called <em>my_document-content</em>, in
a profile called <em>my_document</em> or, if neither of those profiles exists, in the default profile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Type(ContentType.DOCUMENT)
@ContentElement(name="content")
@ContentElement(name="rendition", contentType="application/pdf", storageProfile="s3Profile")
public interface MyDocument {

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="plugin_configuration"><a class="anchor" href="#plugin_configuration"></a>Plugin configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The service uses a plug-in interface for connection to the specific storage provider. The following plugins
are currently available:</p>
</div>
<div class="sect2">
<h3 id="_file_system"><a class="anchor" href="#_file_system"></a>File system</h3>
<div class="paragraph">
<p>Class name: <em>de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin</em>.</p>
</div>
<div class="paragraph">
<p>The FileSystemPlugin offers storage of the data as files in the file system.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Configuration parameters of the file system</caption>
<colgroup>
<col style="width: 20%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">parameter</th>
<th class="tableblock halign-left valign-top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storagePath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the directory that is used to store the files</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="aws_netapp_or_emc_elastic_cloud_storage"><a class="anchor" href="#aws_netapp_or_emc_elastic_cloud_storage"></a>AWS, NetAPP or EMC Elastic Cloud Storage</h3>
<div class="paragraph">
<p>Class name: <em>de.eitco.ecr.storage.plugin.s3.S3Plugin</em>.</p>
</div>
<div class="paragraph">
<p>The S3 plug-in stores data in an Amazon S3 compatible storage.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <em>arveo</em> has no permissions to create buckets, then the administrator has to create the buckets manually.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Configuration parameter of the S3 plugin</caption>
<colgroup>
<col style="width: 20%;">
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pathStyleAccessEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the client to use path-style access for all requests.
  Amazon S3 supports virtual-hosted-style and path-style access in all regions.
  The path-style syntax, however, requires that you use the region-specific endpoint when attempting to access a bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceEndpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL to the S3 endpoint to be used by the plugin</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">region</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The region for access to AWS</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">accessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS Access Key</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretAccessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS Secret Access Key</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the S3 bucket to be created by the plugin. The name can only contain lowercase letters.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">signer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the name of the signature algorithm to use for signing requests made by this client. If not set,
the default configuration of the Amazon S3 SDK will be used.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxyhost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The optional proxy host used by the client when connecting to the S3 storage.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxyprotocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The protocol (HTTP or HTTPS) used to connect to the proxy.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxyport</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port used by the client to connect to the proxy.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">streambuffersize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of the send- and receive-buffers in bytes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32768</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uploadpresignedurl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, the client will use pre-signed URL requests to communicate with the S3 storage.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">acceleratemode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the client to use S3 accelerate endpoint for all requests.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxconnection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of allowed open HTTP connections.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1 (no limit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxErrorRetries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of retries for failed requests.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1 (no retries)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">baseDelay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base delay in milliseconds for the retry policy.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1 (no delay)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxBackoffTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum backoff time in milliseconds for the retry policy.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1 (no maximum backoff time)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">backoffStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The backoff strategy used by the retry policy.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retentionEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the use of S3 object locks for object retention.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retentionMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the protection level of retention object locks. Can be <code>COMPLIANCE</code> or <code>GOVERNANCE</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GOVERNANCE</code></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="configuring_the_retry_policy_of_the_s3_plugin"><a class="anchor" href="#configuring_the_retry_policy_of_the_s3_plugin"></a>Configuring the retry policy of the S3 plugin</h4>
<div class="paragraph">
<p>The Amazon S3 SDK used to connect to a S3 compatible storage supports different ways to retry failed requests. By default,
a retry policy using jitter and 3 retries is used. To configure a custom retry policy, all three parameters <code>baseDelay</code>,
<code>maxBackoffTime</code> and <code>backoffStrategy</code> have to be configured. The <code>backoffStrategy</code> parameter must be set to one of the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FULL_JITTER</code></p>
</li>
<li>
<p><code>EQUAL_JITTER</code></p>
</li>
<li>
<p><code>EXPONENTIAL</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://docs.aws.amazon.com/de_de/general/latest/gr/api-retries.html">Amazon documentation</a> contains an explanation
of the different strategies.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="retention"><a class="anchor" href="#retention"></a>Retention</h3>
<div class="paragraph">
<p>The S3 plugin supports the usage of S3 object locks to set a retention time and litigation hold status on content
elements stored in the S3 compatible storage. To enable the feature, set the parameter <code>retentionEnabled</code> to true.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the retention support is enabled, the bucket used by the storage profile must be created manually.
The S3 Object Locks option must be enabled for the bucket.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The S3 plugin uses the governance retention mode by default, which means, that retention protected objects
can be deleted by or overwritten by any user of the AWS account with the required privileges. When the compliance
retention mode is used, no user (not even the root administrator of the S3 account) is able to delete or overwrite
retention protected objects. To configure this behavior, set the property <code>retentionMode</code> to <code>GOVERNANCE</code> or
<code>COMPLIANCE</code>. More information about object locks can be found in the
<a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lock-overview.html">AWS documentation</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the <code>COMPLIANCE</code> retention mode is used, it is impossible to delete objects from the S3 storage account before
the end of the retention interval is reached.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="azure_blob_storage"><a class="anchor" href="#azure_blob_storage"></a>Azure blob storage</h3>
<div class="paragraph">
<p>Class name: <code>de.eitco.ecr.storage.plugin.azureblob.AzureBlobStoragePlugin</code></p>
</div>
<div class="paragraph">
<p>The Azure blob storage plugin can be used to connect to a storage account in Microsoft Azure.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Configuration parameter of the azure blob storage plugin</caption>
<colgroup>
<col style="width: 20%;">
<col>
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The connection string used to connect to the storage account. The access string can be obtained from the azure portal.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">containerName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the container in the storage account that will contain the data of the storage profile.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeoutMillis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The timeout in milliseconds for requests to Azure.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retentionSupport</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables usage of the immutability policy feature of Azure.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">policyMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the protection level of the immutability policies. Can be <code>LOCKED</code> or <code>UNLOCKED</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UNLOCKED</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Additional parameters contained in the plugin configuration will be passed on to the <code>Configuration</code> used for the
Azure SDK.</p>
</div>
<div class="sect3">
<h4 id="retention_2"><a class="anchor" href="#retention_2"></a>Retention</h4>
<div class="paragraph">
<p>The Azure blob storage plugin supports the immutability policy feature of Azure blob storage. Using this feature
enables an additional security level for retention protected content elements. If a content element is retention
protected or in a litigation hold, it will not be possible to delete it using the Azure management interface or the
Azure SDK.</p>
</div>
<div class="paragraph">
<p>To enable the retention support, the parameter <code>retentionSupport</code> must be set to true.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the retention support is enabled, the container used by the storage profile must be created manually in Azure.
The setting <em>version-level immutability support</em> must be enabled when the container is created. To be able to
enable the version-level immutability support, the storage account must support versioning for blobs. More information
can be found in the <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/immutable-storage-overview">Azure documentation</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The plugin creates unlocked immutability policies by default. Unlocked policies can be altered by Azure users with the
required privileges. Locked immutability policies can neither be deleted nor can the expiry time be shortened.
Prolonging the expiry time (and by this, the retention period), is still possible. Note that even the administrator
of the storage account is not able to delete objects with a locked immutability policy. To configure the policy mode,
set the parameter <code>policyMode</code> to <code>LOCKED</code> or <code>UNLOCKED</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the <code>policyMode</code> is set to <code>LOCKED</code>, it is not possible to delete retention protected objects from the storage
account before the end of the retention interval is reached.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bucketorganizer"><a class="anchor" href="#_bucketorganizer"></a>BucketOrganizer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Class name: <em>de.eitco.ecr.server.storage.plugins.BucketOrganizerPlugin</em>.</p>
</div>
<div class="paragraph">
<p>The BucketOrganizer is not specific for a specific storage technology or storage interface but delegates storage requests
to other storage plugins.The selection of the target plugin depends on the retention information of the document that contains
the content element to be stored. The selection criteria that are used to select the target plugin can be configured in
terms of a list of bucket selection rules.</p>
</div>
<div class="paragraph">
<p>The relevant retention information of the document is defined by the values of the system fields <em>RETENTION_DATE</em> and
<em>LITIGATION_HOLD</em>.
This value pair is matched against the bucket selection rules.The matching process starts with the first rule
and continues to the next rule if the rule does not match the value pair.The matching process ends at the first rule that
matches the value pair.The storage profile named in this rule will be used to store the content. Each bucket
selection rule consists of three parts that are separated by the pipe (|) symbol.</p>
</div>
<div class="sect2">
<h3 id="1_retention_date_match_expression"><a class="anchor" href="#1_retention_date_match_expression"></a>1.  retention date match expression</h3>
<div class="paragraph">
<p>The retention date match expression is usually a time interval that begins at some calendar day and extends to some
later calendar day. The notation for the interval is inspired by ISO 8601 and may read like this
<code>2021-01-01+01:00&#8212;&#8203;2022-01-01+01:00</code>. The general format is <code>begin_date&#8212;&#8203;end_date</code>, that is both dates are separated
by "--". A retention date matches the expression if <code>begin date &#8656; retention date &lt; end date</code>.
The begin and end dates are specified as <code>YYYY-MM-DD</code> followed by a time zone offset as <code>+hh:mm</code> or <code>-hh:mm</code>
It is possible to define open intervals by specifying one of the boundary dates as <code>UNBOUNDED</code>.
Retention dates may be NULL if the retention date has not (yet) been set on the document. A NULL retention date will
not match any interval specified in a match rule. For this reason the retention date match expression may be specified
to be <code>NULL</code> to match NULL retention dates.
A retention date match expression can also be specified to be <code>&#42;</code> if the rule should always match.</p>
</div>
</div>
<div class="sect2">
<h3 id="2_litigation_hold_match_expression"><a class="anchor" href="#2_litigation_hold_match_expression"></a>2.  litigation hold match expression</h3>
<div class="paragraph">
<p>The litigation hold match expression can be one of these literals: <code>true</code>, <code>false</code>, <code>&#42;</code>.
While the literal <code>&#42;</code> will always match, the other literals will match the denoted value only.</p>
</div>
</div>
<div class="sect2">
<h3 id="3_target_storage_profile_name"><a class="anchor" href="#3_target_storage_profile_name"></a>3.  target storage profile name</h3>
<div class="paragraph">
<p>The name of the target storage profile to be used if both expressions match the corresponding system field values</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration_parameters"><a class="anchor" href="#configuration_parameters"></a>Configuration parameters</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Configuration parameters of BucketOrganizer plugin</caption>
<colgroup>
<col style="width: 25%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bucketSelectionRules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of bucket selection rules</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">storage:
  profiles:
    bucketProfile: <i class="conum" data-value="1"></i><b>(1)</b>
      pluginClassName: de.eitco.ecr.server.storage.plugins.BucketOrganizerPlugin <i class="conum" data-value="2"></i><b>(2)</b>
      pluginSettings:
        bucketSelectionRules: <i class="conum" data-value="3"></i><b>(3)</b>
          - "*|true|fsProfileLitigationHold" <i class="conum" data-value="4"></i><b>(4)</b> <i class="conum" data-value="5"></i><b>(5)</b>
          - "NULL|false|fsProfileForever" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2021-01-01+01:00--2022-01-01+01:00|false|fsProfile2021" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2022-01-01+01:00--2023-01-01+01:00|false|fsProfile2022" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2023-01-01+01:00--2024-01-01+01:00|false|fsProfile2023" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2024-01-01+01:00--2025-01-01+01:00|false|fsProfile2024" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2025-01-01+01:00--2026-01-01+01:00|false|fsProfile2025" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2026-01-01+01:00--2027-01-01+01:00|false|fsProfile2026" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2027-01-01+01:00--2028-01-01+01:00|false|fsProfile2027" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2028-01-01+01:00--2029-01-01+01:00|false|fsProfile2028" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2029-01-01+01:00--2030-01-01+01:00|false|fsProfile2029" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2030-01-01+01:00--2031-01-01+01:00|false|fsProfile2030" <i class="conum" data-value="4"></i><b>(4)</b>
          - "*|*|fsProfileAnotherEra" <i class="conum" data-value="4"></i><b>(4)</b>
    fsProfileLitigationHold: <i class="conum" data-value="5"></i><b>(5)</b>
      pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
      pluginSettings:
        storagePath: ${project.build.directory}/storage/litigationHold
    fsProfileForever:
      pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
      pluginSettings:
        storagePath: ${project.build.directory}/storage/forever
    fsProfile2021:
      pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
      pluginSettings:
        storagePath: ${project.build.directory}/storage/2021
 #...
    fsProfile2030:
      pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
      pluginSettings:
        storagePath: ${project.build.directory}/storage/2030
    fsProfileAnotherEra:
      pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
      pluginSettings:
        storagePath: ${project.build.directory}/storage/anotherEra</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>profile name;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>type of plugin, so its class name;</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>rules list.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>a bucket selection rule, consisting of retention date match expression, litigation hold match expression and
target storage profile name.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the referenced profile name.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_storage_profile_templates"><a class="anchor" href="#_storage_profile_templates"></a>Storage profile templates</h3>
<div class="paragraph">
<p>To reduce the number of required entries in the list of bucket selection rules, storage profile templates can be used.
A storage profile template consists of a name template with placeholders, a specific time range and the regular
configuration parameters like the class name of the storage profile.The <code>&lt;year&gt;</code> placeholder can be used as a variable
for the current year.</p>
</div>
<div class="paragraph">
<p>Storage profile templates are configured in a separate section as shown below:</p>
</div>
<div class="listingblock">
<div class="title">Storage profile template configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ecr:
  server:
    storage:
      profiles:
        bucketProfile:
          pluginClassName: de.eitco.ecr.server.storage.plugins.BucketOrganizerPlugin
          pluginSettings:
            bucketSelectionRules:
              - "*|true|fsProfileLitigationHold"
              - "NULL|false|fsProfileForever"
              - "&lt;year&gt;-01-01+01:00|false|fsProfile&lt;year&gt;|2021--2030" <i class="conum" data-value="1"></i><b>(1)</b>
      profile-templates:
        - nameTemplate: "fsProfile&lt;year&gt;" <i class="conum" data-value="2"></i><b>(2)</b>
          genericTimeRange: "2021--2029" <i class="conum" data-value="3"></i><b>(3)</b>
          pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
          pluginSettings:
            storagePath: ${storage.base.directory}/storage/&lt;year&gt; <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A bucket selection rule using a profile template with the year placeholder for the years between 2021 and 2030.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A name template that will create profiles for the years 2021 to 2029.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defines the time range used to create profiles based on the template</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The year placeholder can be used in the configuration properties of the plugin.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing_a_custom_storage_plugin"><a class="anchor" href="#writing_a_custom_storage_plugin"></a>Writing a custom storage plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As mentioned above, <em>arveo</em> uses a plugin interface for the connection to the storage backends. This section
describes how to write a new storage plugin.</p>
</div>
<div class="paragraph">
<p>All classes and interfaces required to implement a custom plugin are contained in the dependency</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;de.eitco.ecr&lt;/groupId&gt;
    &lt;artifactId&gt;ecr-server&lt;/artifactId&gt;
    &lt;version&gt;17.0.0&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A storage plugin must implement the interface <code>de.eitco.ecr.server.storage.StoragePlugin</code>. There are two abstract
implementations that can be extended to simplify the implementation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AbstractStoragePlugin</code>: Provides several methods that make it easier to get plugin configuration settings.</p>
</li>
<li>
<p><code>AbstractSimplifiedStoragePlugin</code>: The superclass of all plugins that do not need retention support</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to the interface to implement, there are some guidelines to respect when writing a custom storage plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The plugin must provide a default no argument constructor because it will be instantiated using reflection.</p>
</li>
<li>
<p>The plugin can use dependency injection, but because of the need for a default constructor, only field injection
using <code>@Autowired</code> is possible.</p>
</li>
<li>
<p>There will be one instance of the plugin for each storage profile configured to use the plugin, so the plugin must
be thread-safe.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="configuration_settings"><a class="anchor" href="#configuration_settings"></a>Configuration settings</h3>
<div class="paragraph">
<p>The <code>StoragePlugin</code> interface contains a method called <code>configure</code>, which will be called once for each plugin instance.
It is used to process the generic parameter values that might be required to configure the plugin. For example, the
parameters might contain a path to a file system directory or credentials for a remote storage system. Because storage
plugins can be configured in <a href="#_storage_profile_templates">profile templates</a>, it might be necessary to replace
placeholders configured in the template. The class <code>AbstractStoragePlugin</code> already contains helper methods like
<code>getMandatoryProperty</code> that take care of these replacements. The <code>configure</code> method is expected to return the actual
configuration with all replacements that is used by this plugin instance. The returned configuration settings are used
by the health checks.</p>
</div>
</div>
<div class="sect2">
<h3 id="using_the_custom_storage_plugin"><a class="anchor" href="#using_the_custom_storage_plugin"></a>Using the custom storage plugin</h3>
<div class="paragraph">
<p>To use the custom plugin, it is enough to add its classes to the classpath of the repository service. The plugin can then
be used for a storage profile by specifying it&#8217;s qualified class name in the <code>pluginClassName</code> parameter. To add the
plugin&#8217;s class to the classpath, use the <code>-Dloader.path=&lt;path&gt;</code> argument to start the service. The argument must point
to a directory containing the required jar files.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="db-access.html">Database access</a></span>
  <span class="next"><a href="renditions.html">Renditions</a></span>
</nav>
</article>
  </div>
</main>
    <!-- The Modal -->
    <div id="imageModalBox" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01">
        <div id="caption"></div>
    </div>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../ui-assets/js/site.js" data-ui-root-path="../../ui-assets"></script>
<script async src="../../ui-assets/js/vendor/highlight.js"></script>
<script async src="../../ui-assets/js/modal.js"></script>
<script src="../../ui-assets/js/vendor/lunr.js"></script>
<script src="../../ui-assets/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../ui-assets/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
