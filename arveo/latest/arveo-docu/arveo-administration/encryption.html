<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configure Encryption :: arveo Documentation</title>
    <link rel="canonical" href="https://eitco.github.io/arveo-docu/17.0.0/arveo-administration/encryption.html">
    <link rel="prev" href="retention-container.html">
    <link rel="next" href="messaging.html">
    <meta name="generator" content="Antora 3.2.0-alpha.4">
    <link rel="stylesheet" href="../../ui-assets/css/site.css">
    <link rel="stylesheet" href="../../ui-assets/css/custom.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand"> 
      <img src="../../ui-assets/img/arveo_WortBildmarke_NEG_500px.png" id="arveoLogo" style="vertical-align:middle;margin:10px 0px">
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://eitco.github.io">Home</a>
        <!--<div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>-->
        <!--<div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>-->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="arveo-docu" data-version="17.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-general/product-summary.html">What is <em>arveo</em> - Content Services Platform (CSP)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Architecture Overview</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/content-services.html">Content Services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/technology-stack.html">Opensource Technology Stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/application-security.html">Application security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/gobd.html">Compliance recommendations (GoBD)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Store</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-storage.html">Persistence architecture</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-deletion.html">Data deletion</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-getting-started/getting-started.html">Getting Started</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration und Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="installation.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="deployment-options.html">Deployment options</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="system-requirements.html">System requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="authentication-oauth2.html">OAuth Authentication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="db-access.html">Database access</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="content-elements-storage.html">Storage locations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="renditions.html">Renditions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention-container.html">Retention and Storage</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="encryption.html">Encryption</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="messaging.html">Configure Active MQ</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="maintenance-mode-db-schema.html">Maintenance mode for the database schema</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="audit.html">Audit</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="solr.html">Solr</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="jobs.html">System jobs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="vault.html">Using Hashicorp Vault</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../commons/configuration-properties.html">Configuration Properties</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="monitoring.html">Monitoring</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Developer</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Access Control</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/access-rights.html">Access rights</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/attribute-based-security.html">Attribute Based Access Control (ABAC)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/permissions.html">Permissions on Type definitions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Modelling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/entity-types.html">Entity types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/entity-annotations.html">Entity annotations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/data-types.html">Data types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/system-fields.html">System fields</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/document-types.html">Document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/container-types.html">Container types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/relation-types.html">Relation types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/folder-types.html">Folder types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/metadata-types.html">Metadata types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/inheritance.html">Inheritance</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/retention-annotations.html">Retention document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/tenant-separation.html">Tenant separation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/advanced-schema-changes.html">Advanced database schema changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-developer/repo-service.html">Repository Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/repo-service-upload-data.html">Upload Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/repo-service-download-data.html">Download Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/repo-service-delete-objects.html">Delete Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/repo-service-locking.html">Locking</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/repo-service-download-links-external-users.html">Download Links for External Users</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/versioning.html">Versioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/search-service.html">Search language</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-developer/retention-introduction.html">Retention</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/retention.html">Retention periods</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/retention-cleanup-job.html">Cleanup job</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SDKs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/client-sdks-json-serialization.html">Client SDKs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/sdk-and-batch-operations.html">Java SDK for Spring applications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/non-spring-sdk.html">Java SDK for non-Spring applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Events and messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/events.html">Events</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/integration-service.html">Enterprise Integration Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archetypes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/slim-archetype.html">The Types archetype</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-developer/full-featured-archetype.html">The full-featured archetype</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../arveo-developer/system-tables.html">System Tables</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/compatibility-list.html">Compatibility List</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/release-notes.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/glossary.html">Important Terminology</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">arveo Documentation</span>
    <span class="version">17.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../arveo-general/product-summary.html">17.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../arveo-general/product-summary.html">arveo Documentation</a></li>
    <li>Administration und Configuration</li>
    <li>Administration</li>
    <li><a href="encryption.html">Encryption</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Configure Encryption</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>arveo</em> provides a transparent encryption for data stored in the profiles. The encryption can be configured individually
for each storage profile.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Encrypting and decrypting is performed by configurable encryption providers. Each provider is identified by a unique
name. The available providers are described below.</p>
</div>
<div class="paragraph">
<p>The following tables give an overview of encryption settings for a storage profile.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Encryption settings</caption>
<colgroup>
<col style="width: 25%;">
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enables or disables the encryption</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">providerName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name of the encryption provider to use</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">commons-aes</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To make sure all content of a specific type definition is encrypted, make sure to limit the content types supported
by the type definition to types that use an encrypting storage profile.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the <a href="content-elements-storage.html#_bucketorganizer" class="xref page">BucketOrganizerPlugin</a> is used, the encryption settings must be configured for each plugin referenced
by the bucket selection rules. Configuring the encryption for the BucketOrganizerPlugin itself is not supported.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="commons_aes_provider"><a class="anchor" href="#commons_aes_provider"></a>Commons AES provider</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>commons-aes</code> provider supports AES encryption with 256bit keys. When a new content element is created in an encrypted
profile, the provider generates a random cipher key for the element. The key is encrypted using a master password that is
configured in the profile&#8217;s encryption settings. It is then stored in the database, which creates an identifier for the key.
The keys are stored in individual tables for each profile called ecr_keys_&lt;profileName&gt;. After that, the content is encrypted
and stored using the profile&#8217;s storage plugin. The key-id is stored in a header together with the encrypted data. When
the data is read, the cipher key is loaded from the database using the key-id read from the header. The key is decrypted
using the master password and used to decrypt the data read by the profile&#8217;s storage plugin.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the database table containing the keys or the master password is lost, it is impossible to restore the
data stored in the profile.
When the master password for a profile is changed, it is required to re-encrypt all stored keys for the profile.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the future, there will be a way to re-encrypt keys. For now, this issue hasn&#8217;t been implemented yet.</p>
</div>
<div class="paragraph">
<p>There is a second database table for each profile called ecr_keys_assoc_&lt;profileName&gt;. This table contains mappings of
key IDs to content element IDs and is intended for system administration purposes.
The encryption feature is configured as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Configuration of encryption for a storage profile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">storage:
  profiles:
    encryptedProfile:
      pluginClassName: "de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin"
      pluginSettings:
        storagePath: "/storage/encrypted"
      encryptionSettings:
        enabled: true
        providerName: "commons-aes"
        providerSettings:
          password: "changeme"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following tables give an overview of encryption settings for the <em>commons-aes</em> provider:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Provider specific settings for 'commons-aes'</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 30%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the master password used to encrypt the cipher keys</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rngAlgorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the algorithm used to generate secure random data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Platform specific. See docs for SecureRandom.getInstanceStrong(). If not specified, the
most secure algorithm available will be used</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="vault_aes_provider"><a class="anchor" href="#vault_aes_provider"></a>Vault AES provider</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>vault-aes</code> encryption provider uses the transit secrets engine of
<a href="https://www.vaultproject.io/docs/secrets/transit">Hashicorp Vault</a> to encrypt and decrypt a generated random cipher key.
The cipher key is generated using a configurable random data generation algorithm and then used to encrypt the content
with AES as described below. The cipher key is then encrypted by Vault and stored in a header together with the encrypted
content data. When the data is decrypted, the encrypted cipher key is read from the header, decrypted using Vault and
then used to decrypt the content. The advantage in comparison to the <code>commons-aes</code> provider is that no master key and
no stored encryption keys in the database are required. The keys required to decrypt the cipher keys (and though the
data, too) are securely stored in Vault and are never known to <em>arveo</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the Vault instance containing the keyring used to encrypt the random cipher keys is lost, it is impossible to
decrypt the content data!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following tables give an overview of encryption settings for the <code>vault-aes</code> provider:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Provider specific settings for 'commons-aes'</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keyring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name of the key ring contained in Vault&#8217;s transit secrets engine used to encrypt the cipher keys</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transitEnginePath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(optional) path of the transit engine. If null, the default path will be used.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rngAlgorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the algorithm used to generate secure random data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Platform specific. See docs for SecureRandom.getInstanceStrong(). If not specified, the
most secure algorithm available will be used</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following example shows a storage profile configuration using the <code>vault-aes</code> encryption provider.</p>
</div>
<div class="listingblock">
<div class="title">example configuration for the vault-aes provider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">vaultEncryptedProfile:
  pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
  pluginSettings:
    storagePath: /storage/vault-encrypted
  encryptionSettings:
    enabled: true
    providerName: vault-aes
    providerSettings:
      keyring: arveo</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementation_details_of_aes_encryption"><a class="anchor" href="#implementation_details_of_aes_encryption"></a>Implementation details of AES encryption</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following chapter contains information about the implementation details of the AES encryption used by <em>arveo</em>.</p>
</div>
<div class="sect2">
<h3 id="header"><a class="anchor" href="#header"></a>Header</h3>
<div class="paragraph">
<p>The encryption library is designed to encrypt data in such a way that it can be stored permanently in encrypted form and
possibly only decrypted after a long time. In order to guarantee decryption, all data required for this (except the key, of
course) are stored in a header together with the encrypted data. Using the data from the header, the library can thus
obtain, for example, the algorithm used and the data for key derivation, and only needs the password or the derived key
for decryption.</p>
</div>
</div>
<div class="sect2">
<h3 id="aes"><a class="anchor" href="#aes"></a>AES</h3>
<div class="paragraph">
<p>The library uses AES according to the recommendation of the Federal Office for Information Security of March 2020:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Operating mode: Galois/Counter-Mode</p>
</li>
<li>
<p>Hash function for key derivation: Argon2</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The library allows the configuration of different parameters, but offers default values according to the recommendation
of the BSI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Key length: 256 bit</p>
</li>
<li>
<p>Length of GCM checksums: 128 bit</p>
</li>
<li>
<p>Length of the initialisation vector: 96 bit</p>
</li>
<li>
<p>Length of the salt for the key derivation: 32 bit</p>
</li>
<li>
<p>Parallelism for Argon2: 1</p>
</li>
<li>
<p>Memory cost for Argon2: 4096 KB</p>
</li>
<li>
<p>Iterations for Argon2: 3</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The initialisation vector is randomly generated each time the encryption methods are called by using SecureRandom. The
salt for the key derivation is generated in the same way each time the password derivation method is called. The fact
that the initialisation vector is always regenerated ensures that the same combination of initialisation vector and key
can never be used more than once.
For both the AES algorithm and the Argon2 hash function, the implementations of the BouncyCastle library are used. For
performance and compatibility reasons, the BouncyCastle implementations are used directly and not via the JCA:</p>
</div>
<div class="listingblock">
<div class="title">Generation of the AES cipher with GCM</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GCMBlockCipher cipher = new GCMBlockCipher(new AESEngine());</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Generation of the Argon2 hash generator</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Argon2BytesGenerator generator = new Argon2BytesGenerator();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the default implementation of the <em>CipherInputStream</em> from <em>javax.crypto</em> is not suitable for block ciphers with data
authentication, the implementations for <em>CipherInputStream</em> and <em>CipherOutputStream</em> from the <em>BouncyCastle</em> library are used.
To generate the random data for the initialisation vector and the salt, a <em>SecureRandom</em> instance created with
<em>SecureRandom.getInstanceStrong()</em> is used by default. However, the library allows you to specify a different RNG algorithm
(see <a href="#note_on_linux">Note on Linux</a> below).</p>
</div>
</div>
<div class="sect2">
<h3 id="header_format"><a class="anchor" href="#header_format"></a>Header Format</h3>
<div class="paragraph">
<p>The header begins with a string to identify data encrypted with the library followed by the length of the
payload data in the header. The header is divided into blocks and can be read serially.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>++&gt;~ENC~&lt;++|97|AES_GCM_ARGON2|1|256|128|10|4096|1|aWFtYW5pbml0aWFsaXphdGlvbnZlY3Rvcg==|aWFtYXNhbHQ=|bXlLZXlJZA==

Marker|length|method|header version|key length|checksum length|iteration|storage cost|parallelism|initialisation vector|salt|key ID</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="key"><a class="anchor" href="#key"></a>Key</h3>
<div class="paragraph">
<p>The keys used for encryption are either generated using random data or derived from any password using the Argon2 hash
function. Since deriving keys can be very computationally intensive depending on the configuration, a key ID can be
stored in the header. This makes it possible to store a key once it has been derived and to reuse it for decryption,
which avoids having to derive the key from the password again. The library is not responsible for the secure storage of
the key. Generating keys using random data is a much faster operation compared to key derivation. The disadvantage is,
that it is not possible to derive the key from a master password in case it was lost. When generated keys are used,
it is crucial to store those keys in a secure location. In this case, the header will not contain a salt but only the
ID of the stored key. When an external system like Vault is used to encrypt generated keys, the encrypted generated key
is stored in the header instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="usage"><a class="anchor" href="#usage"></a>Usage</h3>
<div class="paragraph">
<p>Instantiation of the AesEncryptorAndDecryptor:</p>
</div>
<div class="listingblock">
<div class="title">Instantiation with default parameters</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AesEncryptorAndDecryptor encryptorAndDecryptor=new AesEncryptorAndDecryptor.Builder().build();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Instantiation with customised parameters</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AesEncryptorAndDecryptor encryptorAndDecryptor=new AesEncryptorAndDecryptor.Builder()
    .with128BitKeys()
    .withInitializationVectorLength(128)
    .withTagLength(128)
    .withIterations(5)
    .withMemoryCost(1024)
    .withParallelism(3)
    .withSaltLength(64)
    .withRngAlgorithm("SHA1PRNG")
    .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples of usage can be found in the test class <em>de.eitco.commons.crypto.AesEncryptionTest</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="note_on_linux"><a class="anchor" href="#note_on_linux"></a>Note on Linux</h3>
<div class="paragraph">
<p>On Linux, Java uses the NativePRNG algorithm by default for generating random data with SecureRandom.getInstanceStrong().
This implementation uses /dev/random and may block if there is not enough data available there. This can lead to very
long waiting times for key derivation and encryption. You can then either use a weaker RNG algorithm or make sure that
<em>/dev/random</em> always contains enough data. This can be achieved with the haveged daemon, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>apt-get install haveged
update-rc.d haveged defaults
service haveged start</pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="retention-container.html">Retention and Storage</a></span>
  <span class="next"><a href="messaging.html">Configure Active MQ</a></span>
</nav>
</article>
  </div>
</main>
    <!-- The Modal -->
    <div id="imageModalBox" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01">
        <div id="caption"></div>
    </div>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../ui-assets/js/site.js" data-ui-root-path="../../ui-assets"></script>
<script async src="../../ui-assets/js/vendor/highlight.js"></script>
<script async src="../../ui-assets/js/modal.js"></script>
<script src="../../ui-assets/js/vendor/lunr.js"></script>
<script src="../../ui-assets/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../ui-assets/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
