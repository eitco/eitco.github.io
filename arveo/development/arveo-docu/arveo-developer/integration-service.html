<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Enterprise Integration Service :: arveo Documentation</title>
    <link rel="canonical" href="https://eitco.github.io/arveo-docu/arveo-developer/integration-service.html">
    <link rel="prev" href="events.html">
    <link rel="next" href="slim-archetype.html">
    <meta name="generator" content="Antora 3.2.0-alpha.4">
    <link rel="stylesheet" href="../../ui-assets/css/site.css">
    <link rel="stylesheet" href="../../ui-assets/css/custom.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand"> 
      <img src="../../ui-assets/img/arveo_WortBildmarke_NEG_500px.png" id="arveoLogo" style="vertical-align:middle;margin:10px 0px">
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://eitco.github.io">Home</a>
        <!--<div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>-->
        <!--<div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>-->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="arveo-docu" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-general/product-summary.html">What is <em>arveo</em> - Content Services Platform (CSP)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Architecture Overview</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/content-services.html">Content Services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/technology-stack.html">Opensource Technology Stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/application-security.html">Application security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/gobd.html">Compliance recommendations (GoBD)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Store</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-storage.html">Persistence architecture</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-deletion.html">Data deletion</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-getting-started/getting-started.html">Getting Started</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration und Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-administration/installation.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/deployment-options.html">Deployment options</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/system-requirements.html">System requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/authentication-oauth2.html">OAuth Authentication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/db-access.html">Database access</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/content-elements-storage.html">Storage locations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/renditions.html">Renditions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/retention-container.html">Retention and Storage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/encryption.html">Encryption</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/messaging.html">Configure Active MQ</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/maintenance-mode-db-schema.html">Maintenance mode for the database schema</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/audit.html">Audit</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/solr.html">Solr</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/jobs.html">System jobs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/vault.html">Using Hashicorp Vault</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../commons/configuration-properties.html">Configuration Properties</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../arveo-administration/monitoring.html">Monitoring</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Developer</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Access Control</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="access-rights.html">Access rights</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="attribute-based-security.html">Attribute Based Access Control (ABAC)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="permissions.html">Permissions on Type definitions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Modelling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="entity-types.html">Entity types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="entity-annotations.html">Entity annotations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="data-types.html">Data types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="system-fields.html">System fields</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="document-types.html">Document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="container-types.html">Container types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="relation-types.html">Relation types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="folder-types.html">Folder types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="metadata-types.html">Metadata types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="inheritance.html">Inheritance</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention-annotations.html">Retention document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tenant-separation.html">Tenant separation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced-schema-changes.html">Advanced database schema changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="repo-service.html">Repository Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-upload-data.html">Upload Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-download-data.html">Download Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-delete-objects.html">Delete Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-locking.html">Locking</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-download-links-external-users.html">Download Links for External Users</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="versioning.html">Versioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="search-service.html">Search language</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="retention-introduction.html">Retention</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention.html">Retention periods</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention-cleanup-job.html">Cleanup job</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SDKs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="client-sdks-json-serialization.html">Client SDKs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="sdk-and-batch-operations.html">Java SDK for Spring applications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="non-spring-sdk.html">Java SDK for non-Spring applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Events and messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="events.html">Events</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="integration-service.html">Enterprise Integration Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archetypes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="slim-archetype.html">The Types archetype</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="full-featured-archetype.html">The full-featured archetype</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="system-tables.html">System Tables</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/compatibility-list.html">Compatibility List</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/release-notes.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/glossary.html">Important Terminology</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">arveo Documentation</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../arveo-general/product-summary.html">arveo Documentation</a></li>
    <li>Developer</li>
    <li>Events and messaging</li>
    <li><a href="integration-service.html">Enterprise Integration Service</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Enterprise Integration Service</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>arveo comes with a custom <a href="https://eitco.github.io/integration-service" target="_blank" rel="noopener">enterprise integration service</a> endpoint.</p>
</div>
<div class="paragraph">
<p>The <em>arveo</em> component resides in the Maven repository at the following coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;de.eitco.ecr&lt;/groupId&gt;
    &lt;artifactId&gt;ecr-integration-service-endpoint&lt;/artifactId&gt;
    &lt;version&gt;18.0.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The component provides access to <em>arveo</em> from Apache Camel. It uses the client SDK, which communicates with <em>arveo</em> over HTTP.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage"><a class="anchor" href="#usage"></a>Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>arveo</em> component provides two Camel endpoints for inclusion in a route. A URL endpoint and a bean endpoint for Groovy scripts.
The URL endpoint&#8217;s URL has the format <code>ecr:typedefinition</code>. Here, 'typedefinition' specifies the name of the type definition where the object should be stored. The URL endpoint can be used for simple create or upload operations. The script endpoint offers more flexibility as it makes it possible to use the entire feature set of the client SDK.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="url_endpoint"><a class="anchor" href="#url_endpoint"></a>URL endpoint</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="document_upload"><a class="anchor" href="#document_upload"></a>Document upload</h3>
<div class="paragraph">
<p>The following example shows a route where a document with the content of a file and an attribute named "filename" is created in <em>arveo</em>. The type definition used is named "files". The content of the file is stored in a content element called "content". At the end of the route the file is copied to another directory.</p>
</div>
<div class="listingblock">
<div class="title">Example of the route to upload a document</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package scripts.routes

import de.eitco.commons.integration.core.ExceptionProcessor
import org.apache.camel.builder.RouteBuilder

return new RouteBuilder() {

    @Override
    void configure() throws Exception {

        onException(Exception.class)
                .process(new ExceptionProcessor())
                .handled(true)
                .maximumRedeliveries(0)

        from("file://directory/input?noop=true")
                .routeId("test-route")
                .setHeader("ecr-attribute:filename", simple('${file:onlyname}'))
                .setHeader("ecr-content-name", constant('content'))
                .to("ecr://files")
                .to("file://directory/output")
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating_a_container_or_metadata_entity"><a class="anchor" href="#creating_a_container_or_metadata_entity"></a>Creating a Container or Metadata Entity</h3>
<div class="paragraph">
<p>In the following example, a container is created in <em>arveo</em>. The container is stored in the type definition "test_containers" and has an attribute named "filename". The creation of meta data entities is done analogously. Which type of object is created in <em>arveo</em> depends only on the type definition used.</p>
</div>
<div class="listingblock">
<div class="title">Example of a route uploading a container</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package scripts.routes

import de.eitco.commons.integration.core.ExceptionProcessor
import org.apache.camel.builder.RouteBuilder

return new RouteBuilder() {

    @Override
    void configure() throws Exception {

        onException(Exception.class)
                .process(new ExceptionProcessor())
                .handled(true)
                .maximumRedeliveries(0)

        from("file://directory/input?noop=true")
                .routeId("test-route")
                .setHeader("ecr-attribute:filename", simple('${file:onlyname}'))
                .to("ecr://test_containers")
                .to("file://directory/output")
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create_relation"><a class="anchor" href="#create_relation"></a>Create relation</h3>
<div class="paragraph">
<p>In the following example, a document and a container are created first. Then a relation is created between the two. Note that after creating or updating an object, the <em>arveo</em> endpoint stores the object in the Camel Exchange as a property so that it can be accessed in the route. In the example, this procedure is used to define the parent and child of the relation to be created. The document, the container and the relation each contain exactly one attribute called "filename".</p>
</div>
<div class="listingblock">
<div class="title">Example of a route creating a relation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package scripts.routes

import de.eitco.commons.integration.core.ExceptionProcessor
import de.eitco.commons.integration.ecr.EcrComponent
import de.eitco.commons.lang.Unsafe
import de.eitco.ecr.common.meta.MetaDataEntity
import de.eitco.ecr.common.search.EcrQueryLanguage
import org.apache.camel.Exchange
import org.apache.camel.Expression
import org.apache.camel.builder.RouteBuilder

return new RouteBuilder() {

    @Override
    void configure() throws Exception {

        onException(Exception.class)
                .process(new ExceptionProcessor())
                .handled(true)
                .maximumRedeliveries(0)

        from("file://test-classes/input?noop=true")
                .routeId("test-route")
                .setHeader("ecr-attribute:filename", simple('${file:onlyname}'))

        // create document
                .setHeader(EcrComponent.HEADER_CONTENT_NAME, constant('content'))
                .to("ecr://test_documents")
                .log("Document created")
                .setHeader(EcrComponent.HEADER_RELATION_CHILD, exchangeProperty(EcrComponent.PROPERTY_ENTITY))

        // create container
                .to("ecr://test_containers")
                .log("Container created")
                .setHeader(EcrComponent.HEADER_RELATION_PARENT, exchangeProperty(EcrComponent.PROPERTY_ENTITY))

        // create relation document -&gt; container
                .to("ecr://test_relation")
                .log("Relation created")

        // create meta entity
                .to("ecr://test_meta_data")
                .log("Meta data entity created.")

        // copy file to output
                .to("file://test-classes/output")
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="update_an_existing_object"><a class="anchor" href="#update_an_existing_object"></a>Update an existing object</h3>
<div class="paragraph">
<p>It is also possible to update existing objects. To do this, you just need to set the "ecr-entity-id" header. It can contain both the ID of an object and an EQL expression. The expression must identify exactly one object. It is important to remove the header after the update, so that later calls of the <em>arveo</em> Enpoint do not access the object again. The expression created in the header is an org.apache.camel.expression. The return value of the evaluate method is a de.eitco.commons.search.api.language.Expression.</p>
</div>
<div class="listingblock">
<div class="title">Example of a route updating an entity</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">...
// update container
        .setHeader("ecr-attribute:filename", constant('updated'))
        .setHeader(EcrComponent.HEADER_ENTITY_ID, exchangeProperty(EcrComponent.PROPERTY_ENTITY))
        .to("ecr://test_containers")
        .log("Container updated")
        .setHeader("ecr-attribute:filename", simple('${file:onlyname}'))
        .removeHeader(EcrComponent.HEADER_ENTITY_ID)

// update meta entity
        .setHeader("ecr-attribute:filename", constant('updated'))
        .setHeader(EcrComponent.HEADER_ENTITY_ID, new Expression() {

            @Override
            def &lt;T&gt; T evaluate(Exchange exchange, Class&lt;T&gt; type) {

                def entity = exchange.getProperty(EcrComponent.PROPERTY_ENTITY, MetaDataEntity.class)
                return Unsafe.cast(EcrQueryLanguage.condition().field("counter").equalTo()
                        .value(entity.getAttributes().get("counter")).holds())
            }
        })
        .to("ecr://test_meta_data")
        .log("Meta data entity updated")</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="script_endpoint"><a class="anchor" href="#script_endpoint"></a>Script endpoint</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to the generic URL endpoint, the <em>arveo</em> component also includes a script endpoint. This endpoint can be used to
run Groovy scripts that use the <em>arveo</em> API. Each script is passed the following variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>typeDefinitionServiceClient</code>: Contains an instance of de.eitco.ecr.sdk.TypeDefinitionServiceClient</p>
</li>
<li>
<p><code>systemManagementClient</code>: Contains an instance of de.eitco.ecr.sdk.SystemManagementClient,</p>
</li>
<li>
<p><code>batchOperationServiceClient</code>: Contains an instance of de.eitco.ecr.sdk.BatchOperationServiceClient,</p>
</li>
<li>
<p><code>searchClient</code>: Contains an instance of de.eitco.ecr.sdk.SearchClient,</p>
</li>
<li>
<p><code>camelExchange</code>: Contains the current org.apache.camel.Exchange</p>
</li>
<li>
<p><code>camelContext</code>: Contains the current org.apache.camel.CamelContext.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The script endpoint can be used in a route like the following example. It provides two methods: execute and voidExecute. The <em>execute</em> method sets the return value of the script as the new body of the current Camel message. The <em>voidExecute</em> method ignores the return value of the script. The endpoint consists of a bean called <em>ecrScriptWrapper</em> that is able to execute Groovy scripts that perform the actual interaction with the <em>arveo</em> service.</p>
</div>
<div class="listingblock">
<div class="title">Example of a route using a script endpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package scripts.routes

import de.eitco.commons.integration.core.ExceptionProcessor
import org.apache.camel.builder.RouteBuilder

...
return new RouteBuilder() {

    @Override
    void configure() throws Exception {

        onException(Exception.class)
                .process(new ExceptionProcessor())
                .handled(true)
                .maximumRedeliveries(0)

        from("file://test-classes/input?noop=true")
                .routeId("test-route")
                .to("bean://ecrScriptWrapper?method=voidExecute('common/EcrScript.groovy')")
                .to("file://test-classes/output")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script used in the example creates a new document with the contents of the read file. The return value of the script is a DocumentClient for the new document:</p>
</div>
<div class="listingblock">
<div class="title">Example of a script being used by the route described above</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package scripts.common

import de.eitco.commons.integration.ecr.EcrProducer
import de.eitco.ecr.common.document.DocumentInput
import de.eitco.ecr.sdk.TypeDefinitionServiceClient
import org.apache.camel.Exchange
import org.apache.camel.component.file.GenericFile

LOG.info("ecr script started...")

TypeDefinitionServiceClient typeServiceClient = typeDefinitionServiceClient
Exchange exchange = camelExchange

def serviceClient = typeServiceClient.getDocumentServiceClient().byName("test_documents2")

def documentInput = new DocumentInput(
Map.of("filename", ((GenericFile) exchange.getIn().getBody()).fileNameOnly),
Map.of("content", EcrProducer.getContentUploadFromBody(exchange.getIn().getBody())))
)

serviceClient.create(documentInput)</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="authentication"><a class="anchor" href="#authentication"></a>Authentication</h3>
<div class="paragraph">
<p>The arveo endpoint can log into the ECR using either OAuth2 or x509.</p>
</div>
<div class="sect3">
<h4 id="oauth2"><a class="anchor" href="#oauth2"></a>Oauth2</h4>
<div class="paragraph">
<p>Using OAuth2, the ECR endpoint logs in to the <em>arveo</em> as a concrete user. The user&#8217;s credentials must be specified in the integration service configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ecr-endpoint:
  oauth2:
    user-name: "username"
    password: "password"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, the Spring Security OAuth2 framework used must be configured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  security:
    oauth2:
      client:
        registration:
          keycloak-password:
            provider: keycloak
            client-id: "testclient"
            client-secret: "yx7n6di3kXZ4p3Kj2oY1Js9NW7hbOCjh"
            authorization-grant-type: "password"
            scope: openid
        provider:
          keycloak:
            issuer-uri: "http://localhost:8180/realms/TestRealm"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="x509"><a class="anchor" href="#x509"></a>x509</h4>
<div class="paragraph">
<p>For x509, the certificate to be used by the HTTP client must be configured. Since Oauth2 is the default, it must be turned off and x509 must be turned on:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spring:
  security:
    oauth2:
      client:
        enabled: false

security:
  x509:
    client:
      enabled: true

http:
  client:
    ssl:
      key-store: /path/service-user.p12
      key-store-type: PKCS12
      key-store-password: changeit
      client-auth: true</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="events.html">Events</a></span>
  <span class="next"><a href="slim-archetype.html">The Types archetype</a></span>
</nav>
</article>
  </div>
</main>
    <!-- The Modal -->
    <div id="imageModalBox" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01">
        <div id="caption"></div>
    </div>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../ui-assets/js/site.js" data-ui-root-path="../../ui-assets"></script>
<script async src="../../ui-assets/js/vendor/highlight.js"></script>
<script async src="../../ui-assets/js/modal.js"></script>
<script src="../../ui-assets/js/vendor/lunr.js"></script>
<script src="../../ui-assets/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../ui-assets/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
