<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Foreign keys :: arveo Documentation</title>
    <link rel="canonical" href="https://eitco.github.io/arveo-docu/arveo-developer/foreign-keys.html">
    <meta name="generator" content="Antora 3.2.0-alpha.4">
    <link rel="stylesheet" href="../../ui-assets/css/site.css">
    <link rel="stylesheet" href="../../ui-assets/css/custom.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand"> 
      <img src="../../ui-assets/img/arveo_WortBildmarke_NEG_500px.png" id="arveoLogo" style="vertical-align:middle;margin:10px 0px">
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://eitco.github.io">Home</a>
        <!--<div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>-->
        <!--<div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>-->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="arveo-docu" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-general/product-summary.html">What is <em>arveo</em> - Content Services Platform (CSP)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Architecture Overview</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/content-services.html">Content Services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/technology-stack.html">Opensource Technology Stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/application-security.html">Application security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/gobd.html">Compliance recommendations (GoBD)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Store</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-storage.html">Persistence architecture</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-deletion.html">Data deletion</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-getting-started/getting-started.html">Getting Started</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration und Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-administration/installation.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/deployment-options.html">Deployment options</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/system-requirements.html">System requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/authentication-oauth2.html">OAuth Authentication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/db-access.html">Database access</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/content-elements-storage.html">Storage locations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/renditions.html">Renditions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/retention-container.html">Retention and Storage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/encryption.html">Encryption</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/messaging.html">Configure Active MQ</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/maintenance-mode-db-schema.html">Maintenance mode for the database schema</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/audit.html">Audit</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/solr.html">Solr</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/jobs.html">System jobs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/vault.html">Using Hashicorp Vault</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../commons/configuration-properties.html">Configuration Properties</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../arveo-administration/monitoring.html">Monitoring</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Developer</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Access Control</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="access-rights.html">Access rights</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="attribute-based-security.html">Attribute Based Access Control (ABAC)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="permissions.html">Permissions on Type definitions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Modelling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="entity-types.html">Entity types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="entity-annotations.html">Entity annotations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="data-types.html">Data types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="system-fields.html">System fields</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="document-types.html">Document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="container-types.html">Container types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="relation-types.html">Relation types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="folder-types.html">Folder types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="metadata-types.html">Metadata types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="inheritance.html">Inheritance</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention-annotations.html">Retention document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tenant-separation.html">Tenant separation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced-schema-changes.html">Advanced database schema changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="repo-service.html">Repository Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-upload-data.html">Upload Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-download-data.html">Download Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-delete-objects.html">Delete Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-locking.html">Locking</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-download-links-external-users.html">Download Links for External Users</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="versioning.html">Versioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="search-service.html">Search language</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="retention-introduction.html">Retention</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention.html">Retention periods</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention-cleanup-job.html">Cleanup job</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SDKs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="client-sdks-json-serialization.html">Client SDKs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="sdk-and-batch-operations.html">Java SDK for Spring applications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="non-spring-sdk.html">Java SDK for non-Spring applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Events and messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="events.html">Events</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-service.html">Enterprise Integration Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archetypes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="slim-archetype.html">The Types archetype</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="full-featured-archetype.html">The full-featured archetype</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="system-tables.html">System Tables</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/compatibility-list.html">Compatibility List</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/release-notes.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/glossary.html">Important Terminology</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">arveo Documentation</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../arveo-general/product-summary.html">arveo Documentation</a></li>
    <li><a href="foreign-keys.html">Foreign keys</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Foreign keys</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The following chapter provides a detailed overview about the foreign key feature using a simple example scenario that implements an employee file.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example_scenario"><a class="anchor" href="#example_scenario"></a>Example scenario</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following diagram shows the data model of the example scenario:</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="_images/27d22f94bf9f2ddaebbb87d239bd4b66e2d78338.svg" alt="foreign-key-example-model">
</div>
<div class="title">Figure 1. Data model of the example</div>
</div>
<div class="paragraph">
<p>The scenario contains two type definitions. The <code>EmployeeFile</code> definition is a container type holding the metadata of the employee. The <code>EmployeeDocument</code> is a document type that contains documents related to the employee, like a curriculum vitae. The following code snippets show the two type definitions:</p>
</div>
<div class="listingblock">
<div class="title">The EmployeeFile type definiton</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Type(ObjectType.CONTAINER)
@RecycleBin <i class="conum" data-value="1"></i><b>(1)</b>
public interface EmployeeFile {

    @SystemProperty(SystemPropertyName.ID)
    ContainerId getEmployeeId();

    @Mandatory
    @Unique
    String getName();

    void setName(String name);

    LocalDate getBirthday();

    void setBirthday(LocalDate date);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">The EmployeeDocument Type definiton</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Type(ObjectType.DOCUMENT)
@RecycleBin <i class="conum" data-value="1"></i><b>(1)</b>
public interface EmployeeDocument {

    @ForeignKey(target = EmployeeFile.class, targetProperty = "id")
    @ReadOnly
    @CascadeDelete <i class="conum" data-value="2"></i><b>(2)</b>
    ContainerId getEmployeeId(); <i class="conum" data-value="3"></i><b>(3)</b>

    void setEmployeeId(ContainerId employeeFileId);

    @Optional
    String getDescription();

    void setDescription(String description);

    @SystemProperty(SystemPropertyName.ID)
    DocumentId getDocumentId();

    @SystemProperty(SystemPropertyName.CONTENT)
    Map&lt;String, ContentInformation&gt; getContentInformation();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables the recycle bin feature</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Enables cascading delete and recycle operations</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The attribute defining the foreign key relation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The foreign key relation between the two type definitions is defined by adding an attribute called <em>employee_id</em> to the EmployeeDocument type. The attribute is annotated with <code>@ForeignKey</code>, defining the target type and the target attribute of the foreign key that will be created on the database. The target type is defined by the class name of the referenced type definition. The target attribute has to be defined by name. As a foreign key target attribute must be a unique key, the system attribute <em>id</em> of the EmployeeFile type is the obvious choice. The data type of the attribute must be compatible to the refrenced attribute. For the ID system property, both the typed ID classes like <code>ContainerId</code> or
the raw type of the ID value (<code>long</code>) can be used.</p>
</div>
<div class="paragraph">
<p>The foreign key attribute <em>employee_id</em> is annotated with <code>@CascadeDelete</code>, which will cause all documents referenced by one employee file to be deleted automatically when the employee file is deleted.</p>
</div>
<div class="paragraph">
<p>The <em>employee_id</em> attribute is annotated with <code>@ReadOnly</code>, too. This means that the employee ID must be set when a new EmployeeDocument is created and that it cannot be changed by subsequent update calls on the entity.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="foreign_keys_with_cascade_delete"><a class="anchor" href="#foreign_keys_with_cascade_delete"></a>Foreign keys with cascade delete</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the <code>@CascadeDelete</code> annotation it is possible to enable cascading deletes for entities referenced by foreign
keys. A cascading delete will delete the entity with the foreign key, when the referenced entity is deleted.</p>
</div>
<div class="paragraph">
<p>Foreign keys with cascading delete cannot be used in type definitions that support retention.
Also, no delete event will be fired when an entity is deleted by a cascading delete operation.</p>
</div>
<div class="paragraph">
<p>When the recycle bin feature is used, the entity moved to the recycle bin is not actually deleted. Therefore, no cascading deletes will be performed in this case until the entity is actually deleted.
However, entities referencing an entity that is moved to the recycle bin will be moved to the recycle bin, too. This of course will only happen when the type definition containing the referencing entities supports the recycle bin feature.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating_a_new_employee_file"><a class="anchor" href="#creating_a_new_employee_file"></a>Creating a new Employee file</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following code snipped shows how to create a new employee file entity.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <em>TypeDefinitionServiceClient</em> and <em>BatchOperationServiceClient</em> instances used in the examples can be obtained
using dependency injection.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Creating a new Employee file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        TypedContainerServiceClient&lt;EmployeeFile&gt; employeeFileServiceClient =
            typeDefinitionServiceClient.getContainerServiceClient().byClass(EmployeeFile.class); <i class="conum" data-value="1"></i><b>(1)</b>

        EmployeeFile employeeFile = employeeFileServiceClient.createTypeInstance(); <i class="conum" data-value="2"></i><b>(2)</b>
        employeeFile.setName("Carl Carlson");
        employeeFile.setBirthday(LocalDate.of(1985, 10, 7));

        TypedContainerClient&lt;EmployeeFile&gt; employeeClient = employeeFileServiceClient.createEntity(employeeFile); <i class="conum" data-value="3"></i><b>(3)</b>

        TypedDocumentServiceClient&lt;EmployeeDocument&gt; documentServiceClient =
            typeDefinitionServiceClient.getDocumentServiceClient().byClass(EmployeeDocument.class); <i class="conum" data-value="4"></i><b>(4)</b>

        EmployeeDocument document = documentServiceClient.createTypeInstance(); <i class="conum" data-value="5"></i><b>(5)</b>
        document.setEmployeeId(employeeClient.getIdentifier()); <i class="conum" data-value="6"></i><b>(6)</b>
        document.setDescription("Curriculum Vitae");
        ContentUpload upload = new ContentUpload("curriculum_vitae.docx", null, null, inputStream); <i class="conum" data-value="7"></i><b>(7)</b>
        TypedDocumentInput&lt;EmployeeDocument&gt; input = new TypedDocumentInput&lt;&gt;(Map.of("content", upload), document);

        documentServiceClient.create(input); <i class="conum" data-value="8"></i><b>(8)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtain a service client for the EmployeeFile type definition</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create the entity and add metadata</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Save the EmployeeFile and get a client for the new entity</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Obtain a service client for the EmployeeDocument type definition</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Create the document entity and add metadata</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Set the value of the foreign key attribute to link the document to the employee file</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Create a ContentUpload for the actual document content</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Save the document</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="loading_an_employee_file_and_all_related_documents"><a class="anchor" href="#loading_an_employee_file_and_all_related_documents"></a>Loading an employee file and all related documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following code snippet shows how to load an employee file by searching for the employee&#8217;s name and how to list all
documents related to the file.</p>
</div>
<div class="listingblock">
<div class="title">Loading an Employee file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        TypedContainerServiceClient&lt;EmployeeFile&gt; employeeFileServiceClient =
            typeDefinitionServiceClient.getContainerServiceClient().byClass(EmployeeFile.class); <i class="conum" data-value="1"></i><b>(1)</b>

        Optional&lt;TypedContainerClient&lt;EmployeeFile&gt;&gt; clients =
            employeeFileServiceClient.where().entity().field(EmployeeFileNames.NAME).equalTo().value("Carl Carlson")
                .holds().uniqueResult(); <i class="conum" data-value="2"></i><b>(2)</b>

        EmployeeFile employeeFile = clients.get().getEntity();

        TypedDocumentServiceClient&lt;EmployeeDocument&gt; documentServiceClient =
            typeDefinitionServiceClient.getDocumentServiceClient().byClass(EmployeeDocument.class); <i class="conum" data-value="3"></i><b>(3)</b>

        List&lt;TypedDocumentClient&lt;EmployeeDocument&gt;&gt; documentClients =
            documentServiceClient.where().entity().field(EmployeeDocumentNames.EMPLOYEE_ID)
                .equalTo().value(employeeFile.getEmployeeId()).holds().unpaged(); <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtain a service client for the EmployeeFile type definition</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Search for the file using the employee&#8217;s name</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Obtain a service client for the EmployeeDocument type definition</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>List all documents that are related to the employee file</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the query for the documents in the above example is using the <code>EMPLOYEE_ID</code> constant from the class
<code>EmployeeDocumentNames</code>. This class is automatically created when the type definition classes are compiled.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating_a_file_with_a_document_in_one_transaction"><a class="anchor" href="#creating_a_file_with_a_document_in_one_transaction"></a>Creating a file with a document in one transaction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the batch API it is possible to create an EmployeeFile and a related EmployeeDocument in one transaction. The following code snippet shows how the batch API can be used to do that.</p>
</div>
<div class="listingblock">
<div class="title">Creating a file in one transaction</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        TypedContainerServiceClient&lt;EmployeeFile&gt; employeeFileServiceClient =
            typeDefinitionServiceClient.getContainerServiceClient().byClass(EmployeeFile.class); <i class="conum" data-value="1"></i><b>(1)</b>

        EmployeeFile employeeFile = employeeFileServiceClient.createTypeInstance(); <i class="conum" data-value="2"></i><b>(2)</b>
        employeeFile.setName("Waylon Smithers");
        employeeFile.setBirthday(LocalDate.of(1985, 10, 7));

        TypedContainerBatchCreateInput&lt;EmployeeFile&gt; fileInput =
            new TypedContainerBatchCreateInput&lt;&gt;(new TypedContainerInput&lt;&gt;(employeeFile), List.of()); <i class="conum" data-value="3"></i><b>(3)</b>

        TypedDocumentServiceClient&lt;EmployeeDocument&gt; documentServiceClient =
            typeDefinitionServiceClient.getDocumentServiceClient().byClass(EmployeeDocument.class); <i class="conum" data-value="4"></i><b>(4)</b>

        EmployeeDocument document = documentServiceClient.createTypeInstance(); <i class="conum" data-value="5"></i><b>(5)</b>
        document.setDescription("Curriculum Vitae");
        ContentUpload upload = new ContentUpload("curriculum_vitae.docx", null, null, inputStream); <i class="conum" data-value="6"></i><b>(6)</b>

        final TypedDocumentBatchCreateInput&lt;EmployeeDocument&gt; documentInput = new TypedDocumentBatchCreateInput&lt;&gt;( <i class="conum" data-value="7"></i><b>(7)</b>
            new TypedDocumentInput&lt;&gt;(Map.of("content", upload), document), <i class="conum" data-value="8"></i><b>(8)</b>
            List.of(
                new BatchAttributeReference( <i class="conum" data-value="9"></i><b>(9)</b>
                    EmployeeDocumentNames.EMPLOYEE_ID,
                    SystemFieldList.GeneralSystemField.Id.INSTANCE.getName(),
                    fileInput.getVirtualIdentifier().getUuid() <i class="conum" data-value="10"></i><b>(10)</b>
                )
            )
        );

        batchOperationServiceClient.createTypedEntities(fileInput, documentInput); <i class="conum" data-value="11"></i><b>(11)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtain a service client for the EmployeeFile type definition</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create the entity and add metadata</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create the batch input object that will create the EmployeeFile entity</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Obtain a service client for the EmployeeFile type definition</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Create the document entity and add metadata</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Create a ContentUpload for the actual document content</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Create the batch input that will create the EmployeeDocument entity</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Create the regular typed document input holding the metadata and the content</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Use a BatchAttributeReference to set the <em>EMPLOYEE_ID</em> attribute to the value of the system attribute <em>ID</em> of the EmployeeFile entity</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>The virtual identifier of the batch create input created in step 3 is used to reference the created entity</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Perform the batch operation. Note that the order of the entities is important here.</td>
</tr>
</table>
</div>
</div>
</div>
</article>
  </div>
</main>
    <!-- The Modal -->
    <div id="imageModalBox" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01">
        <div id="caption"></div>
    </div>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../ui-assets/js/site.js" data-ui-root-path="../../ui-assets"></script>
<script async src="../../ui-assets/js/vendor/highlight.js"></script>
<script async src="../../ui-assets/js/modal.js"></script>
<script src="../../ui-assets/js/vendor/lunr.js"></script>
<script src="../../ui-assets/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../ui-assets/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
