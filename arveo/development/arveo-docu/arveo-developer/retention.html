<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Retention periods :: arveo Documentation</title>
    <link rel="canonical" href="https://eitco.github.io/arveo-docu/arveo-developer/retention.html">
    <link rel="prev" href="search-service.html">
    <link rel="next" href="client-sdks-json-serialization.html">
    <meta name="generator" content="Antora 3.2.0-alpha.4">
    <link rel="stylesheet" href="../../ui-assets/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand"> 
      <img src="../../ui-assets/img/eitco_logo.png">
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://eitco.github.io">Home</a>
        <!--<div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>-->
        <!--<div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>-->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="arveo-docu" data-version="master">
  <aside class="nav">
    <div class="panels">      
      <img src="../../ui-assets/img/arveo_logo_transperent_black.png">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-general/product-summary.html">What is <em>arveo</em>?</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Architecture Overview</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/content-services.html">Content Services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/technology-stack.html">Technologie Stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/application-security.html">Application security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/gobd.html">Compliance recommendations (GoBD)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Store</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-storage.html">Persistence architecture</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-deletion.html">Data deletion</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-getting-started/getting-started.html">Getting Started</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration und Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-administration/installation.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/deployment-options.html">Deployment options</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/system-requirements.html">System requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/authentication-oauth2.html">OAuth Authentication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/db-access.html">Database access</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/content-elements-storage.html">Storage locations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/renditions.html">Renditions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/retention-container.html">Retention Container</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/encryption.html">Encryption</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/messaging.html">Configure Active MQ</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/maintenance-mode-db-schema.html">Maintenance mode for the database schema</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/audit.html">Audit</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/solr.html">Solr</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/jobs.html">System jobs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/vault.html">Using Hashicorp Vault</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../commons/configuration-properties.html">Configuration Properties</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../arveo-administration/monitoring.html">Monitoring</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Developer</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Access Control</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="access-rights.html">Access rights</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="attribute-based-security.html">Attribute Based Access Control (ABAC)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="permissions.html">Permissions on Type definitions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Modelling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="entity-types.html">Entity types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="entity-annotations.html">Entity annotations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="data-types.html">Data types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="system-fields.html">System fields</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="document-types.html">Document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="container-types.html">Container types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="relation-types.html">Relation types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="folder-types.html">Folder types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="metadata-types.html">Metadata types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="inheritance.html">Inheritance</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention-annotations.html">Retention document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tenant-separation.html">Tenant separation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced-schema-changes.html">Advanced database schema changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Repository Service</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-upload-data.html">Upload Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-download-data.html">Download Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-delete-objects.html">Delete Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-locking.html">Locking</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-download-links-external-users.html">Download Links for External Users</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="versioning.html">Versioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="search-service.html">Search language</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="retention.html">Retention periods</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SDKs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="client-sdks-json-serialization.html">Client SDKs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="sdk-and-batch-operations.html">Java SDK for Spring applications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="non-spring-sdk.html">Java SDK for non-Spring applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Events and messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="events.html">Events</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-service.html">Enterprise Integration Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archetypes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="slim-archetype.html">The Types archetype</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="full-featured-archetype.html">The full-featured archetype</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="system-tables.html">System Tables</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/compatibility-list.html">Compatibility List</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/release-notes.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/glossary.html">Important Terminology</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">arveo Documentation</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../arveo-general/product-summary.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../arveo-general/product-summary.html">arveo Documentation</a></li>
    <li>Developer</li>
    <li>Repository Service</li>
    <li><a href="retention.html">Retention periods</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Retention periods</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>arveo</em> supports a range of retention management features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Full support of document life cycle;</p>
</li>
<li>
<p>Supports prolongation and litigation hold for data retention managers;</p>
</li>
<li>
<p>Privileged delete before retention expires;</p>
</li>
<li>
<p>Privileges for data protection officers (delete) and data protection managers (litigation);</p>
</li>
<li>
<p>Flexible storage container definition (e.g. months, years) for documents with identical retention period
(S3 buckets or file system folders);</p>
</li>
<li>
<p>Fast erasure of storage container by asynchronous delete jobs.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="concept"><a class="anchor" href="#concept"></a>Concept</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>arveo</em> is able to store content with a fixed retention date to ensure that the legal or tax relevant
retention period of a document is taken into account and the content is protected from deletion.
You can configure retention rules for <em>arveo</em> document types and automatically apply the appropriate retention
period to uploaded documents.</p>
</div>
<div class="paragraph">
<p>If some of your documents could be required in a legal proceeding but the retention period expires before
the end of dispute you can set a litigation hold or prolong the retention period to protect the data until the
dispute has finished.</p>
</div>
<div class="paragraph">
<p>Let us describe why the storage container concept is used by <em>arveo</em>. Most storage systems can create objects much faster than
they can delete them. Once the retention has expired it is
much faster to remove a bucket (cloud storage) or partition/directory (file system).
You can setup retention rules to define which documents are stored to the containers. All documents within a certain
retention range (e.g. 1 year or 3 months) will be stored to one storage container (S3 bucket or directory).
<em>arveo</em> allows you to delete millions of content objects in a very short time by simply removing the entire storage
container.</p>
</div>
<div class="paragraph">
<p>If a document needs to be deleted e.g. for data privacy reasons, <em>arveo</em> also provides an API call to erase single objects by their ID.
If you want to delete an object before its retention period has expired the user needs along with <em>delete_right</em> also the
<em>dataprivacy_admin</em> privilege.</p>
</div>
<div class="paragraph">
<p>Because the new legal data privacy / protection act makes it necessary to erase data even before the expected retention
period has expired <em>arveo</em> does not use hardware retention features, which protect data from erasure on the hardware level.
<em>arveo</em> protects the content by software design. <em>arveo</em> stores the retention information in the database and only allows access
to the content and metadata by the <em>arveo</em> REST API. The REST API prevents any delete operation before the retention period
has expired.
As only <em>arveo</em> and highly authorized administrators have data writer rights for the database and the storage it is impossible
that content be deleted or manipulated before the retention expires.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The operator must take appropriate technical or organizational measures to ensure that the data is stored in the storage in such a way that it cannot be changed within the legally prescribed retention period.<br>
The provider of the <em>arveo</em> services should ensure that only authorized data protection officers &amp; administrators have data
write (INSERT,UPDTAE; DELETE) permissions for the database and the content repository.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="storage_container_and_document_life_cycle"><a class="anchor" href="#storage_container_and_document_life_cycle"></a>Storage container and document life cycle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since deleting large amounts of documents is a performance critical task, the <em>arveo</em> repository service provides special
support for mass deletion of documents whose retention period has expired.</p>
</div>
<div class="paragraph">
<p>The basic idea is to define separate storage locations, which are exclusively used to store documents with similar
retention requirements. The deletion of documents with specific retention requirements is then a matter of deleting
all contents of a specific storage location in one step. Storage locations containing documents with the same retention
period will be called storage container for the rest of this section.</p>
</div>
<div class="paragraph">
<p><em>arveo</em> allows you to store data with the same retention in one storage container and is able to create storage containers
automatically.</p>
</div>
<div class="paragraph">
<p>The storage containers are either folders (file system storage) or buckets (S3 object storage).
The actual selection of the storage container for a document with specific retention requirements can be configured by
rules, that select the storage container based on the retention period and litigation hold status of the uploaded document.</p>
</div>
<div class="paragraph">
<p>When the litigation hold is set, the object is moved to the litigation hold directory or bucket and will not be deleted
when the initial retention period expires.
When the litigation hold ends, the document is deleted the next time a delete job runs. The number of objects under litigation
hold is typically small and does not affect the overall erasure performance.</p>
</div>
<div class="paragraph">
<p>When a litigation hold is removed, the objects are moved to other storage container which do not have a litigationHold on them.</p>
</div>
<div class="paragraph">
<p>The following diagram shows the life cycle of a document with a fixed retention period set on upload, a legal dispute and automatic erasure at the end of the document&#8217;s life cycle:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/arveo_infografik_dokument-lebenszyklus-gruen.png" alt="*Retention in Buckets*">
</div>
<div class="title">Figure 1. Retention in buckets</div>
</div>
<div class="paragraph">
<p>Each storage container in fact corresponds to a separate storage profile that is used to store the contents of that storage container.
The rules that are used to map the retention requirements of documents to storage container are defined as rules for the
Bucket Organizer Plugin, see <a href="../arveo-administration/content-elements-storage.html#_bucketorganizer" class="xref page">Bucketorganizer</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="litigation_hold"><a class="anchor" href="#litigation_hold"></a>Litigation hold</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>arveo</em> provides a system property <em>LITIGATION_HOLD</em> that allows you to prolong the retention
until you remove the litigation hold property.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
This function requires the <em>DATAPRIVACY_ADMIN</em> privilege.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prolongation"><a class="anchor" href="#prolongation"></a>Prolongation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can prolong the retention period but not shorten it. You can use the API call to set the initial retention period if
the retention is null.
When the retention is prolonged, <em>arveo</em> moves the object to the appropriate storage container.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
This function requires the <em>DATAPRIVACY_ADMIN</em> privilege.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="erase_a_document"><a class="anchor" href="#erase_a_document"></a>Erase a document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>arveo</em> delete API will as for all other objects without a retention period delete the respective objects. See also
<a href="../arveo-general/data-deletion.html#_recycle_bin" class="xref page">Deletion of objects</a> and <a href="../arveo-general/data-deletion.html#_recovery_log" class="xref page">Recovery table</a>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
After the retention period has expired, the function requires the <em>DELETE</em> privilege, but
before the retention period has expired, <em>DATAPRIVACY_PRIVILEGED_DELETE</em> privilege is required.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This API should not be used for operations like deleting the objects of a certain year. This should be done using the erasure
storage container API.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="erase_storage_container"><a class="anchor" href="#erase_storage_container"></a>Erase storage container</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have used the storage container feature to speed up the deletion of documents at the end of their life cycle, you
can delete all documents within a retention period range with one API REST call 'EraseStorageContainer'.</p>
</div>
<div class="paragraph">
<p>You can either erase the storage container (buckets, folders) controlled by your operating team or with an automated <em>arveo</em> job.
You can set up a scheduled job in the <em>arveo</em> integration service. Use the erasure storage container template job and adopt it to your needs.
The erasure job will delete all entities of a document type within the given retention period range where litigation hold is <strong>not</strong> set.
The job will write an entry for each erased object in the corresponding audit log table.
For more detailed explanation, see the erasure job template example.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Mass deletion of documents under retention requires the <em>SUPER_USER</em> privilege.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Enable the audit log feature for all document types and dependent document types if you need a report of the erased objects.
<a href="../arveo-administration#_configure_audit">Audit Log</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Grant the deletion right for your storage containers to <em>arveo</em>. If <em>arveo</em> cannot delete the containers, your operating team is
in charge of this task and you must set the option <em>delete rows only</em>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="privileges_roles"><a class="anchor" href="#privileges_roles"></a>Privileges &amp; roles</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Privilege</th>
<th class="tableblock halign-left valign-top"><em>DATAPRIVACY_ADMIN</em> (Data Protection Manager)</th>
<th class="tableblock halign-left valign-top"><em>DATAPRIVACY_PRIVILEGED_DELETE</em> (Data Protection Officer)</th>
<th class="tableblock halign-left valign-top">SUPER_USER (Data Protection Administrator)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prolongation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Litigation Hold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete before retention</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mass Delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="create_document_with_retention_and_set_litigation_hold"><a class="anchor" href="#create_document_with_retention_and_set_litigation_hold"></a>Create document with retention and set litigation hold</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void createDocumentWithRetention() throws IOException {

    final String TEST_IDENTIFIER = "SetLitigationHold test timestamp in ms=";
    final String TEST_DATA = "abcde";
    final String TEST_DATA_MIMETYPE = MediaType.APPLICATION_OCTET_STREAM_VALUE;

    TypedDocumentServiceClient&lt;DocumentWithRetention&gt; serviceClient =
            typeDefinitionServiceClient.getDocumentServiceClient().byClass(DocumentWithRetention.class);
    ZonedDateTime now = ZonedDateTime.now(ZoneOffset.UTC);

    DocumentWithRetention newDocument = serviceClient.createTypeInstance();
    newDocument.setName(TEST_IDENTIFIER + System.currentTimeMillis());
    newDocument.setReceiptDate(now );
    newDocument.setMimeType(TEST_DATA_MIMETYPE);
    newDocument.setRetentionDate(now);

    ByteArrayInputStream data = new ByteArrayInputStream(TEST_DATA.getBytes());

    Map&lt;String, ContentUpload&gt; content = Map.of("content", new ContentUpload(data));

    TypedDocumentClient&lt;DocumentWithRetention&gt; newClient = serviceClient.create(new TypedDocumentInput&lt;&gt;(content, newDocument));

    Assert.assertEquals(IOUtils.toByteArray(newClient.readContent("content")), TEST_DATA.getBytes());
    DocumentWithRetention loadedDocument = newClient.getEntity();

    Assert.assertNotNull(loadedDocument);
    Assert.assertTrue(loadedDocument.getName().startsWith(TEST_IDENTIFIER));
    Assert.assertEquals(loadedDocument.getMimeType(), TEST_DATA_MIMETYPE);

    assertDateEquals( loadedDocument.getReceiptDate(), now);
    assertDateEquals(loadedDocument.getRetentionInformation().getRetentionDate(), now);
    Assert.assertFalse(loadedDocument.getRetentionInformation().isLitigationHold());

    // set LitigationHold = true
    newClient.updateLitigationHold(true);
    newClient = newClient.reload();
    DocumentWithRetention litigationOnDocument = newClient.getEntity();
    Assert.assertTrue(litigationOnDocument.getRetentionInformation().isLitigationHold());

    // set LitigationHold = false)
    newClient.updateLitigationHold(false);
    newClient = newClient.reload();
    DocumentWithRetention litigationOffDocument = newClient.getEntity();
    Assert.assertFalse(litigationOffDocument.getRetentionInformation().isLitigationHold());

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="set_retention_prolong_retention"><a class="anchor" href="#set_retention_prolong_retention"></a>Set retention / prolong retention</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void createDocumentWithoutRetention() throws IOException {

    final String TEST_IDENTIFIER = "SetRetention test timestamp in ms=";
    final String TEST_DATA = "abcde";
    final String TEST_DATA_MIMETYPE = MediaType.APPLICATION_OCTET_STREAM_VALUE;

    TypedDocumentServiceClient&lt;DocumentWithRetention&gt; serviceClient =
            typeDefinitionServiceClient.getDocumentServiceClient().byClass(DocumentWithRetention.class);
    // store document without retention
    DocumentWithRetention newDocument = serviceClient.createTypeInstance();
    newDocument.setName(TEST_IDENTIFIER + System.currentTimeMillis());
    newDocument.setReceiptDate(ZonedDateTime.now());
    newDocument.setMimeType(TEST_DATA_MIMETYPE);

    ByteArrayInputStream data = new ByteArrayInputStream(TEST_DATA.getBytes());

    Map&lt;String, ContentUpload&gt; content = Map.of("content", new ContentUpload(data));

    TypedDocumentClient&lt;DocumentWithRetention&gt; newClient = serviceClient.create(new TypedDocumentInput&lt;&gt;(content, newDocument));

    Assert.assertEquals(IOUtils.toByteArray(newClient.readContent("content")), TEST_DATA.getBytes());
    DocumentWithRetention emptyRetentionDocument = newClient.getEntity();

    RetentionInformation retentionInformation = emptyRetentionDocument.getRetentionInformation();
    Assert.assertNotNull(retentionInformation);
    Assert.assertNull(retentionInformation.getRetentionDate());
    Assert.assertFalse(retentionInformation.isLitigationHold());

    // set initial retention
    ZonedDateTime initialRetentionDate = ZonedDateTime.now();
    emptyRetentionDocument.setRetentionDate(initialRetentionDate);
    TypedDocumentClient&lt;DocumentWithRetention&gt; initialRetentionClient = newClient.updateAttributes(emptyRetentionDocument);
    DocumentWithRetention initialRetentionDocument = initialRetentionClient.getEntity();
    assertDateEquals(initialRetentionDocument.getRetentionInformation().getRetentionDate(), initialRetentionDate);

    // prolong retention
    ZonedDateTime prolongedRetentionDate = ZonedDateTime.of(2050, 1, 1, 0, 0, 0, 0, ZoneId.of("Europe/Berlin"));
    initialRetentionDocument.setRetentionDate(prolongedRetentionDate);
    TypedDocumentClient&lt;DocumentWithRetention&gt; prolongedRetentionClient = initialRetentionClient.updateAttributes(initialRetentionDocument);
    DocumentWithRetention prolongedRetentionDocument = prolongedRetentionClient.getEntity();
    assertDateEquals(prolongedRetentionDocument.getRetentionInformation().getRetentionDate(), prolongedRetentionDate);

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="retention_cleanup_job"><a class="anchor" href="#retention_cleanup_job"></a>Retention cleanup job</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The retention cleanup job can be used to remove entities with an expired retention period that are not currently in
litigation hold status. The job can be triggered to run in the internal job scheduler of the repository service or in
a separate instance of the job service. It expects two configuration parameters to be present in the job context of the
triggered execution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>type-definition-name</code>: The name of the type definition that contains the entities to remove.</p>
</li>
<li>
<p><code>retention-cleanup-retention-end-time</code>: The time at which the rentention period has expired. All entities with a
retention period that has expired before the specified time will be removed. The specified time must be in the past.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following optional properties can be set in the context of the triggered execution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>retention-cleanup-asynchronous</code>: Enables the asynchronous mode of the job. The asynchronous mode is described below.</p>
</li>
<li>
<p><code>retention-cleanup-batch-size</code>: The size of a single batch of entities to process. The default is 1000 and the maximum is 10000.</p>
</li>
<li>
<p><code>retention-cleanup-filter</code>: An optional filter in form of an EQL <code>Expression&lt;Boolean&gt;</code> to apply to the query used to find
entities with expired retention period.</p>
</li>
<li>
<p><code>retention-cleanup-maximum-queue-size</code>: The maximum acceptable size of the message queue used by the job in asynchronous mode. If the queue
size exceeds the configured maximum, the job will stop. The job will check the queue size once a minute.</p>
</li>
<li>
<p><code>retention-cleanup-duration</code>: An optional maximum duration of the job&#8217;s runtime. If the duration is exceeded, the job
will stop. The default is null (no limit). The value must be a <code>java.time.Duration</code>.</p>
</li>
<li>
<p><code>retention-cleanup-max-entity-count</code>: The maximum number of entities to process. If this number is reached, the job
will stop. The default is -1 (no limit).</p>
</li>
<li>
<p><code>retention-cleanup-protocol-file</code>: Optional property that can contain a fully qualified path to a file that will
contain a list of all deleted entity IDs.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>retention-cleanup-maximum-queue-size</code> limitation mechanism relies on statistics data for the JMS queues that is
collected by a separate system job. This job is not enabled by default and must be enabled using the property
<code>ecr.server.jobs.jms-statistics.enabled=true</code> to use this feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All properties except the type definition name, the retention end time and the protocol file can be configured in the
configuration file of the service either globally or for each type definition.
See <a href="../commons/configuration-properties.html#_ecr_server_jobs_retention-cleanup" class="xref page">configuration reference</a> for details.</p>
</div>
<div class="sect2">
<h3 id="asynchronous_mode"><a class="anchor" href="#asynchronous_mode"></a>Asynchronous mode</h3>
<div class="paragraph">
<p>In the asynchronous mode, content is not deleted from the storage immediately. Instead, a message queue is used to delete
the content asynchronously. The database entries for the documents are not removed but marked as deleted using the
<code>COMPLIANCE_DELETED</code> field.</p>
</div>
<div class="paragraph">
<p>The entries that were marked as deleted are automatically excluded from query results. It is not possible to read those
entries using the <em>arveo</em> client API.</p>
</div>
<div class="paragraph">
<p>The <em>arveo</em> client API can be used to delete all entities that were marked as deleted as shown in the
following example:</p>
</div>
<div class="listingblock">
<div class="title">Deleting marked entities</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Expression&lt;Boolean&gt; expression = EcrQueryLanguage.condition()
    .entity().systemField(SystemFieldList.GeneralSystemField.ComplianceDeleted.INSTANCE)
    .equalTo().value(true).holds();
serviceClient.delete(expression, 1000); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set a limit to reduce database load</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="triggering_the_job"><a class="anchor" href="#triggering_the_job"></a>Triggering the job</h3>
<div class="paragraph">
<p>Both the repository service and the job service offer an API that provides methods to create triggers for the job. The
following example shows how to use this API to create a simple trigger that will fire once at a specified time. The API
requires administrator privileges.</p>
</div>
<div class="listingblock">
<div class="title">Triggering the retention cleanup job</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">EcrSchedulerResourceClient schedulerClient = systemManagementClient.getSchedulerClient();

JobKeyModel jobKey = new JobKeyModel(SystemJobIdentities.ECR_JOBS_GROUP, SystemJobIdentities.RETENTION_CLEANUP);
TriggerKeyModel triggerKey = new TriggerKeyModel(SystemJobIdentities.ECR_JOBS_GROUP, "test-trigger-retention-cleanup");

SimpleTriggerModel trigger = new SimpleTriggerModel(triggerKey, jobKey);
trigger.setNextFireTime(ZonedDateTime.now());
trigger.setJobDataMap(Map.of(
    SystemJobDataKeys.TYPE_DEFINITION_NAME, SimpleInvoiceNames.getTypeDefinitionName(),
    SystemJobDataKeys.RETENTION_CLEANUP_RETENTION_END_TIME, ZonedDateTime.now(),
    SystemJobDataKeys.RETENTION_CLEANUP_PROTOCOL_FILE, getTargetDir() + File.separator + "retention-cleanup-job.log"
));

schedulerClient.scheduleSimpleTrigger(trigger);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API provides additional methods to create cron expression based triggers and to unschedule a job.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="search-service.html">Search language</a></span>
  <span class="next"><a href="client-sdks-json-serialization.html">Client SDKs</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../ui-assets/js/site.js" data-ui-root-path="../../ui-assets"></script>
<script async src="../../ui-assets/js/vendor/highlight.js"></script>
<script src="../../ui-assets/js/vendor/lunr.js"></script>
<script src="../../ui-assets/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../ui-assets/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
