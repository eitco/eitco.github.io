<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Events :: arveo Documentation</title>
    <link rel="canonical" href="https://eitco.github.io/arveo-docu/22.0.0/arveo-developer/events.html">
    <link rel="prev" href="non-spring-sdk.html">
    <link rel="next" href="integration-service.html">
    <meta name="generator" content="Antora 3.2.0-alpha.8">
    <link rel="stylesheet" href="../../../ui-assets/css/site.css">
    <link rel="stylesheet" href="../../../ui-assets/css/custom.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand"> 
      <img src="../../../ui-assets/img/arveo_WortBildmarke_NEG_500px.png" id="arveoLogo" style="vertical-align:middle;margin:10px 0px">
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://eitco.github.io">Home</a>
        <!--<div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>-->
        <!--<div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>-->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="arveo-docu" data-version="22.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-general/product-summary.html">What is <em>arveo</em> - Content Services Platform (CSP)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Architecture Overview</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/content-services.html">Content Services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/technology-stack.html">Opensource Technology Stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/application-security.html">Application security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/gobd.html">Compliance recommendations (GoBD)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Store</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-storage.html">Persistence architecture</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-deletion.html">Data deletion</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-getting-started/getting-started.html">Getting Started</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration und Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-administration/installation.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/deployment-options.html">Deployment options</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/system-requirements.html">System requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/authentication-oauth2.html">OAuth Authentication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/db-access.html">Database access</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/content-elements-storage.html">Storage locations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/renditions.html">Renditions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/retention-container.html">Retention and Storage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/encryption.html">Encryption</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/messaging.html">Configure Active MQ</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/maintenance-mode-db-schema.html">Maintenance mode for the database schema</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/audit.html">Audit</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/jobs.html">System jobs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/vault.html">Using Hashicorp Vault</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../commons/configuration-properties.html">Configuration Properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/ecr-shell.html">arveo shell</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../arveo-administration/monitoring.html">Monitoring</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Developer</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Access Control</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="access-rights.html">Access rights</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="attribute-based-security.html">Attribute Based Access Control (ABAC)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="permissions.html">Permissions on Type definitions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Modelling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="entity-types.html">Entity types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="entity-annotations.html">Entity annotations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="data-types.html">Data types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="system-fields.html">System fields</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="document-types.html">Document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="container-types.html">Container types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="relation-types.html">Relation types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="folder-types.html">Folder types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="metadata-types.html">Metadata types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="validation.html">Validation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="inheritance.html">Inheritance</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention-annotations.html">Retention document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tenant-separation.html">Tenant separation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced-schema-changes.html">Advanced database schema changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="repo-service.html">Repository Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-upload-data.html">Upload Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-download-data.html">Download Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-delete-objects.html">Delete Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-locking.html">Locking</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-download-links-external-users.html">Download Links for External Users</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="versioning.html">Versioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="search-service.html">Search language</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="fulltext.html">Full text search in relational database</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="retention-introduction.html">Retention</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention.html">Retention periods</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention-cleanup-job.html">Cleanup job</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SDKs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="client-sdks-json-serialization.html">Client SDKs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="sdk-and-batch-operations.html">Java SDK for Spring applications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="non-spring-sdk.html">Java SDK for non-Spring applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Events and messaging</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="events.html">Events</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-service.html">Enterprise Integration Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archetypes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="slim-archetype.html">The Types archetype</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="full-featured-archetype.html">The full-featured archetype</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="system-tables.html">System Tables</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/compatibility-list.html">Compatibility List</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/release-notes.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/glossary.html">Important Terminology</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">arveo Documentation</span>
    <span class="version">22.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../arveo-general/product-summary.html">22.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../arveo-general/product-summary.html">arveo Documentation</a></li>
    <li>Developer</li>
    <li>Events and messaging</li>
    <li><a href="events.html">Events</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Events</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <em>arveo</em> service publishes several different kinds of events internally for the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create</p>
</li>
<li>
<p>Update</p>
</li>
<li>
<p>Batch-Update</p>
</li>
<li>
<p>Delete</p>
</li>
<li>
<p>Retention prolongation</p>
</li>
<li>
<p>Litigation hold</p>
</li>
<li>
<p>Read content</p>
</li>
<li>
<p>Create content</p>
</li>
<li>
<p>Delete content</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Events are named after the operation they
are published for and have one of the following three prefixes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Before</p>
</li>
<li>
<p>On</p>
</li>
<li>
<p>After</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="before_events"><a class="anchor" href="#before_events"></a>Before-Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>"Before" events are published before an operation takes place but within the same transaction. They contain
information about the input of the change. If a synchronous event listener throws an exception the change will be
omitted, and the transaction aborted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="on_events"><a class="anchor" href="#on_events"></a>On-Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>"On" events are published after a change occurred but within the same transaction. They will contain information about
the result of a change. If a synchronous event listener throws an exception the change will not be omitted, but the
transaction will be aborted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="after_events"><a class="anchor" href="#after_events"></a>After-Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>"After" events are published after the transaction containing the change was committed successfully. They will contain
information about the result of a change. If a synchronous event listener throws an exception the change will not be omitted,
and the transaction will not be aborted. The call itself however will fail while actually being successful.
Thus, it is considered good practice to define listeners for after events as asynchronous.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="listening_to_events"><a class="anchor" href="#listening_to_events"></a>Listening to events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Available events are implemented in the module <em>ecr-events</em>, which can be found at the following maven coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;de.eitco.ecr&lt;/groupId&gt;
    &lt;artifactId&gt;ecr-events&lt;/artifactId&gt;
    &lt;version&gt;22.0.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>arveo</em> service uses spring eventing as implementation, enabling asynchronous events. Thus, events can be
handled by defining a Spring bean or component, containing a method annotated with <code>@EventListener</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example of an Event Listener, listening to all events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import de.eitco.ecr.event.EcrEvent;
import org.springframework.context.event.EventListener;
import org.springframework.stereotype.Component;

@Component
public class EventLog {

    private final Stack&lt;EcrEvent&gt; events = new Stack&lt;&gt;();

    public Stack&lt;EcrEvent&gt; getEvents() {
        return events;
    }

    @EventListener
    public void onEvent(EcrEvent event) {

        events.push(event);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above defines an Event Listender that adds every <em>arveo</em> event to a stack. However, more specific events can be listened to, as well:</p>
</div>
<div class="listingblock">
<div class="title">Example of an Event Listener, listening to specific events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import de.eitco.ecr.event.content.after.AfterDeleteContentEvent;
import de.eitco.ecr.event.document.after.AfterCreateDocumentEvent;
import org.springframework.context.event.EventListener;
import org.springframework.stereotype.Component;

@Component
public class EventListeners {

    @EventListener
    public void afterCreateDocument(AfterCreateDocumentEvent event) {
// ... code that handles event
    }

    @EventListener
    public void afterDeleteContent(AfterDeleteContentEvent event) {
// ... code that handles event
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Events are fired and handled inside of the <em>arveo</em> service. Currently, there is no eventing mechanism avaibale
for the client APIs. Because of this, the Spring component containing the event listener methods must be present in the
classpath of the <em>arveo</em> service. To ensure that the component is registered as a bean, it is required to
implement a Spring Boot starter with the according auto import declaration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="forwarding_events_to_a_message_queue"><a class="anchor" href="#forwarding_events_to_a_message_queue"></a>Forwarding events to a message queue</h2>
<div class="sectionbody">
<div class="paragraph">
<p>arveo can forward the after&#8230;&#8203; events to message queues. This makes it possible for external services to react
to certain events.
The message queues and the types of events to forward can be configured in the configuration of the Content Repository
Service. Only events fired after an action was performed can be forwarded. By default, no events will be forwarded.
The following example configuration shows how to forward all available events to different message queues.</p>
</div>
<div class="listingblock">
<div class="title">forwarding configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ecr:
  server:
    messaging:
      forwarding:
        afterCreate:
          containerQueueName: ecr-after-create-container-events
          documentQueueName: ecr-after-create-document-events
          folderQueueName: ecr-after-create-folder-events
          relationQueueName: ecr-after-create-relation-events
          metaDataQueueName: ecr-after-create-meta-events
        afterUpdate:
          containerQueueName: ecr-after-update-container-events
          documentQueueName: ecr-after-update-document-events
          folderQueueName: ecr-after-update-folder-events
          relationQueueName: ecr-after-update-relation-events
          metaDataQueueName: ecr-after-update-meta-events
        afterBatchUpdate:
          containerQueueName: ecr-after-batch-update-container-events
          documentQueueName: ecr-after-batch-update-document-events
          folderQueueName: ecr-after-batch-update-folder-events
          relationQueueName: ecr-after-batch-update-relation-events
          metaDataQueueName: ecr-after-batch-update-meta-events
        afterDelete:
          containerQueueName: ecr-after-delete-container-events
          documentQueueName: ecr-after-delete-document-events
          folderQueueName: ecr-after-delete-folder-events
          relationQueueName: ecr-after-delete-relation-events
          metaDataQueueName: ecr-after-delete-meta-events
        afterRetentionProlongation:
          containerQueueName: ecr-after-retention-prolongation-container-events
          documentQueueName: ecr-after-retention-prolongation-document-events
          folderQueueName: ecr-after-retention-prolongation-folder-events
          relationQueueName: ecr-after-retention-prolongation-relation-events
        afterLitigationHold:
          containerQueueName: ecr-after-litigation-hold-container-events
          documentQueueName: ecr-after-litigation-hold-document-events
          folderQueueName: ecr-after-litigation-hold-folder-events
          relationQueueName: ecr-after-litigation-hold-relation-events
        afterCreateContentQueueName: ecr-after-create-content-events
        afterReadContentQueueName: ecr-after-read-content-events
        afterDeleteContentQueueName: ecr-after-delete-content-events</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only event types with a configured message queue name will be forwarded.</p>
</div>
<div class="paragraph">
<p>As it is not possible to forward the internal event classes, the events will be converted to serializable event classes.
The available classes are contained in the package <code>de.eitco.ecr.common.events</code>. These events will be serialized to
JSON when they are sent to the message queues.</p>
</div>
<div class="paragraph">
<p>The arveo SDK for Spring applications provides a preconfigured <code>JmsTemplate</code> which will automatically
deserialize the events. The following dependency is required to access the preconfigured <code>JmsTemplate</code>:</p>
</div>
<div class="listingblock">
<div class="title">jms dependency</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;de.eitco.ecr&lt;/groupId&gt;
    &lt;artifactId&gt;ecr-jms&lt;/artifactId&gt;
    &lt;version&gt;22.0.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preconfigured <code>JmsTemplate</code> can then by obtained by injecting an <code>EcrJmsTemplateHolder</code> as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Autowired
private EcrJmsTemplateHolder ecrJmsTemplateHolder;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>JmsTemplate</code> can then be used to receive events. The following example shows how to listen to a specific queue
synchronously.</p>
</div>
<div class="listingblock">
<div class="title">listening to events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JmsTemplate jmsTemplate = ecrJmsTemplateHolder.getJmsTemplate();
AfterUpdateDocumentEvent event = (AfterUpdateDocumentEvent) jmsTemplate.receiveAndConvert(
    new ActiveMQQueue("ecr-after-update-document-events"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ecr-jms</code> module also registers <code>JmsListenerContainerFactory</code> beans that can be used to programmatically register
JMS listeners in a Spring application. The following example shows an example of a component that adds a custom
message listener using the preconfigured <code>JmsListenerContainerFactory</code>:</p>
</div>
<div class="listingblock">
<div class="title">registering event listeners</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
public class MyListenerRegistration implements JmsListenerConfigurer {

    private final JmsListenerContainerFactory&lt;DefaultMessageListenerContainer&gt; queueListenerContainerFactory;

    @Autowired
    public AbstractListenerRegistration(
        @Qualifier("ecr-queue-listener-container-factory") JmsListenerContainerFactory&lt;DefaultMessageListenerContainer&gt; queueListenerContainerFactory <i class="conum" data-value="1"></i><b>(1)</b>
    ) {
        this.queueListenerContainerFactory = queueListenerContainerFactory;
    }

    @Override
    public void configureJmsListeners(@NotNull JmsListenerEndpointRegistrar registrar) {

        SimpleJmsListenerEndpoint endpoint = new SimpleJmsListenerEndpoint(); <i class="conum" data-value="2"></i><b>(2)</b>
        endpoint.setId("my-listener-id");
        endpoint.setDestination("my-queue-name");
        endpoint.setMessageListener(new MyMessageListener());

        registrar.registerEndpoint(endpoint, queueListenerContainerFactory); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Injects the preconfigured <code>JmsListenerContainerFactory</code> provided by the <code>ecr-jms</code> library.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create a custom listener endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Register the custom listener endpoint using the preconfigured container factory</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The custom event listener can be implemented by extending <code>de.eitco.ecr.jms.ConvertingMessageListener</code>. This abstract
class provides automatic deserialization of the message objects.</p>
</div>
<div class="listingblock">
<div class="title">custom event listener</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
public class MyMessageListener extends ConvertingMessageListener&lt;EventType&gt; {

    @Autowired
    public MyMessageListener(MessageConverter messageConverter) {
        super(messageConverter, EventType.class); <i class="conum" data-value="1"></i><b>(1)</b>
    }

    @Override
    protected void handleMessage(@NotNull ActiveMQMessage activeMQMessage, @NotNull EventType event) { <i class="conum" data-value="2"></i><b>(2)</b>

        // the actual event processing happens here
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Pass the injected MessageConverter to the abstract listener. The MessageConverter is provided by the ecr-jms module.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This method is called after the event was converted. The original message is supplied, too.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="filtering_events_by_type_definition"><a class="anchor" href="#filtering_events_by_type_definition"></a>Filtering events by type definition</h3>
<div class="paragraph">
<p>arveo sets a header called <code>ECRTypeDefinition</code> in every forwarded message (except for <code>AfterDeleteContentEvent</code>).
This header can be used in a message selector, so that only events for a specific type definition are received.</p>
</div>
<div class="listingblock">
<div class="title">using a message selector</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String messageSelector = TypeDefinitionSpecificEvent.TYPE_DEFINITION_HEADER + "='"
                         + PersonSimpleNames.getTypeDefinitionName() + "'";

AfterCreateContainerEvent event = (AfterCreateContainerEvent) jmsTemplate.receiveSelectedAndConvert(
    new ActiveMQQueue("ecr-after-create-container-events"), messageSelector);</code></pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="non-spring-sdk.html">Java SDK for non-Spring applications</a></span>
  <span class="next"><a href="integration-service.html">Enterprise Integration Service</a></span>
</nav>
</article>
  </div>
</main>
    <!-- The Modal -->
    <div id="imageModalBox" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01">
        <div id="caption"></div>
    </div>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../ui-assets/js/site.js" data-ui-root-path="../../../ui-assets"></script>
<script async src="../../../ui-assets/js/vendor/highlight.js"></script>
<script async src="../../../ui-assets/js/modal.js"></script>
<script src="../../../ui-assets/js/vendor/lunr.js"></script>
<script src="../../../ui-assets/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../ui-assets/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
