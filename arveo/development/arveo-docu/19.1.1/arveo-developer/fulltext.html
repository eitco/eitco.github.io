<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using full text features of the relational database :: arveo Documentation</title>
    <link rel="canonical" href="https://eitco.github.io/arveo-docu/19.1.1/arveo-developer/fulltext.html">
    <link rel="prev" href="search-service.html">
    <link rel="next" href="retention-introduction.html">
    <meta name="generator" content="Antora 3.2.0-alpha.6">
    <link rel="stylesheet" href="../../../ui-assets/css/site.css">
    <link rel="stylesheet" href="../../../ui-assets/css/custom.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand"> 
      <img src="../../../ui-assets/img/arveo_WortBildmarke_NEG_500px.png" id="arveoLogo" style="vertical-align:middle;margin:10px 0px">
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://eitco.github.io">Home</a>
        <!--<div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>-->
        <!--<div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>-->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="arveo-docu" data-version="19.1.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-general/product-summary.html">What is <em>arveo</em> - Content Services Platform (CSP)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Architecture Overview</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/content-services.html">Content Services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/technology-stack.html">Opensource Technology Stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/application-security.html">Application security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/gobd.html">Compliance recommendations (GoBD)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Store</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-storage.html">Persistence architecture</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-general/data-deletion.html">Data deletion</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-getting-started/getting-started.html">Getting Started</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration und Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../arveo-administration/installation.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/deployment-options.html">Deployment options</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/system-requirements.html">System requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/authentication-oauth2.html">OAuth Authentication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/db-access.html">Database access</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/content-elements-storage.html">Storage locations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/renditions.html">Renditions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/retention-container.html">Retention and Storage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/encryption.html">Encryption</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/messaging.html">Configure Active MQ</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/maintenance-mode-db-schema.html">Maintenance mode for the database schema</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/audit.html">Audit</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/solr.html">Solr</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/jobs.html">System jobs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../arveo-administration/vault.html">Using Hashicorp Vault</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../commons/configuration-properties.html">Configuration Properties</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../arveo-administration/monitoring.html">Monitoring</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Developer</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Access Control</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="access-rights.html">Access rights</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="attribute-based-security.html">Attribute Based Access Control (ABAC)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="permissions.html">Permissions on Type definitions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Modelling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="entity-types.html">Entity types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="entity-annotations.html">Entity annotations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="data-types.html">Data types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="system-fields.html">System fields</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="document-types.html">Document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="container-types.html">Container types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="relation-types.html">Relation types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="folder-types.html">Folder types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="metadata-types.html">Metadata types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="validation.html">Validation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="inheritance.html">Inheritance</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention-annotations.html">Retention document types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="tenant-separation.html">Tenant separation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced-schema-changes.html">Advanced database schema changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="repo-service.html">Repository Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-upload-data.html">Upload Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-download-data.html">Download Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-delete-objects.html">Delete Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-locking.html">Locking</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repo-service-download-links-external-users.html">Download Links for External Users</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="versioning.html">Versioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="search-service.html">Search language</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="fulltext.html">Full text search in relational database</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="retention-introduction.html">Retention</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention.html">Retention periods</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="retention-cleanup-job.html">Cleanup job</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SDKs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="client-sdks-json-serialization.html">Client SDKs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="sdk-and-batch-operations.html">Java SDK for Spring applications</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="non-spring-sdk.html">Java SDK for non-Spring applications</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Events and messaging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="events.html">Events</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-service.html">Enterprise Integration Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Archetypes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="slim-archetype.html">The Types archetype</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="full-featured-archetype.html">The full-featured archetype</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="system-tables.html">System Tables</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/compatibility-list.html">Compatibility List</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/release-notes.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../arveo-commons/glossary.html">Important Terminology</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">arveo Documentation</span>
    <span class="version">19.1.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../arveo-general/product-summary.html">arveo Documentation</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../arveo-general/product-summary.html">19.1.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../arveo-general/product-summary.html">arveo Documentation</a></li>
    <li>Developer</li>
    <li><a href="repo-service.html">Repository Service</a></li>
    <li><a href="fulltext.html">Full text search in relational database</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Using full text features of the relational database</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>arveo</em> can make use of the full text support of the PostgreSQL database. Extracted full text
data can be stored in the database and used in queries in combination with all entity attributes and system properties.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Extracted full text data can be stored either in the PostgreSQL database or in SOLR. It is not possible
to use both simultaneously.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="https://www.postgresql.org/docs/current/textsearch.html">PostgreSQL documentation</a> contains an in-depth explanation
of the database&#8217;s text search capabilities.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="store_extracted_full_text_data_in_the_relational_database"><a class="anchor" href="#store_extracted_full_text_data_in_the_relational_database"></a>Store extracted full text data in the relational database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Full text extraction and storage is configured in the type definition using annotations. The following example shows
how to define a content element for which full text data will be extracted automatically and stored in
PostgreSQL.</p>
</div>
<div class="listingblock">
<div class="title">type definition with full text in relational database</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Type(ObjectType.DOCUMENT)
@ContentElement(
    name = "content1", <i class="conum" data-value="1"></i><b>(1)</b>
    fulltextExtraction = true, <i class="conum" data-value="2"></i><b>(2)</b>
    fullTextStorage = FullTextStorage.RDB, <i class="conum" data-value="3"></i><b>(3)</b>
    fullTextLanguage = FullTextLanguage.ENGLISH, <i class="conum" data-value="4"></i><b>(4)</b>
    reversedFullTextIndex = true <i class="conum" data-value="5"></i><b>(5)</b>
)
@ContentElement(
    name = "content2",
    fulltextExtraction = true,
    fullTextStorage = FullTextStorage.RDB_WITH_VECTOR_COLUMN, <i class="conum" data-value="6"></i><b>(6)</b>
    fullTextLanguage = FullTextLanguage.ENGLISH,
    reversedFullTextIndex = true
)
public interface DocumentWithRdbFullText {

    @Optional
    String getDocumentName();

    void setDocumentName(String documentName);

    @SystemProperty(SystemPropertyName.QUERY_ATTRIBUTES)
    QueryAttributes getQueryAttributes(); <i class="conum" data-value="7"></i><b>(7)</b>

    @SystemProperty(SystemPropertyName.FULL_TEXT_EXTRACTION_STATUS)
    Map&lt;String, FullTextStatusInformation&gt; getFullTextStatusInformation(); <i class="conum" data-value="8"></i><b>(8)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines the name of the content element</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Activates automatic full text extraction</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Tells the system to store the extracted full text data in the relational database</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The language (or configuration) used for the full text index on the database</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If this property is set to true, an additional index is created that contains full text data of the reversed original
content. This is a requirement for suffix-searches. If suffix searches are not required, this setting should not be enabled.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Activates an additional column on the database that will contain the parsed full text vector data. See below for details.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Provides access to additional query result attributes like rank and highlighting</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Provides access to status information about extracted full text data</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="indexes_and_configuration"><a class="anchor" href="#indexes_and_configuration"></a>Indexes and configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The system will create a full text index for each content element for that full text data is stored in the database.
Because full text operations are language specific, the language for the index must be defined in the content element
of the type definition. PostgreSQL provides a number of predefined language configurations, which are
contained in the <code>FullTextLanguage</code> class as constants. It is possible to create custom configurations. More information
can be found in the <a href="https://www.postgresql.org/docs/current/textsearch-intro.html#TEXTSEARCH-INTRO-CONFIGURATIONS">Postgres documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using_vector_columns"><a class="anchor" href="#using_vector_columns"></a>Using vector columns</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The parsed full text data can be kept in indexes and optionally in a separate database column (vector column). To store
full text data in a vector column, set the <code>fullTextStorage</code> attribute to <code>RDB_WITH_VECTOR_COLUMN</code>. If storing the full
text data in an index is sufficient, set this attribute to <code>RDB</code>.</p>
</div>
<div class="paragraph">
<p>Whether to use a vector column depends on the usage of the archived data. Storing the data in a vector column provides
faster search performance but slower write performance. Keeping the data in an index provides slower search performance
but faster write performance. Another thing to consider is the possibility to change the language used to parse the
full text data. If it is changed, both the index and the vector column must be re-created.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="suffix_ends_with_searches"><a class="anchor" href="#suffix_ends_with_searches"></a>Suffix (ends-with) searches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To allow suffix or "ends-with" searches, an additional index or vector column that stores reversed full text data can
be activated using the property <code>reversedFullTextIndex</code>. Such an index (or vector column) is required to perform suffix
searches. Prefix and web searches are always possible. Keep in mind that enabling the storage of reversed full text data
will double the amount of storage required for full text data, so this should only be enabled when suffix searches are
required.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="searching"><a class="anchor" href="#searching"></a>Searching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The EQL provides support for full text searching. Search expressions are formulated like a query in a web search
engine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unquoted text: Text without quotes will be treated as individual terms combined by an AND operator.</p>
</li>
<li>
<p>Quoted text: Text within quotes will be treated as a phrase (individual terms combined by a FOLLOWED-BY operator).</p>
</li>
<li>
<p>OR: The word "or" will be treated like the logical OR operator.</p>
</li>
<li>
<p>Dash: A dash ("-") will be treated like a NOT operator.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Whether the full text data is stored in an index or a vector column does not matter when formulating queries.
The system will automatically reference the correct database entity. Providing the name of the content element is
sufficient.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>'the green ball'</code>: Will find documents that contain the words "green" and "ball". The word "the" will be ignored
because it is a stop-word.</p>
</li>
<li>
<p><code>'"the green ball"'</code>: Will find documents that contain the word "green" followed by the word "ball". Again, the word
"the" will be ignored.</p>
</li>
<li>
<p><code>'blue -red'</code>: Will find documents containing the word "blue" but not the word "red".</p>
</li>
<li>
<p><code>'blue or red'</code>: Will find documents containing the word "blue" or the word "red".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The fluent API can be used to formulate queries as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">formulating queries</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;TypedDocumentClient&lt;DocumentWithRdbFullText&gt;&gt; list = serviceClient.where()
    .contextReference("content1") <i class="conum" data-value="1"></i><b>(1)</b>
    .fullTextMatches() <i class="conum" data-value="2"></i><b>(2)</b>
    .webSearch("the cake is a lie") <i class="conum" data-value="3"></i><b>(3)</b>
    .holds().unpaged();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines the content element from which the full text data was extracted</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Perform full text query</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the web search expression as described above</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In queries using more than one type definition it is necessary to qualify the context reference to the content element
by the name of the type definition:</p>
</div>
<div class="listingblock">
<div class="title">qualified context reference</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;TypedDocumentClient&lt;DocumentWithRdbFullText&gt;&gt; list = serviceClient.where()
    .contextReference(DocumentWithRdbFullTextNames.getTypeDefinitionName(), "content1") <i class="conum" data-value="1"></i><b>(1)</b>
    .fullTextMatches()
    .webSearch("the cake is a lie")
    .holds().unpaged();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Qualify the reference to the content element by using the name of the type definition</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to web searches, <em>arveo</em> supports prefix and suffix searches (or starts-with and ends-with) queries.</p>
</div>
<div class="listingblock">
<div class="title">prefix search</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;TypedDocumentClient&lt;DocumentWithRdbFullText&gt;&gt; list = serviceClient.where()
    .contextReference("content2")
    .fullTextMatches()
    .prefix("search")
    .holds().unpaged();</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The extracted full text data is stored in a separate table (with the postfix "_ft"). This table is automatically joined
when a full text query is performed. Queries without full text will not contain a join for this table.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="ranking_search_results"><a class="anchor" href="#ranking_search_results"></a>Ranking search results</h3>
<div class="paragraph">
<p>In full text queries ranking is used to measure the relevance of each query result in regard of the full text matching
expression. <em>arveo</em> can return a rank value for each element in a query result. The value is of type float in
the range 0-1. The rank value might be null if ranking was not applicable for the specific element.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The rank is calculated for one specific content element, which means that the query must contain exactly one full text
match expression for this content element. It is not possible to calculate more than one rank in a query.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The calculated value can be used to order the returned result.</p>
</div>
<div class="paragraph">
<p>The concrete rank of each returned element can be accessed using the <code>QueryAttributes</code> property of an entity.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Ranking is an expensive operation on the database and should be used with care.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ranking is enabled in the <code>SearchOptions</code> given to the <code>SearchRequest</code> as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="title">ranking</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;TypedDocumentClient&lt;DocumentWithRdbFullText&gt;&gt; list = serviceClient.where()
    .contextReference("content1")
    .fullTextMatches()
    .webSearch("the cake is a lie")
    .holds()
    .withOptions()
    .withRankingByReference("content1") <i class="conum" data-value="1"></i><b>(1)</b>
    .asOptions()
    .order().descendingByRank() <i class="conum" data-value="2"></i><b>(2)</b>
    .unpaged();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Calculate the rank for the full text match expression on the content element named "content"</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the calculated rank to order the result on the database</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The rank value can be accessed as shown below:</p>
</div>
<div class="listingblock">
<div class="title">accessing the rank value</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryAttributes queryAttributes = documentClient.getEntity().getQueryAttributes();
Float rank = queryAttributes.getRank();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="highlighting"><a class="anchor" href="#highlighting"></a>Highlighting</h3>
<div class="paragraph">
<p><em>arveo</em> offers the possibility to generate a headline that can be used to highlight words that matched a full
text query in a document. A client might use this feature to show a short preview of the document in a query result
list so that the user can see why the document was considered relevant.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The headline is generated for one specific content element, which means that the query must contain exactly one full text
match expression for this content element. It is not possible to generate more than one headline in a query.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The generation of the headline is done by the database and must therefore be enabled in the <code>SearchOptions</code> as shown
in the following example.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Generating headlines is an expensive operation on the database and should be used with care.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">headline</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;TypedDocumentClient&lt;DocumentWithRdbFullText&gt;&gt; list = serviceClient.where()
    .contextReference("content1")
    .fullTextMatches()
    .webSearch("the cake is a lie")
    .holds()
    .withOptions()
    .withHeadlineForReference("content1") <i class="conum" data-value="1"></i><b>(1)</b>
    .asOptions()
    .unpaged();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Generate a headline for the extracted full text data of the content element called "content".</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The headline value can be accessed as shown below:</p>
</div>
<div class="listingblock">
<div class="title">accessing the headline value</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryAttributes queryAttributes = documentClient.getEntity().getQueryAttributes();
@Nullable String headline = queryAttributes.getHeadline();</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is not possible to retrieve a headline when a suffix search is performed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="error_handling"><a class="anchor" href="#error_handling"></a>Error handling</h3>
<div class="paragraph">
<p><em>arveo</em> keeps track of the status of the extracted full text data for each document and content element. The
current status can be retrieved from a document entity using a system property getter for full text information as shown
in the type definition above:</p>
</div>
<div class="listingblock">
<div class="title">accessing the status value</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RenditionStatus status = client.getEntity().getFullTextStatusInformation().get("content1").getStatus();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fulltext extraction is retried automatically for each document. The number of retries can be configured using the
property <code>ecr.server.messaging.redelivery.maximum-redeliveries</code>. When all attempts have failed, the status is set to
FAILED. It is possible to reset the status using the API as shown below. A system job will detect these document and
the system will try to extract the full text data again. Triggers for this job are created automatically by the system
at startup for each type definition containing content elements with full text extraction. By default, the job is
triggered every three minutes.</p>
</div>
<div class="listingblock">
<div class="title">resetting the status value</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SearchRequest searchRequest = SearchRequest
    .first(100)
    .ascendingBy(SystemFieldList.GeneralSystemField.Id.INSTANCE.getName())
    .matching(EcrQueryLanguage.condition().entity().id().equalTo().value(client.getIdentifier()).holds()); <i class="conum" data-value="1"></i><b>(1)</b>

serviceClient.resetFailedFullTextExtractionStatus(searchRequest, "content1"); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The selector used to identify the documents to reset the status</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Resets the status for all documents matching the condition for the content element "content1"</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="search-service.html">Search language</a></span>
  <span class="next"><a href="retention-introduction.html">Retention</a></span>
</nav>
</article>
  </div>
</main>
    <!-- The Modal -->
    <div id="imageModalBox" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01">
        <div id="caption"></div>
    </div>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../ui-assets/js/site.js" data-ui-root-path="../../../ui-assets"></script>
<script async src="../../../ui-assets/js/vendor/highlight.js"></script>
<script async src="../../../ui-assets/js/modal.js"></script>
<script src="../../../ui-assets/js/vendor/lunr.js"></script>
<script src="../../../ui-assets/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../ui-assets/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
