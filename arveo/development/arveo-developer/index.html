<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Security</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">arveo 16.1.1-SNAPSHOT</div>
<ul class="sectlevel1">
<li><a href="#_gettingstarted_v"><strong>Security</strong></a>
<ul class="sectlevel2">
<li><a href="#_application_security">Application security</a></li>
<li><a href="#_data_security">Data security</a></li>
<li><a href="#_tenant_security">Tenant security</a></li>
<li><a href="#_security_patches">Security patches</a></li>
<li><a href="#_application_protection_by_design">Application protection by design</a></li>
<li><a href="#_compliance_recommendations_gobd">Compliance recommendations (GoBD)</a></li>
</ul>
</li>
<li><a href="#_data_store"><strong>Data Store</strong></a>
<ul class="sectlevel2">
<li><a href="#_persistence_architecture">Persistence architecture</a></li>
<li><a href="#_data_types">Data types</a></li>
<li><a href="#_high_availability">High availability</a></li>
<li><a href="#_data_integrity_1">Data integrity</a></li>
<li><a href="#_content_storage_2">Content storage</a></li>
<li><a href="#_clustering">Clustering</a></li>
<li><a href="#_data_deletion">Data deletion</a></li>
<li><a href="#_recycle_bin">Recycle bin</a></li>
</ul>
</li>
<li><a href="#_access_control"><strong>Access Control</strong></a>
<ul class="sectlevel2">
<li><a href="#_access_rights">Access rights</a></li>
<li><a href="#_access_control_lists">Access control lists</a></li>
</ul>
</li>
<li><a href="#_attribute_based_access_control_abac">Attribute Based Access Control (ABAC)</a>
<ul class="sectlevel2">
<li><a href="#_parameters">Parameters</a></li>
<li><a href="#_examples">Examples</a></li>
<li><a href="#_interface_inheritance">Interface inheritance</a></li>
<li><a href="#_complex_scenario_a_hospital">Complex scenario: a Hospital</a></li>
<li><a href="#_revision_history_and_abac">Revision history and ABAC</a></li>
<li><a href="#_accessing_external_tables">Accessing external tables</a></li>
<li><a href="#_permissions_on_type_definitions">Permissions on Type definitions</a></li>
</ul>
</li>
<li><a href="#_data_modelling"><strong>Data Modelling</strong></a>
<ul class="sectlevel2">
<li><a href="#_objects_types_definitions">Entity types</a></li>
<li><a href="#_type_annotations">Type annotations</a></li>
<li><a href="#_property_annotations">Property annotations</a></li>
<li><a href="#_data_types_2">Data Types</a></li>
<li><a href="#_system_properties">System Properties</a></li>
<li><a href="#_document_type">Document type</a></li>
<li><a href="#_container_type">Container type</a></li>
<li><a href="#_relation_type">Relation type</a></li>
<li><a href="#_folder_type">Folder type</a></li>
<li><a href="#_metadata_type">Metadata type</a></li>
<li><a href="#_inheritance">Inheritance</a></li>
<li><a href="#_retention">Retention</a></li>
<li><a href="#_tenant_separation">Tenant separation</a></li>
<li><a href="#_advanced_db_schema_changes">Advanced db schema changes</a></li>
</ul>
</li>
<li><a href="#_document_service"><strong>Document Service</strong></a>
<ul class="sectlevel2">
<li><a href="#_upload_data">Upload data</a></li>
<li><a href="#_download_data">Download data</a></li>
<li><a href="#_document_service_recycle_bin">Delete an object</a></li>
<li><a href="#_locking">Locking</a></li>
<li><a href="#_download_links_for_external_users">Download links for external users</a></li>
<li><a href="#_versioning_v">Versioning</a></li>
<li><a href="#_search_language">Search language</a></li>
<li><a href="#_search_endpoints">Search endpoints</a></li>
<li><a href="#_retention_periods_retention">Retention periods</a></li>
</ul>
</li>
<li><a href="#_rest_api"><strong>REST API</strong></a>
<ul class="sectlevel2">
<li><a href="#_client_sdks">Client SDKs</a></li>
<li><a href="#_java_sdk">Java SDK</a></li>
</ul>
</li>
<li><a href="#_system_tables"><strong>System tables</strong></a>
<ul class="sectlevel2">
<li><a href="#_tables_for_type_definitions">Tables for type definitions</a></li>
<li><a href="#_folder_structure_tables">Folder structure tables</a></li>
<li><a href="#_recovery_table">Recovery table</a></li>
<li><a href="#_keystore_tables">Keystore tables</a></li>
</ul>
</li>
<li><a href="#_important_terminology"><strong>Important Terminology</strong></a></li>
</ul>
</div>
</div>
<div id="content">
<div style="page-break-after: always;"></div>
<div class="sect1">
<h2 id="_gettingstarted_v"><a class="anchor" href="#_gettingstarted_v"></a><a class="link" href="#_gettingstarted_v"><strong>Security</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_application_security"><a class="anchor" href="#_application_security"></a><a class="link" href="#_application_security">Application security</a></h3>
<div class="paragraph">
<p><em>arveo</em> is a content service platform you can trust. We are continuously working to ensure
that our services can be operated securely in the cloud.</p>
</div>
<div class="paragraph">
<p>All <em>arveo</em> content services and clients communicate via state-of-the-art secure REST interfaces via
the secure HTTPS (SSL) protocol.
All services require the web standard OAUTH2 with OpenID Connect authentication using tokens.
A central authentication service (Keycloak, Active Directory or <em>arveo</em> user management service) issues tokens with an
expiry date. That ensures that only client authenticated against the central service can use the content service APIs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_data_security"><a class="anchor" href="#_data_security"></a><a class="link" href="#_data_security">Data security</a></h3>
<div class="paragraph">
<p><em>arveo</em>  can encrypt the content with AES 256 and thus protect it against unauthorized access.
The key is stored in such a way that maximum security is guaranteed.
In order not to re-encrypt all data if the key is compromised, own keys are generated. Only the keys used are encrypted with the customer key and stored separately (<a href="../arveo-administration#_encryption">Encryption</a>). See also <a href=".#_data_integrity">Data Integrity</a>.</p>
</div>
<div class="paragraph">
<p><em>arveo</em> allows you to organize documents into folders and records.
<em>arveo</em> can control the access rights such as reading, writing or deleting to each document via
attributes or access lists and thus grant or deny the corresponding access to the groups or users.</p>
</div>
<div class="paragraph">
<p><strong>ACL Permissions</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>None</strong> - no authorization (object not visible)</p>
</li>
<li>
<p><strong>Browse</strong> - the user is allowed to see the metadata of the object, but not the content</p>
</li>
<li>
<p><strong>Read</strong> - the user can read metadata and content</p>
</li>
<li>
<p><strong>Relate</strong> - The user can add an annotation</p>
</li>
<li>
<p><strong>Version</strong> - The user may change the content, but may not overwrite it</p>
</li>
<li>
<p><strong>Write</strong> - The user can change metadata and content with the possibility to overwrite</p>
</li>
<li>
<p><strong>Delete</strong> - The user can delete the object</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_tenant_security"><a class="anchor" href="#_tenant_security"></a><a class="link" href="#_tenant_security">Tenant security</a></h3>
<div class="paragraph">
<p>The metadata and the content of the tenants are separated. Each tenant has its own storage container and
database. It is ensured that all data of a tenant is protected from
unauthorized access by another tenant.<br>
The data of a tenant can be easily exported.</p>
</div>
</div>
<div class="sect2">
<h3 id="_security_patches"><a class="anchor" href="#_security_patches"></a><a class="link" href="#_security_patches">Security patches</a></h3>
<div class="paragraph">
<p>For us it is important to continuously ensure that all known vulnerabilities are fixed
and that we deliver security patches and hotfixes as early as possible to our customers.</p>
</div>
<div class="paragraph">
<p>To achieve this goal we integrated all kind of state-of-the-art tools like OWASP dependency check in our build process
that perform automated static code analysis.
We also perform PEN Tests on a regular basis.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>What is OWASP?</strong><br>
The Open Web Application Security Project® (OWASP) is a nonprofit foundation that works to improve the security of software.
Through community-led open-source software projects, hundreds of local chapters worldwide, tens of thousands of members,
and leading educational and training conferences, the OWASP Foundation is the source for developers and technologists
to secure the web.<br>
OWASP is dedicated to enabling organizations to conceive, develop, acquire, operate, and maintain applications
that can be trusted. <br>
All of our projects, tools, documents, forums, and chapters are free and open to anyone interested in improving application security (<a href="https://owasp.org" class="bare">https://owasp.org</a>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_application_protection_by_design"><a class="anchor" href="#_application_protection_by_design"></a><a class="link" href="#_application_protection_by_design">Application protection by design</a></h3>
<div class="paragraph">
<p>What does Eitco to develop, operate and maintain a secure content service platform?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>we only use Opensource Software from secure and accepted projects like Apache or Spring.</p>
</li>
<li>
<p>we implemented an open source review and monitor process</p>
<div class="ulist">
<ul>
<li>
<p>Software architecture review by the Eitco software architects</p>
</li>
<li>
<p>security check using OWASP dependency check</p>
</li>
<li>
<p>legal licence check to ensure that it is a real open source project on the long term.</p>
</li>
<li>
<p>we continuously check our open source dependencies with reference to architecture, security leaks, maintainability.</p>
</li>
</ul>
</div>
</li>
<li>
<p>to ensure that all known vulnerabilities of 3rd party open source projects are eliminated we integrated the OWASP dependency-check tool in our nightly build.
Dependency check checks our dependencies against a database with all known vulnerabilities.</p>
</li>
<li>
<p>in case a severe vulnerability is found we take the appropriate countermeasures.</p>
<div class="ulist">
<ul>
<li>
<p>provide a security path for our customers with a new version of the 3rd party library</p>
</li>
<li>
<p>change the implementation or configuration using the 3rd party component</p>
</li>
<li>
<p>inform our customers to update or reconfigure components like database, message queue, application server, etc.</p>
</li>
<li>
<p>replace the 3rd party component. The typically requires a major update.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_owasp_dependency_check_tool"><a class="anchor" href="#_owasp_dependency_check_tool"></a><a class="link" href="#_owasp_dependency_check_tool">OWASP dependency-check tool</a></h4>
<div class="paragraph">
<p>it is a Software Composition Analysis tool trying to find vulnerabilities made public within the project dependencies.<br>
The tool checks if there is an issue tracked in the "Common Platform Enumeration (CPE)" for the dependency.<br>
If a vulnerability is found it creates report with a link to the CVE entry.<br>
It is command line interface that can be easily integrated in any nightly build process.<br>
For further information, consult National Vulnerability Database (NVD)– (<a href="https://nvd.nist.gov" class="bare">https://nvd.nist.gov</a>). <br>
The following source is worth having a look at: Jeff Williams und Arshan Dabirsiaghi “Unfortunate Reality of Insecure Libraries”<br>
 (<a href="https://owasp.org/www-pdf-archive/ASDC12-The_Unfortunate_Reality_of_Insecure_Libraries.pdf" class="bare">https://owasp.org/www-pdf-archive/ASDC12-The_Unfortunate_Reality_of_Insecure_Libraries.pdf</a>).<br></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compliance_recommendations_gobd"><a class="anchor" href="#_compliance_recommendations_gobd"></a><a class="link" href="#_compliance_recommendations_gobd">Compliance recommendations (GoBD)</a></h3>
<div class="paragraph">
<p>All companies using electronic data processing for legally or tax relevant documents have to be compliant to the "Principles for the proper management and storage of books, records and documents in electronic form and for data access" (GoBD, BMF letter November 28, 2019).</p>
</div>
<div class="paragraph">
<p>In addition to the proper use of the <em>arveo</em> and 3rd party services, we recommend implementing these measures when using <em>Eitco</em> as compliant repository for legally compliant storage of records and documents.</p>
</div>
<div class="sect3">
<h4 id="_indexing_and_retrievel"><a class="anchor" href="#_indexing_and_retrievel"></a><a class="link" href="#_indexing_and_retrievel">Indexing and retrievel</a></h4>
<div class="paragraph">
<p>To allow users and 3rd party applications to identify and find objects in <em>arveo</em> you should define a unique and immutable unique identifier property (<a href="../arveo-developer#type_annotations">Data Modelling</a>).
The property must be <em>@Unique</em> to ensure that a user or business application can clearly identify the item.
The unique identifier should use the taxonomy of business processes and contain all information to clearly recognize the document.
Make the property <em>@Readonly</em> to ensure that the identifier is always set and immutable.</p>
</div>
<div class="paragraph">
<p>The minimizes the risk of incorrect indexing and undetectability of documents because the index is immutable, duplicate identifiers are rejected and the compliant taxonomy ensures that every user can find documents easy and fast. We strongly recommend building a documented, simple but clear taxonomy.</p>
</div>
<div class="paragraph">
<p>Your business application or the user must set the value when the object is created (<em>@Mandatory</em> annotation), or you can let <em>arveo</em> create a unique value by adding counter annotations.
Add the <em>@Autoincrement</em> annotation if a simple sequential Long id meets your requirements.</p>
</div>
<div class="paragraph">
<p>If you need a more sophisticated unique identifier you can use the annotation _@FormattedCounter which allows you to create e.g. String identifiers like &lt;year&gt;-&lt;sequence&gt; (<a href="../arveo-developer#_formatted_counters_example">Unique Identifier Example</a>)</p>
</div>
<div class="paragraph">
<p>List data types allow you to store more than String or long value for a property. You can search for each value using the array search operation of the <em>arveo</em> query language (<a href="#_data_types">Data Types</a>).</p>
</div>
<div class="paragraph">
<p>Enumeration data types allow you to set one or more values from a fixed set of values.</p>
</div>
</div>
<div class="sect3">
<h4 id="_retention_periods"><a class="anchor" href="#_retention_periods"></a><a class="link" href="#_retention_periods">Retention periods</a></h4>
<div class="paragraph">
<p>Enable that the statutory retention periods are assigned to the records, cases and document types  (<a href="../arveo-developer#_retention_periods_retention">Retention Periods</a>, <a href="../arveo-developer#_retention">Retention Rules</a>) and ensure that the storage container are configured correctly (<a href="../arveo-developer#_retention_container">Retention Container</a>) .</p>
</div>
<div class="paragraph">
<p>Check if the technically assigned retention periods also correspond to the statutory retention periods. Monitor the audit logs to ensure that the retention period is set and is correct. Monitoring could be automated or could be a random control by an employee.</p>
</div>
<div class="paragraph">
<p>The operating team must ensure that storage container contain only documents with the same retention period. Please do not use the same bucket in different storage profiles or assign a storage profile containing content with retention to different document types.</p>
</div>
<div class="paragraph">
<p>Grant the deletion right for your storage containers to <em>arveo</em>. If <em>arveo</em> cannot delete the containers, your operating team is in charge of this task, and you must set the option <em>delete rows only</em>.</p>
</div>
<div class="paragraph">
<p>Configuring storage containers in <em>arveo</em>-service.yaml and your content storage is an ongoing task for your operating team.
<em>Eitco</em> will try to create the buckets or subdirectory on your storage system but can also use already existing ones.</p>
</div>
<div class="paragraph">
<p>It must be ensured that the system time cannot be manipulated (e.g. NTP server). Suitable map measures that a change in the system time is detected promptly.</p>
</div>
<div class="paragraph">
<p>Because the new legal data privacy / protection act makes it necessary to erase data even before the expected retention period has expired <em>arveo</em> please take care that the content storage has no default hardware retention activated.</p>
</div>
<div class="sect4">
<h5 id="_audit_log"><a class="anchor" href="#_audit_log"></a><a class="link" href="#_audit_log">Audit log</a></h5>
<div class="paragraph">
<p>Enable the audit option for all types containing legally compliant content (<a href="../arveo-administration#configure_audit">Audit Log</a>). If the platform is operated safely (<a href=".#<em>platform_link">Platform Security</a>) users and applications can exclusively write content and metadata using the _arveo</em> REST API. <em>arveo</em> logs all user or application update operations of content and metadata to the audit table.</p>
</div>
<div class="paragraph">
<p>All changes of content or metadata are persisted as a traceable and immutable version (<a href="../arveo-developer#_versioning_v">Versioning</a>) on your storage system and an audit entry is written to the audit log table (<a href="../arveo-administration#_configure_audit">Audit Log</a>) containing the author and the timestamp of the change. If a document is updated the version is incremented and saved in the version number. Although all version are traceable and accessible by the API we recommend making the version number system property visible in the application to identify copies of the original easily.</p>
</div>
<div class="paragraph">
<p>Ensure that the <em>@Overwrite</em> option is not set for legally compliant document types. If overwrite is turned on it is possible to manipulate the originally saved content and compromise the document without creating a versioned copy.</p>
</div>
<div class="paragraph">
<p>The audit logs are subject to the retention period of commercial and tax law. Ensure that the audit logs are kept for the legal retention period (10 years). We recommend that the operator of the platform exports and clears the audit tables using database tools after 2 years.
Save the dumps as an <em>arveo</em> document with a 10-year retention period. If you need access to older audit logs you easily download the dumps and upload them to the database.</p>
</div>
<div class="paragraph">
<p>The audit tables must be protected against unauthorized access by users. Do not allow write-access to the audit tables to anyone but the <em>arveo</em> services. Only data protection officers are allowed to have controlled read access to the audit data.</p>
</div>
<div class="paragraph">
<p>Check the audit logs regularly to find unauthorized user activities.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_download_and_migration"><a class="anchor" href="#_download_and_migration"></a><a class="link" href="#_download_and_migration">Download and migration</a></h4>
<div class="paragraph">
<p>All documents in <em>arveo</em> that are subject to retention are available by the REST API and can be downloaded. The integrity and availability of the content is the responsibility of the provider and operator of the platform. The provider must ensure that failures of the storage systems for database and content are identified at an early stage and take appropriate countermeasures. See chapter <a href="#_fail_safety">Fail Safety</a> for technical and organizational measures for high availability of the <em>arveo</em> platform.</p>
</div>
<div class="paragraph">
<p>In the event that data has to be migrated, <em>arveo</em> offers an extensive export API that enables content and metadata to be exported.
<em>arveo</em> saves the hash value (<a href="https://en.wikipedia.org/wiki/Cryptographic_hash_function" class="bare">https://en.wikipedia.org/wiki/Cryptographic_hash_function</a>) in the database that was determined when the content was first uploaded (<a href="../arveo-developer#<em>upload_data">Upload Data</a>). This hash value can be used as a checksum to detect accidental or intentionally corruption of data. If the hash value of the content after the migration is identical to the original hash the migration report proves the correctness of the migration process. To report the completeness of the migration process  the _arveo</em> API allows you to export a list of all records, cases and documents in a document type.</p>
</div>
</div>
<div class="sect3">
<h4 id="_legally_compliant_migration"><a class="anchor" href="#_legally_compliant_migration"></a><a class="link" href="#_legally_compliant_migration">Legally compliant migration</a></h4>
<div class="ulist">
<ul>
<li>
<p>Prerequisite for the migration</p>
<div class="ulist">
<ul>
<li>
<p>use verify and best hash check possible in your solution when uploading content to <em>arveo</em>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>During the migration</p>
<div class="ulist">
<ul>
<li>
<p>download content and metadata (including the original hash and retention period)</p>
</li>
<li>
<p>upload metadata and content to the migrated platform and set the retention period to the exact same value.</p>
</li>
<li>
<p>calculate hash of the migrated platform by downloading the content</p>
</li>
</ul>
</div>
</li>
<li>
<p>After the migration</p>
<div class="ulist">
<ul>
<li>
<p>Correctness: compare hash, metadata and retention period for each original and migrated record, case and document.</p>
</li>
<li>
<p>Completeness: check that each migrated document can be found using the unique identifier</p>
</li>
<li>
<p>Traceability: Create a report for each document type. Report the content hash evidence and the metadata for all migrated objects.<br>
Upload the migration report to the migrated platform and set the retention period to the retention date of the document with the longest retention period within the report.<br>
Depending on your retention policy you can create separate reports for a retention period range (e.g. by year).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_data_integrity"><a class="anchor" href="#_data_integrity"></a><a class="link" href="#_data_integrity">Data integrity</a></h4>
<div class="paragraph">
<p><em>arveo</em> guarantees high availability, reliability and high performance at all times. The system has to be protected from manipulation attempts by proven and well-thought concepts. The data that is stored and managed in the system is protected via the API. The access and editing rights are managed via ACLs. User rights are based on the developed concepts for roles, groups and ACLs. More detailed information on this is provided in the relevant chapters of this manual.</p>
</div>
<div class="paragraph">
<p>Access to all data (documents, metadata) takes place exclusively via the API, with the corresponding protection mechanisms so that the security of the data is guaranteed at all times.</p>
</div>
<div class="sect4">
<h5 id="_content_storage"><a class="anchor" href="#_content_storage"></a><a class="link" href="#_content_storage">Content storage</a></h5>
<div class="paragraph">
<p>The operator must take appropriate technical or organizational measures to ensure that the data is stored in the storage in such a way that it cannot be changed within the legally prescribed retention period.</p>
</div>
<div class="paragraph">
<p>Enable the verify option for all clients and integrations. The upload API optionally can verify the uploaded content. The content service downloads the just uploaded stream from the
content storage and compares the hash once again with the expected value (<a href="../arveo-developer#<em>upload_data">Upload content</a>).
_arveo</em> stores the hash value in a system property and persists the value in the document type metadata table.</p>
</div>
<div class="paragraph">
<p>In case of very sensible data you can enable transparent encryption (<a href="../arveo-administration#_encryption">Encryption</a>) to follow the data protection rules and prevent your administrators from access of document content.</p>
</div>
</div>
<div class="sect4">
<h5 id="_databases"><a class="anchor" href="#_databases"></a><a class="link" href="#_databases">Databases</a></h5>
<div class="paragraph">
<p>For the supported databases postgreSQL 12 you can select between different data replication strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Asynchronous replication (backup or mirror): Enables an asynchronous disaster recovery. Your database is periodically mirrored.</p>
</li>
<li>
<p>Synchronous database cluster: Transactions are synchronously replicated on more than one master node.
The provider of the postgreSQL 12 cluster must guarantee that data is stored redundant and reduce potential data loss.
The provider of the apache solr 8.6 cluster must guarantee that data is replicated between the nodes and that the backup strategy prevents data loss.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The provider of the apache solr 8.6 cluster must guarantee that data is replicated between the nodes and that
the backup strategy prevents data loss.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fail_safety"><a class="anchor" href="#_fail_safety"></a><a class="link" href="#_fail_safety">Fail safety</a></h4>
<div class="paragraph">
<p>The system operator is responsible for data security and recovery. He must ensure that the backups of the data are checked regularly and that recovery is reliably possible in the event of a failure.
The IT processes that ensure the secure, redundant and highly available storage of <em>arveo</em> data in databases and object or file system storage systems are particularly decisive for the proper operation of the platform.
These are the responsibility of the operator of the platform, who must implement the availability and security of the systems in accordance with legal and organizational requirements.</p>
</div>
<div class="paragraph">
<p>We strongly recommend using a redundant file system or object storage system. If you do not at least backup your data periodically
a data loss is likely. For high availability with almost zero data loss our storage system should replicate the written content and data synchronously. The operating team of the platform must ensure that an appropriate replication is set up and monitored.</p>
</div>
<div class="paragraph">
<p>Object storages with REST APIs are designed for the cloud. If you decide to use storage from the Cloud (public or private) we recommend to use object storage via S3 API. Object storages provide a high level of redundancy (even geo redundant) and fail safety.
The REST S3 API is very tolerant against network and infrastructure failures.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Ensure technically and organizationally that there is sufficient space for storing the data.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the best high availability the provider of your storage system must protect the stored data against accidental, malicious, or disaster-induced loss of data. The better your data replication the better is your availability in case of a failure.</p>
</div>
<div class="paragraph">
<p>To achieve high availability for <em>arveo</em> the provider must guarantee that all required (<a href="../product-features#_content__services">content services</a>) run as a cluster.</p>
</div>
</div>
<div class="sect3">
<h4 id="_security"><a class="anchor" href="#_security"></a><a class="link" href="#_security">Security</a></h4>
<div class="sect4">
<h5 id="_operators"><a class="anchor" href="#_operators"></a><a class="link" href="#_operators">Operators</a></h5>
<div class="paragraph">
<p>The provider of the <em>arveo</em> services should ensure that only authorized data protection officers &amp; administrators have data
write (INSERT,UPDATE, DELETE) permissions for the database and the content repository.</p>
</div>
<div class="paragraph">
<p>An administrator only can illegally manipulate content if he can access both database and content storage because the control hash value of the content is stored in the database. Take care that none of your administrators has exclusive and unattended access to the content storage and the database.</p>
</div>
<div class="paragraph">
<p>Distributed management roles of the storage systems and the <em>arveo</em> transparent <a href="../arveo-administration#_encryption">encryption</a> feature make your system more forgery-proof!</p>
</div>
<div class="paragraph">
<p>The activities of administrators with extensive rights must be logged by the operator. The logs are subject to the retention periods of tax law and must be checked regularly.</p>
</div>
</div>
<div class="sect4">
<h5 id="_platform_link"><a class="anchor" href="#_platform_link"></a><a class="link" href="#_platform_link">Platform</a></h5>
<div class="paragraph">
<p>To prevent unauthorized access to the <em>arveo</em> platform the provider must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ensure that HTTPS communication is enabled for all clients, applications, 3rd party components and services (<a href="../product-features#_content__services">Services</a>).</p>
</li>
<li>
<p>enable OAuth2.0 or X.509 certificate authentication <a href="../arveo-developer#<em>authentication-x509">X.509 certificate authentication</a> and authorization for all _arveo</em> service (<a href="../arveo-administration#<em>authentication-oauth2">OAuth2.0</a>). All _arveo</em> services require authentication, ensuring that only  <em>arveo</em> services or authenticated and authorized users can use the API. We recommend using a state-of-the-art authentication services like keycloak and to enable <a href="../arveo-administration#_configure_keycloak_for_sso_with_kerberos"><strong>SSO</strong></a> with at least 2-factor authentication.</p>
</li>
<li>
<p>take suitable technical or organizational actions against unauthorized changes to the data such as firewall, VPN, transparent encryption with <em>arveo</em> or at hardware level,</p>
</li>
<li>
<p>provide adequate protection of passwords by using a state-of-the-art IDP such as Keycloak or MS Active Directory and increasing the password complexity accordingly.</p>
</li>
<li>
<p>take actions against denial of service attacks.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_arveo_content_services"><a class="anchor" href="#_arveo_content_services"></a><a class="link" href="#_arveo_content_services"><em>arveo</em> Content Services</a></h5>
<div class="paragraph">
<p>The administrators of the <em>arveo</em> platform must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>make sure that only authorized persons receive an account that grants access to <em>arveo</em> documents;</p>
</li>
<li>
<p>ensure that objects are protected against unauthorized access using ACLs. We recommend defining a separation of functions and implementing this via <a href="../arveo-developer#_access_control_lists">ACLs</a>. To achieve the best data security assign ACLs to all records, cases and documents. Make sure that for all used ACLs the assignment of access rights to users and groups is carried out regularly (e.g. Invoice document type, accounting: write, employees: read);</p>
</li>
<li>
<p>the activities of managers who can change ACLs are logged via <em>arveo</em> audit and checked at regular intervals;</p>
</li>
<li>
<p>organizationally ensure that the password the <em>arveo</em> administration users are changed regularly.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_store"><a class="anchor" href="#_data_store"></a><a class="link" href="#_data_store"><strong>Data Store</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_persistence_architecture"><a class="anchor" href="#_persistence_architecture"></a><a class="link" href="#_persistence_architecture">Persistence architecture</a></h3>
<div class="paragraph">
<p><em>arveo</em> guarantees forgery-proof long term availability of your content and metadata.</p>
</div>
<div class="paragraph">
<p>All revisions of content or metadata are stored as a traceable and immutable version
(<a href="#_versioning_v">Versioning</a>) to the storage systems.
The content service checks the integrity of uploaded content by computing SHA-256 hashes on client and server side.
Additionally, an audit entry is written to the audit log table (<a href="#_configure_audit">Audit Log</a>).
<em>arveo</em> provides a role based access control on object level and allows you to prevent unauthorized access
to content and metadata.</p>
</div>
<div class="paragraph">
<p><em>arveo</em> protects content and metadata by software design. <em>arveo</em> only allows access to
content and metadata via the <em>arveo</em> REST API. As only <em>arveo</em> and highly authorized administrators have
data writer rights for the database and the storage it is impossible that content
is deleted or manipulated by unauthorized persons.</p>
</div>
<div class="paragraph">
<p>Together with <em>arveo</em>'s capabilities to manage the retention periods of documents and records
(<a href="#_retention_periods_retention">Retention Periods</a>) <em>arveo</em> guarantees a  GDPR and/or DSGVO compliant data protection and data privacy.</p>
</div>
<div class="paragraph">
<p><strong><em>arveo</em> meets the the requirements of a revision proof long term archive and is a corner stone for the legal compliance of your IT systems.</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because the new legal data privacy / protection act makes it necessary to erase data even before the expected
retention period has expired <em>arveo</em> does not use hardware retention features.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If needed you can add verifiable evidence records to the documents (signatures, timestamps) to proof the integrity and authenticity
of content and author. The creation of the evidence is not a feature of <em>arveo</em> . It only stores the record together with
the content.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this chapter you will find all information how to setup a secure and legally compliant content service platform
with <em>arveo</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_data_types"><a class="anchor" href="#_data_types"></a><a class="link" href="#_data_types">Data types</a></h3>
<div class="paragraph">
<p><em>arveo</em> distinguishes three kinds of data and stores each to the most suitable storage system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Content: <em>arveo</em> stores unstructured content like documents, audio, video and images to
either a cloud object storage or a file system storage.<br>
Most cloud providers like AWS S3, NetAPP ONTAP, EMC Elastic Cloud, etc. provide file system storage or object storage systems.
Object storages are organized in buckets and allow you to store an almost unlimited numbers of objects in a bucket.
<em>arveo</em> accesses the content via REST Standard S3.<br>
For an optimized and fast access of often used content objects <em>arveo</em> can integrate a NoSQL Keyvalue
Cache DB like redis.</p>
</li>
<li>
<p>Structured system properties: containing all primary keys and technical information
about documents, containers and folders. The data has a fix data model and requires highest performance, consistency and
transaction support. <em>arveo</em> saves the data on a relational database.</p>
</li>
<li>
<p>Customer specific metadata: The data model is different for each document, container or folder type. This metadata is
semi structured and new properties might be added during the life cycle of the application.</p>
<div class="ulist">
<ul>
<li>
<p>Eventually consistent customer information: Sometimes the consistency of the data is not important, but we must guarantee a high performance and facets support when we filter by any value without the risk of a full table scan.
<em>arveo</em> saves customer metadata on a NoSQL document DB apache solr 8.6 which
is highly efficient for inserting and searching and offers automatic completion and facets.</p>
</li>
<li>
<p>Consistent customer keys: The properties require highest performance, consistancy and
transaction support. <em>arveo</em> saves the data on a relational database.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_high_availability"><a class="anchor" href="#_high_availability"></a><a class="link" href="#_high_availability">High availability</a></h3>
<div class="paragraph">
<p>The high availability (HA) of <em>arveo</em> depends highly on the HA of the storage systems for all kind of data. Each of the storage systems and as a result the <em>arveo</em> services follow the CAP (Consistency, Availability and Partition Tolerance) theorem saying that the availability and fail safety of a system depend on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Consistency: All clients see the same content and metadata.</p>
</li>
<li>
<p>Availability: All clients can read and write.</p>
</li>
<li>
<p>Partition Tolerance: the system is fail safe when one or more nodes fail.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/captheorem.png" alt="CAP theorem">
</div>
</div>
<div class="paragraph">
<p>The CAP theorem in a nutshell predicts that you cannot have all three properties but only two of them.</p>
</div>
<div class="paragraph">
<p>As <em>arveo</em> is a ECM cloud platform <strong>consistency</strong> and <strong>availability</strong> (read/write) of content and metadata
are most important. <em>arveo</em> tolerates that network or message failure of either the primary content
storage or database node can cause exceptions on the client application.
The <em>arveo</em> services do not store data within their containers and focus on scalability and partition tolerance.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <em>arveo</em> micro services should be deployed as containers in your cloud environment (e.g. kubernetes) and auto scaling should be implemented.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_data_integrity_1"><a class="anchor" href="#_data_integrity_1"></a><a class="link" href="#_data_integrity_1">Data integrity</a></h3>
<div class="paragraph">
<p><em>arveo</em> ensures the immutability and integrity of all your digital content and evidence records by an automated hash check each time content is up- or downloaded.</p>
</div>
<div class="sect3">
<h4 id="_upload"><a class="anchor" href="#_upload"></a><a class="link" href="#_upload">Upload</a></h4>
<div class="paragraph">
<p><strong>Hash-Check:</strong> When you use the upload content API, the client side and content service compute SHA-256 hash for the streamed data.
Only if both values are identical the upload process is successful.
The upload API allows you to pass the expected SHA-256 value and the API will only return OK if the server side hash
matches the expected hash.</p>
</div>
<div class="paragraph">
<p><strong>Verify:</strong> The upload API optionally can verify the uploaded content. The content service downloads the just uploaded stream from the
content storage and compares the hash once again with the expected value (<a href="#_upload_data">Upload Content</a>).
<em>arveo</em> stores the hash value in a system property and persists the value in the document type metadata table.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The verify option of the Upload API may slow down your system when uploading a huge amount of data.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_transactions"><a class="anchor" href="#_transactions"></a><a class="link" href="#_transactions">Transactions</a></h4>
<div class="paragraph">
<p>The <em>arveo</em> REST API is stateless and there is no session. That means that all REST API calls are atomic and all database commands are executed within one transaction. <em>arveo</em> guarantees the atomicity of the transactions and to avoid inconsistent states, all aborted transactions are removed and rolled back. Hanging transactions are removed and rolled back to avoid database locks.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The database provider should configure the transaction deadlock timeout on your database to avoid locks on the database that can decrease the performance of your UPDATE and DELETE calls.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_download"><a class="anchor" href="#_download"></a><a class="link" href="#_download">Download</a></h4>
<div class="paragraph">
<p>When you use the download API (<a href="../arveo-developer#_download_data">Download Content</a>) the client SDK computes the SHA-256 hash of the downloaded stream and compares it to the hash value
in the system property of the document type. If the hash does not match the upload hash value in the database the download fails with a data integrity exception
telling the caller that the data on the storage was most likely manipulated.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
An administrator only can illegally manipulate content if he can access both database and content storage because the control hash value of the content is stored in the database. Take care that none of your administrators has exclusive and unattended access to the content storage and the database.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Distributed management roles of the storage systems and the <em>arveo</em> transparent encryption feature can make your system forgery-proof!
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_content_storage_2"><a class="anchor" href="#_content_storage_2"></a><a class="link" href="#_content_storage_2">Content storage</a></h3>
<div class="paragraph">
<p><em>arveo</em> support evidence proof long term storage of your content and metadata by storing the content legally secure to either a S3 object storage or a file system. The storage must be redundant. Object storage systems like AWS, NetAPP or EMC Elastic Cloud Storage guarantee the long term availability and integrity of your content.</p>
</div>
<div class="paragraph">
<p>All changes of content or metadata are persisted as a traceable and immutable version (<a href="../arveo-developer#<em>versioning_v">Versioning</a>) on your storage system
and an audit entry is written to the audit log table (<a href="../arveo-administration#_configure_audit">Audit Log</a>).
_arveo</em> creates a version each time metadata including comments and annotations or content of a document is changed by the API <em>arveo</em>} creates a new entry containing the author and the timestamp pf the change in the version management table.
The Update API allows you to add a comment to each version. The Version Management API provides access to all version information and metadata and content of previous versions.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
To ensure that the content is immutable only <em>arveo</em> should have write access to the storage system.<br>
Only authorized data protection officers &amp; administrators should have write-access to the storage system.<br>
In case of very sensible data you can enable encryption (<a href="#_encryption">Encryption</a>) to follow the data protection rules and prevent your administrators from access of document content.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For best high availability the provider of your storage system must protect the stored data against accidental, malicious, or disaster-induced
loss of data. The better your data replication the better is your availability in case of a failure.</p>
</div>
<div class="sect3">
<h4 id="_data_replication_redundancy"><a class="anchor" href="#_data_replication_redundancy"></a><a class="link" href="#_data_replication_redundancy">Data replication (redundancy)</a></h4>
<div class="paragraph">
<p>For both supported storages (S3, file system) you can select between different data replication strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Backup or Mirror enables an asynchronous disaster recovery. Your content data is periodically mirrored and the data;</p>
</li>
<li>
<p>Synchronous replication;</p>
</li>
<li>
<p>Asynchronous replication.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_fail_safety_consistency_availability"><a class="anchor" href="#_fail_safety_consistency_availability"></a><a class="link" href="#_fail_safety_consistency_availability">Fail Safety (Consistency, Availability)</a></h4>
<div class="paragraph">
<p>As <em>arveo</em> stores each version of the content as an immutable object it is not possible that clients will get
outdated data. If the replication is asynchronous it only can happen that clients get a read error.</p>
</div>
<div class="paragraph">
<p>In case the storage is offline <em>arveo</em> is not available and the system has an outage.
In case the storage allows only read access <em>arveo</em> can download content but upload operations fail.</p>
</div>
<div class="paragraph">
<p>If the storage node has a long term outage the potential data loss is limited by the time
that has passed since the last replication and the number of objects stored since that time.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
We strongly recommend using a redundant file system or object storage system. If you do not at least backup your data periodically
a data loss is likely.<br>
For high availability with almost zero data loss
your storage system should replicate the written content and data synchronously.<br>
The operating team of the platform must ensure that an appropriate replication is set up and monitored.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can configure different storage location (Cloud-Storage or on premise) for your content and document types (<a href="#_bucketorganizer">Storage Configuration</a>).<br>
Reduce costs by storing non compliant and legally relevant data like PDF/A renditions of documents on storage systems with lower availability and performance SLAs.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Object storages with REST APIs are designed for the cloud. If you decide to use storage from the Cloud (public or private)
we recommend to use object storage via S3 API. Object storages provide a high level of redundancy (even geo redundant) and fail safety.
The REST S3 API is very tolerant against network and infrastructure failures.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_consistent_meta_data_storage_relational_database"><a class="anchor" href="#_consistent_meta_data_storage_relational_database"></a><a class="link" href="#_consistent_meta_data_storage_relational_database">Consistent meta data storage (relational database)</a></h4>
<div class="paragraph">
<p>The relational database postgreSQL 12 is responsible for 100% consistent processing of the structured metadata and transactions.</p>
</div>
<div class="sect4">
<h5 id="_data_replication_redundancy_2"><a class="anchor" href="#_data_replication_redundancy_2"></a><a class="link" href="#_data_replication_redundancy_2">Data replication (redundancy)</a></h5>
<div class="paragraph">
<p>For the supported databases postgreSQL 12 you can select between different data replication strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Asynchronous replication (backup or mirror): Enables an asynchronous disaster recovery. Your database is periodically mirrored.</p>
</li>
<li>
<p>Synchronous database cluster: Transactions are synchronously replicated on more than one master node.</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The provider of the postgreSQL 12 cluster must guarantee that data is stored redundant and reduce potential data loss.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fail_safety_consistency_availability_2"><a class="anchor" href="#_fail_safety_consistency_availability_2"></a><a class="link" href="#_fail_safety_consistency_availability_2">Fail safety (consistency, availability)</a></h4>
<div class="paragraph">
<p>In case the database cluster is down or allows only read access <em>arveo</em> is not available (Deny Of Service/DOS).
If the database has a long term outage and the data files are affected the potential data loss is limited by the time
that has passed since the last replication and the number of objects stored since that time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_eventually_consistent_meta_data_storage_nosql_document_database_apache_solr_8_6"><a class="anchor" href="#_eventually_consistent_meta_data_storage_nosql_document_database_apache_solr_8_6"></a><a class="link" href="#_eventually_consistent_meta_data_storage_nosql_document_database_apache_solr_8_6">Eventually consistent meta data storage (NoSQL document database apache solr 8.6)</a></h4>
<div class="paragraph">
<p><em>arveo</em> uses modern NoSQL storage technologies to guarantee high search performance and horizontal scalability at
all times. We store semi-structured or dynamic document metadata to a NoSQL document database apache solr 8.6.</p>
</div>
<div class="paragraph">
<p>Solr is an open source search platform that has been partially integrated into <em>arveo</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../images/solr_arveo.png" alt="solr arveo">
</div>
</div>
<div class="paragraph">
<p>Based on the type definitions that are created in <em>arveo</em>, <em>arveo</em> automatically creates a schema
that Solr uses. In addition, for each client that is created in <em>arveo</em>, a new collection is also created in
Solr, so that there is also a separation of data there.</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_replication_redundancy_3"><a class="anchor" href="#_data_replication_redundancy_3"></a><a class="link" href="#_data_replication_redundancy_3">Data Replication (Redundancy)</a></h4>
<div class="paragraph">
<p>Setup a cluster of replicated nodes for apache solr 8.6. Refer to the apache solr 8.6 documentation to
setup a redundant cluster.</p>
</div>
<div class="sect4">
<h5 id="_fail_safety_availability_partition_tolerance"><a class="anchor" href="#_fail_safety_availability_partition_tolerance"></a><a class="link" href="#_fail_safety_availability_partition_tolerance">Fail safety (availability, partition tolerance)</a></h5>
<div class="paragraph">
<p>In case the database cluster is down <em>arveo</em> is still available but free customer searches fail.
In case one database node is down or the database is read only <em>arveo</em> is still available but searches may return outdated results.
If the database has a long term outage and the data files are affected the potential data loss is limited by the time that has passed since the last replication and the number of objects stored since that time.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The provider of the apache solr 8.6 cluster must guarantee that data is replicated between the nodes and that the a backup strategy prevents data loss.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_clustering"><a class="anchor" href="#_clustering"></a><a class="link" href="#_clustering">Clustering</a></h3>
<div class="paragraph">
<p>Each <em>arveo</em> service can be configured as a service cluster to achieve HA. Depending on the deployment you can either set up an application server cluster (WAR deployment) or run our containerized applications on a cloud platform like open-stack with kubernetes.</p>
</div>
<div class="sect3">
<h4 id="_fail_safety_consistency_availability_3"><a class="anchor" href="#_fail_safety_consistency_availability_3"></a><a class="link" href="#_fail_safety_consistency_availability_3">Fail safety (consistency, availability)</a></h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Content services in <em>arveo</em></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Failure risks</th>
<th class="tableblock halign-left valign-top">Recommended</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User management Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No login possible, system outage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Config Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration not available to all nodes, system outage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registry Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service registry not available, system outage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Document Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Store, edit and version documents and metadata not available, system outage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2-n, automatic scale up/down by load</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAP Archive Link Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAP archive link not available, SAP outage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2-n, automatic scale up/down by load</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Document Conversion Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conversion to PDF/A not available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2-n, automatic scale up/down by load</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise Integration Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Job execution paused and integration with external systems not available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2-n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Federation Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to external repositories (Documentum, Saperion) not available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2-n, automatic scale up/down by load</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Control Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access of objects with  access control list fails, partial system outage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_required_3rd_party_services"><a class="anchor" href="#_required_3rd_party_services"></a><a class="link" href="#_required_3rd_party_services">Required 3rd party services</a></h4>
<div class="paragraph">
<p>To operate <em>arveo</em> successfully with high availability the operator of the platform must provide
the following services as a cluster.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Failure risks</th>
<th class="tableblock halign-left valign-top">Recommended</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active MQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asynchronous operations are not triggered</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">postgreSQL 12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to metadata not available, system outage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2-n depending on load and configuration of postgreSQL 12 cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apache solr 8.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise search not available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2-n depending on load and configuration of apache solr 8.6 cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content access not available, system outage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage cluster depending on provider</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Service (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Login not available via OAUTH2, system outage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitoring (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ELK (Elasticsearch, Logstash, and Kibana)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster 2</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
To achieve high availability for <em>arveo</em> the provider must guarantee that all required <a href="#_content__services">content services</a> run as a cluster.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_data_deletion"><a class="anchor" href="#_data_deletion"></a><a class="link" href="#_data_deletion">Data deletion</a></h3>
<div class="paragraph">
<p>By default all documents of a specific document type stored in <em>arveo</em> store the metadata to the configured database and their content to the object storage. When a version is created the content or metadata is stored as a traceable and immutable version (<a href="#_versioning_v">Versioning</a>) to the database and storage system. That means that we have separate content objects and database entries for each version.
Each document can have a retention period that ensures that the document cannot be deleted before the period expires.</p>
</div>
<div class="paragraph">
<p>You can delete or purge any object with the <em>arveo</em> Delete-API if you have the <em>DELETE</em> right for the document type and the object ACL and the retentions period has not expired.</p>
</div>
<div class="paragraph">
<p>The delete method deletes all entities including all versions of the object in the database, but it does not delete the content objects or files. The delete operation cannot be restored and the data is permanently deleted.</p>
</div>
<div class="paragraph">
<p>The purge method additionally erases the content objects or files from the content storage.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you delete objects only in the database the content objects are orphaned, and it is impossible to restore them and almost impossible to delete them later on because there is no relation left in the database. The content objects remain as data trash in the system and cannot be accessed by the API.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_recycle_bin"><a class="anchor" href="#_recycle_bin"></a><a class="link" href="#_recycle_bin">Recycle bin</a></h3>
<div class="paragraph">
<p>Any document, container or folder type can use the optional <em>recycle bin</em> feature. If it is enabled, entities in the type definition can be moved to and restored from the recycle bin.</p>
</div>
<div class="paragraph">
<p>The recycle bin is implemented as a boolean database system property <em>DELETED</em>. Entities in the recycle bin will be filtered from normal queries by default, but a client can compose search expressions that override this behavior (see <a href="#_document_service_recycle_bin">Recycle Bin</a>).</p>
</div>
<div class="paragraph">
<p>If you delete or purge an object in the recycle bin it is deleted like a document without recycle bin feature and cannot be restored.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For compliance reasons the audit entries in the database are not deleted by the Delete-API and the delete operation written to the audit log. The operator of the  platform must clean up the audit table after the legal retention period has expired. We recommend backing up the audit logs to meet the legal requirements of data protection and to ensure that the backups can be restored within the legal retention period.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_automated_recycle_bin_emptying"><a class="anchor" href="#_automated_recycle_bin_emptying"></a><a class="link" href="#_automated_recycle_bin_emptying">Automated recycle bin emptying</a></h4>
<div class="paragraph">
<p>It is possible to empty your recycle bin by an automated job scheduled in the Enterprise Integration Service of <em>arveo</em>.You can activate the predefined empty recycle bin job, and you can change the age from the 6 months default value to the age you choose. The job deletes all entries permanently that have been in the recycle bin for longer than the set age.</p>
</div>
</div>
<div class="sect3">
<h4 id="_recovery_log"><a class="anchor" href="#_recovery_log"></a><a class="link" href="#_recovery_log">Recovery log</a></h4>
<div class="paragraph">
<p>In addition to the recycle bin feature, the <em>arveo</em> offers an additional safety layer to recover permanently deleted entities.By annotating a type definition with <em>@Recovery</em>, it is possible to define a time period, in which permanently deleted entities will be kept in a system-wide recovery table before they are removed completely.An entity in such a type definition that is deleted (or purged) will be removed from the type definition&#8217;s table (and its version table).A copy of each version of the entity will be stored in the recovery table making it possible to restore it manually.If the entity is a document, its contents will not be deleted from the storage until the entity is removed from the recovery table.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
There is no API to restore data from the recovery table.
This feature is only intended as a last backup in order to make accidentally deleted data available to the business by an administrator.The admin can copy the content file from the storage together with the JSON metadata and send it to the business department.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_recovery_log_emptying"><a class="anchor" href="#_recovery_log_emptying"></a><a class="link" href="#_recovery_log_emptying">Recovery log emptying</a></h4>
<div class="paragraph">
<p>The system management API provides a method to remove expired entities from the recovery table.An entity is considered expired when its keep-until timestamp is in the past compared from the moment the method is invoked.A user who calls this
method needs the <strong>ECR_PURGE_RECOVERY_TABLE</strong> authority (see <a href="#_access_rights">Access Rights</a>).</p>
</div>
<div class="paragraph">
<p>The recovery of deleted entities is a manual process. The recovery table contains a JSONB column containing a JSON representation of the entire entity including attributes, content information and modification information. Each version of an entity is contained in the recovery table as a separate row.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is possible to empty the recovery log by an automated custom job scheduled in the Enterprise Integration Service of <em>arveo</em>. The job must execute the Management-API method to empty the recovery table.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_access_control"><a class="anchor" href="#_access_control"></a><a class="link" href="#_access_control"><strong>Access Control</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_access_rights"><a class="anchor" href="#_access_rights"></a><a class="link" href="#_access_rights">Access rights</a></h3>
<div class="paragraph">
<p>The REST API has the following user-rights (authorities) for different endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ECR_SERVICE_USER</strong> (configurable): Required authority for all API endpoints. Must always be present.</p>
</li>
<li>
<p><strong>ECR_ADMIN</strong>: Allows editing type- and attribute definitions as well as other administrative operations.</p>
</li>
<li>
<p><strong>ECR_DSGVO_ADMIN</strong>: Allows a user to change the litigation hold and retention settings of entities contained in type
definitions using the retention feature.</p>
</li>
<li>
<p><strong>ECR_DSGVO_PRIVILEGED_DELETE</strong>: An addition to ECR_DSGVO_ADMIN that allows a user to delete an entity which is still
within it&#8217;s retention period. Organisational precautions must be put in place to ensure DSGVO compliance when making use
of this authority. ECR_DSGVO_PRIVILEGED_DELETE privilege does NOT require ECR_DSGVO_ADMIN privilege.</p>
</li>
<li>
<p><strong>ECR_ALL_TYPES_READ</strong>: Allows read access to all type definitions that use type level access restrictions.</p>
</li>
<li>
<p><strong>ECR_ALL_TYPES_WRITE</strong>: Allows write access to all type definitions that use type level access restrictions.</p>
</li>
<li>
<p><strong>ECR_PURGE_RECOVERY_TABLE</strong>: Allows a user to trigger the removal of expired entries in the recovery table.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_access_control_lists"><a class="anchor" href="#_access_control_lists"></a><a class="link" href="#_access_control_lists">Access control lists</a></h3>
<div class="paragraph">
<p><em>arveo</em> makes use of access control lists (ACLs) to protect entities. Each entity can be protected by one ACL.
The handling of ACLs is performed by the Access Control Service. The documentation of the Access Control Service contains
more information about the general concept of the ACLs used by <em>arveo</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To enable the ACL feature for a type definition, the type class must be annotated with <code>@Acls</code>. Meta-data type definitions
do not support ACLs.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_mapping_of_the_access_control_list_values"><a class="anchor" href="#_mapping_of_the_access_control_list_values"></a><a class="link" href="#_mapping_of_the_access_control_list_values">Mapping of the Access Control List values</a></h4>
<div class="paragraph">
<p>Although the module <code>user-management-access-control</code> defines the concepts and functionality of the ACLs, the actual
mapping of the values is implemented in <em>arveo</em>. The class <code>de.eitco.ecr.acl.AclRight</code> implements the
following permissions using the numeric values shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/**
 * The user is allowed to see the object's meta data but not the content.
 */
BROWSE(4000),

/**
 * The user is allowed to see the meta data and content of the object.
 */
READ(8000),

/**
 * The user is allowed to add annotations to the object.
 */
COMMENT(12000),

/**
 * The user is allowed to change meta data and content of the object creating a new version.
 */
WRITE(16000),

/**
 * The user is allowed to overwrite an existing version of the object.
 */
OVERWRITE(20000),

/**
 * The user is allowed to delete the object.
 */
DELETE(24000),

/**
 * The user is allowed to change the ACL of the object.
 */
CHANGE_ACL((Short.MAX_VALUE - 1));</code></pre>
</div>
</div>
<div class="paragraph">
<p>To illustrate the information above, here are some examples:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The permission COMMENT is assigned to a group or a job position. In this case, the assignee is per default granted
the permissions BROWSE and READ;</p>
</li>
<li>
<p>The prohibition WRITE is assigned to a group or a job position. In this case, the assignee is per default prohibited
all the higher rights, so OVERWRITE, DELETE and CHANGE_ACL;</p>
</li>
<li>
<p>A job position J1 with the permission COMMENT acts as a substitute for a job position J2 with the permission OVERWRITE.
So the job position J1 is assigned the permission OVERWRITE for the time of the substitution.</p>
</li>
<li>
<p>A job position J1 with the prohibition WRITE acts as a substitute for a job position J2 with the prohibition READ.
The job position J1 is still assigned the prohibition WRITE for the time of the substitution. This way, it is guaranteed,
that J1 is still able to perform their tasks (which would become impossible if they were assigned stronger prohibitions,
that is, the prohibitions of J2).</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_batch_updates_for_acls"><a class="anchor" href="#_batch_updates_for_acls"></a><a class="link" href="#_batch_updates_for_acls">Batch updates for ACLs</a></h4>
<div class="paragraph">
<p>It is possible to change values of multiple ACLs. So lists of ACLs, that satisfy a certain condition, can be processed.
For every ACL, that fulfills a given condition, the following modifications can be specified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>addgroupright (adds a given right to a given group in every ACL that fulfills the condition);</p>
</li>
<li>
<p>adduserright (adds a given right to a given user in every ACL that fulfills the condition);</p>
</li>
<li>
<p>keepgroupright (keeps the current right of a given group in every ACL that fulfills the condition);</p>
</li>
<li>
<p>keepuserright (keeps the current right of a given user in every ACL that fulfills the condition).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All the other entries in the ACLs that fulfill the condition, are removed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The ACL updates are performed in the the module 'common', in the Client SDK by the class <em>AclServiceClient</em>. It calls the
method <em>updateAclsWhere()</em> and passes two parameters: an <em>Expression</em> of type <em>Boolean</em> (the condition mentioned above)
and a <em>List</em> of type <em>AccessControlListModification</em> as modifications (the four modifications mentioned above) to apply
to every ACL. The method <em>updateAclsWhere()</em> executes the given ACL batch updates.</p>
</div>
<div class="paragraph">
<p>There is also a more convenient method with the same name updateAclsWhere(), that returns a <em>ConditionBuilder</em>, that can
be used in searches (see <a href=".#_search_service">Search Service</a>).</p>
</div>
<div class="sect4">
<h5 id="_example_of_usage"><a class="anchor" href="#_example_of_usage"></a><a class="link" href="#_example_of_usage">Example of usage</a></h5>
<div class="paragraph">
<p>Consider the following snippet from a test class as an example of the batch update functionality for the ACLs.
Pay attention to the method <em>setRightsTo()</em>, which is called to modify the current rights.</p>
</div>
<div class="listingblock">
<div class="title">Example of batch update functionality</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        aclServiceClient.updateAclsWhere().contextReference("id").in().values(
                acl1.getIdentifier().getValue(),
                acl2.getIdentifier().getValue()
            ).holds()
            .setRightsTo(GrantAndDeny.grant(AclRight.READ)).of(umAdmin.getIdentifier())
            .execute();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_attribute_based_access_control_abac"><a class="anchor" href="#_attribute_based_access_control_abac"></a><a class="link" href="#_attribute_based_access_control_abac">Attribute Based Access Control (ABAC)</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>arveo allows entity access based on attributes of that entity.
This can be specified per entity by a static method annotated with <code>@Security</code>.
The method must return an eql expression that resolves to a boolean i.e. a condition.
It will be called by arveo when entities of the given type are accessed to retrieve an additional filter for the access.
<strong>Operations will only affect entities where the condition evaluates to true.</strong></p>
</div>
<div class="paragraph">
<p>Every operation on entities of the type will execute the method and add the resulting expression to the filter of the operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Searches will add the expression to the filter of the search request.</p>
</li>
<li>
<p>Batch operations will add the expression to their filter</p>
</li>
<li>
<p>Calls that operate on a specific id will fail if the expression yields <code>false</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The simplest case would look like this:</p>
</div>
<div class="listingblock">
<div class="title">The simplest access check</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT)
public interface UnsecuredDocuments {

    @Security
    static Expression&lt;Boolean&gt; calculateAccess() {

        return Eql.alwaysTrue();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would add the filter 'true' to every operation on the entity, which would allow anyone to access entities.</p>
</div>
<div class="paragraph">
<p>In most cases, one would want to compare attributes of the entity with properties of the user requesting the current operation.
The first can be accomplished with the eql:</p>
</div>
<div class="listingblock">
<div class="title">Accessing an attribute</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
public interface ThresholdContainer {

    int getThreshold();

    void setThreshold(int threshold);

    @Security
    static Expression&lt;Boolean&gt; calculateAccess(Alias alias) {

        return EcrQueryLanguage.condition().
                        alias(alias).field("threshold").
                                greaterThan().value(300);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Users may only access entities of the type above where the field 'threshold' is greater than 300.</p>
</div>
<div class="paragraph">
<p>In order to check the user requesting an operation, one can define a parameter to the method of the type <code>AuthenticationContext</code>.
Other information may be accessed this way, too.
The method can have up to four parameters of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AuthenticationContext</code>: this class holds information about the user requesting the operation.</p>
</li>
<li>
<p><code>AclRight</code>: the right needed to perform the operation.</p>
</li>
<li>
<p><code>Alias</code>: identifies the part of the query that holds the entity</p>
</li>
<li>
<p><code>DSLContext</code>: an entrypoint to the <a href="https://www.jooq.org/doc/3.15/manual/">jooq</a> api bound to the database and schema the table containing the entities is located in.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_parameters"><a class="anchor" href="#_parameters"></a><a class="link" href="#_parameters">Parameters</a></h3>
<div class="sect3">
<h4 id="_authenticationcontext_who_requests_the_operation"><a class="anchor" href="#_authenticationcontext_who_requests_the_operation"></a><a class="link" href="#_authenticationcontext_who_requests_the_operation"><code>AuthenticationContext</code>: who requests the operation?</a></h4>
<div class="paragraph">
<p>The <code>AuthenticationContext</code> holds information about the user requesting the operation.
This parameter will most likely be used in every such method, except for the most basic cases.</p>
</div>
<div class="paragraph">
<p>Take a case where access to a document is specified by a field named <code>access_token</code>.
It holds the name of a user-management authority every user with access to it must have.
If it is null, every user has access to the document:</p>
</div>
<div class="listingblock">
<div class="title">A type specifying different access to different users</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT)
@OverwriteAllowed
public interface DocumentWithAccessToken {

    @Mandatory(false)
    String getAccessToken(); <i class="conum" data-value="1"></i><b>(1)</b>

    void setAccessToken(String accessToken);

    @Security
    static Expression&lt;Boolean&gt; calculateAccess(Alias alias, AuthenticationContext authenticationContext, DSLContext dslContext) { <i class="conum" data-value="4"></i><b>(4)</b>

        return EcrQueryLanguage.condition()
            .alias(alias).field("access_token").isNull() <i class="conum" data-value="2"></i><b>(2)</b>
            .or()
            .value(authenticationContext.getAuthorities())
            .contains().alias(alias).field("access_token")
            .holds();
    }

    // ...
    // more attributes <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the type defines the attribute that specifies access</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the query generated uses this attribute.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>other elements of the type are omitted for the sake of readability</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>note that the third parameter is unused. In such a case it could be omitted.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_aclright_what_will_the_operation_do"><a class="anchor" href="#_aclright_what_will_the_operation_do"></a><a class="link" href="#_aclright_what_will_the_operation_do"><code>AclRight</code>: what will the operation do?</a></h4>
<div class="paragraph">
<p>The <code>AclRight</code> parameter holds the right necessary to perform the operation requested.
This is a hint for the method about what should actually be done in the operation.
It allows differentiating between read and write access:</p>
</div>
<div class="listingblock">
<div class="title">A type differentiating between read and write access</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
@OverwriteAllowed
@Acls
public interface ContainerAccessedByUserId {

    long getOwner(); <i class="conum" data-value="1"></i><b>(1)</b>

    void setOwner(long owner);

    List&lt;Long&gt; getAudience(); <i class="conum" data-value="2"></i><b>(2)</b>

    void setAudience(List&lt;Long&gt; audience);

    @Security
    static Expression&lt;Boolean&gt; checkAccess(Alias alias, AuthenticationContext authenticationContext, AclRight right) {

        long userId = authenticationContext.getUser().getIdentifier().getValue();

        if (AclRight.READ.getValue() &lt; right.getValue()) { <i class="conum" data-value="3"></i><b>(3)</b>

            return EcrQueryLanguage.condition().alias(alias).field("owner").equalTo().value(userId).holds();
        }

        return EcrQueryLanguage.condition()  <i class="conum" data-value="4"></i><b>(4)</b>
            .alias(alias).field("audience").contains().value(userId)
            .or().alias(alias).field("owner").equalTo().value(userId)
            .holds();
    }

    // ...
    // more attributes
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This type defines an attribute <code>owner</code> holding the user id of the user, responsible.
The owner of an entity will be the only user to modify the entities.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The type also defines a list of user ids <code>audience</code>, holding the ids of users that may read the entity.
Users that are neither <code>owner</code> nor <code>audience</code> have no access on the entity.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Thus, in cases where a right greater than <code>READ</code> is requested, the method returns an expression, that checks whether the current user is the owner of the document.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>In every other case .i.e. the requested access right is <code>READ</code> or below, an expression is returned, that checks whether the current user is the owner or part of the audience.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_alias"><a class="anchor" href="#_alias"></a><a class="link" href="#_alias"><code>Alias</code></a></h4>
<div class="paragraph">
<p>The alias identifies the part of the query executed that contains the entity and should be used to reference its members.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Always use the alias as given in the examples.
Other ways to reference the entity might work in most cases but only using the alias assures that referencing entity attributes works in every case.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The full class name is <code>de.eitco.ecr.common.search.Alias</code>.
Avoid confusion with another <code>Alias</code> class.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dslcontext"><a class="anchor" href="#_dslcontext"></a><a class="link" href="#_dslcontext"><code>DSLContext</code></a></h4>
<div class="paragraph">
<p>In some cases, using expressions on the entity itself may become cumbersome or slow.
For that, one can use the DSLContext parameter.
This allows access by <a href="https://www.jooq.org/doc/3.15/manual/">jooq</a> to any table in the same schema the table of the requested entity is located in.
It can be used to obtain specific data directly.</p>
</div>
<div class="paragraph">
<p>Since the access is directly to the database, there are no further access checks on queries using DSLContext.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Depending on the operation requested, the method may be able to execute <code>INSERT</code> or <code>UPDATE</code> statements.
It is the responsibility of the security methods author to make sure changes do not create an inconsistent or otherwise corrupted state of the database.
The simplest way to assure this, is to use the DSLContext only to read data.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples"><a class="anchor" href="#_examples"></a><a class="link" href="#_examples">Examples</a></h3>
<div class="sect3">
<h4 id="_subselect"><a class="anchor" href="#_subselect"></a><a class="link" href="#_subselect">Subselect</a></h4>
<div class="paragraph">
<p>There might be cases where the attribute defining access is not part of the entity itself, but part of another entity referred to by a foreign key or a relation.
In such cases a subselect comes handy.
Assume two entity types: documents, to which access is restricted by an attribute named <code>owner_group</code> which is part of the second entity a container.
An owner group must be given Documents are linked to their container with a foreign key named <code>contained_in</code>:</p>
</div>
<div class="listingblock">
<div class="title">The container entity</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
public interface OwnedContainer {

    long getOwnerGroup(); <i class="conum" data-value="1"></i><b>(1)</b>

    void setOwnerGroup(long ownerGroup);


    // ...
    // more attributes

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">The document entity</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT)
public interface OwnedDocument {

    @ForeignKey(target = OwnedContainer.class, targetProperty = "id")
    ContainerId getContainedIn(); <i class="conum" data-value="2"></i><b>(2)</b>

    void setContainedIn(ContainerId container);

    @Security
    static Expression&lt;Boolean&gt; calculateAccess(Alias alias, AuthenticationContext authenticationContext) {

        List&lt;Long&gt; groupIds = authenticationContext.getAllGroups().stream().map(group -&gt; group.getIdentifier().getValue()).collect(Collectors.toList()); <i class="conum" data-value="3"></i><b>(3)</b>

        return EcrQueryLanguage.condition().alias(alias).field("contained_in").in() <i class="conum" data-value="4"></i><b>(4)</b>
            .select("id").from("owned_container").as("container").where().
            contextReference("container", "owner_group").in().values(groupIds).holds().holds();
    }

    // ...
    // more attributes
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The entity <code>OwnedContainer</code> holds the attribute that specifies access.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The entity <code>OwnedDocument</code> is linked with a container by its attribute <code>contained_in</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>AuthenticationContext</code> is used to obtain the ids of every group the current user is a member of.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The group ids are used to create a check whether the entity is contained in a container whose <code>owner_group</code> is one of the users groups.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interface_inheritance"><a class="anchor" href="#_interface_inheritance"></a><a class="link" href="#_interface_inheritance">Interface inheritance</a></h3>
<div class="paragraph">
<p>Since attribute based security - by definition - is based on attributes, it must be able to be specified by type.
However, in some cases a more general solution is desired.
In these cases, java interface inheritance comes handy.</p>
</div>
<div class="paragraph">
<p>Assume the class <code>DocumentWithAccessToken</code> from above.
Assume further that there are other types (<code>ContainerWithAccessToken</code> and <code>FolderWithAccessToken</code>) that should be secured by their access-token as well.
In this case it is a good practice to combine the access method and field in a common superinterface:</p>
</div>
<div class="listingblock">
<div class="title">Superinterface</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><i class="conum" data-value="2"></i><b>(2)</b>
public interface WithAccessToken {

    @Mandatory(false)
    String getAccessToken();

    void setAccessToken(String accessToken);

    @Security
    static Expression&lt;Boolean&gt; calculateAccess(Alias alias, AuthenticationContext authenticationContext) {

        return EcrQueryLanguage.condition() <i class="conum" data-value="1"></i><b>(1)</b>
            .alias(alias).field("access_token").isNull()
            .or()
            .alias(alias).field("access_token").in()
            .values(new ArrayList&lt;&gt;(authenticationContext.getAuthorities()))
            .holds();
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The check for the access token is defined here.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>note that this interface does not specify an entity by itself, since it lacks a <code>@Type</code> annotation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then the types itself can simply inherit this feature:</p>
</div>
<div class="listingblock">
<div class="title">Inheriting entity 1</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
@OverwriteAllowed
public interface ContainerWithAccessToken extends WithAccessToken {
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Inheriting entity 2</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.FOLDER)
@OverwriteAllowed
public interface FolderWithAccessToken extends WithAccessToken {
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_complex_scenario_a_hospital"><a class="anchor" href="#_complex_scenario_a_hospital"></a><a class="link" href="#_complex_scenario_a_hospital">Complex scenario: a Hospital</a></h3>
<div class="paragraph">
<p>Here we take a look at a more complex example: a Hospital.
The hospital manages <strong>documents</strong> concerning <strong>cases</strong>.
A case belongs to a <strong>patient</strong>.
Users of the system are hospital employees and may access data about documents, cases and patients.
These users are part of one or several <strong>wards</strong>.
For every ward there is a group in the system containing the users that are part of this ward.
Cases have a list of wards - that may change over time - where the patient was treated for that case.
Access is specified as follows;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A user may only access cases whose wards contain at least one ward, the user is a member of.</p>
</li>
<li>
<p>A user may only access patients whose cases he may access.</p>
</li>
<li>
<p>A user may only access document whose cases he may access.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cases could be modeled as follows:</p>
</div>
<div class="listingblock">
<div class="title">The case</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
public interface MedicalRecordCase {

    @Mandatory
    @ForeignKey(target = MedicalRecordPatient.class, targetProperty = "id")
    ContainerId getPatient();  <i class="conum" data-value="1"></i><b>(1)</b>

    void setPatient(ContainerId containerId);

    @Mandatory
    List&lt;String&gt; getWards(); <i class="conum" data-value="2"></i><b>(2)</b>

    void setWards(List&lt;String&gt; wards);

    @Security
    static Expression&lt;Boolean&gt; access(Alias alias, AuthenticationContext authenticationContext) {

        List&lt;String&gt; groupNames = authenticationContext.getAllGroups() <i class="conum" data-value="3"></i><b>(3)</b>
            .stream().map(group -&gt; group.getEntityName().getValue()).collect(Collectors.toList());

        Expression&lt;Boolean&gt; result = null;

        for (String groupName : groupNames) { <i class="conum" data-value="4"></i><b>(4)</b>

            Expression&lt;Boolean&gt; wardCondition = EcrQueryLanguage.condition() <i class="conum" data-value="5"></i><b>(5)</b>
                .alias(alias).field("wards").contains().value(groupName)
                .holds();

            if (result == null) {

                result = wardCondition;

            } else {

                result = Eql.or(result, wardCondition); <i class="conum" data-value="6"></i><b>(6)</b>
            }
        }

        if (result == null) {

            return Eql.alwaysFalse(); <i class="conum" data-value="7"></i><b>(7)</b>
        }

        return result;
    }


    // case attributes ... <i class="conum" data-value="8"></i><b>(8)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A case holds a foreign key to a patient.
Since a case must have a patient, this attribute is mandatory.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A case has a list of wards, where it was treated.
This attribute is also mandatory.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>When computing access, the groups - and thus the wards - of the current user are obtained from the <code>AuthenticationContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Since it is necessary to check whether the intersection between the wards of the case and the groups of the user is not empty, it is iterated over all the groups of the user.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>A condition is created that checks whether the entities wards contain the current group.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Access is granted when one of the conditions created yields <code>true</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>If the user is in no group whatsoever he may access no case at all.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Further attributes are omitted for the sake of readability.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now Patients specify their security as follows:</p>
</div>
<div class="listingblock">
<div class="title">The patient</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
public interface MedicalRecordPatient {

    @Security
    static Expression&lt;Boolean&gt; access(Alias alias, AuthenticationContext authenticationContext) {

        Alias caseAlias = Alias.byName("case"); <i class="conum" data-value="2"></i><b>(2)</b>

        Expression&lt;Boolean&gt; caseAccessCondition = MedicalRecordCase.access(caseAlias, authenticationContext);  <i class="conum" data-value="1"></i><b>(1)</b>

        return EcrQueryLanguage.condition().exists()
            .select("id").from(MedicalRecordCase.class).as(caseAlias.getValue()) <i class="conum" data-value="3"></i><b>(3)</b>
            .where()
            .alias(caseAlias).field("patient").equalTo().alias(alias).id() <i class="conum" data-value="4"></i><b>(4)</b>
            .and(caseAccessCondition).holds().holds(); <i class="conum" data-value="5"></i><b>(5)</b>
    }

    // patient attributes ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access to a patient depends on access to cases.
So, the <code>MedicalRecordCase.access()</code> is called (see above).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In order to do that a custom alias is specified, that is used for the method call and in the query below.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Using a subselect its is checked whether there is a case &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>&#8230;&#8203; that is assigned to the patient the access is checked for and &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>&#8230;&#8203; and to which the current user may access.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Documents may specify their security method very similar, only the document-to-case link is specified the other way around:</p>
</div>
<div class="listingblock">
<div class="title">The document</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT)
public interface MedicalRecordDocument {

    @ForeignKey(target = MedicalRecordCase.class, targetProperty = "id")
    @Mandatory
    ContainerId getCase(); <i class="conum" data-value="1"></i><b>(1)</b>

    void setCase(ContainerId containerId);

    @Security
    static Expression&lt;Boolean&gt; access(Alias alias, AuthenticationContext authenticationContext) {

        Alias caseAlias = Alias.byName("case");

        Expression&lt;Boolean&gt; caseAccessCondition = MedicalRecordCase.access(caseAlias, authenticationContext); <i class="conum" data-value="2"></i><b>(2)</b>

        return EcrQueryLanguage.condition()
            .exists().select("id").from(MedicalRecordCase.class).as(caseAlias.getValue())
            .where()
            .alias(caseAlias).id().equalTo().alias(alias).field("case") <i class="conum" data-value="3"></i><b>(3)</b>
            .and(caseAccessCondition).holds().holds();
    }

    // patient attributes ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A document is assigned to a case.
This is mandatory.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>As for patients, the access check for documents depends on the access check for cases.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A similar subselect to the one above is created, however here the outer select holds the link to the inner one.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_revision_history_and_abac"><a class="anchor" href="#_revision_history_and_abac"></a><a class="link" href="#_revision_history_and_abac">Revision history and ABAC</a></h3>
<div class="paragraph">
<p>In the example above access to the entities is defined by one attribute: the wards of a case. It is assumed that a case may be treated in several wards - one after another - and every employee belonging to those wards needs access  to the case, its patients data and its documents. Visiting the wards one after another will result in several updates on the case - each adding another ward - and thus in a revision history where the list of wards will build up over time.</p>
</div>
<div class="paragraph">
<p>This has an interesting consequence in the scenario above : The access to older versions of the case will be granted to users who were allowed to access it at the time the version was created.</p>
</div>
<div class="paragraph">
<p>For instance, if a case started in the pulmonology it would have the following revision list:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 30%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">revision</th>
<th class="tableblock halign-left valign-top">ward(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pulmonology</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If it was moved to intensive care after that, it would result in the following revision list:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 30%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">revision</th>
<th class="tableblock halign-left valign-top">ward(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pulmonology</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pulmonology, intensive care</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Employees working in intensive care would be unable to access data of revision 1 of this case.
Depending on the scenario this might or might not be desired.</p>
</div>
<div class="paragraph">
<p>If this is not desired, it can be fixed with a simple annotation on the case interface:</p>
</div>
<div class="listingblock">
<div class="title">An alternative case</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Mandatory
    @Versioned(value = false)
    List&lt;String&gt; getWards();</code></pre>
</div>
</div>
<div class="paragraph">
<p>By simply specifying the <code>wards</code> attribute as not versioned, changes on the attribute will affect every revision of the case.
If a case started in the pulmonology it would at first have the same revision history as above:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 30%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">revision</th>
<th class="tableblock halign-left valign-top">ward(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pulmonology</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>However, if it was moved to intensive care now, the revision list would look like this:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 30%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">revision</th>
<th class="tableblock halign-left valign-top">ward(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pulmonology, intensive care</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pulmonology, intensive care</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Now all employees in pulmonology and intensive care have access to every revision of this case.</p>
</div>
<div class="paragraph">
<p>This solution can be used generally.
When access control to entities depends on attributes, deciding whether those attributes are versioned or not is an important detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_external_tables"><a class="anchor" href="#_accessing_external_tables"></a><a class="link" href="#_accessing_external_tables">Accessing external tables</a></h3>
<div class="paragraph">
<p>Assume that in the hospital from the example above, the information which employee belongs to which ward is kept in a separate table named 'employee_to_ward'.
This table is managed by an external application.</p>
</div>
<div class="sect3">
<h4 id="_using_direct_database_access"><a class="anchor" href="#_using_direct_database_access"></a><a class="link" href="#_using_direct_database_access">Using direct database access</a></h4>
<div class="paragraph">
<p>As stated earlier, it is possible to add a parameter of the type <code>org.jooq.DSLContext</code> to a security method in order to gain direct access to the database.
This could be used to access the 'employee_to_ward' table:</p>
</div>
<div class="listingblock">
<div class="title">Using DSLContext</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Security
    static Expression&lt;Boolean&gt; access(
        Alias alias,
        AuthenticationContext authenticationContext,
        DSLContext context  <i class="conum" data-value="1"></i><b>(1)</b>
    ) {

        long userId = authenticationContext.getUser().getIdentifier().getValue(); <i class="conum" data-value="2"></i><b>(2)</b>

        final List&lt;String&gt; wards = context.selectFrom("test_employee_to_ward")
            .where(DSL.field(DSL.name("employee")).eq(DSL.value(userId))) <i class="conum" data-value="3"></i><b>(3)</b>
            .fetch(DSL.field("ward", String.class));

        Expression&lt;Boolean&gt; result = null;

        for (String ward : wards) {

 // ... (as above) <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>DSLContext</code> is defined as another parameter.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>AuthenticationContext</code> is only used to get the current users id.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The wards of the user are obtained using the <a href="https://www.jooq.org/doc/3.15/manual/">jooq-api</a> to directly access the database.
Depending on the scenario, it might improve performance to cache the result of this query.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>After that, the same code as above is executed.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_using_a_metadata_type"><a class="anchor" href="#_using_a_metadata_type"></a><a class="link" href="#_using_a_metadata_type">Using a Metadata type</a></h4>
<div class="paragraph">
<p>Alternatively, an arveo custom <code>@Type</code> could be used to access the external table:</p>
</div>
<div class="listingblock">
<div class="title">An external type</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@View <i class="conum" data-value="1"></i><b>(1)</b>
@Name("employee_to_ward") <i class="conum" data-value="2"></i><b>(2)</b>
@Type(ObjectType.META)
public interface UserToWard {

    long getEmployee();

    void setEmployee(long employee);

    String getWard();

    void setWard(String ward);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@View</code> annotation marks the type as external.
This means arveo will not create the corresponding table.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Name</code> annotation specifies the name of the table the types entities are stored in.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, in the security method this type can be accessed with a subselect:</p>
</div>
<div class="listingblock">
<div class="title">Using subselect</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Security
    static Expression&lt;Boolean&gt; access(Alias alias, AuthenticationContext authenticationContext) {

        final Alias userWard = Alias.byName("user_ward");  <i class="conum" data-value="1"></i><b>(1)</b>

        return EcrQueryLanguage.condition()
            .exists().select("ward").from(UserToWard.class).as(userWard.getValue())<i class="conum" data-value="2"></i><b>(2)</b>
            .where()
                .alias(userWard).field("employee").equalTo()
                .value(authenticationContext.getUser().getIdentifier().getValue()) <i class="conum" data-value="3"></i><b>(3)</b>
            .and()
                .alias(alias).field("wards").contains() <i class="conum" data-value="4"></i><b>(4)</b>
                .alias(userWard).field("ward").holds()
            .holds();
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>First, an alias is declared for the subselect.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Then, a query is created that checks whether there is a ward, that &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>&#8230;&#8203; the current user is assigned to and &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>&#8230;&#8203; that is contained in the current entities <code>wards</code> attribute.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_permissions_on_type_definitions"><a class="anchor" href="#_permissions_on_type_definitions"></a><a class="link" href="#_permissions_on_type_definitions">Permissions on Type definitions</a></h3>
<div class="paragraph">
<p>It is possible to restrict the access of users to certain type definitions. This is an optional feature of a type
definition that can be enabled using the <code>@AccessChecks(true)</code> annotation. The following type level access rights exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>READ</code>: Allows a user to read entities and to perform search operations.</p>
</li>
<li>
<p><code>INSERT</code>: Allows a user to create new entities.</p>
</li>
<li>
<p><code>UPDATE</code>: Allows a user to update existing entities.</p>
</li>
<li>
<p><code>DELETE</code>: Allows a user to delete existing entities or to recycle and restore entities.</p>
</li>
<li>
<p><code>ASSIGN_ACL</code>: Allows a user to assign an ACL to an entity.</p>
</li>
<li>
<p><code>WRITE</code>: Combines the rights <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code> and <code>ASSIGN_ACL</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To assign type level access rights to a user, the user must be granted the required authorities. The authorities consist
of the prefix <code>ECR-TYPE_</code> followed by the ID of the type definition followed by the granted access right. For instance,
to grant a user the <code>UPDATE</code> right on the type definition with ID 12345, the authority <code>ECR-TYPE_12345_UPDATE</code> is
required.</p>
</div>
<div class="paragraph">
<p>Additionally, there are two additional authorities <code>ECR_ALL_TYPES_READ</code> and <code>ECR_ALL_TYPES_WRITE</code>, which give a user
read or write access to all type definitions. The check of the permissions on the type definitions can also be disabled
completely using the switch <code>ecr.server.security.type-definition-access-checks-enabled</code> (<code>true</code>/<code>false</code>).</p>
</div>
<div class="paragraph">
<p>Within a folder structure, child elements of a parent folder can belong to different type definitions. To filter the
result, the user&#8217;s permissions on the type definitions are used. This means that a user will only see folders and
documents from type definitions for which he or she has read permission.</p>
</div>
<div class="paragraph">
<p>Permissions of folders are inherited to the documents. For example, if a document of a type definition to which the
user has read permission is located in a folder on whose type definition the user does not have read permission, the
user is not allowed to access the document either. The folder permissions are currently only checked for the direct
parent folder. There is no inheritance within the folder hierarchy.</p>
</div>
<div class="paragraph">
<p>The <code>SystemManagementClient</code> provides a method that generates the possible access right authorities for a specific
type definition. This functionality is provided by the REST endpoint located at <code>/api/system/accessRightValues/{typeDefinitionName}</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_modelling"><a class="anchor" href="#_data_modelling"></a><a class="link" href="#_data_modelling"><strong>Data Modelling</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_objects_types_definitions"><a class="anchor" href="#_objects_types_definitions"></a><a class="link" href="#_objects_types_definitions">Entity types</a></h3>
<div class="paragraph">
<p>The following chapter defines entity types and type definitions, used in <em>arveo</em>.</p>
</div>
<div class="paragraph">
<p>To be able to store objects in the database we define a class for entity definitions.So an entity represents a type of data structure used in the <em>arveo</em>.There are five supported entity types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Document</strong>: an entity that can contain metadata and content. Documents are the only objects that can have content, the content may be binary. Documents can be contained in folders (<a href="#_document_type"><strong>Document</strong></a>).</p>
</li>
<li>
<p><strong>Container</strong>: simple folder-like object not organized in a tree structure but with relations to other objects. A Container contains only metadata and cannot be contained in a folder (<a href="#_container_type"><strong>Container</strong></a>).</p>
</li>
<li>
<p><strong>Relation</strong>: an entity that represents a relation between two other entities. A relation can contain metadata (<a href="#_relation_type"><strong>Relation</strong></a>).</p>
</li>
<li>
<p><strong>Folder</strong>: an entity that contains metadata and is organized in a tree structure like in a file system (<a href="#_folder_type"><strong>Folder</strong></a>)</p>
</li>
<li>
<p><strong>Meta</strong>: an entity that contains only metadata. Unlike containers, metadata entities do not support system attributes like ID and creation date (<a href="#_metadata_type"><strong>Metadata</strong></a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each type definition is represented by one (or more) tables in the database.</p>
</div>
<div class="paragraph">
<p>Each entity is referred by its system-wide unique id, which consists of a tenant id and its type definition id, followed by the sequential database id of this entity:</p>
</div>
<div class="paragraph">
<p>[12bit Tenant id][14bit Type Definition id][38bit Entity id].</p>
</div>
<div class="sect3">
<h4 id="_versioned_entities"><a class="anchor" href="#_versioned_entities"></a><a class="link" href="#_versioned_entities">Versioned entities</a></h4>
<div class="paragraph">
<p>All above listed entities (except for meta) are versioned by default. It means that they store version information, modification information. The class <em>VersionInformation</em> combines information about a version, including version id, version number and version comment. The version modification object stores a modification stamp, consisting of a user id and a <em>ZonedDateTime</em> object, both for the events of creation and last modification of the entity. The version information is stored in a separate table for each typed entity.</p>
</div>
<div class="paragraph">
<p>When specifying a type definition, you can decide which attributes of this type definition are versioned.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If none of the attributes are versioned, the entire object is not versioned.
For the type <em>Document</em> the content changes are always versioned.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_custom_types"><a class="anchor" href="#_custom_types"></a><a class="link" href="#_custom_types">Custom types</a></h4>
<div class="paragraph">
<p>You can make your class a type and add features by annotating your classes. You can define the custom metadata schema with simple getter and setter methods.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When you start a project you have to create your own types. Simply annotate the class with the TYPE annotation and define your schema with type safe getter/setter methods (<a href="#_entity_types_examples"><strong>Example</strong></a>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can find the <em>arveo</em>-specific annotations in the module <code>type-definition-annotations</code>. The goal is to create a type, and specify its properties. So annotations precisely define the behavior of the type definitions. When defining a type, a database table is created. To achieve this, you annotate the type definition with <em>@Type</em>. There is an exception to that: when annotating with <em>@View</em> or <em>@Partial_View</em>, no database table is created.</p>
</div>
<div class="paragraph">
<p>There are 2 types of annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>annotations on types (interfaces): <em>@Target({ElementType.TYPE, ElementType.ANNOTATION_TYPE})</em></p>
</li>
<li>
<p>annotations on properties (getter-methods): <em>@Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE})</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some annotations can be used both on interfaces and on getter-methods. The annotation <em>ElementType.ANNOTATION_TYPE</em> is used for inherited annotations.
The following annotation groups are used in <em>arveo</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>constraint</strong>: contains annotations that define specific properties or behaviour of attributes;</p>
</li>
<li>
<p><strong>defaults</strong>: contains annotations that define default values of attributes;</p>
</li>
<li>
<p><strong>index</strong>: contains annotations that define indexes on type definitions;</p>
</li>
<li>
<p><strong>naming</strong>: contains annotations that specify names for tables,
attribute definitions, type definitions, enumeration types and enumeration values;</p>
</li>
<li>
<p><strong>reference</strong>: contains annotations that specify references between types or attributes;</p>
</li>
<li>
<p><strong>system</strong>: contains annotations that concern system properties;</p>
</li>
<li>
<p><strong>view</strong>: contains annotations that mark an interfaces as view;</p>
</li>
<li>
<p><strong>other</strong>: contains annotations like <em>@Type</em>, <em>@EcrIgnore</em> and others, which stand out and cannot be classified into a
group.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use the 5 entity classes to create custom entity types to serve the needs of your system. The customized entity types reflect the structure of your project or organization and can be created in a flexible way by extending the five entity types of the <em>arveo</em> system.
You can make your class a type and add features by annotating your classes. You can define the custom metadata schema with simple getter and setter methods.</p>
</div>
<div class="paragraph">
<p>To create your first project using <em>arveo</em> you may want to review the following examples and follow the pattern.</p>
</div>
</div>
<div class="sect3">
<h4 id="_variables"><a class="anchor" href="#_variables"></a><a class="link" href="#_variables">Variables</a></h4>
<div class="paragraph">
<p>There are two different ways custom metadata can be stored for an entity: As an attribute, which is defined by a getter
and setter method in the type definition class and gets stored in a separate column in the database, and as a variable,
which are stored in a JSON structure in a system field in the database. Attributes must be defined in the type definition.
Changes to the available attributes require an update of the database schema. Variables can be added and removed without
changing the database schema.</p>
</div>
<div class="paragraph">
<p>It is possible to use variables when searching for an entity, but the available query operations are limited. It is also
not possible to use variables for references like foreign keys.</p>
</div>
<div class="paragraph">
<p>Variables are an optional feature of a type definition that can be enabled by adding the <code>@Variables</code> annotation to the
type interface. To access variables, a getter for the respective system field can be used as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Getter for variables</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@SystemProperty(SystemPropertyName.VARIABLES)
Map&lt;String, Object&gt; getVariables();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The names of variables must comply to the same rules as attribute names as defined by the regular expression
<code>[a-zA-Z][a-zA-Z0-9_]*</code>. Variables do not support null values.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following Java data types are supported for variable values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Integer</p>
</li>
<li>
<p>Long</p>
</li>
<li>
<p>String</p>
</li>
<li>
<p>Boolean</p>
</li>
<li>
<p>Double</p>
</li>
<li>
<p>LocalDate</p>
</li>
<li>
<p>LocalTime</p>
</li>
<li>
<p>ZonedDateTime</p>
</li>
<li>
<p>UUID</p>
</li>
<li>
<p>Enums</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_storing_variables"><a class="anchor" href="#_storing_variables"></a><a class="link" href="#_storing_variables">Storing variables</a></h5>
<div class="paragraph">
<p>Variables can be stored by providing a <code>Map&lt;String, Object&gt;</code> to the respective input type:</p>
</div>
<div class="listingblock">
<div class="title">Storing variables</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Map&lt;String, Object&gt; variables = Map.of("myVariable", "some value", "myIntVariable", 1);

client = serviceClient.create(
    new TypedContainerInput&lt;&gt;(null, typeInstance, null, null, variables));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_updating_variables"><a class="anchor" href="#_updating_variables"></a><a class="link" href="#_updating_variables">Updating variables</a></h5>
<div class="paragraph">
<p>To update variables, simply provide a map with the updated values. Other variables that might already be present in the
entity will not be changed.</p>
</div>
<div class="listingblock">
<div class="title">Updating variables</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Map&lt;String, Object&gt; variables = Map.of("myIntVariable", 2, "newVariable", true);

client = client.update(
    new TypedContainerInput&lt;&gt;(
        null,
        serviceClient.createTypeInstance(),
        null,
        null,
        variables
    )
);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_removing_variables"><a class="anchor" href="#_removing_variables"></a><a class="link" href="#_removing_variables">Removing variables</a></h5>
<div class="paragraph">
<p>To remove a variable, set it&#8217;s value to <code>new AttributeNullValue()</code> in an update operation.</p>
</div>
<div class="listingblock">
<div class="title">Removing variables</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Map&lt;String, Object&gt; variables = Map.of("newVariable", new AttributeNullValue());

client = client.update(
    new TypedContainerInput&lt;&gt;(
        null,
        serviceClient.createTypeInstance(),
        null,
        null,
        variables
    )
);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_searching"><a class="anchor" href="#_searching"></a><a class="link" href="#_searching">Searching</a></h5>
<div class="paragraph">
<p>The following examples show how variables can be used when searching for entities.</p>
</div>
<div class="listingblock">
<div class="title">Search for a variable with a specific value</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;TypedContainerClient&lt;RegisteredContainer&gt;&gt; list = serviceClient.where()
    .variable("uuid").withEntityAlias().equalTo().value(uuid).holds().unpaged();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Search for entities that contain a variable with a specific name</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@NotNull List&lt;TypedContainerClient&lt;RegisteredContainer&gt;&gt; list = serviceClient.where()
    .variable("uuid").withEntityAlias().isDefined().holds().unpaged();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Search for entities that do not contain a variable with a specific name</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@NotNull List&lt;TypedContainerClient&lt;RegisteredContainer&gt;&gt; list = serviceClient.where()
    .variable("nosuchvariable").withEntityAlias().isUndefined().holds().unpaged();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inherited_annotations"><a class="anchor" href="#_inherited_annotations"></a><a class="link" href="#_inherited_annotations">Inherited annotations</a></h4>
<div class="paragraph">
<p>Certain properties of annotations have a wide usage throughout the code, so it is therefore more convenient to define a certain annotation once for frequent usage.</p>
</div>
<div class="paragraph">
<p>The following is a listing of the interface definition <em>@CustomAnnotation</em>, which defines itself as a system property version id.If you mark a getter-method with this annotation, there is no
need to list the system property name.</p>
</div>
<div class="listingblock">
<div class="title">Listing of the interface @CustomAnnotation</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE})
@SystemProperty(SystemPropertyName.VERSION_ID)
public @interface CustomAnnotation {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To take advantage of this interface, we annotate getter-methods with it as shown in the listing below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface InterfaceInheritanceExample {

    @SystemProperty(SystemPropertyName.ID)
    DocumentId getId();

    @CustomAnnotation
    VersionId getVersionId();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_entity_types_examples"><a class="anchor" href="#_entity_types_examples"></a><a class="link" href="#_entity_types_examples">Examples</a></h4>
<div class="sect4">
<h5 id="_enumeration_example"><a class="anchor" href="#_enumeration_example"></a><a class="link" href="#_enumeration_example">Enumeration example</a></h5>
<div class="paragraph">
<p>Define a enum class and use it in a another object type (<a href="#_document_type_example"><strong>Example</strong></a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Enumeration(typeName = "my_enum")
public enum MyEnum {
    ENUM1, ENUM2, ENUM3, ENUM4
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_document_type_example"><a class="anchor" href="#_document_type_example"></a><a class="link" href="#_document_type_example">Document type example</a></h5>
<div class="listingblock">
<div class="title">Example of a type definition using the object type <em>Document</em></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT) <i class="conum" data-value="1"></i><b>(1)</b>
@RetentionProtected
@ContentElement(defaultDefinition = true, separateField = true)
@OverwriteAllowed
@RecycleBin
@Audit
public interface Resume {
// Immutable identifier documentid of the resume document: unique and readonly
@Unique
@ReadOnly
// alternatively: use autoincrement instead of unique and readonly to let the service create a unique sequence
//@Autoincrement
long getDocumentId(); <i class="conum" data-value="2"></i><b>(2)</b>
void setDocumentId(long value);

// title of the resume document
String getTitle(); <i class="conum" data-value="2"></i><b>(2)</b>
void setTitle(String value);

// relation to Person by person.id()
@ForeignKey (target = Person.class, targetProperty = "id") <i class="conum" data-value="3"></i><b>(3)</b>
String getPersonId();
void setPersonId(String value);

// Multi value with former employers
List&lt;String&gt; getEmployers();
void setEmployers(List&lt;String&gt; employers);

MyEnum getEnum();
void setEnum(MyEnum myEnum);

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Definition of the object type to allow  <em>Document</em> to upload content</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A database column is created for this property with a default name <em>DocumentId</em>. The column is readonly, mandatory, autoincrement and unique. The database creates a sequence of integer values. The value is readonly and so immutable. This allows users and 3rd party applications to identify and find the object. If you leave the <em>@Autoincrement</em> annotation the id must be set on creation and is readonly and immutable from that moment on.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This annotation specifies a foreign key to class Person</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_container_type_example"><a class="anchor" href="#_container_type_example"></a><a class="link" href="#_container_type_example">Container type example</a></h5>
<div class="paragraph">
<p>The following example class is marked as type <em>Container</em>. To use an entity type, we annotate the class using the <em>@Type</em> annotation.</p>
</div>
<div class="listingblock">
<div class="title">Example of an object definition of entity type <em>Container</em></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER) <i class="conum" data-value="1"></i><b>(1)</b>
public interface Person {
    String getFirstName(); <i class="conum" data-value="2"></i><b>(2)</b>
    void setFirstName(String value);
    @Name("last_name")  <i class="conum" data-value="3"></i><b>(3)</b>
    String getSurname();
    void setSurname(String value);
    @Unique  <i class="conum" data-value="4"></i><b>(4)</b>
    String getVatNumber();
    void setVatNumber(String value);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Definition of the object type to be <em>Container</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A database column is created for this property with a default name <em>first_name</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This annotation specifies the name of the database column, which is different from the default</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This annotation specifies a unique column, in this case <em>vat_number</em>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_referencing_attributes_by_name"><a class="anchor" href="#_referencing_attributes_by_name"></a><a class="link" href="#_referencing_attributes_by_name">Referencing attributes by name</a></h4>
<div class="paragraph">
<p>The system creates a column for each attribute of a type definition in the type definition&#8217;s database table. The name
of the column will be a <em>snake case</em> representation of the camel case name of the getter method of the attribute. For
example, the getter <code>getInvoiceNumber</code> will be mapped to an attribute (and a column) named <code>invoice_number</code>. To make it
easy to reference these names in a compile-safe manner, classes with string constants for all type definitions will be
generated automatically. For example, for a type definition class called <code>SimpleInvoice</code> a class named
<code>SimpleInvoiceNames</code> will be generated in the same package as <code>SimpleInvoice</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The classes containing the constants are generated using an annotation processor that is contained in the library
containing the type annotations. The processor is picked up by the compiler automatically.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how these constants can be used to perform a search referencing two different attributes.</p>
</div>
<div class="listingblock">
<div class="title">Example of a search using generated attribute name constants</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        EcrSearchService&lt;SimpleInvoice&gt; searchService = serviceClient.asEntitySearchService(); <i class="conum" data-value="1"></i><b>(1)</b>

        List&lt;SimpleInvoice&gt; list = searchService.where() <i class="conum" data-value="2"></i><b>(2)</b>
            .entity().field(SimpleInvoiceNames.INVOICE_NUMBER).like().value("2021-08-*")
            .and()
            .entity().field(SimpleInvoiceNames.AMOUNT).greaterThan().value(90D)
            .holds()
            .unpaged();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>serviceClient is a <code>TypedDocumentServiceClient</code> obtained using the <code>TypeDefinitionServiceClient</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A query is formulated using the fluent API of the EQL using the attributes invoice_number and amount</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_type_annotations"><a class="anchor" href="#_type_annotations"></a><a class="link" href="#_type_annotations">Type annotations</a></h3>
<table id="type_annotations" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 2. Type annotations</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Type</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ObjectType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the entity type of your class by setting a valid ObjectType: DOCUMENT, FOLDER, RELATION,
  CONTAINER, META: <a href="#_document_type_example"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@AccessChecks</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation specifies whether type-based access-checking will be enabled on a type.
  Default = false. See <a href="#_permissions_on_type_definitions">permissions on type definitions</a> for details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Acls</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support for ACLs is disabled by default but can be enabled by annotating the type class with this annotation. Additionally,
  annotating a getter for the ACL-Id system property with @Mandatory enforces the assignment of an ACL to every entity.
  Meta types do not support ACLs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@FilingEnabled</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The filing feature makes it possible to assign a document to a folder. The feature is disabled by default and can be
  activated on typ classes of type DOCUMENT by annotating the class with .</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@RetentionProtected</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The retention and litigation hold feature is disabled by default and can be enabled by annotating a type class with.
  Meta types do not support retention. <a href="#_annotations_retentionprotected"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@OptimisticLocking</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The optimistic locking feature makes it possible for clients to ensure that updates do not overwrite changes made by
  other clients by accident. The feature is disabled by default and can be enabled by annotating a type class with</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@RecycleBin</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The recycle bin feature makes it possible to move entities to the recycle bin and restore them again if required.
  The feature is disabled by default but can be enabled by annotating a type class with. <a href="include::../../../../docs-commons/src/main/asciidoc/data-deletion.html#_recycle_bin"><strong>Recycle Bin</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Recovery</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the recovery log. Content objects or files are deleted after configurable time: <a href="include::../../../../docs-commons/src/main/asciidoc/data-deletion.html#_recovery_log"><strong>Recovery Log</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@ContentElement</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the allowed content types:  <a href="include::../../../../docs-commons/src/main/asciidoc/content-elements-storage.html#_types_of_content_elements"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Audit</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation enables auditing of create-, update- and delete-operations on the type definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Versioned</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation defines if all properties of a type are versioned or not. If the annotation
  is present on a type and on a getter in the type, the annotation on the getter wins.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@OverwriteAllowed</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, <em>arveo</em> creates a new version if the content object of a document
  is changed. You can always read and restore all older versions of a content element. If overwrite is allowed you can
  replace a content element and overwrite it on the content store. The old version is lost.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@View</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The metadata type is a database view: <a href="#_define_a_view"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Tablename</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the real database table name of a system column which is not camel case but snake case:
  <a href="#_external_views"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@SourceType</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation marks a setter method to be setting a property that is part of an update or
  create call and not a member of the entity itself. Examples are revision commentary or the update counter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@TargetType</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation specifies the class being the target of a foreign key or relation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@InheritedProperty</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation marks a property as an inherited property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Enumeration</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation can be used to configure a registered enumeration type.You must pass the
database snake case name of the enumeration type: <a href="#_enumeration_example"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@EcrIgnore</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ignore Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation marks a method to be ignored as property or a class to be ignored as
type.The property is not stored in the database table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@NOSql</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation enables full-text support for all columns of the document types. By default,
the full-text support is disabled: <a href="#_nosql_example"><strong>Example</strong></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Variables</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the support for schema-independent properties stored in a generic map.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_property_annotations"><a class="anchor" href="#_property_annotations"></a><a class="link" href="#_property_annotations">Property annotations</a></h3>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 3. Property annotations</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@AutoIncrement</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The annotation <em>AutoIncrement</em> indicates that the value of an attribute will be auto-incremented by the database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Indexed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The annotation ensures, that an index will be created for one or more properties. You must pass the index name as a parameter.
  When several attributes are annotated to use an index with the same name, a multi-column-index will be created for
  these columns. Use {@link Index} to configure additional properties of the index.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Unique</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a unique column. If you try to create an entity with a duplicate value an unique
  constraint violation is thrown. <em>arveo</em> creates an unique index or an unique constraint on the database and
  ensures the integrity of the documents. <a href="#_annotation_examples"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Mandatory</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a mandatory column. Default = false, the create operation fails with an exception if the property is not set.
  <a href="#_default_values"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Readonly</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property must be set when the entity is created (like <em>@Mandatory</em>) and cannot be changed afterwards. If a column
  has the annotations <em>@Readonly</em> and <em>@Unique</em> you have an immutable index value that can be used as business primary
  key. This ensures that users and third-party systems can clearly identify and find a document. <a href="#_annotation_examples"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Versioned</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation defines if an attribute of a type is versioned or not (when placed on a getter).
  If the annotation is present on a type and on a getter in the type, the annotation on the getter wins.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Length</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation specifies the length of a string or binary attribute</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Precision</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long<br>
  Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation specifies the precision of a decimal, parameter: digits before and after comma</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Casesensitive</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation marks a field of type String as case-sensitive. This effects how searches on this field will be
  performed. The value itself will always be stored preserving the case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@DefaultValue</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String<br>
  default&lt;T&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is possible to specify default values for properties. Pass the database name of the property (camel vs. snake case!)
  and define a function returning the required type. If an instance of a type  with a field that has a default value
  specified is created, and a value for that field is not defined, the default value will be used instead. However,
  if the field is explicitly set to null, then null will be used instead. <a href="#_default_values"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@DefaultSystemPropertyValue</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String<br>
  ZonedDateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is possible to calculate the initial value of the retention period and set it as a default value for <em>RETENTION_DATE</em>
  system column. Pass the database column name "retention_date" and a function returning a ZonedDateTime value.
  <a href="#_retention_examples"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@PrimaryKey</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation marks a custom property as part of the elements primary key. The primary key will be combined of every
  custom property annotated with this annotation and the system property id. The property will be mandatory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@SecondaryKey</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation marks a property as secondary. The property is mandatory and unique.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@ForeignKey</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a foreign key. You must pass the class name and the column for the foreign key. _arveo creates the
  foreign key on the database and ensures the data integrity of your entities. <a href="#_entity_types_examples"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@CascadeDelete</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is possible to define foreign keys that cascade a delete operation to the referencing entity.
  <a href="#_foreign_keys_with_on_delete_cascade_example"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@Systemproperty</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SystemPropertyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To access system properties you can use the annotation <em>@SystemProperty</em> and
  pass one of the following names (<a href="#_retention_examples"><strong>Example</strong></a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@FormattedCounter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation marks an attribute of type String as a formatted counter. Formatted
  counters can be used to generate string valued attributes with a counter backed by a sequence as well as a
  prefix and a suffix. The name of the sequence can be user defined, or it can be auto-generated by the system. Prefix,
  suffix, and the name of the sequence can contain placeholders. Currently, the only supported placeholder is
  <code>$date(&lt;format&gt;)</code>. The format string is a simple date format string as supported by
  <code>DateTimeFormatter.ofPattern</code>. <a href="#_formatted_counters_example"><strong>Example</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@RelationCounter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation marks a property of type Int as a counter for a specific relation type
  identified by the type definition class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@EcrIgnore</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation marks a method to be ignored as property or a class to be ignored as type.
  The property is not stored in the database table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>@NOSql</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This annotation enables or disables full-text support for this property.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Please note the following tips regarding <strong>Unique identifiers</strong>:</p>
</div>
<div class="paragraph">
<p>To allow users and 3rd party applications to identify and find objects in <em>arveo</em> you should define a unique
and immutable property.
The property must be <em>@Unique</em> to ensure that an application can identify the item.
Make the property <em>@ReadOnly</em> to ensure that the identifier is always set and immutable.</p>
</div>
<div class="paragraph">
<p>Your business application or the user must set the value when the object is created.
Use the <em>@AutoIncrement</em> annotation instead of <em>@Unique</em> and <em>@Readonly</em> if a simple sequential Long id meets your
requirements.
If you need a more sophisticated unique identifier you can use the annotation <em>@FormattedCounter</em> which allows you to
create e.g. String identifiers like &lt;year&gt;-&lt;sequence&gt; (<a href="#_formatted_counters_example"><strong>Example</strong></a>).</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
If overwrite is turned on it is possible to manipulate the originally saved content and compromise the document without
creating a versioned copy. Ensure that the <em>@OverwriteAllowed</em> annotation is not present on legally compliant document
types.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_annotation_examples"><a class="anchor" href="#_annotation_examples"></a><a class="link" href="#_annotation_examples">Examples</a></h4>
<div class="sect4">
<h5 id="_default_values"><a class="anchor" href="#_default_values"></a><a class="link" href="#_default_values">Default values</a></h5>
<div class="listingblock">
<div class="title">Example of a default value definition</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
public interface ContainerWithSimpleDefaultProperty {

    String DEFAULT_STRING = "default string"; <i class="conum" data-value="2"></i><b>(2)</b>

    @Mandatory
    String getMyStringField();

    void setMyStringField(String myStringField);

    @DefaultValue("my_string_field") <i class="conum" data-value="1"></i><b>(1)</b>
    default String defaultStringField() {

        return DEFAULT_STRING;
    }

    // ...
    // your custom attribute definitions
    // ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>With <code>@DefaultValue("my_string_field")</code> the method <code>defaultStringField</code> is defined to return the default value of <code>my_string_field</code>.Note that the reference in the annotation is in snake-case while the actual property <code>getMyStringField</code> is camel-case.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In a simple case like this it is considered good practice to declare a constant default value as a public constant.However, the default method does not need to return a constant.For example, date-time fields could use <code>ZonedDateTime.now()</code> to specify the timestamp of the creation as default value.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_index_example"><a class="anchor" href="#_index_example"></a><a class="link" href="#_index_example">Index example</a></h5>
<div class="paragraph">
<p>As an example of annotations usage let us define an interface <em>BookIndex</em> with two properties, <em>page</em> and <em>chapter</em>.These properties have to be indexed.</p>
</div>
<div class="listingblock">
<div class="title">Object annotation of type <code>Meta</code></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.META)
@Index("book-chapter-page-index")
public interface BookIndex {

    @PrimaryKey
    @AutoIncrement
    int getId();

    @Indexed("book-chapter-page-index")
    int getChapter();
    void setChapter(int chapter);

    @Indexed("book-chapter-page-index")
    int getPage();
    void setPage(int page);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above-mentioned properties are thus marked with the annotation <em>@Indexed</em>, which ensures, that an index will be created for these attributes.Here, the annotation <em>@Index</em> on the type is an example of an annotation on a type, described above.</p>
</div>
</div>
<div class="sect4">
<h5 id="_formatted_counters_example"><a class="anchor" href="#_formatted_counters_example"></a><a class="link" href="#_formatted_counters_example">Formatted counters example</a></h5>
<div class="paragraph">
<p>Using the <em>@FormattedCounter</em> annotation it is possible to define counters with prefix and suffix that are backed by a
sequence on the database.There are several properties that can be defined in the annotation:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The prefix used for the counter values. Can contain placeholders.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">suffix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The suffix used by the counter values. Can contain placeholders.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">digits</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of digits for the counter. Shorter numbers will be padded with zero.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sequenceName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the sequence to use. Can contain placeholders.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoGenerateSequences</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of sequences to auto-generate when the system is started in maintenance mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startValue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The start value of the generated sequence(s).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The parameters prefix, suffix and sequenceName support placeholders.Currently, the system supports a placeholder for
dates in the form <code>$date(&lt;format&gt;)</code> where <code>format</code> is a java date format string supported by
java.time.format.DateTimeFormatter#ofPattern(String)
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The <code>autoGenerateSequences</code> property can only be used when the <code>sequenceName</code> contains the placeholder
<code>$date(uuuu)</code>.It must not contain any other placeholders.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows a formatted counter attribute used as an invoice number that will produce counter values in
the form <code>2021#0103</code>.It will be backed by a sequence called <code>inv_no_seq_2021</code>.The system will create the next 10
sequences automatically (<code>inv_no_seq_2021</code> to <code>inv_no_seq_2030</code>).The start value of each sequence will be 100. The
sequence to use will be determined automatically because of the date placeholder in the <code>sequenceName</code> property.So on
January 1st 2022, the generated counter values will use another prefix and the counter will start over at 100
(<code>2022#0100</code>).Each time the system is started in maintenance mode, it will make sure that sequences for the next 10
years will be present.</p>
</div>
<div class="listingblock">
<div class="title">Example: Defining a formatted counter attribute</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@FormattedCounter(prefix = "$date(uuuu)#", digits = 4, sequenceName = "inv_no_seq_$date(uuuu)", autoGenerateNextSequences = 10, startValue = 100)
String getInvoiceNumber();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_foreign_keys_with_on_delete_cascade_example"><a class="anchor" href="#_foreign_keys_with_on_delete_cascade_example"></a><a class="link" href="#_foreign_keys_with_on_delete_cascade_example">Foreign keys with ON DELETE CASCADE example</a></h5>
<div class="paragraph">
<p>Add the <em>@CascadeDelete</em> annotation to the getter for the foreign key attribute.
For relation types it is possible to add the cascade delete option to the foreign keys to the parent and child of the
relation.To do that, add a system property for the parent- and/or child-id and annotate it with <em>@CascadeDelete</em>.</p>
</div>
<div class="listingblock">
<div class="title">Usage of the annotation @CascadeDelete</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// simple foreign key
@CascadeDelete
@Mandatory(false)
@ForeignKey(target = BookIndex.class, targetProperty = "id")
Integer getReferencedIndex();

// parent- and child-id of a relation
@CascadeDelete
@SystemProperty(SystemPropertyName.PARENT_ID)
short getParentId();

@CascadeDelete
@SystemProperty(SystemPropertyName.CHILD_ID)
short getChildId();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The cascade delete option is supported only for entities that are not versioned (hence it cannot be used on <em>Document</em> types) and do not support retention or inheritance.It is also not possible to inherit attribute values from a type definition that has a foreign key with the cascade delete option.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_property_like_system_fields"><a class="anchor" href="#_property_like_system_fields"></a><a class="link" href="#_property_like_system_fields">Property-like system fields</a></h5>
<div class="paragraph">
<p>If a getter for a system field is defined, then it is possible to define a setter, <em>if</em> the system field is property like.
The following fields are property-like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>acl_id;</p>
</li>
<li>
<p>retention_date.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following listing shows the definition of a getter and a setter method on a property-like field.</p>
</div>
<div class="listingblock">
<div class="title">Example of property-like fields</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface Secured {

    @SystemProperty(SystemPropertyName.ACL_ID)
    AccessControlListId getAclId();

    void setAclId(AccessControlListId aclId);

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_define_a_view"><a class="anchor" href="#_define_a_view"></a><a class="link" href="#_define_a_view">Define a view</a></h4>
<div class="paragraph">
<p>To define your type as a view or a partial view, you have to annotate your type with <em>@View</em> or <em>@PartialView</em>.The <em>@View</em> annotation specifies whether the defined type is a view i.e. whether it should create the tables for it.The <em>@PartialView</em> annotation marks a class to be a partial view of the type definition created by another class via the <em>@Type</em> annotation.Partial views can be used for updates and selects with limited select clauses.No tables will be
created for classes annotated this way.The interfaces that are to be defined as views of an object type, have to be registered on the interface, representing this object type.For instance, if an interface <em>NamedFile</em> inherits from the interface <em>NamedEntity</em>, and <em>NamedEntity</em> is a partial view of <em>NamedFile</em>, it has to be registered on the object from
which it inherits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@PartialView(NamedFile.class)
public interface NamedEntity {
    //...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: An interface may also be a partial view of more than one type definitions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_external_views"><a class="anchor" href="#_external_views"></a><a class="link" href="#_external_views">External views</a></h4>
<div class="paragraph">
<p>It is possible to expose tables that are under control of other applications to <em>arveo</em> and include them in its type system.This assumes that the given tables are in the same database schema as the tables of <em>arveo</em>.Also, one needs to know the name of these tables as well as their types.In this case one can define a meta-type annotated with <em>@View</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
External views will only be read from ecr.It will never write to an external view.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, the <a href="#Access Control Service">access-control-service</a> defines several tables, one of it named <code>usrv_acl</code>.In this table there are - amongst others - two fields: <code>id</code> (a <code>bigint</code>) and <code>name</code> (a <code>varchar</code>).With this knowledge one can define the following external view:</p>
</div>
<div class="listingblock">
<div class="title">Example for an external view</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@View <i class="conum" data-value="1"></i><b>(1)</b>
@Type(ObjectType.META) <i class="conum" data-value="2"></i><b>(2)</b>
@TableName("usrv_acl") <i class="conum" data-value="3"></i><b>(3)</b>
public interface AclView {

    @Unique
    String getName(); <i class="conum" data-value="4"></i><b>(4)</b>

    @PrimaryKey
    long getId(); <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We annotate the class with <em>@View</em> to declare it as an external view.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specifying the type as a <code>META</code> type is good practice, since every other type would expect specific system fields.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specifying the table name is good practice here, since an external table most likely follows its own name convention. However, it would be possible to omit the <em>@TableName</em> annotation here and instead name the class <code>UsrvAcl</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Since we know that the table <code>usrv_acl</code> has a field <code>name</code> of type <code>varchar</code> we can define the property <code>name</code> of type <code>String</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We know that the table <code>usrv_acl</code> has a field <code>id</code> of type <code>bigint</code>, so we specify a java property accordingly.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_entity_annotations_nosql_example"><a class="anchor" href="#_entity_annotations_nosql_example"></a><a class="link" href="#_entity_annotations_nosql_example">NoSQL example</a></h4>
<div class="paragraph">
<p>You can write the annotation <em>@NOSql</em> to the type definitions, which should also be created in the solr schema, so
that the whole class is created with its fields.</p>
</div>
<div class="listingblock">
<div class="title">Example of usage of the @NOSql annotation</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
@NOSql
public interface PersonSimple {
    String getFirstName();
    void setFirstName(String value);
    String getLastName();
    void setLastName(String value);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to create a field, you can disable it with the annotation <em>@NOSql</em>(value = false).</p>
</div>
<div class="listingblock">
<div class="title">Example of usage of the @NOSql annotation with value set to false</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
@NOSql
public interface PersonSimple {
    String getFirstName();
    void setFirstName(String value);
   @NOSql(value = false)
    String getLastName();
    void setLastName(String value);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_systemproperty_annotation"><a class="anchor" href="#_systemproperty_annotation"></a><a class="link" href="#_systemproperty_annotation"><em>@SystemProperty</em> annotation</a></h4>
<div class="paragraph">
<p>To access system properties you can use the annotation <em>@SystemProperty</em> and pass one of the following names (<a href="#_document_type_10_year_retention_period"><strong>Retention Information Getter</strong></a>)</p>
</div>
<div class="paragraph">
<p><em>general system fields:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID: The unique identifier of the entity. Use on EcrId properties (or subclasses as applicable). Can be used on any entity</p>
</li>
<li>
<p>CREATION_DATE: The date and time the relation was created. Use on ZonedDateTime properties. Can only be used
on relations.</p>
</li>
<li>
<p>CREATOR_USER_ID: The id of the user that created this relation. Use on UserId properties. Can only be used on
relations.</p>
</li>
<li>
<p>ACL_ID: The id of the ACL currently assigned to the entity. Might be null. This is not supported for metadata entities.</p>
</li>
<li>
<p>ACL_RIGHT: The resolved right based on the ACL currently assigned to the entity and the current user.
This is not supported for metadata entities.</p>
</li>
<li>
<p>RETENTION_INFO: Information about the retention properties of the entity.
It contains the RETENTION_DATE and the LITIGATION_HOLD flag described below.
Can only be used on potentially versioned entities i.e. Folders, Documents, Relations and Containers that declared to be retention protected.</p>
</li>
<li>
<p>RETENTION_DATE: The retention date defines the minimum storage date i.e. the related object can not be deleted until after this date passed. The the storage period may be extended but never shortened.
Can only be used on potentially versioned entities i.e. Folders, Documents, Relations and Containers that
declared to be retention protected.</p>
</li>
<li>
<p>LITIGATION_HOLD:A flag that indicates whether a document is related to a litigation.
If the flag is set the document must never be deleted - even if the retention date has passed by.
Can only be used on potentially versioned entities i.e. Folders, Documents, Relations and Containers that
declared to be retention protected.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>versioned system fields:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>VERSION_NUMBER: The number of the version of the versioned entity. Use on int/Integer properties. Can only be used on versioned entities.</p>
</li>
<li>
<p>VERSION_ID: The unique identifier of the version of the entity. Use on VersionId properties. Can only be used on versioned entities</p>
</li>
<li>
<p>UPDATE_COUNTER: A counter that is incremented each time an entity is updated. It is used for the optimistic locking feature and therefore is only available on type definitions that use optimistic locking.</p>
</li>
<li>
<p>IS_CURRENT_VERSION: A boolean that indicates whether the entity was the current version at the time it was loaded from the backend. Can only be used on versioned entities.</p>
</li>
<li>
<p>MODIFICATION_INFO: Information about the date and time as well as the user of the first and last modification of the entity. Use on ModificationInformation properties. Can only be used on potentially versioned
entities i.e. Folders, Documents, Relations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>document system fields:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>CONTENT: Information about the content of the document. Use on Map&lt;String, ContentInformation&gt;
properties. Can only be used on documents.</p>
</li>
<li>
<p>CONTAINING_FOLDER: The id of the folder containing the document (if any). Use on FolderId properties. Can only
be used on documents.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>folder system fields:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>FOLDER_NAME: The name of the folder. Use on String properties. Can only be used on folders.</p>
</li>
<li>
<p>PARENT_FOLDER: The id of this folders parent. Use on FolderId properties. Can only be used on folders.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>relation system fields:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>PARENT_ID: The id of the parent of this relation. Use on TypedId properties (or applicable subclasses). Can
only be used on relations.</p>
</li>
<li>
<p>PARENT_VERSION_ID: The version-id of the parent of this relation. Use on VersionId properties. Can
only be used on relation types that support relations to or from versions.</p>
</li>
<li>
<p>CHILD_ID: The id of the child of this relation. Use on TypedId properties (or applicable subclasses).
Can only be used on relations.</p>
</li>
<li>
<p>CHILD_VERSION_ID: The version-id of the child of this relation. Use on VersionId properties.
Can only be used on relation types that support relations to or from versions.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_data_types_2"><a class="anchor" href="#_data_types_2"></a><a class="link" href="#_data_types_2">Data Types</a></h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Property Data Types</caption>
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 10.5263%;">
<col style="width: 78.9474%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Java Type</th>
<th class="tableblock halign-center valign-top">Database Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unlimited unicode text. Limit the length with <em>@Length</em> annotation</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Integer or int</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 bit integer value, Integer = null is allowed</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Long or long</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 bit long value, Long = null is allowed</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Double or double</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double value, Double = null is allowed</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Boolean or boolean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean value, Boolean = 3 state boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Decimal or decimal</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">decimal( precision)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decimal value, Decimal = null is allowed, add <em>@Precision</em> annotation</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">UUID</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid type</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">byte[ length ]</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bytea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary data with a length, specified by a java int (max. 4 gb).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String based ID with a non-null length.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">EnumerationType</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">EnumerationType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>arveo</em> creates an enumeration object on postgreSQL 12.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">ZonedDateTime</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>arveo</em> stores a GMT based date time value in postgreSQL 12</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">LocalDate</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>arveo</em> stores a date time value in postgreSQL 12, but only the date is relevant</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">LocalTime</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>arveo</em> stores a date time value in postgreSQL 12, but only the time is relevant</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">List&lt;String&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">array(text)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_arveo stores multiple text values in an array column of postgreSQL 12.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">List&lt;Long&gt;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">array(bigint)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_arveo stores multiple bigint values in an array column of postgreSQL 12.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, postgreSQL 12 does not limit the length of String values. Typically, it is not necessary to define a length using the <em>@Length</em> annotation because postgreSQL 12 does handle Strings of all length very well.<br>
Your strings should have a length up to 4 kByte. Even larger strings are allowed, but you should take care that you do not inadvertently consume too much data space if you store very large strings.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
List data types allow you to store more than String or long value for a property. You can search for each value using the array search operation of the <em>arveo</em> query language.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Enumeration data types allow you to set one or more values from a fixed set of values.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_system_properties"><a class="anchor" href="#_system_properties"></a><a class="link" href="#_system_properties">System Properties</a></h3>
<div class="paragraph">
<p>The following chapter describes types of system properties in <em>arveo</em>.</p>
</div>
<div class="paragraph">
<p>There are different types of system properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>General system properties: system properties that are available on all types of entity (except for meta data entities).</p>
</li>
<li>
<p>General system properties: system properties that are available on all types of entity (except for meta data entities).</p>
</li>
<li>
<p>Versioned entity system properties: system properties that are only available on entities that can be versioned
(Containers, Documents, Folders, Relations).
Those properties are contained in the main table of a type definition.</p>
</li>
<li>
<p>Document system properties: system properties that are only available on documents.</p>
</li>
<li>
<p>Folder system properties: system properties that are only available on folders.</p>
</li>
<li>
<p>Relation system properties: system properties that are only available on relations.</p>
</li>
<li>
<p>Version system properties: system properties that are only available on versions of entities. Those properties are
contained in the version table of a type definition.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_system_property_names"><a class="anchor" href="#_system_property_names"></a><a class="link" href="#_system_property_names">System Property Names</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All system columns in the database are snake case but not camel case. e.g. the Java RetentionDate variable is persisted as "retention_date".
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. <em>General system properties:</em></caption>
<colgroup>
<col style="width: 23%;">
<col style="width: 11%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Database Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique identifier of the entity. Use EcrId properties (or subclasses as applicable). Can be used on any entity and is applied by <em>arveo</em> for all types but metadata.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">acl_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the ACL currently assigned to the entity. Might be null. This is not supported for metadata entities or type with disabled ACLs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">creation_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GMT timestamp when the entity or version was created, precision (1/1000 second)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">creator_user_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the user who created the entity or version (<a href="#user_management"><strong>User Management</strong></a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional flag that indicates that an entity is currently contained in the recycle bin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">last_delete_restore_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional GMT timestamp of when the entity was last moved in or out of the recycle bin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retention_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The GMT based retention timestamp defines the minimum storage date i.e. the related object can not be deleted until after this date passed. Cannot be used on meta data entities and is only available on entity types that declared to be retention protected (<a href="#"><strong>Retention</strong></a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">litigation_hold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The boolean indicates whether a document is related to a litigation. If the flag is set the document must never be deleted - even if the retention date has passed by. Cannot be used on meta data entites and is only available on entity types that declared to be retention protected (<a href="#"><strong>Retention</strong></a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">update_counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional counter for the number of updates on an entity used for optimistic locking.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. <em>Versioned entity system properties:</em></caption>
<colgroup>
<col style="width: 23%;">
<col style="width: 11%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Database Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version_number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sequential number of the latest version of the versioned entity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">latest_version_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique identifier of the latest version of the entity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version_comment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comment set by the client when a new version is created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modification_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GMT timestamp when the version was created or changed, precision (1/1000 second)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modification_user_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the user who created or changed the version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initial_creation_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GMT timestamp of when the first version of an entity was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initial_creation_user_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the user who created the first version of the entity.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. <em>Document system properties:</em></caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Database Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">content</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON containing content properties:<br>
ID :  unique id of the content<br>
Hash : SHA256 hash of the content stream <br>
Hash-Algorithm: Algorithm of the hash<br>
MediaType : mime type of the content, e.g. octet-stream<br>
Creation: GMT based ZonedDateTime timestamp of the creation of the object<br>
FileName: Name of the file, if stored on a file system storage<br>
Size: bigint value containing the size of the content stream in bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional field that contains the ID of the folder the document is contained in.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. <em>Folder system properties:</em></caption>
<colgroup>
<col style="width: 17%;">
<col style="width: 11%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Database Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">folder_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the folder.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the parent of the folder in the folder tree.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. <em>Relation system properties:</em></caption>
<colgroup>
<col style="width: 17%;">
<col style="width: 11%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Database Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the parent of this relation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent_version_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version-id of the parent of this relation. Can only be used on relation types that support relations to or from versions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">child_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the child of this relation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">child_version_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version-id of the child of this relation. Can only be used on relation types that support relations to or from versions.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. <em>Version system properties:</em></caption>
<colgroup>
<col style="width: 17%;">
<col style="width: 11%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Database Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version_number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sequential number of the version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique identifier of the version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version_comment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comment set by the client when a new version is created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entity_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the entity the version belongs to.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_timestamps"><a class="anchor" href="#_timestamps"></a><a class="link" href="#_timestamps">Timestamps</a></h4>
<div class="paragraph">
<p>All timestamp system properties (<em>creation_date</em>, <em>initial_creation_date</em>, <em>modification_date</em>) are stored in the database
using the GMT timezone and a precision of 1 millisecond. When using the Java API, the values will be returned as
<em>ZonedDateTime</em> instances.</p>
</div>
<div class="paragraph">
<p>The <em>initial_creation_date</em> field will contain the
timestamp of when the very first version of an entity was created. This field is never updated. The <em>creation_date</em>
field on the other hand will contain the time a specific version of an entity was created. Thus, the <em>creation_date</em>
field in the main table will be updated when a new version is created because the main table will always contain the
latest version of an entity. The modification timestamp field (<em>modification_date</em>) will contain the timestamp of when a
version was created or overwritten. This field, too, will be updated in the main table each time a new version is created.
It will be updated in the main table and in the version table when a version gets overwritten.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_document_type"><a class="anchor" href="#_document_type"></a><a class="link" href="#_document_type">Document type</a></h3>
<div class="paragraph">
<p>The following chapter provides a more detailed overview of the type <code>Document</code>.</p>
</div>
<div class="paragraph">
<p>A <code>Document</code> is one of five entity types supported by the <em>arveo</em> system. Unlike the other entity types, documents are always versioned too keep track of changes of the binary content.</p>
</div>
<div class="paragraph">
<p>A <code>Document</code> consists of the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Technical metadata, which is filled by <em>arveo</em> and cannot be changed, see <a href="#"><strong>System properties</strong></a></p>
</li>
<li>
<p>Typed metadata as defined in the annotated interface (the type definition)</p>
</li>
<li>
<p>0-n content objects: A content object has a content type that is freely configured in the system.A maximum of one
element can be inserted per content type.Examples of content types are: original object, rendition, full text,
text notes, XML properties, etc.</p>
</li>
<li>
<p>content metadata like content size, mime-type and hash</p>
</li>
<li>
<p>0-n annotations per content object: Only for image objects (TIFF, JPEG, PNG, BMP, PDF/A) annotations can be created
in a layer independent of the document.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any number of versions can be created for a <code>Document</code>. All the versions are traceable in the repository and can be referenced via independent system-wide unique IDs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_container_type"><a class="anchor" href="#_container_type"></a><a class="link" href="#_container_type">Container type</a></h3>
<div class="paragraph">
<p>The following chapter provides a more detailed overview of the type <code>Container</code>.</p>
</div>
<div class="paragraph">
<p>A <code>Container</code> is an object without content. It supports all system managed metadata attributes and custom attributes
defined by the type definition. It is called 'Container' because it&#8217;s primary use case is to serve as an entity that
contains custom metadata and that is related to other entities like a document via foreign keys or relations.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use container objects to build records and cases that contain documents.You can map the relationship between file,
case and documents either as a foreign key (<a href="#_property_annotations"><strong><em>@ForeignKey</em> annotation</strong></a>)
or using the relation type objects (<a href="#_relation_type"><strong>Relation Type</strong></a>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you use Foreign keys to create the relationship between objects you can inherit values from the parent to its
children (<a href="#_inheritance"><strong>Inheritance</strong></a>)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Containers can be versioned. A <code>Container</code> consists of the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Technical meta information, which is filled by <em>arveo</em> and cannot be changed, see <a href="#_system_properties"><strong>System properties</strong></a></p>
</li>
<li>
<p>Typed container type metadata according to the type definition of the container type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any number of versions can be created for a <code>Container</code>. All the versions are traceable in the repository and can be
referenced via independent IDs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_relation_type"><a class="anchor" href="#_relation_type"></a><a class="link" href="#_relation_type">Relation type</a></h3>
<div class="paragraph">
<p>The following chapter provides a more detailed overview of the type <code>Relation</code>.</p>
</div>
<div class="paragraph">
<p>A <code>Relation</code> represents a connection between two entities (document, container, folder or meta). It is directed, having
a parent and a child and it can contain custom metadata attributes. A <code>Relation</code> type must specify the type of the parent
and child entities. Any number of versions can be created for a <code>Relation</code>. All the versions are traceable in the repository and can be referenced via independent IDs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Changes of the child-id or parent-id are not tracked in the version table.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="relation-type-model.png" alt="relation type model" width="780" height="154">
</div>
<div class="title">Figure 1. Data model of a <code>Relation</code></div>
</div>
<div class="listingblock">
<div class="title">Example: A <code>Relation</code> type definition</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.RELATION) <i class="conum" data-value="1"></i><b>(1)</b>
@SourceType(Customer.class) <i class="conum" data-value="2"></i><b>(2)</b>
@TargetType(Invoice.class) <i class="conum" data-value="3"></i><b>(3)</b>
public interface CustomerInvoiceRelation {

    @SystemProperty(SystemPropertyName.CHILD_ID) <i class="conum" data-value="4"></i><b>(4)</b>
    @InputProperty(InputPropertyName.RELATION_CHILD) <i class="conum" data-value="5"></i><b>(5)</b>
    DocumentId getChildId();

    void setChildId(DocumentId childId);

    @SystemProperty(SystemPropertyName.PARENT_ID) <i class="conum" data-value="6"></i><b>(6)</b>
    @InputProperty(InputPropertyName.RELATION_PARENT) <i class="conum" data-value="7"></i><b>(7)</b>
    ContainerId getParentId();

    void setParentId(ContainerId parentId);

    String getStatus();

    void setStatus(String status);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specifies that the type definition is used for relations</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Defines the type of the source or parent of the relation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defines the type of the target or child of the relation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Marks an attribute to return the value of the <code>childId</code> property of the relation</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Marks an attribute to set the value of the <code>childId</code> property of the relation</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Marks an attribute to return the value of the <code>parentId</code> property of the relation</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Marks an attribute to set the value of the <code>parentId</code> property of the relation</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_relations_vs_foreign_keys"><a class="anchor" href="#_relations_vs_foreign_keys"></a><a class="link" href="#_relations_vs_foreign_keys">Relations vs. foreign keys</a></h4>
<div class="paragraph">
<p>Instead of using relations, it is possible to model a dependency between two entities using foreign keys. The key
difference between the two approaches is that a relation can carry its own metadata attributes, which a foreign key
can not. This possibility requires an additional database table (or two, in case of versioned relations) for a relation,
which might have a negative impact on the performance. If the dependency between the two entities does not require its own
metadata attributes (and is not a many-to-many relation), it is recommended to use foreign keys instead of relations.</p>
</div>
<div class="paragraph">
<p>Foreign keys can be defined by
adding the <code>@ForeignKey</code> annotation to an attribute in a type definition. The <code>targetProperty</code> attribute of the
annotation must point to the ID or to a custom metadata attribute with a unique constraint of the target type.
The type of the annotated attribute must match the type of the target property of the foreign key. The chapter
<a href="foreign-keys.html#_foreign_keys">Foreign Keys</a> contains a more detailed overview of the foreign key feature.</p>
</div>
<div class="listingblock">
<div class="title">Example: Defining a foreign key</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ForeignKey(name = "fk_invoice_customer", target = Customer.class, targetProperty = "id")
long getCustomerNumber();</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="foreign-key-model.png" alt="foreign key model" width="500" height="154">
</div>
<div class="title">Figure 2. Data model of a foreign key relationship</div>
</div>
</div>
<div class="sect3">
<h4 id="_relations_to_versions"><a class="anchor" href="#_relations_to_versions"></a><a class="link" href="#_relations_to_versions">Relations to versions</a></h4>
<div class="paragraph">
<p>By default, a relation can point to the current version or to a specific version of its parent or child, when the
parent- or child-type supports versions. This behavior can be controlled by the <code>supportedNodeVersion</code> property of
the <code>@Source</code> and <code>@Target</code> annotations used for relation type definitions. The attribute supports three different
values (defined in <code>de.eitco.ecr.type.definition.annotations.reference.SupportedNodeVersion</code>):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Possible values of the supportedNodeVersion attribute</caption>
<colgroup>
<col style="width: 25%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CURRENT_VERSION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The relation must point to the current version of the node identified by the node&#8217;s ID (NOT the VersionId of the current version)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPECIFIC_VERSION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The relation must point to a specific version of the node identified by it&#8217;s VersionId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CURRENT_OR_SPECIFIC_VERSION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The relation can point to either the current version or a specific version of the node. This is the default.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_unique_relations"><a class="anchor" href="#_unique_relations"></a><a class="link" href="#_unique_relations">Unique relations</a></h4>
<div class="paragraph">
<p>A single relation always has exactly one parent and one child. However, by default a single entity can be the parent or
child of multiple relations (many-to-many). By adding unique constraints to the <code>parentId</code> and/or <code>childId</code> system
properties of the relation type, it is possible to define one-to-many, many-to-one or one-to-one relations.</p>
</div>
<div class="listingblock">
<div class="title">Example: Adding a unique constraint to the child ID of a relation</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@SystemProperty(SystemPropertyName.CHILD_ID)
@Unique(constraintName = "uccr_parent_child_uc")
ContainerId getChildId();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_relation_counters"><a class="anchor" href="#_relation_counters"></a><a class="link" href="#_relation_counters">Relation counters</a></h4>
<div class="paragraph">
<p>By using the <code>@RelationCounter</code> annotation it is possible to create counters on the parent- and child-entities for both
incoming and outgoing relations. The counters are persisted in the database and are updated automatically when relations
are added or removed.</p>
</div>
<div class="paragraph">
<p>The <code>@RelationCounter</code> annotation contains two attributes: The <code>relationType</code> attribute
defines the type of relation to count and the <code>direction</code> attribute defines whether to count incoming (the entity is
the child or target of the relation) or outgoing (the entity is the parent or source of the relation). By annotating
the relation counter attribute with <code>@Versioned</code> it is possible to control whether the counter attribute is stored
in the version table for each version or in the main table for all versions. When the counter is stored in the version
table it will contain the count for a single version of the entity. If it is stored in the main table it will contain
the count for all versions of the entity. The following example shows how to define relation counter attributes. The
<code>@Name</code> annotation is used because the attribute name is too long for a database column name.</p>
</div>
<div class="listingblock">
<div class="title">Example: Defining relation counter attributes</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RelationCounter(relationType = TypedContainerContainerRelation.class, direction = RelationCounterDirection.INCOMING)
@Versioned(false)
int getIncomingRelationCounter();

@RelationCounter(relationType = TypedContainerContainerRelation.class, direction = RelationCounterDirection.INCOMING)
@Versioned
@Name("v_in_relation_counter")
int getVersionedIncomingRelationCounter();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_relations"><a class="anchor" href="#_working_with_relations"></a><a class="link" href="#_working_with_relations">Working with relations</a></h4>
<div class="paragraph">
<p>The <em>$arveo</em> API provides several methods that can be used to create, modify and resolve relations. Relations
itself are treated just like any other entity type. Entities, that can be the parent or child of a relation (containers,
folders, documents and meta data entities), provide additional relation-specific methods in the client API. The available
methods are defined in the interface <code>de.eitco.ecr.sdk.TypedBaseRelationNodeEntityClient</code>, which is a super interface
of the clients used in the API for documents, folders, containers and meta data entities. The injectable
<code>de.eitco.ecr.sdk.SearchClient</code> offers additional methods to search for relations using filters on the relation, the
parent or the child.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_folder_type"><a class="anchor" href="#_folder_type"></a><a class="link" href="#_folder_type">Folder type</a></h3>
<div class="paragraph">
<p>The following chapter provides a more detailed overview of the type <code>Folder</code>.</p>
</div>
<div class="paragraph">
<p>A <code>Folder</code> is an entity that is organized in a file system like tree structure. A <code>Folder</code> can contain custom metadata
attributes. Documents can be <em>filed</em> in a <code>Folder</code>.</p>
</div>
<div class="paragraph">
<p>A <code>Folder</code> consists of the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Technical meta information, which is filled by <em>arveo</em> and cannot be changed, see <a href="#_system_properties"><strong>System properties</strong></a>.</p>
</li>
<li>
<p>Typed folder type metadata according to a schema defined for the document type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any number of versions can be created for a <code>Folder</code>. All the versions are traceable in the repository and can be referenced via independent IDs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Only documents can be <em>filed</em> in a <code>Folder</code>. To enable the filing feature, add the <em>@FilingEnabled</em> annotation to your
document type.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_metadata_type"><a class="anchor" href="#_metadata_type"></a><a class="link" href="#_metadata_type">Metadata type</a></h3>
<div class="paragraph">
<p><code>Metadata</code> types are used for example to connect external tables. They do not contain any specific system fields and no typed ID as a primary key. The database table can be created by the <em>arveo</em> or an existing table can be used.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use the <em>@View</em> annotation to mark a metadata type as a view for which the system should not create a table and use the <em>@TableName</em> annotation to define the name of the table of the external system.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Metadata</code> types do not support versioning and retention protection.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can use the <em>@PrimaryKey</em> annotation to define one or more properties of a <code>Metadata</code> type to be the primary key.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_inheritance"><a class="anchor" href="#_inheritance"></a><a class="link" href="#_inheritance">Inheritance</a></h3>
<div class="sect3">
<h4 id="_simple_direct_inheritance"><a class="anchor" href="#_simple_direct_inheritance"></a><a class="link" href="#_simple_direct_inheritance">Simple direct inheritance</a></h4>
<div class="paragraph">
<p>The following chapter describes the inheritance scheme, used in <em>arveo</em>.
The object to be inherited and its initial state is shown in the following table.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<caption class="title">Table 12. The object to be inherited</caption>
<colgroup>
<col style="width: 40%;">
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Create</th>
<th class="tableblock halign-left valign-top">Initial state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Company</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID (Company)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">888</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CTuX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CTuX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CountryCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PhoneNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table describes direct inheritance (hence with no intermediate objects).
Here, <strong>Invoice</strong> is an object that inherited from <strong>Company</strong>.
The following table describes its initial state, and the update status after 3 different updates.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Inheritance scheme</caption>
<colgroup>
<col style="width: 11%;">
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Create</th>
<th class="tableblock halign-left valign-top">Initial state</th>
<th class="tableblock halign-left valign-top">Update 1</th>
<th class="tableblock halign-left valign-top">After Update 1</th>
<th class="tableblock halign-left valign-top">Update 2</th>
<th class="tableblock halign-left valign-top">After Update 2</th>
<th class="tableblock halign-left valign-top">Update 3</th>
<th class="tableblock halign-left valign-top">After Update 3</th>
<th class="tableblock halign-left valign-top">Update 4</th>
<th class="tableblock halign-left valign-top">After Update 4</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Invoice</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID (Invoice)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">931</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">931</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">931</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">931</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">931</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">InvoiceNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-53</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">888</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">888</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CTuX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eitco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eitco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyCountryCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyPhone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+49 (30) 408191-425</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+49 (30) 408191-425</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+49 (30) 408191-425</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+41 123456</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+41 123456</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="red">Error: no change!</span></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="red">Not possible: faulty update parameters!</span></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note the following principles:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>After update2:</strong> All inherited fields are NULLs if inheritance key is set to NULL, unless values are explicitly specified.
<strong>After update3:</strong> All inherited fields are NULLs if inheritance key is set to NULL, unless values are explicitly specified.
- Even if the inheritance key was already NULL before.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_multilevel_inheritance"><a class="anchor" href="#_multilevel_inheritance"></a><a class="link" href="#_multilevel_inheritance">Multilevel inheritance</a></h4>
<div class="paragraph">
<p>This inheritance form has an object to be inherited from, just like the direct inheritance.
An objects inherits from it, after that another object inherits from the second object.
The initial object is still the same, its initial state is described in the table above.</p>
</div>
<div class="paragraph">
<p>In the following table, the second object <strong>Creditor</strong>, which inherits from the first object, is described.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 55%;">
<caption class="title">Table 14. The object to be inherited and inheriting</caption>
<colgroup>
<col style="width: 45%;">
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Create</th>
<th class="tableblock halign-left valign-top">Initial state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Creditor</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID (Creditor)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">999</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CreditorNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">471147114711</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">471147114711</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CompanyID</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">888</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">888</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CTuX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyCountryCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyPhone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the table above, the object <strong>Creditor</strong> inherited the following properites through the companyID: companyName, companyCountryCode, companyPhone.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The results of multilevel inheritance through an intermediate object are shown in the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Inheritance Scheme in Multilevel inheritance</caption>
<colgroup>
<col style="width: 25%;">
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Create</th>
<th class="tableblock halign-left valign-top">Initial state</th>
<th class="tableblock halign-left valign-top">Update 1</th>
<th class="tableblock halign-left valign-top">After Update 1</th>
<th class="tableblock halign-left valign-top">Update 2</th>
<th class="tableblock halign-left valign-top">After Update 2</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Invoice</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID (Invoice)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">931</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">931</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">931</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">InvoiceNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">creditorID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">999</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">999</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CTuX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eitco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EITCO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyCountryCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyPhone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+49 (30) 408191-425</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+49 (30) 408191-425</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+49 (30) 408191-425</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_indirect_inheritance"><a class="anchor" href="#_indirect_inheritance"></a><a class="link" href="#_indirect_inheritance">Indirect inheritance</a></h4>
<div class="paragraph">
<p>The third form of inheritance is indirect inheritance.
It is much like the second form, only the inheriting object inherits the IDs of both objects it inherits from.
In the example above, the object <strong>Invoice</strong> inherits both the <em>creditorID</em> and the <em>companyID</em>.</p>
</div>
<div class="paragraph">
<p>In the following table, the object <strong>Creditor</strong> is described.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 55%;">
<caption class="title">Table 16. An object to be inherited</caption>
<colgroup>
<col style="width: 45%;">
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Create</th>
<th class="tableblock halign-left valign-top">Initial state</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Creditor</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID (Creditor)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">999</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CreditorNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">471147114711</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">471147114711</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CompanyID</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">888</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">888</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The table below describes the mechanism of indirect inheritance.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Inheritance scheme in indirect inheritance</caption>
<colgroup>
<col style="width: 25%;">
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Create</th>
<th class="tableblock halign-left valign-top">Initial state</th>
<th class="tableblock halign-left valign-top">Update 1</th>
<th class="tableblock halign-left valign-top">After Update 1</th>
<th class="tableblock halign-left valign-top">Update 2</th>
<th class="tableblock halign-left valign-top">After Update 2</th>
<th class="tableblock halign-left valign-top">Update 2a</th>
<th class="tableblock halign-left valign-top">After Update 2a</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Invoice</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID (Invoice)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">931</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">931</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">931</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">931</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">InvoiceNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIT-11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">creditorID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">999</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">999</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">888</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">888</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CTuX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eitco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CTuX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eitco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EITCO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyCountryCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">companyPhone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+49 (30) 408191-425</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+49 (30) 408191-425</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[NULL]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+49 (30) 408191-425</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+49 (30) 408191-425</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This form of inheritance is currently not needed and therefore not supported by ECR.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_inheritance_of_acls"><a class="anchor" href="#_inheritance_of_acls"></a><a class="link" href="#_inheritance_of_acls">Inheritance of ACLs</a></h4>
<div class="paragraph">
<p>The <code>acl_id</code> system field is <a href="#_property_like_system_fields">property-like</a>, thus a type can define it as inherited.
This permits scenarios where there is one main entity providing the access definition with several entities being linked to it. If the acl of the main entity changes, the ACLs of the linked entities change as well:</p>
</div>
<div class="listingblock">
<div class="title">Example for the main entity</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
@Acls
public interface MainEntity {

    @Mandatory <i class="conum" data-value="2"></i><b>(2)</b>
    @SystemProperty(SystemPropertyName.ACL_ID) <i class="conum" data-value="1"></i><b>(1)</b>
    AccessControlListId getMainAcl(); <i class="conum" data-value="7"></i><b>(7)</b>

    void setMainAcl(AccessControlListId id);

    // ...
    // your custom attribute definitions
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example for linked entities</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT)
@Acls
public interface ChildEntity {

    @Mandatory <i class="conum" data-value="4"></i><b>(4)</b>
    @ForeignKey(target = MainEntity.class, targetProperty = "id") <i class="conum" data-value="3"></i><b>(3)</b>
    ContainerId getCurrentMainEntity(); <i class="conum" data-value="6"></i><b>(6)</b>

    void setCurrentMainEntity(ContainerId mainEntity);


    @SystemProperty(SystemPropertyName.ACL_ID)
    @InheritedProperty(foreignKeyPropertyName = "current_main_entity", sourcePropertyName = "acl_id") <i class="conum" data-value="5"></i><b>(5)</b>
    AccessControlListId getAcl();

    // ...
    // your custom attribute definitions
    // ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The main entity defines a property that accesses the ACL system property.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This property is defined mandatory - thus the main entity will always have an ACL.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The child entity defines a foreign key to the main entity.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>By specifying the foreign key property as mandatory, every child entity will be linked to a main entity</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Now we can specify an ACL property being inherited.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Note that <code>foreignKeyPropertyName</code> (in line 12) is written in snake-case while the actual property getter is written in camel-case.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Note further, that while the property referenced is actually defined by the getter <code>getMainAcl</code> (MainEntity line 6), <code>sourcePropertyName</code> is set to the name of the system field <code>"acl_id"</code> to derive the property.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s see this behaviour in action.
Assume that we have a <code>TypeDefinitionServiceClient</code> named <code>typeDefintionServiceClient</code> and also the ids of two ACLs (<code>firstAclId</code> and <code>differenceAclId</code>).
First we can create service Clients for the two types defined above:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The annotation <em>@DefaultValue()</em> only accepts the database column name as static string parameter. As the document type properties are CAMEL case and the database column names are SNAKE case
you must convert your properties e.g. MyCamelCaseProperty = my_camel_case_property.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        TypedContainerServiceClient&lt;MainEntity&gt; mainEntityServiceClient =
            typeDefinitionServiceClient.getContainerServiceClient().byClass(MainEntity.class);
        TypedDocumentServiceClient&lt;ChildEntity&gt; childEntityServiceClient =
            typeDefinitionServiceClient.getDocumentServiceClient().byClass(ChildEntity.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>With these service clients we can now create several entity instances of <code>MainEntity</code> and <code>ChildEntity</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        MainEntity mainEntity = mainEntityServiceClient.createTypeInstance();
        mainEntity.setMainAcl(firstAclId);
        TypedContainerClient&lt;MainEntity&gt; mainEntityClient = mainEntityServiceClient.createEntity(mainEntity);

        ChildEntity childEntity1 = childEntityServiceClient.createTypeInstance();
        childEntity1.setCurrentMainEntity(mainEntityClient.getIdentifier());
        TypedDocumentClient&lt;ChildEntity&gt; childEntityClient1 = childEntityServiceClient.createEntity(childEntity1);

        // ...

        ChildEntity childEntityN = childEntityServiceClient.createTypeInstance();
        childEntityN.setCurrentMainEntity(mainEntityClient.getIdentifier());
        TypedDocumentClient&lt;ChildEntity&gt; childEntityClientN = childEntityServiceClient.createEntity(childEntityN);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The instances of <code>ChildEntity</code> will automatically have the same ACL as <code>mainEntity</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Assert.assertEquals(childEntityClient1.getEntity().getAcl(), firstAclId);
        // ...
        Assert.assertEquals(childEntityClientN.getEntity().getAcl(), firstAclId);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the ACL of the parent is updated&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        mainEntity.setMainAcl(differentAclId);
        mainEntityClient.updateAttributes(mainEntity);</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;then the ACLs the instances of <code>ChildEntity</code> change as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        childEntityClient1 = childEntityClient1.reload();
        // ...
        childEntityClientN = childEntityClientN.reload();

        Assert.assertEquals(childEntityClient1.getEntity().getAcl(), differentAclId);
        // ...
        Assert.assertEquals(childEntityClientN.getEntity().getAcl(), differentAclId);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_default_acls_and_inheritance"><a class="anchor" href="#_default_acls_and_inheritance"></a><a class="link" href="#_default_acls_and_inheritance">Default ACLs and Inheritance</a></h4>
<div class="paragraph">
<p>In many cases it will be desirable to be able to specify a default ACL for a given type. But the naive approach for defining a default ACL will prove cumbersome:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
public interface ContainerWithDefaultAcl extends WithData {

    @Mandatory
    @SystemProperty(SystemPropertyName.ACL_ID)
    long getAclId();

    void setAclId(long aclId);

    @DefaultValue("acl_id") <i class="conum" data-value="1"></i><b>(1)</b>
    default long defaultAcl() {

        return ?? <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Of course one can define the ACL system property with a default value.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>However, when specifying the default value one faces a problem. The id of an ACL is set by the Access Control Service
automatically and will vary from deployment to deployment, even between test and production environments.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However, the concepts presented so far can be used for a better solution. The main idea is to specify the ACL by its name instead of its id. For that we will need access to a table containing ACL names and their respective ids. Here <a href="#External Views">external views</a> can be used. We have already seen an external view exposing the ACL table to <em>arveo</em>:</p>
</div>
<div class="listingblock">
<div class="title">Defintion of a view to the acl table</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@View
@Type(ObjectType.META)
@TableName("usrv_acl")
public interface AclView {

    @Unique
    String getName();

    @PrimaryKey
    long getId();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since that exposes ACLs as <em>arveo</em> type instances, ACLs can be used for <a href="#Direct inheritance">inheritance</a>. And since ACL names are unique they can be used as a foreign key, particularly as one defining inheritance. That way the actual ACL id can be inherited by a key that is an ACL name, for which we can easily define a <a href="#Default Values">default value</a> that is stable over every environment:</p>
</div>
<div class="listingblock">
<div class="title">A sofisticated example of an ACL default value</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
@Acls
public interface ContainerWithDefaultAcl extends WithData {

    String DEFAULT_ACL_NAME = "default-container-acl"; <i class="conum" data-value="6"></i><b>(6)</b>

    @Id
    ContainerId getId();

    @Optional <i class="conum" data-value="7"></i><b>(7)</b>
    @ForeignKey(target = AclView.class, targetProperty = "name") <i class="conum" data-value="2"></i><b>(2)</b>
    String getAcl(); <i class="conum" data-value="1"></i><b>(1)</b>

    void setAcl(String acl);

    @DefaultValue("acl")
    default String defaultAcl() { <i class="conum" data-value="3"></i><b>(3)</b>

        return DEFAULT_ACL_NAME;
    }

    @Mandatory <i class="conum" data-value="7"></i><b>(7)</b>
    @InheritedProperty(foreignKeyPropertyName = "acl", sourcePropertyName = "id") <i class="conum" data-value="5"></i><b>(5)</b>
    @SystemProperty(SystemPropertyName.ACL_ID)
    long getAclId(); <i class="conum" data-value="4"></i><b>(4)</b>

    void setAclId(long aclId);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In our type we define a property ACL, that holds the name of the ACL.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This property is a foreign key that targets the field <code>name</code> table <code>usr_acl</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>For this property we can easily specify a default value.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Now we specify the ACL property.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>It is simply defined to be inherited by the foreign key to the ACL table.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>It is good practice to store constant default values in constants.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Marking the ACL id as <em>@Mandatory</em> enforces that every instance of the entity must have an ACL. However, this does not need to be an inherited one (since the ACL name is marked <em>@Optional</em>). So the more cumbersome way - to set the ACL by its id - is still possible. Marking the ACL propery as <em>@Mandatory</em> would forbid this.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_retention"><a class="anchor" href="#_retention"></a><a class="link" href="#_retention">Retention</a></h3>
<div class="sect3">
<h4 id="_annotations_retentionprotected"><a class="anchor" href="#_annotations_retentionprotected"></a><a class="link" href="#_annotations_retentionprotected">Annotations <em>@RetentionProtected</em></a></h4>
<div class="paragraph">
<p>An object may be annotated as <em>@RetentionProtected</em>. This will enable all further retention annotations listed below.Every retention enabled object extends the data model by</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Datetime <em>Retention_Date</em>: contains the fixed retention period as <em>ZonedDateTime</em> format</p>
</li>
<li>
<p>Boolean <em>LitigationHold</em>: stores the litigation hold property</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The convenience class 'Retention_Info' contains both values and can be used to read the retention information with one call.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_annotations_defaultsystempropertyvalueretention_date"><a class="anchor" href="#_annotations_defaultsystempropertyvalueretention_date"></a><a class="link" href="#_annotations_defaultsystempropertyvalueretention_date">Annotations <em>@DefaultSystemPropertyValue(RETENTION_DATE)</em></a></h4>
<div class="paragraph">
<p>It is possible to define a default value for the <em>RETENTION_DATE</em> system column
(<a href="#_default_values">Default Values</a>]).</p>
</div>
<div class="paragraph">
<p>If a retention date is not explicitly set, a default value for the retention period is calculated using the default value
function implemented by the document type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@DefaultSystemPropertyValue(SystemPropertyName.RETENTION_DATE)
default ZonedDateTime defaultDatum() {
    return ZonedDateTime.Now().plusYears(10);
}</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<em>@RetentionProtected</em> annotations is required if you want to set a default for <em>retention_date</em>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you have defined foreign keys, you can inherit the retention date from container or folder objects.This is very helpful
if you have records in your data model (<a href="#_inheritance">Defaults and Inheritance</a>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_retention_examples"><a class="anchor" href="#_retention_examples"></a><a class="link" href="#_retention_examples">Examples</a></h4>
<div class="sect4">
<h5 id="_document_type_10_year_retention_period"><a class="anchor" href="#_document_type_10_year_retention_period"></a><a class="link" href="#_document_type_10_year_retention_period">Document Type: 10 year retention period</a></h5>
<div class="paragraph">
<p>The following example shows how to set the default retention to creation date + 10 years.
It also shows how to set a default value for the property <em>warrantyEnd</em> based on the ReceiptDate + 3 years.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
It is still possible to set the <em>Retention_date</em> and <em>warrantyEnd</em> when you upload the document and overwrite the default value.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example: Upload a document with new content</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/*
 * Copyright (c) 2020 EITCO GmbH
 * All rights reserved.
 *
 * Created on 02.10.2020
 *
 */
package de.eitco.ecr.system.test.types.defaultvalues;

import de.eitco.ecr.common.RetentionInformation;
import de.eitco.ecr.type.definition.annotations.ContentElement;
import de.eitco.ecr.type.definition.annotations.ObjectType;
import de.eitco.ecr.type.definition.annotations.OverwriteAllowed;
import de.eitco.ecr.type.definition.annotations.Type;
import de.eitco.ecr.type.definition.annotations.constraint.Mandatory;
import de.eitco.ecr.type.definition.annotations.constraint.SecondaryKey;
import de.eitco.ecr.type.definition.annotations.defaults.DefaultSystemPropertyValue;
import de.eitco.ecr.type.definition.annotations.defaults.DefaultValue;
import de.eitco.ecr.type.definition.annotations.system.Acls;
import de.eitco.ecr.type.definition.annotations.system.Id;
import de.eitco.ecr.type.definition.annotations.system.RetentionProtected;
import de.eitco.ecr.type.definition.annotations.system.SystemProperty;
import de.eitco.ecr.type.definition.annotations.system.SystemPropertyName;
import org.springframework.http.MediaType;

import java.time.ZoneId;
import java.time.ZonedDateTime;

@Type(ObjectType.DOCUMENT)
@RetentionProtected
@ContentElement(name = "content", separateField = true)
@OverwriteAllowed
@Acls
public interface DocumentWithDefaultRetention {

    @Id
    Object identifier();

    @SystemProperty(value = SystemPropertyName.RETENTION_INFO)
    RetentionInformation getRetentionInformation();

    @SystemProperty(value = SystemPropertyName.RETENTION_DATE)
    ZonedDateTime getRetentionDate();

    void setRetentionDate(ZonedDateTime retentionDate);

    @SystemProperty(value = SystemPropertyName.LITIGATION_HOLD)
    Boolean getLitigationHold();

    @SecondaryKey
    String getName();

    void setName(String name);

    @Mandatory
    ZonedDateTime getReceiptDate();

    void setReceiptDate(ZonedDateTime receiptDate);

    @Mandatory
    ZonedDateTime getWarrantyEnd();

    void setWarrantyEnd(ZonedDateTime warrantyEnd);

    @Mandatory
    String getMimeType();

    void setMimeType(String value);


    // helper for snake case db column names based on camel case getter/setter names
    // attenttion you MUST use snake db column names in default value annotations! if the name is wrong you will get a model exception during start up
    String DB_COL_WARRANTYEND = "warranty_end"; <i class="conum" data-value="1"></i><b>(1)</b>
    String DB_COL_MIMETYPE = "mime_type";
    String DB_COL_RECEIPTDATE = "receipt_date";
    String DB_COL_NAME = "name";
    String DB_COL_RETENTIONDATE = "retention_date";

    ZoneId ZoneIdEuropeBerlin = ZoneId.of("Europe/Berlin");

    // set default values
    @DefaultValue(DB_COL_WARRANTYEND)
    default ZonedDateTime defaultWarrantyEnd() {

        return getReceiptDate().withZoneSameInstant(ZoneIdEuropeBerlin).plusYears(3);
    }

    @DefaultSystemPropertyValue(SystemPropertyName.RETENTION_DATE)
    default ZonedDateTime defaultRetentionDate() {

        return ZonedDateTime.now(ZoneIdEuropeBerlin).plusYears(10);
    }

    @DefaultValue(DB_COL_MIMETYPE)
    default String defaultMimeType() {
        return MediaType.APPLICATION_OCTET_STREAM_VALUE;
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
(1) The annotation <em>@DefaultValue()</em> only accepts the database column name as static string parameter.As the document
type properties are CAMEL case and the database column names are SNAKE case
you must convert your properties e.g. MyCamelCaseProperty = my_camel_case_property.In the below example constants are defined in the type.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The retention annotations also work for the document types: container, folder and relation.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tenant_separation"><a class="anchor" href="#_tenant_separation"></a><a class="link" href="#_tenant_separation">Tenant separation</a></h3>
<div class="paragraph">
<p>Objects can be separated by <a href="https://nexus.eitco.de/repository/html-default/de.eitco.commons.tenant/cmn-tenant-parent/5.0.0/documentation/index.html">tenant</a>. If this is activated on a type definition, the corresponding table will contain a system field <em>tenant_id</em>, where the <a href="https://nexus.eitco.de/repository/html-default/de.eitco.commons.tenant/cmn-tenant-parent/5.0.0/documentation/index.html#_tenants">id of the tenant</a> an entity resides in is stored.</p>
</div>
<div class="paragraph">
<p>The field will be assigned to the creation users tenants id and never change. When entities are queried, a filter will be added that filters only entities whose <em>tenant_id</em> field have the value of the querying users tenants id.</p>
</div>
<div class="sect3">
<h4 id="_fallback_tenant"><a class="anchor" href="#_fallback_tenant"></a><a class="link" href="#_fallback_tenant">Fallback-tenant</a></h4>
<div class="paragraph">
<p>Should the creation user be in the <a href="https://nexus.eitco.de/repository/html-default/de.eitco.commons.tenant/cmn-tenant-parent/5.0.0/documentation/index.html#<em>the_fallback_tenant">fallback-tenant</a>, the _tenant_id</em> field will be set to <em>NULL</em>.
Should a querying user reside in the fallback-tenant, the query will not be filtered by tenant. This means that the fallback tenant behaves like a view to the data that combines all tenants. If such a thing is unwanted deactivate the fallback tenant using the <a href="https://nexus.eitco.de/repository/html-default/de.eitco.commons.tenant/cmn-tenant-parent/5.0.0/documentation/index.html#_configuration">multi-tenancy.mode configuration property</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage"><a class="anchor" href="#_usage"></a><a class="link" href="#_usage">Usage</a></h4>
<div class="paragraph">
<p>The behaviour is primarily defined by the <a href="https://nexus.eitco.de/repository/html-default/de.eitco.commons.tenant/cmn-tenant-parent/5.0.0/documentation/index.html#_configuration">multi-tenancy.mode configuration property</a></p>
</div>
<div class="paragraph">
<p>It can be controlled more fine-grained by the annotation <em>@TenantSeparation</em>, however this makes sense mostly in environments where <em>multi-tenancy.mode</em> is <em>allowed</em>.</p>
</div>
<div class="listingblock">
<div class="title">A type separating its entities by tenant</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
@TenantSeparation(true)
public interface Person {

// property definitions ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are aliases specified: <em>@TenantSeparated</em> for <em>@TenantSeparation(true)</em> and <em>@TenantAgnostic</em> for <em>@TenantSeparation(false)</em>.</p>
</div>
<div class="paragraph">
<p>The default behaviour depends on the <a href="https://nexus.eitco.de/repository/html-default/de.eitco.commons.tenant/cmn-tenant-parent/5.0.0/documentation/index.html#_configuration">multi-tenancy.mode configuration property</a>:</p>
</div>
<div class="paragraph">
<p>If it is <em>enforced</em>, types are separated by tenant by default. Any type specified to be not separated by tenant will cause arveo to fail at startup.</p>
</div>
<div class="paragraph">
<p>If it is <em>disabled</em>, types are not separated by tenant by default. Any type specified to be separated by tenant will cause arveo to fail at startup.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_db_schema_changes"><a class="anchor" href="#_advanced_db_schema_changes"></a><a class="link" href="#_advanced_db_schema_changes">Advanced db schema changes</a></h3>
<div class="paragraph">
<p>Simple changes of the database schema like adding a new attribute are performed automatically by the system in
maintenance mode. In some cases it might be required to perform more complex schema changes, which cannot be handled by
the system automatically.
The following changes cannot be performed automatically on tables that already contains data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>setting NOT NULL for an existing column;</p>
</li>
<li>
<p>type changes especially to non-string columns;</p>
</li>
<li>
<p>foreign keys;</p>
</li>
<li>
<p>making a column UNIQUE.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, changing the data type of an attribute is not supported because it usually
requires project specific migration steps. Advanced changes like this can be performed by custom liquibase scripts.</p>
</div>
<div class="paragraph">
<p>To perform custom database schema migrations, <em>arveo</em> offers several ways to define custom liquibase migration
scripts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A global script that will be executed before the first type definition will be created or updated. This script can
be configured using the property <code>ecr.server.liquibase.preInitializationChangeLog</code>.</p>
</li>
<li>
<p>A global script that will be executed after the last type definition was created or updated. This script can
be configured using the property <code>ecr.server.liquibase.customChangeLog</code>.</p>
</li>
<li>
<p>A script for a specific type definition that will be executed before the type definition is created or updated.
This script can be configured using the annotation <code>@PreSchemaInitialization</code> on the class representing the type
definition.</p>
</li>
<li>
<p>A script for a specific type definition that will be executed after the type definition was created or updated.
This script can be configured using the annotation <code>@PostSchemaInitialization</code> on the class representing the type
definition.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The values of the configuration properties for the global scripts and the annotations must be valid URIs pointing to
a liquibase changelog script. The URIs can point to a filesystem resource (using <code>file:/</code>) or a classpath resource
(using <code>classpath:</code>). Each script will be executed in every configured tenant.</p>
</div>
<div class="sect3">
<h4 id="_schema_initialization_steps"><a class="anchor" href="#_schema_initialization_steps"></a><a class="link" href="#_schema_initialization_steps">Schema initialization steps</a></h4>
<div class="paragraph">
<p>For a better understanding of how the schema initialization works, the following list shows the steps performed by the
system at startup:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for each tenant:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create or update the system tables</p>
</li>
<li>
<p>Execute custom pre initialization changelog if configured</p>
</li>
<li>
<p>For each registered type definition class:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Execute custom class-specific pre schema initialization script if configured</p>
</li>
<li>
<p>Create or update the type definition table(s)</p>
</li>
<li>
<p>Execute custom class-specific post schema initialization script if configured</p>
</li>
</ol>
</div>
</li>
<li>
<p>Execute custom liquibase changelog if configured</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the actions performed by the automatic schema initialization in step 3.b. can be influenced by the changes
that were already performed by the custom scripts executed before. For example, the system will not try to create a new
attribute if the custom script has already performed the required schema changes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_example"><a class="anchor" href="#_example"></a><a class="link" href="#_example">Example</a></h4>
<div class="paragraph">
<p>The following example shows a type definition class that defines a custom script that will be executed before the
type definition is updated. The script expects that the type definition table already exists on the database and is
used to change the data type of the attribute <em>postal_code</em> from Long to String. Note that for the sake of simplicity,
the script does not perform an actual data migration but simply drops and re-creates the database column for the
attribute.</p>
</div>
<div class="listingblock">
<div class="title">Example for a type definition with custom pre schema initialization script</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
@Index(value = "my_container_name_index", onVersionTable = true)
@PreSchemaInitialization("classpath:liquibase/my-container-changelog.xml")
@Variables
public interface MyContainer {</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example for a custom liquibase script</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.1" encoding="UTF-8"?&gt;
&lt;databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd"
        logicalFilePath="my-container-changelog.xml"&gt;

    &lt;changeSet id="update-my-container-1" author="root"&gt;
        &lt;dropColumn tableName="my_container" columnName="postal_code"/&gt;
        &lt;addColumn tableName="my_container"&gt;
            &lt;column name="postal_code" type="text"/&gt;
        &lt;/addColumn&gt;
        &lt;dropColumn tableName="my_container_ver" columnName="postal_code"/&gt;
        &lt;addColumn tableName="my_container_ver"&gt;
            &lt;column name="postal_code" type="text"/&gt;
        &lt;/addColumn&gt;
    &lt;/changeSet&gt;

&lt;/databaseChangeLog&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the script in the above example first updates the content of the type definition system tables to reflect
the changed data type of the attribute <em>postal_code</em> of the type <em>my_container</em>. Doing this causes the automatic
migration performed afterwards to ignore the change. Other changes in the type class would still be performed automatically, if possible.
The script then simple drops and re-creates the column for the
attribute. In a real-life scenario, this is the place where the actual data migration would happen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_changes_not_checked_during_startup"><a class="anchor" href="#_changes_not_checked_during_startup"></a><a class="link" href="#_changes_not_checked_during_startup">Changes not checked during startup</a></h4>
<div class="paragraph">
<p>The following changes in the type system will not be checked for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Inheritance</strong>: Changing the source key or the source property of an inherited property is allowed. The system will accept it (and not even check it). This can have subtle consequences. The data of an entity created before such a change will still be as before. However, the next time it is updated the inheritance will be computed anew and thus the data will change according the new inheritance rule.</p>
</li>
<li>
<p><strong>formatted counter sequence names</strong>: Changing the name of the sequence of a formatted counter will take effect. This can have an impact on your application. It will result in the creation of a new sequence and effectively reset the counters value. This might be desired effect - it could also be the result of an oversight in the type changes. To protect oneself from accidental changes it is deemed could practice to mark formatted counter fields with <code>@Unique</code>.</p>
</li>
<li>
<p><strong>indexes prefixed with <code>ecr_mnl_</code>:</strong> Indexes defined on tables belonging to ecr types will be created and deleted according to changes in the types. However, indexes whose names start with the prefix <code>ecr_mnl_</code> will be excluded from that. This enables admins to quickly react on slow systems without a system update inferring with such a patch. This has two consequences</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Admins, that manually add an index, should pick a name for the index that starts with <code>ecr_mnl_</code></p>
</li>
<li>
<p>Developers, that add an index to an arveo type should pick a name that does not start with <code>ecr_mnl_</code></p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In a case where an index prefixed with <code>ecr_mnl_</code> is used it will be beneficially in the long-run, to add the index to the type. In this case the prefix <code>ecr_mnl_</code> in the name must be omitted when defining the index on the type.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_document_service"><a class="anchor" href="#_document_service"></a><a class="link" href="#_document_service"><strong>Document Service</strong></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Document Service service is responsible for handling various repository entities such as documents and folders. The following entity types are supported: document, folder, container, relation and metadata.</p>
</div>
<div class="paragraph">
<p>The service saves the binary data belonging to the documents and delivers them again. Various plugins are available for connecting storage devices and services. A plug-in is assigned to a profile and configured. When saving data, the client has to specify the profile to be used and thereby decides where the data will be saved.</p>
</div>
<div class="sect2">
<h3 id="_upload_data"><a class="anchor" href="#_upload_data"></a><a class="link" href="#_upload_data">Upload data</a></h3>
<div class="paragraph">
<p>Content, annotations (see below) and metadata can be uploaded as a coherent document. 0-n content elements of different content types are possible. Each content element is named. As a result, you get a globally unique ID (DocumentID), which can be used to reference content, annotations and / or just metadata of the latest version of the document. It is possible to clone content elements from one document to another, creating a copy of the content on the storage. For that, a ContentReference can be supplied when the document is created.</p>
</div>
<div class="listingblock">
<div class="title">Example: Upload a document with new content</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">TypedDocumentServiceClient&lt;SingleContentDocument&gt; serviceClient =
    typeDefinitionServiceClient.getDocumentServiceClient().byClass(SingleContentDocument.class); <i class="conum" data-value="1"></i><b>(1)</b>

SingleContentDocument document = serviceClient.createTypeInstance();
document.setName("some name");

TypedDocumentClient&lt;SingleContentDocument&gt; client = serviceClient.create(
    new TypedDocumentInput&lt;&gt;(Map.of("content", <i class="conum" data-value="2"></i><b>(2)</b>
        new ContentUpload(inputStream)), document)); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The typeDefinitionServiceClient is an instance of TypeDefinitionServiceClient, that can be injected.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The type definition SingleContentDocument uses only the default content definition, hence the default name is used.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The actual content is passed as an InputStream.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example: Upload a document with cloned content</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">TypedDocumentServiceClient&lt;TypedTargetDocument&gt; serviceClient =
    typeDefinitionServiceClient.getDocumentServiceClient().byClass(TypedTargetDocument.class); <i class="conum" data-value="1"></i><b>(1)</b>

TypedTargetDocument document = serviceClient.createTypeInstance();

DocumentContentReference reference = new DocumentContentReference(documentId, "content"); <i class="conum" data-value="2"></i><b>(2)</b>

TypedDocumentClient&lt;TypedTargetDocument&gt; client =
    serviceClient.create(new TypedDocumentInput&lt;&gt;(document, Map.of("content", reference)));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The typeDefinitionServiceClient is an instance of TypeDefinitionServiceClient, that can be injected.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Here the documentId is the ID of an already existing document that uses the default content definition.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example: Upload a document with Base64 encoded data</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Base64EncodedData data = new Base64EncodedData(base64Data);<i class="conum" data-value="1"></i><b>(1)</b>
Map&lt;String, ContentUpload&gt; contentElements = Map.of("content", new ContentUpload(data));<i class="conum" data-value="2"></i><b>(2)</b>

serviceClient.create(new TypedDocumentInput&lt;&gt;(contentElements, document));<i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Wrap the Base64 encoded data in a new <code>Base64EncodedData</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create a content upload with the created <code>Base64EncodedData</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Upload the document</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_validating_uploaded_content"><a class="anchor" href="#_validating_uploaded_content"></a><a class="link" href="#_validating_uploaded_content">Validating uploaded content</a></h4>
<div class="paragraph">
<p>There are several different ways to validate the content of an uploaded document. The method to use depends on the requirements of the client application. Some applications might already have computed a hash of the content while others might offload this to the server.</p>
</div>
<div class="sect4">
<h5 id="_validating_content_on_the_client_side"><a class="anchor" href="#_validating_content_on_the_client_side"></a><a class="link" href="#_validating_content_on_the_client_side">Validating content on the client side</a></h5>
<div class="paragraph">
<p>When content is uploaded to a type definition that supports content metadata, the server computes an SHA-256 hash for the received data and returns it in the result of the upload request. The client can use this hash value to compare the data received by the server with the original data. The following example shows how to compare the hash values:</p>
</div>
<div class="listingblock">
<div class="title">Example: Checking hash values on the client side</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ContentTest entity = client.create(input).getEntity(); <i class="conum" data-value="1"></i><b>(1)</b>
Hash hash = entity.getContent().get("content").getHash(); <i class="conum" data-value="2"></i><b>(2)</b>

Hash expectedHash = Hash.sha256Hash(inputStream, 1000000, tempFile); <i class="conum" data-value="3"></i><b>(3)</b>
Assert.assertEquals(expectedHash, hash);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The document is uploaded using a type definition service client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get the hash returned from the server. <code>getContent</code> is a getter for the system property <code>SystemPropertyName.CONTENT</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use <code>de.eitco.ecr.common.Hash</code> to compute the expected hash</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>TypedDocumentServiceClient</code> offers an additional method to validate uploaded content. The <code>createAndValidate</code> method automatically computes a hash of the uploaded data and compares it with the hash value returned from the server. If the two hashes do not match, a <code>HashValidationException</code> is thrown and the created document will be purged.</p>
</div>
<div class="listingblock">
<div class="title">Example: Using the createAndValidate method</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">TypedDocumentServiceClient&lt;ContentTest&gt; client = typeDefinitionServiceClient
    .getDocumentServiceClient().byClass(ContentTest.class);

ContentUpload contentUpload = new ContentUpload(data);

Map&lt;String, ContentUpload&gt; content = Map.of("content", contentUpload);

ContentTest instance = client.createTypeInstance();
TypedDocumentInput&lt;ContentTest&gt; input = new TypedDocumentInput&lt;&gt;(content, instance);

client.createAndValidate(input);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_validating_content_on_the_server_side"><a class="anchor" href="#_validating_content_on_the_server_side"></a><a class="link" href="#_validating_content_on_the_server_side">Validating content on the server side</a></h5>
<div class="paragraph">
<p>It is also possible to pass a hex representation of an SHA-256 hash code of the uploaded content to the server. If such a hash is present, the server will compare the computed hash value with the one specified by the client. If the values do not match, the upload fails and the uploaded file will not be stored.</p>
</div>
<div class="listingblock">
<div class="title">Example: Checking hash values on the server side</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Hash hash = Hash.sha256Hash(inputStream, 1000000, tempFile); <i class="conum" data-value="1"></i><b>(1)</b>

ContentUpload contentUpload = new ContentUpload(
    "lorem_ipsum.txt", <i class="conum" data-value="2"></i><b>(2)</b>
    null, <i class="conum" data-value="3"></i><b>(3)</b>
    null, <i class="conum" data-value="4"></i><b>(4)</b>
    data,
    hash
);

Map&lt;String, ContentUpload&gt; content = Map.of("content", contentUpload);

ContentTest document = client.createTypeInstance();
TypedDocumentInput&lt;ContentTest&gt; input = new TypedDocumentInput&lt;&gt;(content, document);

client.create(input);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>de.eitco.ecr.common.Hash</code> to compute the hash</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The filename</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>null for the length, will be computed by the server</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>null for the content type, will be computed by the server</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_validating_the_content_of_an_existing_document"><a class="anchor" href="#_validating_the_content_of_an_existing_document"></a><a class="link" href="#_validating_the_content_of_an_existing_document">Validating the content of an existing document</a></h5>
<div class="paragraph">
<p>The <code>TypedDocumentServiceClient</code> provides a method called <code>hashMatches</code> that can be used to check if the content of an existing document is valid. The client has to provide the expected hash, the document&#8217;s ID and the name of the content element to check. An additional parameter called <code>loadContent</code> defines if the server should use the hash value stored in the database or if it should load the content from the storage and compute a new hash value to compare. It is possible to check the content of a specific version of a document, too.</p>
</div>
<div class="listingblock">
<div class="title">Example: Checking hash values of an existing document</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Hash hash = Hash.sha256Hash(inputStream, 1000000, tempFile);
boolean hashMatches = documentServiceClient.hashMatches(documentId, "content", hash, false);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_resumable_uploads"><a class="anchor" href="#_resumable_uploads"></a><a class="link" href="#_resumable_uploads">Resumable uploads</a></h4>
<div class="paragraph">
<p>In some situations uploading large files might fail because of timeouts or an unstable network connection. For these
situations, arveo supports resumable uploads using the <a href="http://tus.io">tus</a> protocol. On the server side, an
additional service is used that provides the tus API and stores uploaded files in the filesystem. The Content Repository
Service retrieves uploaded files from the upload service and stores them just as any regular content. When the content
was stored successfully, the uploaded file is deleted from the upload service&#8217;s storage automatically. In case storing
the content in the Content Repository Service has failed, the uploaded file is not removed, giving the client the
opportunity to re-try storing the content without having to upload the entire file again.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use the tus client in combination with the arveo SDK to use
resumable uploads. The tus client can be obtained using the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;de.eitco.commons&lt;/groupId&gt;
    &lt;artifactId&gt;tus-upload-service-client-spring&lt;/artifactId&gt;
    &lt;version&gt;${tus-upload-service.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example: Resumable uploads</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">File file = new File(baseDirectory + "/src/test/resources/documents/lorem_ipsum.txt");
String uploadId;

try (TusClient tusClient = tusClientFactory.newClient()) { <i class="conum" data-value="1"></i><b>(1)</b>

    TusUpload upload = new TusUpload(new FileInputStream(file), "lorem-ipsum.txt", file.length());
    uploadId = tusClient.resumeOrCreateUpload(upload, 100 * 1024); <i class="conum" data-value="2"></i><b>(2)</b>
}

TypedDocumentServiceClient&lt;Files&gt; serviceClient =
    typeDefinitionServiceClient.getDocumentServiceClient().byClass(Files.class);

Files document = serviceClient.createTypeInstance();
document.setFilename("lorem_ipsum.txt");

AsyncUploadReference uploadReference = new AsyncUploadReference(uploadId, "lorem_ipsum.txt"); <i class="conum" data-value="3"></i><b>(3)</b>
Map&lt;String, ContentReference&gt; contentReferences = Map.of("content", uploadReference);

TypedDocumentClient&lt;Files&gt; typedDocumentClient =
    serviceClient.create(new TypedDocumentInput&lt;&gt;(document, contentReferences));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a new TusClient using the injectable TusClientFactory.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Remember the unique ID of the upload.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Reference the uploaded file using its ID for the document creation call for the Content Repository Service.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_download_data"><a class="anchor" href="#_download_data"></a><a class="link" href="#_download_data">Download data</a></h3>
<div class="paragraph">
<p>Content, annotations and metadata of a document can be downloaded via API. It is possible to load the entire document as a multipart or a structure of the document that includes all metadata, annotations and a list of content elements with their IDs, types and identifiers. Each content element can then be loaded using the document ID / content ID or the
document ID / content type. Access to individual content elements without a document ID is not possible for reasons of access control. Access control based on the document ID is ensured with every access.</p>
</div>
<div class="sect3">
<h4 id="_update_metadata_without_a_version"><a class="anchor" href="#_update_metadata_without_a_version"></a><a class="link" href="#_update_metadata_without_a_version">Update metadata without a version</a></h4>
<div class="paragraph">
<p>The meta information of a document can be changed. The changes can be persisted in the database without creating a version. It is possible, to maintain frequently changing information on the document quickly without creating the overhead of a version. However, in the event of an audit, the changes are not traceable.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_document_service_recycle_bin"><a class="anchor" href="#_document_service_recycle_bin"></a><a class="link" href="#_document_service_recycle_bin">Delete an object</a></h3>
<div class="paragraph">
<p>Documents contain one or more content elements which are not stored in the database but in the storage system. When a document is deleted using one of the delete-calls, the content elements will remain on the storage. To delete both the database entries and all content elements (including those referenced from older versions), a client can use the purge
methods provided by the document clients.</p>
</div>
<div class="paragraph">
<p>A type definition can use the optional <em>recycle bin</em> feature. If it is enabled, entities in the type definition can be moved to and restored from the recycle bin.
The Delete-API allows you to execute the methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MoveToRecycleBin(): to move an object to the recycle bin. The <em>DELETE</em>-property of the latest version is set to 1 and content and older versions are not affected.</p>
</li>
<li>
<p>Delete() all the versions of the object are deleted from the database.</p>
</li>
<li>
<p>Purge(): all the version of the objects are deleted from the database and the content objects or files are erased.</p>
</li>
<li>
<p>RestoreFormRecycleBin(): restore an object from the recycle bin, the <em>DELETE</em>-property is set to 0</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If an object has relations to other objects is related by other objects the delete or purge method will fail with a foreign key exception. The Relation API provides methods to delete the relations (<a href="#_removing_all_relations_of_an_entity"><strong>Remove Relations</strong></a>)
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_filter_recycle_bin"><a class="anchor" href="#_filter_recycle_bin"></a><a class="link" href="#_filter_recycle_bin">Filter recycle bin</a></h4>
<div class="paragraph">
<p>Entities in the recycle bin will be filtered from normal queries by default, but a client can compose search expressions that override this behavior. To do that it is sufficient to include a reference to the deleted system field in the expression. The following example shows a part of a query that will show only deleted entities:</p>
</div>
<div class="listingblock">
<div class="title">Excerpt of an example query</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">....and().systemField(SystemFieldList.GeneralSystemField.Deleted.INSTANCE).equalTo().value(true)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the deleted system field can contain <em>null</em> values, which have the same meaning as <em>false</em>. When a client uses one of the <em>delete</em> calls to delete one or more entities, all database entries for those entities will be deleted (including all versions).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is no option to restore entities once they have been deleted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If there are relations between entities that are to be deleted, the relations are not deleted. Instead, a <em>ForeignKeyException</em> is thrown - and has to be handled by the caller.</p>
</div>
</div>
<div class="sect3">
<h4 id="_removing_all_relations_of_an_entity"><a class="anchor" href="#_removing_all_relations_of_an_entity"></a><a class="link" href="#_removing_all_relations_of_an_entity">Removing all relations of an entity</a></h4>
<div class="paragraph">
<p>To delete all relations that originate from a certain entity, the method <em>removeAllRelations()</em> has to be used. The method returns the deleted relations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Relation&gt; removed = sourceContainerClient.removeAllRelations();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also delete all relations that point to a specific entity. For this, there is the method <em>removeAllIncomingRelations()</em>. This also returns the deleted relations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;Relation&gt; removed = targetContainerClient.removeAllIncomingRelations();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once all relations have been removed, the entity can also be deleted.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_locking"><a class="anchor" href="#_locking"></a><a class="link" href="#_locking">Locking</a></h3>
<div class="paragraph">
<p>If your applications want to update objects from different processes at the same time you must decide if you want to use no locking or optimistic locking.
No locking means that the latest update wins and overwrites the concurrent update. Depending on the database configuration it might happen that one update becomes a deadlock victim and an exception is thrown.
If optimistic locking is enabled for the document type the API ensures that updates do not overwrite changes made by other clients by accident. The feature is disabled by default and can be enabled by annotating a type class with <em>@OptimisticLocking</em>.
e.g. two processes A and B load the same object including content and versions at the same time and get the same version of the document. Now both processes process the document and some metadata and add additional content. A is faster than B. With No Locking B overwrites the changes made by A. With optimistic locking B cannot save the changes and receives a Locking exception. Process B has to load the changes made by A and retry the operation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_download_links_for_external_users"><a class="anchor" href="#_download_links_for_external_users"></a><a class="link" href="#_download_links_for_external_users">Download links for external users</a></h3>
<div class="paragraph">
<p>You can create download links for content elements that can be used by external users who do not exist in the user management service. Such a link has an expiration date and can be used to download a single content element. The links are digitally signed using a configurable certificate, so that the receiver cannot alter the
referenced content element or the expiration date of the link. The <em>arveo</em> service provides a special HTTP endpoint to process download links. This endpoint does not require authentication. Instead, the download link contains credentials that allow the user to access the referenced content element.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature must be activated by configuring a keystore containing an RSA keypair that will be used to sign the links.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration options are listed <a href="include::../../../../docs-commons/src/main/asciidoc/configuration-properties.html#_ecr_server_content-access-tokens">here</a>.</p>
</div>
<div class="paragraph">
<p>Download links (or content access tokens), can be created using the Java SDK as shown in the following exaple:</p>
</div>
<div class="listingblock">
<div class="title">Injecting and instance of the ContentAccessTokenResourceClient</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Autowired
private ContentAccessTokenResourceClient contentAccessTokenResourceClient;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Creating a new content access token</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">ContentAccessTokenInput input = new ContentAccessTokenInput(
    documentId,<i class="conum" data-value="1"></i><b>(1)</b>
    "content",<i class="conum" data-value="2"></i><b>(2)</b>
    ZonedDateTime.now().plusHours(3)<i class="conum" data-value="3"></i><b>(3)</b>
);

String token = contentAccessTokenResourceClient.createToken(input);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The ID of the document containing the content element to download</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of the content element</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The expiration date of the link (can be omitted)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The returned token can then be used to download the content by performing a GET request to the following endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>GET http://my-arveo-instance/api/streaming/&lt;token&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Download links can only be created for content elements that are accessible to the user creating the link. When the client does not define an expiration date when the content access token is created, the configured maximum lifetime is used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The creation of new tokens will fail when the client specifies an expiration date that would exceed the configured maximum lifetime.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_versioning_v"><a class="anchor" href="#_versioning_v"></a><a class="link" href="#_versioning_v">Versioning</a></h3>
<div class="paragraph">
<p>The goal of using the concept of versioning is to create and work with version-safe archives and track the history of each change in the system.</p>
</div>
<div class="sect3">
<h4 id="_versioning_basics"><a class="anchor" href="#_versioning_basics"></a><a class="link" href="#_versioning_basics">Versioning basics</a></h4>
<div class="paragraph">
<p>All entity types in <em>arveo</em> may have a version, which itself is an optional attribute.
The attributes of the entity types specify in their definition whether they are versioned. If an entity
type has at least one versioned attribute, a version table is created.
The version number of an existing entity is automatically created and can be retrieved via the system property
version_number.</p>
</div>
<div class="paragraph">
<p>In the version table, the version changes to the metadata are listed, as well as the changes to one or more content
elements. Optionally you can specify a Unicode version comment.
Each version gets a version ID, which is unique for this bundle of version tables. The version id allows a developer to
retrieve content and metadata of exactly this version of the entity.
Using the API a developer can query all versions including their metadata and content elements for each entity ID or
version ID. It is ensured that the existing content of a version is not changed or deleted by a new version, but there is an exception to this rule, which does allow to overwrite a version change.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is a function that allows you to make a change without having to note it in the version table. And there is
a way to forbid this for a certain entity type.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_of_versioning"><a class="anchor" href="#_implementation_of_versioning"></a><a class="link" href="#_implementation_of_versioning">Implementation of versioning</a></h4>
<div class="paragraph">
<p>The concept of versioning is implemented using the annotation <em>@Versioned</em>, which is defined by the interface <em>Versioned</em>.
This annotation defines if an attribute of a type is versioned or not (when placed on a getter) or if all attributes
of a type are versioned or not (when placed on a type). When the annotation is present on a type and on a getter in
the type, the annotation on the getter wins.</p>
</div>
<div class="paragraph">
<p>The following example of an object of type <em>Container</em> contains an attribute "name", which is a versioned attribute.
The other attribute "counter" in this example is marked as not versioned.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
@OverwriteAllowed
public interface TypedSourceContainer {

    @Name("counter")
    @Versioned(false)
    int getCounter();

    @Name("name")
    @Versioned
    String getName();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_data_model_for_versioning"><a class="anchor" href="#_data_model_for_versioning"></a><a class="link" href="#_data_model_for_versioning">Data model for versioning</a></h4>
<div class="paragraph">
<p>The actual search table only contains the current status of metadata and system fields.
In the version table, however, all entities and their versions including the metadata are listed. Only versioned
attributes are included in the version table. A current internal version counter (1.,2&#8230;&#8203;n) is maintained in the system
column <em>version_number</em>.</p>
</div>
<div class="paragraph">
<p>During versioning the service counts up the internal version counter by incrementing the value of the system
column version_number by 1. The value is stored in the version table.</p>
</div>
<div class="paragraph">
<p>Changes to non-versioned fields cannot be tracked because they are not written to the version table.
To prevent accidental overwriting of such fields, optimistic locking can be activated.
In this case, a certain property is defined to let the system know, a certain version of an entity is outdated.</p>
</div>
<div class="sect4">
<h5 id="_optimistic_locking"><a class="anchor" href="#_optimistic_locking"></a><a class="link" href="#_optimistic_locking">Optimistic locking</a></h5>
<div class="paragraph">
<p>Activating the optimistic locking prevents overwriting for versioned fields. When simultaneously editing an entity and trying to overwrite saved changes of another user, an error message is thrown. Overwriting is not thus possible. Hence, through activating the optimistic locking on an entity type definition (using the annotation <em>@OptimisticLocking</em>), you prevent data corruption.</p>
</div>
<div class="paragraph">
<p>Optimistic locking is used only for single updates, not for batch updates.</p>
</div>
</div>
<div class="sect4">
<h5 id="_structure_of_the_version_system_table"><a class="anchor" href="#_structure_of_the_version_system_table"></a><a class="link" href="#_structure_of_the_version_system_table">Structure of the version system table</a></h5>
<div class="paragraph">
<p>The version system table consists of the following columns (this is not a complete excerpt):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Structure of the system table</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">column</th>
<th class="tableblock halign-left valign-top">db data type</th>
<th class="tableblock halign-left valign-top">java data type</th>
<th class="tableblock halign-left valign-top">nullable?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigserial</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entity_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version_acl_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modification_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZonedDateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modification_user_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version_comment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version_number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this table, <em>version_id</em> is the primary key. The foreign key <em>entity_id</em> references the corresponding entity table.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_version_id"><a class="anchor" href="#_version_id"></a><a class="link" href="#_version_id">Version ID</a></h4>
<div class="paragraph">
<p>The version ID has the following structure:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[12bit Tenant id][14bit Type Definition id][38bit Version id]</pre>
</div>
</div>
<div class="paragraph">
<p>Here the tenant may be for instance a database scheme or a customer. It is followed by a type definition, for instance
<em>Container</em>. The third part is the version id in the database. The composed version id is unique in <em>arveo</em> system.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_search_language"><a class="anchor" href="#_search_language"></a><a class="link" href="#_search_language">Search language</a></h3>
<div class="sect3">
<h4 id="_search_service"><a class="anchor" href="#_search_service"></a><a class="link" href="#_search_service">Concept</a></h4>
<div class="paragraph">
<p>Any client application, that needs a search function, can implement the Search Service with a suitable parameter. An
example of such an implementation is the class <em>DocumentServiceClient</em> in the Client API. The search queries are
formulated similarly, what is different is the search result, which is always typed. In  <em>arveo</em> the type is
<em>Entity</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_technical_implementation"><a class="anchor" href="#_technical_implementation"></a><a class="link" href="#_technical_implementation">Technical implementation</a></h4>
<div class="paragraph">
<p>Search Service is part of the module 'commons'. It was created to enable more convenient searching. The Search Service
works on the basis of EQL (Eitco Query Language). This query language is also used for some other services, like
Access Control Service.
The main interface is SearchService. It is a functional interface, providing just one method to be implemented: search().
However, this functional interface has a variety of convenience methods, enabling faster and more convenient search, like
<em>firstResult()</em>, <em>uniqueResult()</em>, <em>count()</em>, <em>stream()</em> and others.</p>
</div>
<div class="listingblock">
<div class="title">Listing for the search method definition</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Page&lt;EntityType&gt; search(@NotNull SearchRequest searchRequest);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the only parameter, a search request is accepted, returning a <em>Page</em> of results. A Page has a page definition, a
completeCount and a parameterized list of results. The Search Service also provides a method <em>where()</em> with a condition
builder, filtering results based on a specific condition.</p>
</div>
<div class="paragraph">
<p><em>SearchServiceFactory</em> is a server class, which builds search queries. It has methods for creating an instance of search
service for Documents (<em>searchServiceForDocument()</em>), but also for all the other entities, including Metadata. The result
of the search is transformed into a Document (or respectively another entity) by the <em>DocumentMapper</em>.</p>
</div>
<div class="paragraph">
<p>The class <em>SearchResourceImplementation</em> provides an API for searches that are not bound to one and only one type
definition.</p>
</div>
<div class="paragraph">
<p>The interface SearchService is implemented by the class <em>EcrSearchService</em>.</p>
</div>
<div class="paragraph">
<p>The search client creates different search services, which can be used to search for corresponding entities, for
instance a folder search service, a document search service and so on. And there is also a <em>GenericUnionSearchService</em>,
that can be used to create any joins on search statements.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_2"><a class="anchor" href="#_usage_2"></a><a class="link" href="#_usage_2">Usage</a></h4>
<div class="paragraph">
<p>The following examples demonstrates the usage of the Search Service to retrieve an object page.</p>
</div>
<div class="listingblock">
<div class="title">Example of Search Service usage</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">SearchService&lt;Object&gt; searchService = &lt;a valid instance&gt;;
Page&lt;Object&gt; objectPage = searchService.where()
    .contextReference("field").equalTo().value(7).or()
    .contextReference("other_field").greaterEqual().contextReference("another_field")
    .holds()
    .order().descendingBy("field").from(5).pageSize(7);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to check the type of object searched for:</p>
</div>
<div class="listingblock">
<div class="title">Example for type checking</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">            searchService.where() <i class="conum" data-value="1"></i><b>(1)</b>
                .entity().typeId()   <i class="conum" data-value="2"></i><b>(2)</b>
                .equalTo()
                .typeId(NamedFile.class) <i class="conum" data-value="3"></i><b>(3)</b>
                .or()
                .entity().typeName() <i class="conum" data-value="4"></i><b>(4)</b>
                .in().expressions(x -&gt; x
                    .typeName(NamedTextFile.class) <i class="conum" data-value="5"></i><b>(5)</b>
                    .typeName(NamedFolder.class)
                ).and()
                .entity().typeId().notEqual().typeId("named_relation") <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The variable <code>searchService</code> is an <code>EcrSearchService</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The id of the type of given entity is referenced by the method <code>typeId()</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The type id is checked to be the id of the type defined by the class <code>NamedFile</code> (which is obtained by the method <code>typeId()</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Here the type name is referenced instead of the type id.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>As with the type id, the name of the type defined by the class <code>NamedTextFile</code> is obtained.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The type id can also be obtained if only the type name is given.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_search_endpoints"><a class="anchor" href="#_search_endpoints"></a><a class="link" href="#_search_endpoints">Search endpoints</a></h3>
<div class="paragraph">
<p>Using the ecr sdk you will be able to obtain a <code>SearchClient</code> by spring injection.</p>
</div>
<div class="listingblock">
<div class="title">Injecting a search client</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Autowired
    private SearchClient searchClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A search client has several methods to search in different ways or different contexts.</p>
</div>
<div class="sect3">
<h4 id="_aggregation_searches"><a class="anchor" href="#_aggregation_searches"></a><a class="link" href="#_aggregation_searches">Aggregation searches</a></h4>
<div class="paragraph">
<p>In some situations one needs to accumulate some values that are listed in a database. In SQL this is done using aggregate functions and the <code>group by</code> clause. For example in an invoice archive one might be interested in the number of invoices per customer, or the sum of their totals (per customer).
Queries like this can be executed using the aggregated search. As opposed to the other search methods the result entity type of this search method is <code>Map&lt;String, Object&gt;</code>, since aggregating properties will potentially result in a different type - one that might not be specified. Thus, a more general return type is used.</p>
</div>
<div class="paragraph">
<p>To start an aggregated search query, you will need to build a search service for your aggregated search first. We will build a service for the example above: querying the number and total sum of invoices per user.</p>
</div>
<div class="paragraph">
<p>Assume that we have a type <code>customer</code> defined by the class <code>Customer</code> and a type <code>invoice</code> defined by the class <code>Invoice</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT)
@FilingEnabled
@Acls
public interface Customer {

    @SystemProperty(SystemPropertyName.ID)
    DocumentId id();

    @Unique
    String getName();

    void setName(String name);

}

@Type(ObjectType.DOCUMENT)
@FilingEnabled
@Acls
public interface Invoice {

    @ForeignKey(name = "fk_invoice_customer", target = Customer.class, targetProperty = "id")
    long getCustomerNumber();

    void setCustomerNumber(long number);

    @Optional
    String getCustomerName();
    void setCustomerName(String customerName);

    @Optional
    String getName();

    void setName(String name);

    @Optional
    Integer getTotal();

    void setTotal(Integer total);

    @Optional
    Boolean getOpen();

    void setOpen(Boolean open);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the invoice references the customer with the property <code>customer_number</code> defined by the method <code>getCustomerNumber()</code>. Now we can build a search service as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        final EcrSearchService&lt;Map&lt;String, Object&gt;&gt; aggregationSearchService = searchClient.aggregate() <i class="conum" data-value="1"></i><b>(1)</b>
                .count("i", "id").as("invoice_count") <i class="conum" data-value="2"></i><b>(2)</b>
                .sum("i", "total").as("invoice_total")
                .groupedBy("c", "name").as("customer")
                .from().type(Invoice.class).as("i").join().type(Customer.class).as("c")  <i class="conum" data-value="3"></i><b>(3)</b>
                .on().alias("i").field("customer_number").equalTo().alias("c").id() <i class="conum" data-value="4"></i><b>(4)</b>
                .holds().build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Calling <code>SearchClient.aggregate()</code> is the entry point to the fluent api to build a search service for aggregation search requests.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>At first, we need to specify what to aggregate and what to group by: In our case we want to get the count (of the invoice ids) and the sum of the invoice totals grouped by customer name (which is  unique). Every field that is grouped by will also be part of the result.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Now we need to specify from where the data to aggregate comes from. We join the type <code>Invoice</code> with the type <code>Customer</code>. Note that we specify aliases for the types <code>"i"</code> and <code>"c"</code>, which we used in the step before to reference the types fields.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Now we specify the condition for the join. The condition is that the invoices <code>customer_number</code> must equal the customers' id - as the foreign key <code>fk_invoice_customer</code> above specifies.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we can query for the aggregated data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        final List&lt;Map&lt;String, Object&gt;&gt; all = aggregationSearchService.where().alwaysTrue().holds().unpaged();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will result in a list of maps - one map per customer - where every map contains the keys <code>"customer"</code>, <code>"invoice_count"</code> and <code>"invoice_total"</code>. Holding the customers name, the number of their invoices and their total sum, respectively´.</p>
</div>
<div class="paragraph">
<p>Additionally, we can query specific customers and invoices using the same search service. In this scenario for example we could query every customers <code>"invoice_count"</code> and <code>"invoice_total"</code> of invoices that are open i.e. that they haven&#8217;t paid, yet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        final List&lt;Map&lt;String, Object&gt;&gt; open = aggregationSearchService.where()
                .alias("i").field("open").equalTo().value(true)
                .holds().unpaged();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will also result in a list of maps - one map per customer - where every map contains the keys <code>"customer"</code>, <code>"invoice_count"</code> and <code>"invoice_total"</code>. Holding the customers name, the number of their invoices and their total sum, respectively´ - only counting open invoices.</p>
</div>
<div class="paragraph">
<p>Note that we can reference the invoices field <code>open</code> by using the alias <code>i</code> we provided earlier, even though it is not part of the result.
=== Enterprise Search
==== NoSQL Document Database apache solr 8.6
Apache Solr is a search server and is used as an independent full-text search server for ECR Healthcare. Solr uses the Apache Lucene search library as the core for full-text indexing and search.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_retention_periods_retention"><a class="anchor" href="#_retention_periods_retention"></a><a class="link" href="#_retention_periods_retention">Retention periods</a></h3>
<div class="paragraph">
<p><em>arveo</em> supports a range of retention management features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Full support of document life cycle;</p>
</li>
<li>
<p>Supports prolongation and litigation hold for data retention managers;</p>
</li>
<li>
<p>Privileged delete before retention expires;</p>
</li>
<li>
<p>Privileges for data protection officers (delete) and data protection managers (litigation);</p>
</li>
<li>
<p>Flexible storage container definition (e.g. months, years) for documents with identical retention period
(S3 buckets or file system folders);</p>
</li>
<li>
<p>Fast erasure of storage container by asynchronous delete jobs.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_concept"><a class="anchor" href="#_concept"></a><a class="link" href="#_concept">Concept</a></h4>
<div class="paragraph">
<p><em>arveo</em> is able to store content with a fixed retention date to ensure that the legal or tax relevant
retention period of a document is taken into account and the content is protected from deletion.
You can configure retention rules for <em>arveo</em> document types and automatically apply the appropriate retention
period to uploaded documents.</p>
</div>
<div class="paragraph">
<p>If some of your documents could be required in a legal proceeding but the retention period expires before
the end of dispute you can set a litigation hold or prolong the retention period to protect the data until the
dispute has finished.</p>
</div>
<div class="paragraph">
<p>Let us describe why the storage container concept is used by <em>arveo</em>. Most storage systems can create objects much faster than
they can delete them. Once the retention has expired it is
much faster to remove a bucket (cloud storage) or partition/directory (file system).
You can setup retention rules to define which documents are stored to the containers. All documents within a certain
retention range (e.g. 1 year or 3 months) will be stored to one storage container (S3 bucket or directory).
<em>arveo</em> allows you to delete millions of content objects in a very short time by simply removing the entire storage
container.</p>
</div>
<div class="paragraph">
<p>If a document needs to be deleted e.g. for data privacy reasons, <em>arveo</em> also provides an API call to erase single objects by their ID.
If you want to delete an object before its retention period has expired the user needs along with <em>delete_right</em> also the
<em>dataprivacy_admin</em> privilege.</p>
</div>
<div class="paragraph">
<p>Because the new legal data privacy / protection act makes it necessary to erase data even before the expected retention
period has expired <em>arveo</em> does not use hardware retention features, which protect data from erasure on the hardware level.
<em>arveo</em> protects the content by software design. <em>arveo</em> stores the retention information in the database and only allows access
to the content and metadata by the <em>arveo</em> REST API. The REST API prevents any delete operation before the retention period
has expired.
As only <em>arveo</em> and highly authorized administrators have data writer rights for the database and the storage it is impossible
that content be deleted or manipulated before the retention expires.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The operator must take appropriate technical or organizational measures to ensure that the data is stored in the storage in such a way that it cannot be changed within the legally prescribed retention period.<br>
The provider of the <em>arveo</em> services should ensure that only authorized data protection officers &amp; administrators have data
write (INSERT,UPDTAE; DELETE) permissions for the database and the content repository.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_storage_container_and_document_life_cycle"><a class="anchor" href="#_storage_container_and_document_life_cycle"></a><a class="link" href="#_storage_container_and_document_life_cycle">Storage container and document life cycle</a></h4>
<div class="paragraph">
<p>Since deleting large amounts of documents is a performance critical task, the <em>arveo</em> repository service provides special
support for mass deletion of documents whose retention period has expired.</p>
</div>
<div class="paragraph">
<p>The basic idea is to define separate storage locations, which are exclusively used to store documents with similar
retention requirements. The deletion of documents with specific retention requirements is then a matter of deleting
all contents of a specific storage location in one step. Storage locations containing documents with the same retention
period will be called storage container for the rest of this section.</p>
</div>
<div class="paragraph">
<p><em>arveo</em> allows you to store data with the same retention in one storage container and is able to create storage containers
automatically.</p>
</div>
<div class="paragraph">
<p>The storage containers are either folders (file system storage) or buckets (S3 object storage).
The actual selection of the storage container for a document with specific retention requirements can be configured by
rules, that select the storage container based on the retention period and litigation hold status of the uploaded document.</p>
</div>
<div class="paragraph">
<p>When the litigation hold is set, the object is moved to the litigation hold directory or bucket and will not be deleted
when the initial retention period expires.
When the litigation hold ends, the document is deleted the next time a delete job runs. The number of objects under litigation
hold is typically small and does not affect the overall erasure performance.</p>
</div>
<div class="paragraph">
<p>When a litigation hold is removed, the objects are moved to other storage container which do not have a litigationHold on them.</p>
</div>
<div class="paragraph">
<p>The following diagram shows the life cycle of a document with a fixed retention period set on upload, a legal dispute and automatic erasure at the end of the document&#8217;s life cycle:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/arveo_infografik_dokument-lebenszyklus-gruen.png" alt="*Retention in Buckets*">
</div>
<div class="title">Figure 3. Retention in buckets</div>
</div>
<div class="paragraph">
<p>Each storage container in fact corresponds to a separate storage profile that is used to store the contents of that storage container.
The rules that are used to map the retention requirements of documents to storage container are defined as rules for the
Bucket Organizer Plugin, see <a href="#BucketOrganizer">Bucketorganizer</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_litigation_hold"><a class="anchor" href="#_litigation_hold"></a><a class="link" href="#_litigation_hold">Litigation hold</a></h4>
<div class="paragraph">
<p><em>arveo</em> provides a system property <em>LITIGATION_HOLD</em> that allows you to prolong the retention
until you remove the litigation hold property.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
This function requires the <em>DATAPRIVACY_ADMIN</em> privilege.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_prolongation"><a class="anchor" href="#_prolongation"></a><a class="link" href="#_prolongation">Prolongation</a></h4>
<div class="paragraph">
<p>You can prolong the retention period but not shorten it. You can use the API call to set the initial retention period if
the retention is null.
When the retention is prolonged, <em>arveo</em> moves the object to the appropriate storage container.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
This function requires the <em>DATAPRIVACY_ADMIN</em> privilege.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_erase_a_document"><a class="anchor" href="#_erase_a_document"></a><a class="link" href="#_erase_a_document">Erase a document</a></h4>
<div class="paragraph">
<p>The <em>arveo</em> delete API will as for all other objects without a retention period delete the respective objects. See also
<a href="#_recycle_bin">Deletion of objects</a> and <a href="#_recovery_log">Recovery table</a>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
After the retention period has expired, the function requires the <em>DELETE</em> privilege, but
before the retention period has expired, <em>DATAPRIVACY_PRIVILEGED_DELETE</em> privilege is required.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This API should not be used for operations like deleting the objects of a certain year. This should be done using the erasure
storage container API.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_erase_storage_container"><a class="anchor" href="#_erase_storage_container"></a><a class="link" href="#_erase_storage_container">Erase storage container</a></h4>
<div class="paragraph">
<p>If you have used the storage container feature to speed up the deletion of documents at the end of their life cycle, you
can delete all documents within a retention period range with one API REST call 'EraseStorageContainer'.</p>
</div>
<div class="paragraph">
<p>You can either erase the storage container (buckets, folders) controlled by your operating team or with an automated <em>arveo</em> job.
You can set up a scheduled job in the <em>arveo</em> integration service. Use the erasure storage container template job and adopt it to your needs.
The erasure job will delete all entities of a document type within the given retention period range where litigation hold is <strong>not</strong> set.
The job will write an entry for each erased object in the corresponding audit log table.
For more detailed explanation, see the erasure job template example.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Mass deletion of documents under retention requires the <em>SUPER_USER</em> privilege.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Enable the audit log feature for all document types and dependent document types if you need a report of the erased objects.
<a href="../arveo-administration#_configure_audit">Audit Log</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Grant the deletion right for your storage containers to <em>arveo</em>. If <em>arveo</em> cannot delete the containers, your operating team is
in charge of this task and you must set the option <em>delete rows only</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_privileges_roles"><a class="anchor" href="#_privileges_roles"></a><a class="link" href="#_privileges_roles">Privileges &amp; roles</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Privilege</th>
<th class="tableblock halign-left valign-top"><em>DATAPRIVACY_ADMIN</em> (Data Protection Manager)</th>
<th class="tableblock halign-left valign-top"><em>DATAPRIVACY_PRIVILEGED_DELETE</em> (Data Protection Officer)</th>
<th class="tableblock halign-left valign-top">SUPER_USER (Data Protection Administrator)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prolongation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Litigation Hold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete before retention</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mass Delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_examples_2"><a class="anchor" href="#_examples_2"></a><a class="link" href="#_examples_2">Examples</a></h4>
<div class="sect4">
<h5 id="_create_document_with_retention_and_set_litigation_hold"><a class="anchor" href="#_create_document_with_retention_and_set_litigation_hold"></a><a class="link" href="#_create_document_with_retention_and_set_litigation_hold">Create document with retention and set litigation hold</a></h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public void createDocumentWithRetention() throws IOException {

    final String TEST_IDENTIFIER = "SetLitigationHold test timestamp in ms=";
    final String TEST_DATA = "abcde";
    final String TEST_DATA_MIMETYPE = MediaType.APPLICATION_OCTET_STREAM_VALUE;

    TypedDocumentServiceClient&lt;DocumentWithRetention&gt; serviceClient =
            typeDefinitionServiceClient.getDocumentServiceClient().byClass(DocumentWithRetention.class);
    ZonedDateTime now = ZonedDateTime.now(ZoneOffset.UTC);

    DocumentWithRetention newDocument = serviceClient.createTypeInstance();
    newDocument.setName(TEST_IDENTIFIER + System.currentTimeMillis());
    newDocument.setReceiptDate(now );
    newDocument.setMimeType(TEST_DATA_MIMETYPE);
    newDocument.setRetentionDate(now);

    ByteArrayInputStream data = new ByteArrayInputStream(TEST_DATA.getBytes());

    Map&lt;String, ContentUpload&gt; content = Map.of("content", new ContentUpload(data));

    TypedDocumentClient&lt;DocumentWithRetention&gt; newClient = serviceClient.create(new TypedDocumentInput&lt;&gt;(content, newDocument));

    Assert.assertEquals(IOUtils.toByteArray(newClient.readContent("content")), TEST_DATA.getBytes());
    DocumentWithRetention loadedDocument = newClient.getEntity();

    Assert.assertNotNull(loadedDocument);
    Assert.assertTrue(loadedDocument.getName().startsWith(TEST_IDENTIFIER));
    Assert.assertEquals(loadedDocument.getMimeType(), TEST_DATA_MIMETYPE);

    assertDateEquals( loadedDocument.getReceiptDate(), now);
    assertDateEquals(loadedDocument.getRetentionInformation().getRetentionDate(), now);
    Assert.assertFalse(loadedDocument.getRetentionInformation().isLitigationHold());

    // set LitigationHold = true
    newClient.updateLitigationHold(true);
    newClient = newClient.reload();
    DocumentWithRetention litigationOnDocument = newClient.getEntity();
    Assert.assertTrue(litigationOnDocument.getRetentionInformation().isLitigationHold());

    // set LitigationHold = false)
    newClient.updateLitigationHold(false);
    newClient = newClient.reload();
    DocumentWithRetention litigationOffDocument = newClient.getEntity();
    Assert.assertFalse(litigationOffDocument.getRetentionInformation().isLitigationHold());

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_set_retention_prolong_retention"><a class="anchor" href="#_set_retention_prolong_retention"></a><a class="link" href="#_set_retention_prolong_retention">Set retention / prolong retention</a></h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public void createDocumentWithoutRetention() throws IOException {

    final String TEST_IDENTIFIER = "SetRetention test timestamp in ms=";
    final String TEST_DATA = "abcde";
    final String TEST_DATA_MIMETYPE = MediaType.APPLICATION_OCTET_STREAM_VALUE;

    TypedDocumentServiceClient&lt;DocumentWithRetention&gt; serviceClient =
            typeDefinitionServiceClient.getDocumentServiceClient().byClass(DocumentWithRetention.class);
    // store document without retention
    DocumentWithRetention newDocument = serviceClient.createTypeInstance();
    newDocument.setName(TEST_IDENTIFIER + System.currentTimeMillis());
    newDocument.setReceiptDate(ZonedDateTime.now());
    newDocument.setMimeType(TEST_DATA_MIMETYPE);

    ByteArrayInputStream data = new ByteArrayInputStream(TEST_DATA.getBytes());

    Map&lt;String, ContentUpload&gt; content = Map.of("content", new ContentUpload(data));

    TypedDocumentClient&lt;DocumentWithRetention&gt; newClient = serviceClient.create(new TypedDocumentInput&lt;&gt;(content, newDocument));

    Assert.assertEquals(IOUtils.toByteArray(newClient.readContent("content")), TEST_DATA.getBytes());
    DocumentWithRetention emptyRetentionDocument = newClient.getEntity();

    RetentionInformation retentionInformation = emptyRetentionDocument.getRetentionInformation();
    Assert.assertNotNull(retentionInformation);
    Assert.assertNull(retentionInformation.getRetentionDate());
    Assert.assertFalse(retentionInformation.isLitigationHold());

    // set initial retention
    ZonedDateTime initialRetentionDate = ZonedDateTime.now();
    emptyRetentionDocument.setRetentionDate(initialRetentionDate);
    TypedDocumentClient&lt;DocumentWithRetention&gt; initialRetentionClient = newClient.updateAttributes(emptyRetentionDocument);
    DocumentWithRetention initialRetentionDocument = initialRetentionClient.getEntity();
    assertDateEquals(initialRetentionDocument.getRetentionInformation().getRetentionDate(), initialRetentionDate);

    // prolong retention
    ZonedDateTime prolongedRetentionDate = ZonedDateTime.of(2050, 1, 1, 0, 0, 0, 0, ZoneId.of("Europe/Berlin"));
    initialRetentionDocument.setRetentionDate(prolongedRetentionDate);
    TypedDocumentClient&lt;DocumentWithRetention&gt; prolongedRetentionClient = initialRetentionClient.updateAttributes(initialRetentionDocument);
    DocumentWithRetention prolongedRetentionDocument = prolongedRetentionClient.getEntity();
    assertDateEquals(prolongedRetentionDocument.getRetentionInformation().getRetentionDate(), prolongedRetentionDate);

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_retention_cleanup_job"><a class="anchor" href="#_retention_cleanup_job"></a><a class="link" href="#_retention_cleanup_job">Retention cleanup job</a></h4>
<div class="paragraph">
<p>The retention cleanup job can be used to remove entities with an expired retention period that are not currently in
litigation hold status. The job can be triggered to run in the internal job scheduler of the repository service or in
a separate instance of the job service. It expects two configuration parameters to be present in the job context of the
triggered execution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>type-definition-name</code>: The name of the type definition that contains the entities to remove.</p>
</li>
<li>
<p><code>retention-cleanup-retention-end-time</code>: The time at which the rentention period has expired. All entities with a
retention period that has expired before the specified time will be removed. The specified time must be in the past.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
On systems supporting multiple tenants, the tenant to run the job for must be configured using the property <code>tenant</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following optional properties can be set in the context of the triggered execution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>retention-cleanup-asynchronous</code>: Enables the asynchronous mode of the job. The asynchronous mode is described below.</p>
</li>
<li>
<p><code>retention-cleanup-batch-size</code>: The size of a single batch of entities to process. The default is 1000 and the maximum is 10000.</p>
</li>
<li>
<p><code>retention-cleanup-filter</code>: An optional filter in form of an EQL <code>Expression&lt;Boolean&gt;</code> to apply to the query used to find
entities with expired retention period.</p>
</li>
<li>
<p><code>retention-cleanup-maximum-queue-size</code>: The maximum acceptable size of the message queue used by the job in asynchronous mode. If the queue
size exceeds the configured maximum, the job will stop. The job will check the queue size once a minute.</p>
</li>
<li>
<p><code>retention-cleanup-duration</code>: An optional maximum duration of the job&#8217;s runtime. If the duration is exceeded, the job
will stop. The default is null (no limit). The value must be a <code>java.time.Duration</code>.</p>
</li>
<li>
<p><code>retention-cleanup-max-entity-count</code>: The maximum number of entities to process. If this number is reached, the job
will stop. The default is -1 (no limit).</p>
</li>
<li>
<p><code>retention-cleanup-protocol-file</code>: Optional property that can contain a fully qualified path to a file that will
contain a list of all deleted entity IDs.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>retention-cleanup-maximum-queue-size</code> limitation mechanism relies on statistics data for the JMS queues that is
collected by a separate system job. This job is not enabled by default and must be enabled using the property
<code>ecr.server.jobs.jms-statistics.enabled=true</code> to use this feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All properties except the type definition name, the retention end time and the protocol file can be configured in the
configuration file of the service either globally or for each type definition.
See <a href="include::../../../../docs-commons/src/main/asciidoc/configuration-properties.html#_ecr_server_jobs_retention-cleanup">configuration reference</a> for details.</p>
</div>
<div class="sect4">
<h5 id="_asynchronous_mode"><a class="anchor" href="#_asynchronous_mode"></a><a class="link" href="#_asynchronous_mode">Asynchronous mode</a></h5>
<div class="paragraph">
<p>In the asynchronous mode, content is not deleted from the storage immediately. Instead, a message queue is used to delete
the content asynchronously. The database entries for the documents are not removed but marked as deleted using the
<code>COMPLIANCE_DELETED</code> field.</p>
</div>
<div class="paragraph">
<p>The entries that were marked as deleted are automatically excluded from query results. It is not possible to read those
entries using the <em>arveo</em> client API.</p>
</div>
<div class="paragraph">
<p>The <em>arveo</em> client API can be used to delete all entities that were marked as deleted as shown in the
following example:</p>
</div>
<div class="listingblock">
<div class="title">Deleting marked entities</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Expression&lt;Boolean&gt; expression = EcrQueryLanguage.condition()
    .entity().systemField(SystemFieldList.GeneralSystemField.ComplianceDeleted.INSTANCE)
    .equalTo().value(true).holds();
serviceClient.delete(expression, 1000); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set a limit to reduce database load</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_triggering_the_job"><a class="anchor" href="#_triggering_the_job"></a><a class="link" href="#_triggering_the_job">Triggering the job</a></h5>
<div class="paragraph">
<p>Both the repository service and the job service offer an API that provides methods to create triggers for the job. The
following example shows how to use this API to create a simple trigger that will fire once at a specified time. The API
requires administrator privileges.</p>
</div>
<div class="listingblock">
<div class="title">Triggering the retention cleanup job</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">EcrSchedulerResourceClient schedulerClient = systemManagementClient.getSchedulerClient();

JobKeyModel jobKey = new JobKeyModel(SystemJobIdentities.ECR_JOBS_GROUP, SystemJobIdentities.RETENTION_CLEANUP);
TriggerKeyModel triggerKey = new TriggerKeyModel(SystemJobIdentities.ECR_JOBS_GROUP, "test-trigger-retention-cleanup");

SimpleTriggerModel trigger = new SimpleTriggerModel(triggerKey, jobKey);
trigger.setNextFireTime(ZonedDateTime.now());
trigger.setJobDataMap(Map.of(
    SystemJobDataKeys.TYPE_DEFINITION_NAME, SimpleInvoiceNames.getTypeDefinitionName(),
    SystemJobDataKeys.RETENTION_CLEANUP_RETENTION_END_TIME, ZonedDateTime.now(),
    SystemJobDataKeys.TENANT, "master",
    SystemJobDataKeys.RETENTION_CLEANUP_PROTOCOL_FILE, getTargetDir() + File.separator + "retention-cleanup-job.log"
));

schedulerClient.scheduleSimpleTrigger(trigger);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API provides additional methods to create cron expression based triggers and to unschedule a job.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rest_api"><a class="anchor" href="#_rest_api"></a><a class="link" href="#_rest_api"><strong>REST API</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_client_sdks"><a class="anchor" href="#_client_sdks"></a><a class="link" href="#_client_sdks">Client SDKs</a></h3>
<div class="paragraph">
<p>The client SDKs provide APIs for applications using <em>arveo</em>. SDKs exist for both Java and TypeScript. Client applications
should not use the REST API of <em>arveo</em> directly but instead use one of the provided SDKs.</p>
</div>
<div class="sect3">
<h4 id="_json_serialization"><a class="anchor" href="#_json_serialization"></a><a class="link" href="#_json_serialization">JSON serialization</a></h4>
<div class="paragraph">
<p><em>arveo</em> uses a custom serialization for the JSON data in the REST API to support advanced features like polymorphism.
Additionally, the custom serialization allows the <em>arveo</em> server and the client SDKs to pass type information. This way
it is for example possible to differ between number types like short, int and long. The client SDKs take care of the
serialization and the direct usage of the REST API is discouraged.</p>
</div>
<div class="paragraph">
<p>If it is necessary to (de-) serialize the custom JSON data, use the already configured Jackson <em>ObjectMapper</em> that is
used by the server and the SDKs. This <em>ObjectMapper</em> is equipped with mixin types that contain information about how
to (de-) serialize the custom JSON content. The internal <em>ObjectMapper</em> can be obtained by injecting an instance of
<code>de.eitco.commons.spring.web.json.AsdlObjectMapperHolder</code>.</p>
</div>
<div class="paragraph">
<p>The service offers an overview page containing the REST resources and details about the models. It can generate examples
for the models, too. The overview page is located at the root URL of the service.</p>
</div>
</div>
<div class="sect3">
<h4 id="_type_information"><a class="anchor" href="#_type_information"></a><a class="link" href="#_type_information">Type information</a></h4>
<div class="paragraph">
<p>Each object contains a type identifier in a json property called <code>@type</code>. The required value is listed in the API
overview page for each model class. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"identifier": {
  "@type": "container-id",
  "identifier": {
    "@long": "1"
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_type_information_for_data_types"><a class="anchor" href="#_type_information_for_data_types"></a><a class="link" href="#_type_information_for_data_types">Type information for data types</a></h4>
<div class="paragraph">
<p>There are some special type identifiers used to identify the type of JSON fields.</p>
</div>
<div class="paragraph">
<p>The following table lists types and their corresponding identifiers.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 55%;">
<caption class="title">Table 19. Types in Java and their Identifiers in <em>arveo</em></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type (Java)</th>
<th class="tableblock halign-left valign-top">Identifier</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@byte</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@short</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@long</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@big-int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@utc-date-time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZonedDateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@zoned-date-time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class&lt;?&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@type-reference</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UUID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@uuid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@binary</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocalDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocalTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@time</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Other data types do not require specific type identifiers.</p>
</div>
<div class="paragraph">
<p>The following example shows a special type identifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"retentionDate": {
  "@zoned-date-time": "2020-12-15T15:52:21.5193002+01:00[Europe/Berlin]"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_collections"><a class="anchor" href="#_collections"></a><a class="link" href="#_collections">Collections</a></h4>
<div class="paragraph">
<p>To distinguish between different types of collections (lists and sets) there are type identifiers for collection
types.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 55%;">
<caption class="title">Table 20. Identifiers for the Types List and Set</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type (Java)</th>
<th class="tableblock halign-left valign-top">Identifier</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@set</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following is an example of the Type <em>List</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"list": {
  "@list": []
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_java_sdk"><a class="anchor" href="#_java_sdk"></a><a class="link" href="#_java_sdk">Java SDK</a></h3>
<div class="paragraph">
<p>The SDK contains the general API for accessing the <em>arveo</em>. The SDK can be used both
to access the <em>arveo</em> via HTTP and to use the <em>arveo</em> as an embedded library.</p>
</div>
<div class="listingblock">
<div class="title">Maven dependency of the Client SDK for usage via HTTP</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
   &lt;groupId&gt;de.eitco.ecr&lt;/groupId&gt;
   &lt;artifactId&gt;ecr-sdk-http&lt;/artifactId&gt;
   &lt;version&gt;${ecr.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Maven dependency of the Client SDK for embedded usage</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
   &lt;groupId&gt;de.eitco.ecr&lt;/groupId&gt;
   &lt;artifactId&gt;ecr-embedded-all&lt;/artifactId&gt;
   &lt;version&gt;${ecr.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The SDK offers both a generic API, where attributes of objects are mapped as a generic map, and a typed API. The typed
API uses classes to be created by the project that represent the objects with the attributes.
The main entry point for the API is the class <em>de.eitco.ecr.sdk.TypeDefinitionServiceClient</em>. An instance of this class
can be obtained using Spring Dependency Injection. With the methods</p>
</div>
<div class="ulist">
<ul>
<li>
<p>getDocumentServiceClient()</p>
</li>
<li>
<p>getContainerServiceClient()</p>
</li>
<li>
<p>getFolderServiceClient()</p>
</li>
<li>
<p>getRelationServiceClient()</p>
</li>
<li>
<p>getMetaDataServiceClient()</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>you obtain a client factory that can be used to create a service client for a specific type definition. This service client
can then be used to create new objects or load existing objects. For created or loaded objects, one in turn receives an
entity client that offers methods for accessing the object. Special version clients are also available for concrete
versions of entities.</p>
</div>
<div class="sect3">
<h4 id="_using_the_sdk_in_a_non_web_application"><a class="anchor" href="#_using_the_sdk_in_a_non_web_application"></a><a class="link" href="#_using_the_sdk_in_a_non_web_application">Using the SDK in a non-web application</a></h4>
<div class="paragraph">
<p>The SDK can be used both in applications that provide web functionality like REST endpoints and in applications that
do not contain any web functionality. For non-web applications, some differences need to be considered.</p>
</div>
<div class="sect4">
<h5 id="_dependencies"><a class="anchor" href="#_dependencies"></a><a class="link" href="#_dependencies">Dependencies</a></h5>
<div class="paragraph">
<p>By default, the SDK contains an OAuth2 client implementation that relies on some web-related spring beans. For non-web
applications, a different OAuth2 client implementation is available. The default implementation needs to be excluded
from the SDK dependency and replaced by the non-web implementation as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;de.eitco.ecr&lt;/groupId&gt;
    &lt;artifactId&gt;ecr-sdk-http&lt;/artifactId&gt;
    &lt;version&gt;${ecr.version}&lt;/version&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;de.eitco.commons&lt;/groupId&gt;
            &lt;artifactId&gt;cmn-spring-security5-oauth2-client&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;de.eitco.commons&lt;/groupId&gt;
    &lt;artifactId&gt;cmn-spring-security5-oauth2-client-non-web&lt;/artifactId&gt;
    &lt;version&gt;${commons-oauth2-version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The current version of the OAuth2 client can be found in the Nexus.</p>
</div>
</div>
<div class="sect4">
<h5 id="_application_initialization"><a class="anchor" href="#_application_initialization"></a><a class="link" href="#_application_initialization">Application initialization</a></h5>
<div class="paragraph">
<p>The SDK contains some dependencies that cause Spring to initialize some web functionality automatically. This can cause
problems like missing spring security configuration errors. Non-web applications can simply turn off all of Springs
web functionality by using the <code>SpringApplicationBuilder</code> class as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@SpringBootApplication
public class MyApplication {

	public static void main(String[] args) {
		new SpringApplicationBuilder(MyApplication.class)
			.web(WebApplicationType.NONE)
			.run(args);
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_batch_operations"><a class="anchor" href="#_batch_operations"></a><a class="link" href="#_batch_operations">Batch Operations</a></h4>
<div class="paragraph">
<p>The SDK provides various methods for batch operations. For example, several objects can be created or updated at once.</p>
</div>
<div class="sect4">
<h5 id="_create_update_or_delete_multiple_objects_of_the_same_type"><a class="anchor" href="#_create_update_or_delete_multiple_objects_of_the_same_type"></a><a class="link" href="#_create_update_or_delete_multiple_objects_of_the_same_type">Create, update or delete multiple objects of the same type</a></h5>
<div class="paragraph">
<p>All service clients provide methods for creating, updating and deleting multiple objects. Since a service client is bound to a specific type definition, only objects of the same type can be created, updated or deleted in this way.
The objects to be updated or deleted are identified by any selector. When updating, methods are available that return
the updated objects and methods that return only the number of updated objects. Especially if a large number of objects
are updated at once, only the latter methods should be used. With these methods, the objects can only be updated in the
same way. If the objects are to be customised, the methods from the BatchOperationServiceClient (see below) must be used.</p>
</div>
</div>
<div class="sect4">
<h5 id="_create_or_update_several_objects_of_different_types"><a class="anchor" href="#_create_or_update_several_objects_of_different_types"></a><a class="link" href="#_create_or_update_several_objects_of_different_types">Create or update several objects of different types</a></h5>
<div class="paragraph">
<p>The <em>BatchOperationServiceClient</em> class provides methods to create or update multiple objects of different types.</p>
</div>
</div>
<div class="sect4">
<h5 id="_create_several_interdependent_objects"><a class="anchor" href="#_create_several_interdependent_objects"></a><a class="link" href="#_create_several_interdependent_objects">Create several interdependent objects</a></h5>
<div class="paragraph">
<p>To create multiple objects of different types, special <em>BatchCreateInput</em> input objects are used that bundle the type of
the object and its properties. The order in which the objects are created corresponds to the order in which the input
objects are passed. Each of these input objects contains a virtual ID that identifies it within the batch operation. In
this way, for example, a relation as well as its source and target can be created in a batch operation. The relation only
has to be created with the virtual IDs of source and target.</p>
</div>
<div class="paragraph">
<p>If the relation between the objects consists not only of the ID, but also of a foreign key to any attribute, a reference
to the corresponding attribute of the referenced object must be given to the dependent object. For this purpose, the
class <em>BatchAttributeReference</em> is available, which bundles the name of the foreign key attribute, the referenced attribute and the virtual ID of the other object in the batch operation. Code examples can be found in the class <em>de.eitco.ecr.system.test.BatchCreationIT</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_update_multiple_objects_of_different_types"><a class="anchor" href="#_update_multiple_objects_of_different_types"></a><a class="link" href="#_update_multiple_objects_of_different_types">Update multiple objects of different types</a></h5>
<div class="paragraph">
<p>The <em>BatchOperationServiceClient</em> also provides methods to update several different objects of different types in a batch operation. A separate input object is passed for each object to be updated, which contains the ID of the object and the properties to be updated. This means that individual changes can also be made to each object with these methods. The BatchUpdateUtility class provides auxiliary methods with which the respective input objects can be created.
Code examples can be found in the class <em>de.eitco.ecr.system.test.BatchUpdateIT</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_automatic_update_in_case_of_collision"><a class="anchor" href="#_automatic_update_in_case_of_collision"></a><a class="link" href="#_automatic_update_in_case_of_collision">Automatic update in case of collision</a></h5>
<div class="paragraph">
<p>The <em>BatchCreateInput</em> objects used to create various types make it possible to automatically update the existing object
in the event of a collision. To do this, the <em>BatchCreateInput</em> only has to be made aware of the field on which the
collision could occur:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">TypedContainerBatchCreateInput&lt;Person&gt; containerBatchCreateInput =
    new TypedContainerBatchCreateInput&lt;&gt;(new TypedContainerInput&lt;&gt;(person), List.of());
containerBatchCreateInput.setCollisionCheckAttribute("first_name");</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, a container is to be created in a batch where a collision could possibly occur on the attribute
<code>first_name</code>.</p>
</div>
<div class="paragraph">
<p>The attribute that is to be used to detect the collisions must be provided with a unique constraint.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_or_update_upsert_operations"><a class="anchor" href="#_create_or_update_upsert_operations"></a><a class="link" href="#_create_or_update_upsert_operations">Create or update (upsert) operations</a></h4>
<div class="paragraph">
<p>The SDK provides methods to perform create or update (upsert) operations on entities.The entity to update, if it
should exist, is identified by an EQL selector. If a matching entity is found, it is updated using the provided data.
If no matching entity is found, the provided data is used to create a new entity. The selector must match exactly one or
zero existing entities. If it matches more than one entity, an exception is thrown. The following example shows how
to perform an upsert operation.</p>
</div>
<div class="listingblock">
<div class="title">Performing an upsert operation</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">TypedContainerServiceClient&lt;Person&gt; serviceClient =
    typeDefinitionServiceClient.getContainerServiceClient().byClass(Person.class);

LocalDate birthday = LocalDate.of(1995, Month.SEPTEMBER, 16);

Person person = serviceClient.createTypeInstance();
person.setBirthday(birthday);
person.setSurname("Smith");
person.setFirstName("John");
person.setBreakTime(LocalTime.NOON);
person.setProcedureDate(ZonedDateTime.now());

TypedContainerClient&lt;Person&gt; client = serviceClient.createOrUpdate(
    EcrQueryLanguage.condition().entity().field(PersonNames.FIRST_NAME).equalTo().value("John").holds(), <i class="conum" data-value="1"></i><b>(1)</b>
    person
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The selector that uniquely identifies the entity to update</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_generic_batch_operations"><a class="anchor" href="#_generic_batch_operations"></a><a class="link" href="#_generic_batch_operations">Generic batch operations</a></h4>
<div class="paragraph">
<p>The generic batch operation API can be used to perform different operations like create, update or delete in one
transaction. The batch operations use the same input types as the other batch functions described above, which makes
it possible to use the result of one operation in another following operation. The following operation types are available:</p>
</div>
<div class="sect4">
<h5 id="_read_operations"><a class="anchor" href="#_read_operations"></a><a class="link" href="#_read_operations">Read operations</a></h5>
<div class="ulist">
<ul>
<li>
<p><code>TypedContainerBatchReadOperation</code></p>
</li>
<li>
<p><code>TypedDocumentBatchReadOperation</code></p>
</li>
<li>
<p><code>TypedFolderBatchReadOperation</code></p>
</li>
<li>
<p><code>TypedMetaDataBatchReadOperation</code></p>
</li>
<li>
<p><code>TypedRelationDataBatchReadOperation</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The purpose of read operations is to provide input data for other operations. For example, a read operation could be used
to read an entity of which only the ID is known, and then use the entity&#8217;s attribute values as input for a create operation.
When the entity cannot be read, the entire batch of operations fails and the transaction is rolled back.</p>
</div>
</div>
<div class="sect4">
<h5 id="_delete_operations"><a class="anchor" href="#_delete_operations"></a><a class="link" href="#_delete_operations">Delete operations</a></h5>
<div class="ulist">
<ul>
<li>
<p><code>TypedContainerBatchDeleteOperation</code></p>
</li>
<li>
<p><code>TypedDocumentBatchDeleteOperation</code></p>
</li>
<li>
<p><code>TypedFolderBatchDeleteOperation</code></p>
</li>
<li>
<p><code>TypedMetaDataBatchDeleteOperation</code></p>
</li>
<li>
<p><code>TypedRelationBatchDeleteOperation</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Delete operations are used to delete a single entity. Unlike the other operations, it is not possible to reference
a delete operation. When the entity cannot be deleted, the entire batch of operations fails and the transaction is rolled back.</p>
</div>
</div>
<div class="sect4">
<h5 id="_update_operations"><a class="anchor" href="#_update_operations"></a><a class="link" href="#_update_operations">Update operations</a></h5>
<div class="ulist">
<ul>
<li>
<p><code>TypedContainerBatchUpdateOperation</code></p>
</li>
<li>
<p><code>TypedDocumentBatchUpdateOperation</code></p>
</li>
<li>
<p><code>TypedFolderBatchUpdateOperation</code></p>
</li>
<li>
<p><code>TypedMetaDataBatchUpdateOperation</code></p>
</li>
<li>
<p><code>TypedRelationBatchUpdateOperation</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Update operations are used to update a single entity. When the entity cannot be updated, the entire batch of operations
fails and the transaction is rolled back.</p>
</div>
</div>
<div class="sect4">
<h5 id="_create_or_update_operations"><a class="anchor" href="#_create_or_update_operations"></a><a class="link" href="#_create_or_update_operations">Create or update operations</a></h5>
<div class="ulist">
<ul>
<li>
<p><code>TypedContainerBatchCreateOrUpdateOperation</code></p>
</li>
<li>
<p><code>TypedDocumentBatchCreateOrUpdateOperation</code></p>
</li>
<li>
<p><code>TypedFolderBatchCreateOrUpdateOperation</code></p>
</li>
<li>
<p><code>TypedMetaDataBatchCreateOrUpdateOperation</code></p>
</li>
<li>
<p><code>TypedRelationBatchCreateOrUpdateOperation</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Create or update operations perform an upsert as described in <a href="#_create_or_update_upsert_operations">Create or update (upsert) operations</a>. When the
operation cannot update or create the entity, the entire batch of operations fails and the transaction is rolled back.</p>
</div>
</div>
<div class="sect4">
<h5 id="_create_operations"><a class="anchor" href="#_create_operations"></a><a class="link" href="#_create_operations">Create operations</a></h5>
<div class="ulist">
<ul>
<li>
<p><code>TypedContainerBatchCreateOperation</code></p>
</li>
<li>
<p><code>TypedDocumentBatchCreateOperation</code></p>
</li>
<li>
<p><code>TypedFolderBatchCreateOperation</code></p>
</li>
<li>
<p><code>TypedMetaDataBatchCreateOperation</code></p>
</li>
<li>
<p><code>TypedRelationBatchCreateOperation</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Create operations are used to create a new entity. When the entity cannot be created, the entire batch of operations
fails and the transaction is rolled back.</p>
</div>
</div>
<div class="sect4">
<h5 id="_examples_3"><a class="anchor" href="#_examples_3"></a><a class="link" href="#_examples_3">Examples</a></h5>
<div class="paragraph">
<p>The first example implements a solution for the following problem: An invoice was archived with a relation to an
invalid customer. The customer must be replaced with a new customer and the reference in the invoice must be updated.</p>
</div>
<div class="listingblock">
<div class="title">Using the generic batch api for crud operations</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Customer customer = customerServiceClient.createTypeInstance();
customer.setName(UUID.randomUUID().toString());

TypedDocumentBatchCreateOperation&lt;Customer&gt; createCustomerOperation = <i class="conum" data-value="1"></i><b>(1)</b>
    new TypedDocumentBatchCreateOperation&lt;&gt;(customer);

Invoice invoice = invoiceServiceClient.createTypeInstance();

BatchAttributeReference reference = new BatchAttributeReference( <i class="conum" data-value="2"></i><b>(2)</b>
    InvoiceNames.CUSTOMER_NUMBER,
    SystemFieldList.GeneralSystemField.Id.INSTANCE.getName(),
    createCustomerOperation.getVirtualId().getUuid()
);

TypedDocumentBatchUpdateInput&lt;Invoice&gt; invoiceInput =
    new TypedDocumentBatchUpdateInput&lt;&gt;(invoiceId, new TypedDocumentInput&lt;&gt;(invoice), List.of(reference));

TypedDocumentBatchUpdateOperation&lt;Invoice&gt; updateInvoiceOperation = <i class="conum" data-value="3"></i><b>(3)</b>
    new TypedDocumentBatchUpdateOperation&lt;&gt;(invoiceInput);

TypedDocumentBatchDeleteOperation deleteCustomerOperation = new TypedDocumentBatchDeleteOperation(customerId); <i class="conum" data-value="4"></i><b>(4)</b>

List&lt;EcrId&gt; ids = batchOperationServiceClient.performTypedBatchOperations( <i class="conum" data-value="5"></i><b>(5)</b>
    createCustomerOperation, updateInvoiceOperation, deleteCustomerOperation);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The operation to create the new customer</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A reference to the ID of the new customer to be used for the customer_number field of the updated invoice</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The operation to update the existing invoice</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The operation to delete the invalid customer</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>An injected instance of <code>de.eitco.ecr.sdk.BatchOperationServiceClient</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The second example shows how to use a read operation.</p>
</div>
<div class="listingblock">
<div class="title">Using a read operation</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">TypedDocumentBatchReadOperation readCustomerOperation = new TypedDocumentBatchReadOperation(customerId);

Invoice invoice = invoiceServiceClient.createTypeInstance();
invoice.setCustomerNumber(customerId.getIdentifier());

BatchAttributeReference attributeReference = new BatchAttributeReference( <i class="conum" data-value="1"></i><b>(1)</b>
    InvoiceNames.CUSTOMER_NAME,
    CustomerNames.NAME,
    readCustomerOperation.getVirtualId().getUuid()
);

TypedDocumentBatchCreateInput&lt;Invoice&gt; invoiceInput =
    new TypedDocumentBatchCreateInput&lt;&gt;(new TypedDocumentInput&lt;&gt;(invoice), List.of(attributeReference));
TypedDocumentBatchCreateOperation&lt;Invoice&gt; createInvoiceOperation =
    new TypedDocumentBatchCreateOperation&lt;&gt;(invoiceInput);

List&lt;EcrId&gt; ids = batchOperationServiceClient.performTypedBatchOperations(readCustomerOperation, createInvoiceOperation); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A reference to the name attribute of the customer read by the read operation used for the customer_name attribute of the invoice</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An injected instance of <code>de.eitco.ecr.sdk.BatchOperationServiceClient</code></td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_system_tables"><a class="anchor" href="#_system_tables"></a><a class="link" href="#_system_tables"><strong>System tables</strong></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section contains information about the system tables used by <em>arveo</em>.</p>
</div>
<div class="sect2">
<h3 id="_tables_for_type_definitions"><a class="anchor" href="#_tables_for_type_definitions"></a><a class="link" href="#_tables_for_type_definitions">Tables for type definitions</a></h3>
<div class="paragraph">
<p>The system stores some information like the ID of type definitions in the database. For this, the following tables are
used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ecr-types</code>: Contains en entry for each type definition</p>
</li>
<li>
<p><code>ecr-types-content-elements</code>: Contains 1:n mappings of content elements to type definitions.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="type-system-tables.png" alt="type system tables" width="810" height="196">
</div>
<div class="title">Figure 4. ERD of type system tables</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Columns of ecr_types</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 15%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the type definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">creation_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creation date and time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">object_type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the objects in the type definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the type definition</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. Columns of ecr_types_content_elements</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 15%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ce_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the content element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ce_type_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the type definition containing the content element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ce_content_type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The allowed content type of the content element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ce_profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the storage profile used by the content element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ce_store_json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the content element uses the JSON field or not</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_folder_structure_tables"><a class="anchor" href="#_folder_structure_tables"></a><a class="link" href="#_folder_structure_tables">Folder structure tables</a></h3>
<div class="paragraph">
<p>The object type FOLDER is used to create tree-like structures with parent- and child-relationships. The structure is
stored in the <em>ecr_folder_structure</em> table. The table <em>ecr_folder_structure_closure</em> contains a transitive hull of the
parent- and child-relationships to allow fast database queries in the tree.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="folder-structure-tables.png" alt="folder structure tables" width="780" height="210">
</div>
<div class="title">Figure 5. ERD of folder structure tables</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. Columns of ecr_folder_structure</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 15%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">child_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the child-folder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">child_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">varchar(128)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the child-folder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the parent-folder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent_type_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the parent type definition</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. Columns of ecr_folder_structure_closure</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 15%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the entry in the closure table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">child_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the child-folder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">child_type_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the child type definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">depth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The distance between the child and the parent on the direct path in the tree</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the parent folder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent_type_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the parent type definition</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_recovery_table"><a class="anchor" href="#_recovery_table"></a><a class="link" href="#_recovery_table">Recovery table</a></h3>
<div class="paragraph">
<p>The recovery table <em>ecr_recovery</em> is used for the <a href=".#_recovery_log">recovery</a> feature.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="ecr-recovery-table.png" alt="ecr recovery table" width="310" height="196">
</div>
<div class="title">Figure 6. ERD of ecr_recovery</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. Columns of <em>ecr_recovery</em></caption>
<colgroup>
<col style="width: 20%;">
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleted_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date and time at which the entity was deleted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jsonb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A JSON representation of the deleted entity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entity_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the entity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keep_until</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date and time until which to keep the entity in the recovery table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the type definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version ID of the deleted entity</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_keystore_tables"><a class="anchor" href="#_keystore_tables"></a><a class="link" href="#_keystore_tables">Keystore tables</a></h3>
<div class="paragraph">
<p>When the <a href="../arveo-administration#<em>encryption">encryption</a> feature is enabled for a storage profile, the generated keys are stored in
profile-specific database tables. For each encrypted profile, a table called <code>ecr_keys-&lt;profile&gt;</code> and a table called
<code>ecr_keys_assoc</em>&lt;profile&gt;</code> is created. The ecr_keys_&lt;profile&gt; table contains the generated keys, and the
ecr_keys_assoc_&lt;profile&gt; table contains the associations between content elements and keys.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="ecr-keystore-tables.png" alt="ecr keystore tables" width="720" height="154">
</div>
<div class="title">Figure 7. ERD of keystore tables</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. Columns of ecr_keys_&lt;profile&gt;</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The encryption key</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. Columns of ecr_keys_assoc_&lt;profile&gt;</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">content_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the content element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the key</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_important_terminology"><a class="anchor" href="#_important_terminology"></a><a class="link" href="#_important_terminology"><strong>Important Terminology</strong></a></h2>
<div class="sectionbody">
<div class="dlist glossary">
<dl>
<dt>ECR</dt>
<dd>
<p>Short for Enterprise Content Services; this is the collection of the <em>arveo</em> content services providing
all document and record features.</p>
</dd>
<dt>EQL</dt>
<dd>
<p>Eitco Query Language.</p>
<div class="paragraph">
<p>Used for search operations.</p>
</div>
</dd>
<dt>Entity</dt>
<dd>
<p>Object that represents a type of data structure used in <em>arveo</em>.</p>
</dd>
<dt>Document</dt>
<dd>
<p>An entity that can contain metadata and content.</p>
</dd>
<dt>Folder</dt>
<dd>
<p>An entity that contains metadata and is organized in a tree structure like in a file system.</p>
</dd>
<dt>Relation</dt>
<dd>
<p>An entity that represents a relation between two other entities.</p>
</dd>
<dt>Container</dt>
<dd>
<p>Simple folder-like object not organized in a tree structure but with relations to other objects.</p>
</dd>
<dt>Meta</dt>
<dd>
<p>An entity that contains only metadata.</p>
</dd>
<dt>Content type</dt>
<dd>
<p>A meta specification, that classifies the data.</p>
<div class="paragraph">
<p>Examples of content types are: original object, rendition, full text, text notes, XML properties, etc.</p>
</div>
</dd>
<dt>Retention</dt>
<dd>
<p>Continuous audit-proof storage of all company data for compliance or own business purposes.</p>
</dd>
<dt>Litigation hold</dt>
<dd>
<p>A flag that indicates whether a document is related to a litigation.</p>
<div class="paragraph">
<p>If the flag is set the document must never be deleted - even if the retention date has passed by.</p>
</div>
</dd>
<dt>Bucket</dt>
<dd>
<p>Object storage.</p>
</dd>
<dt>Encryption</dt>
<dd>
<p>Translating data into unreadable forms by means of electronic or digital codes
or keys.</p>
<div class="paragraph">
<p>A specific key in the form of a procedure or an algorithm is required for the reverse transformation.
Then the legitimate user can access the original data.</p>
</div>
</dd>
<dt>Annotation</dt>
<dd>
<p>A construct used on interfaces or getter-methods to specify their properties.</p>
</dd>
<dt>Storage profile</dt>
<dd>
<p>Are used to define on which storage the content elements are saved.</p>
</dd>
<dt>Storage Container</dt>
<dd>
<p>Are folders or buckets on the content storage containing documents with the same retention period (e.g. Jan-Dez 2031).</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-02-08 02:27:48 UTC
</div>
</div>
</body>
</html>