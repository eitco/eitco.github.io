<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Installation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">arveo 16.1.1</div>
<ul class="sectlevel1">
<li><a href="#_installation"><strong>Installation</strong></a>
<ul class="sectlevel2">
<li><a href="#_deployment_options">Deployment options</a></li>
<li><a href="#_system_requirements">System requirements</a></li>
<li><a href="#_installation_2">Installation</a></li>
</ul>
</li>
<li><a href="#_administration"><strong>Administration</strong></a>
<ul class="sectlevel2">
<li><a href="#_configure_database_access">Configure Database access</a></li>
<li><a href="#_configure_storage_locations">Configure Storage Locations</a></li>
<li><a href="#_renditions">Renditions</a></li>
<li><a href="#_configure_retention_container">Configure retention container</a></li>
<li><a href="#_encryption">Configure Encryption</a></li>
<li><a href="#_configure_active_mq">Configure Active MQ</a></li>
<li><a href="#_configure_arveo_user_management_as_authentication_service">Configure <em>arveo</em> user management as Authentication Service</a></li>
<li><a href="#_configure_authentication_between_content_services">Configure authentication between Content Services</a></li>
<li><a href="#_authentication-oauth2">OAuth2.0 Authentication</a></li>
<li><a href="#_configure_audit">Configure audit</a></li>
<li><a href="#_solr">Solr</a></li>
<li><a href="#_system_jobs">System jobs</a></li>
<li><a href="#_hashicorp_vault">Using Hashicorp Vault</a></li>
<li><a href="#_configuration_properties">Configuration Properties</a></li>
</ul>
</li>
<li><a href="#_monitoring"><strong>Monitoring</strong></a>
<ul class="sectlevel2">
<li><a href="#_custom_health_indicators">Custom health indicators</a></li>
<li><a href="#_custom_endpoints">Custom endpoints</a></li>
<li><a href="#_custom_metrics">Custom metrics</a></li>
<li><a href="#_prometheus">Prometheus</a></li>
<li><a href="#_other_monitoring_systems">Other monitoring systems</a></li>
<li><a href="#_attributes_in_mdc">Attributes in MDC</a></li>
<li><a href="#_open_telemetry">Open Telemetry</a></li>
</ul>
</li>
<li><a href="#_system_tables"><strong>System tables</strong></a>
<ul class="sectlevel2">
<li><a href="#_tables_for_type_definitions">Tables for type definitions</a></li>
<li><a href="#_folder_structure_tables">Folder structure tables</a></li>
<li><a href="#_recovery_table">Recovery table</a></li>
<li><a href="#_keystore_tables">Keystore tables</a></li>
</ul>
</li>
<li><a href="#_compatibility_list"><strong>Compatibility list</strong></a></li>
<li><a href="#_important_terminology"><strong>Important Terminology</strong></a></li>
</ul>
</div>
</div>
<div id="content">
<div style="page-break-after: always;"></div>
<div class="sect1">
<h2 id="_installation"><a class="anchor" href="#_installation"></a><a class="link" href="#_installation"><strong>Installation</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_deployment_options"><a class="anchor" href="#_deployment_options"></a><a class="link" href="#_deployment_options">Deployment options</a></h3>
<div class="paragraph">
<p>The lightweight and stateless services are delivered as
containers for all platforms and allow the <em>arveo</em> to automatically scale horizontally. Customers have the choice between an on-premise, cloud or hybrid installation.</p>
</div>
<div class="paragraph">
<p>The deployment may be done as a:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Docker images (for the <em>arveo</em> services): A Docker image is a template that contains a set of instructions for
creating a container. Several containers can be started from one image;</p>
</li>
<li>
<p>executable jar: Integrate the content services in your java application and run on any platform that provides a JVM;</p>
</li>
<li>
<p>a <em>.war</em> file: Deploy the services as web applications in an application server like Tomcat;</p>
</li>
<li>
<p>Spring Boot application: Deployed as a self running service using an embedded tomcat servlet container;</p>
</li>
<li>
<p>Debian package: Debian packages are used for software installation on Debian-based operating systems;</p>
</li>
<li>
<p>Kubernetes HELM charts: Deploy the content services as containerized applications in your kubernetes environment with flexible HELM charts. That will enable load-dependent,
automated service provision.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_system_requirements"><a class="anchor" href="#_system_requirements"></a><a class="link" href="#_system_requirements">System requirements</a></h3>
<div class="paragraph">
<p>This chapter describes the system requirements for an on premise installation. The configuration and deployment of all required artefacts is performed by Eitco or a partner by the automated deployment tool "Puppet".</p>
</div>
<div class="sect3">
<h4 id="_general_prerequisites"><a class="anchor" href="#_general_prerequisites"></a><a class="link" href="#_general_prerequisites">General prerequisites</a></h4>
<div class="sect4">
<h5 id="_firewall"><a class="anchor" href="#_firewall"></a><a class="link" href="#_firewall">Firewall</a></h5>
<div class="paragraph">
<p>Some firewall permissions are required. The IP addresses and the ports are customer-specific. In order to notify the provider of this, the customer must fill out the form customer-specific information.</p>
</div>
</div>
<div class="sect4">
<h5 id="_network_access"><a class="anchor" href="#_network_access"></a><a class="link" href="#_network_access">Network Access</a></h5>
<div class="paragraph">
<p>SSH access from the Eitco network to all customer-specific systems (including server) is required so that the installation can be carried out. Access to the official Ubuntu package sources is required. This is done either in the form of direct access via the Internet or by providing a local copy of the corresponding repository.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_smtp_mail"><a class="anchor" href="#_smtp_mail"></a><a class="link" href="#_smtp_mail">SMTP Mail</a></h4>
<div class="paragraph">
<p>In addition, an SMTP server access is required for sending mail, as well as access to the Eitco Puppet Master via VPN. The following parameters must also be provided by the customer so that any error messages from the HL7 Integration Service can be sent by email:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SMTP_SERVER</p>
</li>
<li>
<p>SMTP_PORT</p>
</li>
<li>
<p>SMTP_STARTTLS = true / false</p>
</li>
<li>
<p>SMTP_USER</p>
</li>
<li>
<p>SMTP_PASSWORD</p>
</li>
<li>
<p>MAIL_TO</p>
</li>
<li>
<p>MAIL_FROM.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>MAIL_TO is the address to which the mails are sent and MAIL_FROM is the sender address.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reference_integration_system"><a class="anchor" href="#_reference_integration_system"></a><a class="link" href="#_reference_integration_system">Reference Integration System</a></h4>
<div class="paragraph">
<p>A reference system (in the form of a VM or similar) is required to test the system. There must be the same setup as on the customer client systems (i.e. the same web browser, with the same settings, etc). In addition, a terminal / RDP access is to be provided so that Eitco can test the client installation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_web_browser"><a class="anchor" href="#_web_browser"></a><a class="link" href="#_web_browser">Web browser</a></h4>
<div class="paragraph">
<p>For the administration user interfaces the following web browsers are supported: Safari, Google Chrome, Microsoft Edge, Mozilla Firefox, each in the current version.</p>
</div>
</div>
<div class="sect3">
<h4 id="_system_requirements"><a class="anchor" href="#_system_requirements"></a><a class="link" href="#_system_requirements">Containerized Applications</a></h4>
<div class="paragraph">
<p>For the installation of the product, certain requirements for the hardware, software and infrastructure to be provided
must be met.
In a typical cloud environment each <em>arveo</em> service is deployed as a containerized application and is hosted and scaled by a cloud operating system.
However, a different setup can be used, depending on the customer infrastructure and the load of the system (see <a href="#">Deployment Options</a>)</p>
</div>
<div class="paragraph">
<p>The following chapter describes the minimum CPU and RAM requirements of each <em>arveo</em> service in a production environment.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Content services requirements</caption>
<colgroup>
<col>
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">CPU</th>
<th class="tableblock halign-left valign-top">RAM</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Document Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 x&gt; 2 GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 32 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Management Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1x &gt; 2 GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 2 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registry Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1x &gt; 2 GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 512 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Config Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1x &gt; 2 GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 512 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Control Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1x &gt; 2 GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 2 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Audit Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1x &gt; 2 GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 512 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAP Archive Link Service (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1x &gt; 2 GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 1 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Document Conversion Service (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1x &gt; 2 GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 2 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise User Management Service (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1x &gt; 2 GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 1 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise Integration Service (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1x &gt; 2 GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 1 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Federation Service (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1x &gt; 2 GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 2 GB</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The number of started services for each service group and the assigned CPU and RAM depends very much on the load and the number of documents and objects in the database. You should always monitor the system and scale up or down on demand.
Especially service like document conversion or enterprise integration service can produce heavy load and require a lot of containers consuming RAM and CPU.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For a test or development system the requirements are lower
and each service requires: &lt; 1 CPU, 256 MB for all services.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_typical_non_containerized_installation"><a class="anchor" href="#_typical_non_containerized_installation"></a><a class="link" href="#_typical_non_containerized_installation">Typical Non-Containerized Installation</a></h4>
<div class="paragraph">
<p>Assuming that the installation is performed as spring boot services we recommend to set up a minimum of 3 machines. The database and the document service carry the highest load and should be deployed on separate machines. All other services and 3rd party services can run on one OS instance. Some services like Archive Link, Document Conversion may consume high CPU and RAM and can make it necessary to outsource them to separate machines,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>System machine 1 - <strong>database</strong>. The PostgreSQL database is installed here.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Requirements for the database machine</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Recommendation</th>
<th class="tableblock halign-left valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4x (&gt; 2 GHz)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least 16 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depending on the size of the database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DB Storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proportional to the number and the kind of the entities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recommendation: should be stored on separate
storage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depending on the volume of changes to the database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recommendation: Should be stored on separate storage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu 18.04/20.04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operating system recommendation is optional, hence any system satisfying the requirements
of the PostgreSQL database may be installed</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>System machine 2 - Document Service is installed here.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Requirements for the <em>arveo</em> machine</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Recommendation</th>
<th class="tableblock halign-left valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4x (&gt; 2 GHz)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 GB</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proportional to the size of the content objects</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">These storages are supported:<br>
1) on a separate file storage<br>
2) AWS, NetAPP or EMC Elastic Cloud Storage.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu 18.04/20.04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The tests are performed on a Debian machine, hence it is recommended to install a Debian
based distribution, for example a current LTS version of Ubuntu</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The storage is meant for storing the <em>arveo</em> content objects of type <em>Document</em>, meaning binary content. All metadata and system properties are stored in the database, see System machine 1 above.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>System machine 3 - Here all other services of <em>arveo</em> are installed: see <a href="#_content__services"><strong>Content Services</strong></a>, <a href="../../../../product-features/src/main/asciidoc/content-services.html#_3rd_party_services"><strong>3rd party services</strong></a></p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Requirements for the Services machine</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Recommendation</th>
<th class="tableblock halign-left valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4x (&gt; 2 GHz)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 GB</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu 18.04/20.04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operating system should be a Debian based</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The importance of testing shouldn&#8217;t be underestimated, so there should always be a way to test specific cases
without trying it out on a production system. For this reason, it is important to create a test system, which has
the same specification and a similar data set as the original system.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the <em>arveo</em> services JDK 11, 16 is required. All the other recommendations listed above are
non-binding, but they have proven to work well. In some cases, other recommendations can be made, according to your
individual project setup as well as the requirements of the project.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installation_2"><a class="anchor" href="#_installation_2"></a><a class="link" href="#_installation_2">Installation</a></h3>
<div class="sect3">
<h4 id="_general_concept"><a class="anchor" href="#_general_concept"></a><a class="link" href="#_general_concept">General concept</a></h4>
<div class="paragraph">
<p>These instructions describe the installation procedure, the installation content and the items required for commissioning the product.
We recommend controlling the rollout of the <em>_arveo</em> services by a continuous integration process that provides all artefact required for the deployment of the required content services and your web solution and integrations.</p>
</div>
<div class="paragraph">
<p>Depending on the underlying platform, deployment takes place via binary service artifacts that are deployed on pre-installed VMs or via containerized applications that are made available in the host cloud system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_on_premise_installation_by_eitco"><a class="anchor" href="#_on_premise_installation_by_eitco"></a><a class="link" href="#_on_premise_installation_by_eitco">On premise installation By Eitco</a></h4>
<div class="paragraph">
<p>This chapter describes the compliant On Premise installation provided by Eitco. The configuration and deployment of all required artefacts is performed by Eitco or a partner by the automated deployment tool "Puppet".</p>
</div>
<div class="paragraph">
<p>The customer provides several virtual machines that are configured by Eitco with the automated deployment tool Puppet (<a href="#_puppet">Puppet Deployment</a>) in order to ensure a problem-free software rollout in the customer system.</p>
</div>
<div class="paragraph">
<p>Depending on the service level agreement Eitco can guarantee high availability, reliability and high performance at all times. The system has to be protected from manipulation attempts by technical or organizational measures. The data that is stored and managed in the system is protected via the API. The access and editing rights are managed via ACLs. User rights are based on the concepts for roles, groups and ACLs. More detailed information on this is provided in the relevant chapters of this manual.</p>
</div>
<div class="paragraph">
<p>All changes to the system and the data are logged via the API, and the changes are traceable via
the audit log. If auditing is activated, every database change is logged.
In order to guarantee the atomicity of the transactions and to avoid inconsistent states, all are aborted transactions removed and rolled back.</p>
</div>
<div class="paragraph">
<p>Access to all data (documents, metadata) is exclusively provided via the API, with the corresponding protection mechanisms so that the security of the data is guaranteed at all times.</p>
</div>
</div>
<div class="sect3">
<h4 id="_puppet"><a class="anchor" href="#_puppet"></a><a class="link" href="#_puppet">Puppet</a></h4>
<div class="paragraph">
<p>Puppet is open source software developed by Puppet Labs and is used for the automated configuration and deployment of software deliveries. It ensures the configuration management of servers with both Unix-like operating systems and the Windows operating system via network. The Ad-min-Tool allows the automated configuration of computers and servers as well as the services installed on them.
The <em>arveo</em> services are installed and configured with Puppet. After the server has been provided, see <a href="#_system_requirements">System Requirements</a>, the Puppet Agent is installed on it, which then takes care of setting up the environment and the actual application. The duration of the installation process can vary and requires an adequate internet connection. The individual installation components are installed in the form of .deb packages.
The installation is completely automated and carried out remotely.</p>
</div>
</div>
<div class="sect3">
<h4 id="_installed_services"><a class="anchor" href="#_installed_services"></a><a class="link" href="#_installed_services">Installed services</a></h4>
<div class="paragraph">
<p><a href="../product-features#_3rd_party_services"><strong>3rd Party Services</strong></a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>postgreSQL 12 Database</p>
</li>
<li>
<p>apache solr 8.6 Document Database (full text)</p>
</li>
<li>
<p>JDK 11, 16</p>
</li>
<li>
<p>Keycloak, Active Directory Authentication Service</p>
</li>
<li>
<p>Active MQ Message Service Hub</p>
</li>
<li>
<p>Tomcat 9 Application Server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="../product-features#<em>content__services"><strong></em>arveo_ Content Services</strong></a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Document Service</p>
</li>
<li>
<p>Registry Service</p>
</li>
<li>
<p>Configuration Service</p>
</li>
<li>
<p>User Management Service</p>
</li>
<li>
<p>Access Control Service</p>
</li>
<li>
<p>Audit Service (optional)</p>
</li>
<li>
<p>Document Conversion Service (optional)</p>
</li>
<li>
<p>Enterprise Integration Service (optional)</p>
</li>
<li>
<p>Enterprise User Management Service (optional)</p>
</li>
<li>
<p>Enterprise Federation Service (optional).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Customer Applications &amp; Services</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eitco or Customer application and integration services (typically web client and Apache Camel integration end pints)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_order_of_services"><a class="anchor" href="#_order_of_services"></a><a class="link" href="#_order_of_services">Order of services</a></h4>
<div class="paragraph">
<p>Following you find the order of the service starts. The content services may not work before important services are started.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All commands should be executed as root. When running as a non-root user, sudo should be set in front of systemctl.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The services are initially started by Puppet.
After the installation of <em>arveo</em> has been successfully completed, the customer applications can be started.
Additional information on registration, user management and the use of the web client can be found in the user and admin manual.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>postgreSQL 12: systemctl start/stop postgresql</p>
</li>
<li>
<p>apache solr 8.6: systemctl start/stop solr.service, systemctl start/stop zookeeper.service</p>
</li>
<li>
<p>Config Service: systemctl start/stop common_config_service.service</p>
</li>
<li>
<p>Registry Service: systemctl start/stop common_registry_service.service</p>
</li>
<li>
<p>User Management Service: systemctl start/stop common_user_management.service</p>
</li>
<li>
<p>ACL Service: systemctl start/stop common_access_control.service</p>
</li>
<li>
<p>Enterprise User Management Service: systemctl start/stop common_enterprise_user_management.service (optional)*</p>
</li>
<li>
<p>Federation Service: esystemctl start/stop cr_federation.service (optional)</p>
</li>
<li>
<p>Audit Service: systemctl start/stop common_audit.service (optional)</p>
</li>
<li>
<p>Document Service: systemctl start/stop ecr_repository_service.service</p>
</li>
<li>
<p><em>Document Conversion Service: systemctl start/stop common_document_conversion.service</em> (optional)</p>
</li>
<li>
<p><em>Enterprise Integration Service: systemctl start/stop common_enterprise_integration.service</em> (optional)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The current status of the service can also be determined with systemctl status &lt;service&gt;.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ssl_certificates"><a class="anchor" href="#_ssl_certificates"></a><a class="link" href="#_ssl_certificates">SSL Certificates</a></h4>
<div class="paragraph">
<p>If all connections between the services are to be encrypted, SSL certificates are required. The following requirements apply:
An <a href="../arveo-developer#_authentication-x509">X-509 certificate</a> with an associated "private key" is required for each server. The certificate should be signed by an official CA or the company&#8217;s own CA. Self-signed certificates can also be used. The following special feature must be observed: the X509 extension “Subject Alternative Name” must contain all DNS names and IP addresses via which the respective systems are accessed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_licensing"><a class="anchor" href="#_licensing"></a><a class="link" href="#_licensing">Licensing</a></h4>
<div class="paragraph">
<p>The client software uses several 3rd party licenses. The list of licenses can be called up via the following link: <a href="https://&lt;customername&gt;.eitco.de/3rdpartylicenses.txt" class="bare">https://&lt;customername&gt;.eitco.de/3rdpartylicenses.txt</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_backups"><a class="anchor" href="#_backups"></a><a class="link" href="#_backups">Backups</a></h4>
<div class="paragraph">
<p>The logs are on the db server in the directory /var/log/postgresql/backup.log.
The database backup script is located at /var/lib/postgresql/backup.sh. This can also be started manually at any time. There should not yet be a folder with the current date under / backup / full /. If such a folder exists, it must be moved beforehand.
The script is controlled by cron and is always started automatically at 10 p.m.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administration"><a class="anchor" href="#_administration"></a><a class="link" href="#_administration"><strong>Administration</strong></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_configure_database_access"><a class="anchor" href="#_configure_database_access"></a><a class="link" href="#_configure_database_access">Configure Database access</a></h3>
<div class="paragraph">
<p><em>arveo</em> uses the default spring datasource configuration for the JDBC datasource. The datasource must be
configured as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">configuring the datasource</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  datasource:
    url: "jdbc:postgresql://localhost:5432/postgres?currentSchema=arveo&amp;ApplicationName=${spring.application.name}"
    driver-class-name: org.postgresql.Driver
    username: username
    password: password</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifying the <code>ApplicationName</code> property is optional but can be helpful when analyzing database issues. The name of the
Spring application will then be visible in Postgres query analytics.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The username and password should not be stored in the configuration files. Instead, they should be stored in <a href="#">Vault</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Advanced configuration properties can be found in the
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html#appendix.application-properties.data">Spring boot documentation</a>.
To configure the connection pool, use the <code>spring.datasource.hikari</code> properties.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configure_storage_locations"><a class="anchor" href="#_configure_storage_locations"></a><a class="link" href="#_configure_storage_locations">Configure Storage Locations</a></h3>
<div class="sect3">
<h4 id="_content_and_type_definitions"><a class="anchor" href="#_content_and_type_definitions"></a><a class="link" href="#_content_and_type_definitions">Content and type definitions</a></h4>
<div class="paragraph">
<p>Only Documents can contain content elements. A Document in the repository can contain several content elements.
For example, a document could contain a content element with the original content (like a TIFF image or a Word document)
and a PDF rendition. Each content element has a <em>contentName</em> and some more properties like the media type.
The <em>contentName</em> is a label that uniquely identifies a single content element contained in a Document.
For example, a Document might contain two content elements that are identified by the contentNames 'content' and
'rendition'.</p>
</div>
<div class="paragraph">
<p>The contentNames are not only relevant for uniquely identifying a content element contained in a document, but serve
as reference for further customization of the repository. The repository does accept configuration options that are
directly related to contentNames and the Document type definitions define restrictions regarding the
allowed contentNames.</p>
</div>
<div class="paragraph">
<p>Type definitions define which contentNames can be contained in the entities stored in the
definition.</p>
</div>
<div class="paragraph">
<p>Each content element is stored in a storage profile, which defines the place where the actual content will
be stored. The <em>contentType</em>  parameter can be used to define what kind of content
a content element can contain. When the media type is set to <code>application/octet-stream</code>, any kind of content can be used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The name of a content element must start with a letter and can consist only of letters (upper- and lower-case),
numbers and the <code>&#95;</code> character. More formally, the name must match the regular expression <code>[a-zA-Z][a-zA-Z0-9_]*</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_types_of_content_elements"><a class="anchor" href="#_types_of_content_elements"></a><a class="link" href="#_types_of_content_elements">Types of content elements</a></h4>
<div class="paragraph">
<p>It is specified in the type definition, which content elements this type definition may have.</p>
</div>
<div class="paragraph">
<p>Usually, the content elements of the entities are stored in a JSON field in the database which contains the storage-ID
and additional metadata like size, media type and a hash. The actual content data is not stored in the JSON field.
If required, a content element can also be stored in a separate field of type text. The separate field will contain only the
storage-ID but no additional metadata. Additional metadata for content elements using separate fields have to be
handled by the client application, for example by storing them in a custom metadata attribute.</p>
</div>
<div class="paragraph">
<p>The following example is an object of type <em>Document</em>, for which two content elements are defined: "content" and
"LARGE_CONTENT". In this example, "separateField = true" means a separate column in the database, otherwise it is
written in the corresponding json field of the database. The name of a separate column in the database is derived
from the name of the content element.</p>
</div>
<div class="listingblock">
<div class="title">Example of a Document with two content elements</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT)
@ContentElement(name = "content", separateField = true)
@ContentElement(name = "LARGE_CONTENT", separateField = true)
public interface TwoContentsDocument {

    @SystemProperty(SystemPropertyName.ID)
    DocumentId getId();

    @SystemProperty(SystemPropertyName.CONTENT)
    Map&lt;String, ContentInformation&gt; getContentInformation();

    String getName();

    void setName(String name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>contentType</code> attribute of the <code>@ContentElement</code> annotation one can define the required content type for a
content element. The content type <em>application/octet-stream</em> is used as a wildcard type for any type of content.
For example, if the value of the contentType attribute is set to <em>application/pdf</em>, only PDF files can be stored in the
content element.</p>
</div>
<div class="paragraph">
<p>It is possible to define the content type of a new content element when it is uploaded. The server will trust this
information, so the client is responsible to send the correct content type. If the client does not define the content
type, the server will automatically detect the content type of the uploaded binary data.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_default_content_element"><a class="anchor" href="#_the_default_content_element"></a><a class="link" href="#_the_default_content_element">The default content element</a></h4>
<div class="paragraph">
<p>If a type definition of type DOCUMENT does not contain any <code>@ContentElement</code> annotations, the server will automatically
assign a content element with the name <code>content</code> to it. This content element&#8217;s metadata will be stored in the JSON
field of the type definition and it accepts any kind of content type.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_contentelement_annotation"><a class="anchor" href="#_the_contentelement_annotation"></a><a class="link" href="#_the_contentelement_annotation">The ContentElement annotation</a></h4>
<div class="paragraph">
<p>The following Table contains an Overview of the available attributes of the <code>@ContentElement</code> annotation.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Attributes of the ContentElement annotation</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the content element. This attribute is mandatory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">profile</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the storage profile used to store the content element. This attribute is optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/octet-stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of content supported by the content element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">separateField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to store only the content ID and no additional metadata in a separate database field.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fulltextExtraction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the fulltext content of the content element will be extracted and stored in the NOSQL database.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_storage_profiles"><a class="anchor" href="#_storage_profiles"></a><a class="link" href="#_storage_profiles">Storage profiles</a></h4>
<div class="paragraph">
<p>A StorageProfile defines on which storage the content elements are saved. Access to the storage backends (like
filesystem or S3) is handled by storage plugins.</p>
</div>
<div class="paragraph">
<p>A StoragePlugin is defined in the StorageProfile, which is used to access the connected storage.
The same plugin can be used in several StorageProfiles. Each StorageProfile can have a different set of parameters (access
data, URls, &#8230;&#8203;) for the plugin.</p>
</div>
<div class="listingblock">
<div class="title">StorageProfile definition</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">ecr:
  server:
    storage:
      profiles:
        fileSystemProfile: <i class="conum" data-value="1"></i><b>(1)</b>
          defaultProfile: true <i class="conum" data-value="4"></i><b>(4)</b>
          pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin <i class="conum" data-value="2"></i><b>(2)</b>
          pluginSettings: <i class="conum" data-value="3"></i><b>(3)</b>
            storagePath: /storage
        s3Profile: <i class="conum" data-value="1"></i><b>(1)</b>
          pluginClassName: de.eitco.ecr.storage.plugin.s3.S3Plugin <i class="conum" data-value="2"></i><b>(2)</b>
          pluginSettings: <i class="conum" data-value="3"></i><b>(3)</b>
            pathStyleAccessEnabled: true
            serviceEndpoint: "http://localhost:49999"
            region: us-west-2
            accessKey: myaccesskey
            secretAccessKey: mysecretaccesskey
            bucket: testbucket</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>profile name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>class name of the plugin</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>plugin specific configuration data like the path for the filesystem plugin or the bucket for the S3 plugin</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>defines this profile as the default profile (see <a href="#_mapping_content_elements_to_storage_profiles">Mapping content elements to storage profiles</a>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each profile is identified by name and defines the storage plugin to use. Plugin-specific settings can be configured
in the <code>pluginSettings</code> map. So the plugin class name determines the storage technology and the plugin settings.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not rename a storage profile after data was stored in it. The name of the profile is part of the identifier of a
content element. Renaming the profile would make it impossible to load the data stored in it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a content element has been saved using the named StoragePlugin, the plugin defined in the profile will return a
contentID, with which the stored data can be retrieved later. This id, which is usually of type String, is saved with
the document. It is a task of the storage plugin to implement, which contents this id has. Usually it is a UUID, but
it may also be a text string.</p>
</div>
<div class="paragraph">
<p>A plugin is assigned to each profile based on the fully qualified class name. Any name-value pairs can be
specified for the configuration of the plug-in. The profiles are identified by their name.</p>
</div>
<div class="sect4">
<h5 id="_using_aliases_for_storage_profiles"><a class="anchor" href="#_using_aliases_for_storage_profiles"></a><a class="link" href="#_using_aliases_for_storage_profiles">Using aliases for storage profiles</a></h5>
<div class="paragraph">
<p>It is possible to assign aliases to storage profile names. This might be required when storage profiles are mapped
to content elements by configuration as described below. Assigning aliases can be done in the configuration by defining
<code>alias: profileName</code> entries as shown below:</p>
</div>
<div class="listingblock">
<div class="title">Storage profile aliases</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">ecr:
  server:
    storage:
      profile-aliases:
        alias1: encryptedProfile
        another_alias: encryptedProfile</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to define more than one alias for a storage profile.
Aliases are resolved before a content element is saved. The resulting <code>ContentId</code> will contain the resolved profile, not
the alias name.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The bucket selector plugin does not support aliases when selection rules are evaluated.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mapping_content_elements_to_storage_profiles"><a class="anchor" href="#_mapping_content_elements_to_storage_profiles"></a><a class="link" href="#_mapping_content_elements_to_storage_profiles">Mapping content elements to storage profiles</a></h4>
<div class="paragraph">
<p>There are two ways to map a specific content element to a storage profile.</p>
</div>
<div class="sect4">
<h5 id="_mapping_by_code"><a class="anchor" href="#_mapping_by_code"></a><a class="link" href="#_mapping_by_code">Mapping by code</a></h5>
<div class="paragraph">
<p>To define the mapping of the content elements to storage profiles in the application code, the storage profile name
can be set in the <code>@ContentElement</code> annotation using the <code>profile</code> attribute.</p>
</div>
<div class="listingblock">
<div class="title">Defining the storage profile of a content element in the code</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT)
@ContentElement(name = "content", profile = "fileSystemProfile")
public interface MyDocument {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows a document type with a single named content element that will be stored in a storage profile
called <em>fileSystemProfile</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mapping_by_configuration"><a class="anchor" href="#_mapping_by_configuration"></a><a class="link" href="#_mapping_by_configuration">Mapping by configuration</a></h5>
<div class="paragraph">
<p>If the mapping should be controlled by the configuration and not be defined in the code, storage profiles with auto-
matchable names must be used. The matching is based on the name of the type definition (in snake-case) and the name
of the content element separated by <code>-</code>.</p>
</div>
<div class="paragraph">
<p>The following type definition is used as an example in the following explanations. It uses one content element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT)
@ContentElement(name = "rendition")
public interface MyDocument {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A matching profile for the content element named <em>rendition</em> of the interface MyDocument would be selected using the
following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check if there is a profile called <code>my_document-rendition</code>. If so, use it.</p>
</li>
<li>
<p>If not, check if there is a profile called <code>my_document</code>. If so, use it.</p>
</li>
<li>
<p>If not, check if there is a <em>default storage profile</em>. If so, use it.</p>
</li>
<li>
<p>If none of the steps above succeeded, an exception is thrown.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_examples"><a class="anchor" href="#_examples"></a><a class="link" href="#_examples">Examples</a></h4>
<div class="paragraph">
<p>The following example shows the simplest possible configuration. The type definition does not contain any content element.
It implicitly uses the default content element named <code>content</code>. The content element will be stored in a storage profile
called <em>my_document</em>, or, if no such profile exists, in the default storage profile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ContentType.DOCUMENT)
public interface MyDocument {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example shows the same type definition, but with an annotation that defines which storage profile to use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ContentType.DOCUMENT)
@ContentElement(name = ContentElement.CONTENT, profile="fileSystemProfile")
public interface MyDocument {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example shows a type definition that contains two content elements. The "rendition"
content element will support only PDF documents. The PDFs contained in the rendition content element will be stored
in an S3 storage. The content in the other element will either be stored in a profile called <em>my_document-content</em>, in
a profile called <em>my_document</em> or, if neither of those profiles exists, in the default profile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ContentType.DOCUMENT)
@ContentElement(name="content")
@ContentElement(name="rendition", contentType="application/pdf", storageProfile="s3Profile")
public interface MyDocument {

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_plugin_configuration"><a class="anchor" href="#_plugin_configuration"></a><a class="link" href="#_plugin_configuration">Plugin configuration</a></h4>
<div class="paragraph">
<p>The service uses a plug-in interface for connection to the specific storage provider. The following plugins
are currently available:</p>
</div>
<div class="sect4">
<h5 id="_file_system"><a class="anchor" href="#_file_system"></a><a class="link" href="#_file_system">File system</a></h5>
<div class="paragraph">
<p>Class name: <em>de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin</em>.</p>
</div>
<div class="paragraph">
<p>The FileSystemPlugin offers storage of the data as files in the file system.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Configuration parameters of the file system</caption>
<colgroup>
<col style="width: 20%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">parameter</th>
<th class="tableblock halign-left valign-top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storagePath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the directory that is used to store the files</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_aws_netapp_or_emc_elastic_cloud_storage"><a class="anchor" href="#_aws_netapp_or_emc_elastic_cloud_storage"></a><a class="link" href="#_aws_netapp_or_emc_elastic_cloud_storage">AWS, NetAPP or EMC Elastic Cloud Storage</a></h5>
<div class="paragraph">
<p>Class name: <em>de.eitco.ecr.storage.plugin.s3.S3Plugin</em>.</p>
</div>
<div class="paragraph">
<p>The S3 plug-in stores data in an Amazon S3 compatible storage.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <em>arveo</em> has no permissions to create buckets, then the administrator has to create the buckets manually.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Configuration parameter of the S3 plugin</caption>
<colgroup>
<col style="width: 20%;">
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pathStyleAccessEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the client to use path-style access for all requests.
  Amazon S3 supports virtual-hosted-style and path-style access in all regions.
  The path-style syntax, however, requires that you use the region-specific endpoint when attempting to access a bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceEndpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL to the S3 endpoint to be used by the plugin</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">region</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The region for access to AWS</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">accessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS Access Key</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretAccessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS Secret Access Key</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the S3 bucket to be created by the plugin. The name can only contain lowercase letters.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">signer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the name of the signature algorithm to use for signing requests made by this client. If not set,
the default configuration of the Amazon S3 SDK will be used.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxyhost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The optional proxy host used by the client when connecting to the S3 storage.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxyprotocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The protocol (HTTP or HTTPS) used to connect to the proxy.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxyport</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port used by the client to connect to the proxy.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">streambuffersize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of the send- and receive-buffers in bytes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32768</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uploadpresignedurl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, the client will use pre-signed URL requests to communicate with the S3 storage.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">acceleratemode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the client to use S3 accelerate endpoint for all requests.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxconnection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of allowed open HTTP connections.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1 (no limit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxErrorRetries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of retries for failed requests.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1 (no retries)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">baseDelay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base delay in milliseconds for the retry policy.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1 (no delay)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxBackoffTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum backoff time in milliseconds for the retry policy.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1 (no maximum backoff time)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">backoffStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The backoff strategy used by the retry policy.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retentionEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the use of S3 object locks for object retention.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retentionMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the protection level of retention object locks. Can be <code>COMPLIANCE</code> or <code>GOVERNANCE</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GOVERNANCE</code></p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_configuring_the_retry_policy_of_the_s3_plugin"><a class="anchor" href="#_configuring_the_retry_policy_of_the_s3_plugin"></a><a class="link" href="#_configuring_the_retry_policy_of_the_s3_plugin">Configuring the retry policy of the S3 plugin</a></h6>
<div class="paragraph">
<p>The Amazon S3 SDK used to connect to a S3 compatible storage supports different ways to retry failed requests. By default,
a retry policy using jitter and 3 retries is used. To configure a custom retry policy, all three parameters <code>baseDelay</code>,
<code>maxBackoffTime</code> and <code>backoffStrategy</code> have to be configured. The <code>backoffStrategy</code> parameter must be set to one of the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FULL_JITTER</code></p>
</li>
<li>
<p><code>EQUAL_JITTER</code></p>
</li>
<li>
<p><code>EXPONENTIAL</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://docs.aws.amazon.com/de_de/general/latest/gr/api-retries.html">Amazon documentation</a> contains an explanation
of the different strategies.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_retention"><a class="anchor" href="#_retention"></a><a class="link" href="#_retention">Retention</a></h5>
<div class="paragraph">
<p>The S3 plugin supports the usage of S3 object locks to set a retention time and litigation hold status on content
elements stored in the S3 compatible storage. To enable the feature, set the parameter <code>retentionEnabled</code> to true.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the retention support is enabled, the bucket used by the storage profile must be created manually.
The S3 Object Locks option must be enabled for the bucket.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The S3 plugin uses the governance retention mode by default, which means, that retention protected objects
can be deleted by or overwritten by any user of the AWS account with the required privileges. When the compliance
retention mode is used, no user (not even the root administrator of the S3 account) is able to delete or overwrite
retention protected objects. To configure this behavior, set the property <code>retentionMode</code> to <code>GOVERNANCE</code> or
<code>COMPLIANCE</code>. More information about object locks can be found in the
<a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lock-overview.html">AWS documentation</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the <code>COMPLIANCE</code> retention mode is used, it is impossible to delete objects from the S3 storage account before
the end of the retention interval is reached.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_azure_blob_storage"><a class="anchor" href="#_azure_blob_storage"></a><a class="link" href="#_azure_blob_storage">Azure blob storage</a></h5>
<div class="paragraph">
<p>Class name: <code>de.eitco.ecr.storage.plugin.azureblob.AzureBlobStoragePlugin</code></p>
</div>
<div class="paragraph">
<p>The Azure blob storage plugin can be used to connect to a storage account in Microsoft Azure.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Configuration parameter of the azure blob storage plugin</caption>
<colgroup>
<col style="width: 20%;">
<col>
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The connection string used to connect to the storage account. The access string can be obtained from the azure portal.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">containerName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the container in the storage account that will contain the data of the storage profile.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeoutMillis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The timeout in milliseconds for requests to Azure.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retentionSupport</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables usage of the immutability policy feature of Azure.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">policyMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the protection level of the immutability policies. Can be <code>LOCKED</code> or <code>UNLOCKED</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UNLOCKED</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Additional parameters contained in the plugin configuration will be passed on to the <code>Configuration</code> used for the
Azure SDK.</p>
</div>
<div class="sect5">
<h6 id="_retention_2"><a class="anchor" href="#_retention_2"></a><a class="link" href="#_retention_2">Retention</a></h6>
<div class="paragraph">
<p>The Azure blob storage plugin supports the immutability policy feature of Azure blob storage. Using this feature
enables an additional security level for retention protected content elements. If a content element is retention
protected or in a litigation hold, it will not be possible to delete it using the Azure management interface or the
Azure SDK.</p>
</div>
<div class="paragraph">
<p>To enable the retention support, the parameter <code>retentionSupport</code> must be set to true.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the retention support is enabled, the container used by the storage profile must be created manually in Azure.
The setting <em>version-level immutability support</em> must be enabled when the container is created. To be able to
enable the version-level immutability support, the storage account must support versioning for blobs. More information
can be found in the <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/immutable-storage-overview">Azure documentation</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The plugin creates unlocked immutability policies by default. Unlocked policies can be altered by Azure users with the
required privileges. Locked immutability policies can neither be deleted nor can the expiry time be shortened.
Prolonging the expiry time (and by this, the retention period), is still possible. Note that even the administrator
of the storage account is not able to delete objects with a locked immutability policy. To configure the policy mode,
set the parameter <code>policyMode</code> to <code>LOCKED</code> or <code>UNLOCKED</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the <code>policyMode</code> is set to <code>LOCKED</code>, it is not possible to delete retention protected objects from the storage
account before the end of the retention interval is reached.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bucketorganizer"><a class="anchor" href="#_bucketorganizer"></a><a class="link" href="#_bucketorganizer">BucketOrganizer</a></h4>
<div class="paragraph">
<p>Class name: <em>de.eitco.ecr.server.storage.plugins.BucketOrganizerPlugin</em>.</p>
</div>
<div class="paragraph">
<p>The BucketOrganizer is not specific for a specific storage technology or storage interface but delegates storage requests
to other storage plugins.The selection of the target plugin depends on the retention information of the document that contains
the content element to be stored. The selection criteria that are used to select the target plugin can be configured in
terms of a list of bucket selection rules.</p>
</div>
<div class="paragraph">
<p>The relevant retention information of the document is defined by the values of the system fields <em>RETENTION_DATE</em> and
<em>LITIGATION_HOLD</em>.
This value pair is matched against the bucket selection rules.The matching process starts with the first rule
and continues to the next rule if the rule does not match the value pair.The matching process ends at the first rule that
matches the value pair.The storage profile named in this rule will be used to store the content. Each bucket
selection rule consists of three parts that are separated by the pipe (|) symbol.</p>
</div>
<div class="sect4">
<h5 id="_1_retention_date_match_expression"><a class="anchor" href="#_1_retention_date_match_expression"></a><a class="link" href="#_1_retention_date_match_expression">1.  retention date match expression</a></h5>
<div class="paragraph">
<p>The retention date match expression is usually a time interval that begins at some calendar day and extends to some
later calendar day. The notation for the interval is inspired by ISO 8601 and may read like this
<code>2021-01-01+01:00&#8212;&#8203;2022-01-01+01:00</code>. The general format is <code>begin_date&#8212;&#8203;end_date</code>, that is both dates are separated
by "--". A retention date matches the expression if <code>begin date &#8656; retention date &lt; end date</code>.
The begin and end dates are specified as <code>YYYY-MM-DD</code> followed by a time zone offset as <code>+hh:mm</code> or <code>-hh:mm</code>
It is possible to define open intervals by specifying one of the boundary dates as <code>UNBOUNDED</code>.
Retention dates may be NULL if the retention date has not (yet) been set on the document. A NULL retention date will
not match any interval specified in a match rule. For this reason the retention date match expression may be specified
to be <code>NULL</code> to match NULL retention dates.
A retention date match expression can also be specified to be <code>&#42;</code> if the rule should always match.</p>
</div>
</div>
<div class="sect4">
<h5 id="_2_litigation_hold_match_expression"><a class="anchor" href="#_2_litigation_hold_match_expression"></a><a class="link" href="#_2_litigation_hold_match_expression">2.  litigation hold match expression</a></h5>
<div class="paragraph">
<p>The litigation hold match expression can be one of these literals: <code>true</code>, <code>false</code>, <code>&#42;</code>.
While the literal <code>&#42;</code> will always match, the other literals will match the denoted value only.</p>
</div>
</div>
<div class="sect4">
<h5 id="_3_target_storage_profile_name"><a class="anchor" href="#_3_target_storage_profile_name"></a><a class="link" href="#_3_target_storage_profile_name">3.  target storage profile name</a></h5>
<div class="paragraph">
<p>The name of the target storage profile to be used if both expressions match the corresponding system field values</p>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_parameters"><a class="anchor" href="#_configuration_parameters"></a><a class="link" href="#_configuration_parameters">Configuration parameters</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Configuration parameters of BucketOrganizer plugin</caption>
<colgroup>
<col style="width: 25%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bucketSelectionRules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of bucket selection rules</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">storage:
  profiles:
    bucketProfile: <i class="conum" data-value="1"></i><b>(1)</b>
      pluginClassName: de.eitco.ecr.server.storage.plugins.BucketOrganizerPlugin <i class="conum" data-value="2"></i><b>(2)</b>
      pluginSettings:
        bucketSelectionRules: <i class="conum" data-value="3"></i><b>(3)</b>
          - "*|true|fsProfileLitigationHold" <i class="conum" data-value="4"></i><b>(4)</b> <i class="conum" data-value="5"></i><b>(5)</b>
          - "NULL|false|fsProfileForever" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2021-01-01+01:00--2022-01-01+01:00|false|fsProfile2021" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2022-01-01+01:00--2023-01-01+01:00|false|fsProfile2022" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2023-01-01+01:00--2024-01-01+01:00|false|fsProfile2023" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2024-01-01+01:00--2025-01-01+01:00|false|fsProfile2024" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2025-01-01+01:00--2026-01-01+01:00|false|fsProfile2025" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2026-01-01+01:00--2027-01-01+01:00|false|fsProfile2026" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2027-01-01+01:00--2028-01-01+01:00|false|fsProfile2027" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2028-01-01+01:00--2029-01-01+01:00|false|fsProfile2028" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2029-01-01+01:00--2030-01-01+01:00|false|fsProfile2029" <i class="conum" data-value="4"></i><b>(4)</b>
          - "2030-01-01+01:00--2031-01-01+01:00|false|fsProfile2030" <i class="conum" data-value="4"></i><b>(4)</b>
          - "*|*|fsProfileAnotherEra" <i class="conum" data-value="4"></i><b>(4)</b>
    fsProfileLitigationHold: <i class="conum" data-value="5"></i><b>(5)</b>
      pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
      pluginSettings:
        storagePath: ${project.build.directory}/storage/litigationHold
    fsProfileForever:
      pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
      pluginSettings:
        storagePath: ${project.build.directory}/storage/forever
    fsProfile2021:
      pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
      pluginSettings:
        storagePath: ${project.build.directory}/storage/2021
 #...
    fsProfile2030:
      pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
      pluginSettings:
        storagePath: ${project.build.directory}/storage/2030
    fsProfileAnotherEra:
      pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
      pluginSettings:
        storagePath: ${project.build.directory}/storage/anotherEra</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>profile name;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>type of plugin, so its class name;</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>rules list.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>a bucket selection rule, consisting of retention date match expression, litigation hold match expression and
target storage profile name.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the referenced profile name.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_storage_profile_templates"><a class="anchor" href="#_storage_profile_templates"></a><a class="link" href="#_storage_profile_templates">Storage profile templates</a></h5>
<div class="paragraph">
<p>To reduce the number of required entries in the list of bucket selection rules, storage profile templates can be used.
A storage profile template consists of a name template with placeholders, a specific time range and the regular
configuration parameters like the class name of the storage profile.The <code>&lt;year&gt;</code> placeholder can be used as a variable
for the current year.</p>
</div>
<div class="paragraph">
<p>Storage profile templates are configured in a separate section as shown below:</p>
</div>
<div class="listingblock">
<div class="title">Storage profile template configuration</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">ecr:
  server:
    storage:
      profiles:
        bucketProfile:
          pluginClassName: de.eitco.ecr.server.storage.plugins.BucketOrganizerPlugin
          pluginSettings:
            bucketSelectionRules:
              - "*|true|fsProfileLitigationHold"
              - "NULL|false|fsProfileForever"
              - "&lt;year&gt;-01-01+01:00|false|fsProfile&lt;year&gt;|2021--2030" <i class="conum" data-value="1"></i><b>(1)</b>
      profile-templates:
        - nameTemplate: "fsProfile&lt;year&gt;" <i class="conum" data-value="2"></i><b>(2)</b>
          genericTimeRange: "2021--2029" <i class="conum" data-value="3"></i><b>(3)</b>
          pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
          pluginSettings:
            storagePath: ${storage.base.directory}/storage/&lt;year&gt; <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A bucket selection rule using a profile template with the year placeholder for the years between 2021 and 2030.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A name template that will create profiles for the years 2021 to 2029.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defines the time range used to create profiles based on the template</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The year placeholder can be used in the configuration properties of the plugin.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_writing_a_custom_storage_plugin"><a class="anchor" href="#_writing_a_custom_storage_plugin"></a><a class="link" href="#_writing_a_custom_storage_plugin">Writing a custom storage plugin</a></h4>
<div class="paragraph">
<p>As mentioned above, <em>arveo</em> uses a plugin interface for the connection to the storage backends. This section
describes how to write a new storage plugin.</p>
</div>
<div class="paragraph">
<p>All classes and interfaces required to implement a custom plugin are contained in the dependency</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;de.eitco.ecr&lt;/groupId&gt;
    &lt;artifactId&gt;ecr-server&lt;/artifactId&gt;
    &lt;version&gt;16.1.1&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A storage plugin must implement the interface <code>de.eitco.ecr.server.storage.StoragePlugin</code>. There are two abstract
implementations that can be extended to simplify the implementation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AbstractStoragePlugin</code>: Provides several methods that make it easier to get plugin configuration settings.</p>
</li>
<li>
<p><code>AbstractSimplifiedStoragePlugin</code>: The superclass of all plugins that do not need retention support</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to the interface to implement, there are some guidelines to respect when writing a custom storage plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The plugin must provide a default no argument constructor because it will be instantiated using reflection.</p>
</li>
<li>
<p>The plugin can use dependency injection, but because of the need for a default constructor, only field injection
using <code>@Autowired</code> is possible.</p>
</li>
<li>
<p>There will be one instance of the plugin for each storage profile configured to use the plugin, so the plugin must
be thread-safe.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_configuration_settings"><a class="anchor" href="#_configuration_settings"></a><a class="link" href="#_configuration_settings">Configuration settings</a></h5>
<div class="paragraph">
<p>The <code>StoragePlugin</code> interface contains a method called <code>configure</code>, which will be called once for each plugin instance.
It is used to process the generic parameter values that might be required to configure the plugin. For example, the
parameters might contain a path to a file system directory or credentials for a remote storage system. Because storage
plugins can be configured in <a href="#_storage_profile_templates">profile templates</a>, it might be necessary to replace
placeholders configured in the template. The class <code>AbstractStoragePlugin</code> already contains helper methods like
<code>getMandatoryProperty</code> that take care of these replacements. The <code>configure</code> method is expected to return the actual
configuration with all replacements that is used by this plugin instance. The returned configuration settings are used
by the health checks.</p>
</div>
</div>
<div class="sect4">
<h5 id="_using_the_custom_storage_plugin"><a class="anchor" href="#_using_the_custom_storage_plugin"></a><a class="link" href="#_using_the_custom_storage_plugin">Using the custom storage plugin</a></h5>
<div class="paragraph">
<p>To use the custom plugin, it is enough to add its classes to the classpath of the repository service. The plugin can then
be used for a storage profile by specifying it&#8217;s qualified class name in the <code>pluginClassName</code> parameter. To add the
plugin&#8217;s class to the classpath, use the <code>-Dloader.path=&lt;path&gt;</code> argument to start the service. The argument must point
to a directory containing the required jar files.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_renditions"><a class="anchor" href="#_renditions"></a><a class="link" href="#_renditions">Renditions</a></h3>
<div class="paragraph">
<p>Renditions of content elements, for example a PDF rendition of an image, can be created automatically. To create a
rendition, the <code>@Rendition</code> annotation can be used as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="title">A document type definition with a rendition</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT)
@ContentElement(name = "original", separateField = true) <i class="conum" data-value="1"></i><b>(1)</b>
@Rendition(name = "rendition", sourceElement = "original", contentType = MediaType.APPLICATION_PDF_VALUE, separateField = true) <i class="conum" data-value="2"></i><b>(2)</b>
@OverwriteAllowed
public interface DocumentWithRendition {

    String getName();
    void setName(String name);

    @ContentType(contentElement = "original") <i class="conum" data-value="3"></i><b>(3)</b>
    String getContentType();
    void setContentType(String contentType);

    @SystemProperty(SystemPropertyName.RENDITION_STATUS) <i class="conum" data-value="4"></i><b>(4)</b>
    Map&lt;String, RenditionStatusInformation&gt; getRenditionStatus();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The content element containing the original content</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The rendition content element to create automatically</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The content type of the original content</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A getter for the current status of the renditions of the document</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example shows a document type with one content element and one rendition. Both the original and the rendition
element are stored in separate fields. This is possible but not required for renditions. When the original content
is stored in a separate field, meta information like the content type is not stored in the database. As the content
type of the original content is required to create a rendition, it is recommended to define an attribute of type 'String'
that contains the original content&#8217;s type. The attribute must be annotated with <code>@ContentType</code> to bind its value to
the original content element and return a valid mime type string like "image/jpeg". If no such attribute is present,
the system will try to detect the content type automatically.</p>
</div>
<div class="paragraph">
<p>The current status of the renditions can be retrieved as shown in the example above. The returned map contains a
<code>RenditionStatusInformation</code> instance for each rendition content element of the document. The status information contains
a status value and the number of times the system tried to create the rendition, if available. The status of a rendition can
be one of the following values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Rendition status values</caption>
<colgroup>
<col style="width: 25%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">parameter</th>
<th class="tableblock halign-left valign-top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AVAILABLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The rendition was created successfully (or was uploaded by a client) and is available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PENDING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The rendition is not yet available but is expected to be available in the future.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FAILED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creating the rendition has failed permanently.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EMPTY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The rendition is not available because the source content element does not exist.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RESET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creating the rendition has failed and the status was manually reset (see error handling).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>@Rendition</code> annotation accepts the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Parameters of <code>@Rendition</code></caption>
<colgroup>
<col style="width: 25%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">parameter</th>
<th class="tableblock halign-left valign-top">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the rendition content element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourceElement</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the content element to create a rendition of</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the rendition to create (a mime type string like "application/pdf")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the profile used to store the rendition content element (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">separateField</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(optional) whether to store the renditions&#8217;s meta data in a separate field or in the JSON content field</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Renditions are created asynchronously. When a document is created or updated, a message will be posted to a queue in
ActiveMQ. The messages are processed by event listeners in the repository service. Depending on the current load it
might take some time until the rendition is available.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The system will not try to create a rendition when the rendition content element is written by the client.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The actual rendering will be done by the Document Conversion Service. Which conversions are supported, depends on the
plugins available on the classpath of the service.</p>
</div>
<div class="sect3">
<h4 id="_error_handling"><a class="anchor" href="#_error_handling"></a><a class="link" href="#_error_handling">Error handling</a></h4>
<div class="paragraph">
<p>When the creation of a rendition fails, the system will re-try to create the rendition. The number of re-tries can
be configured, the default is three (see <a href="#_ecr_server_messaging">configuration properties</a>).
When all retries have failed, the rendition message will be added to a dead letter queue and the status field of the
rendition will be set to -1 (FAILED). For this to work, the message queue in ActiveMQ must be configured to
use an individual dead letter queue as described in <a href="https://activemq.apache.org/message-redelivery-and-dlq-handling.html">the ActiveMQ documentation</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;policyEntry queue="ecr-queue-create-renditions"&gt;
    &lt;deadLetterStrategy&gt;
        &lt;individualDeadLetterStrategy queuePrefix="DLQ." useQueueForQueueMessages="true"/&gt;
    &lt;/deadLetterStrategy&gt;
&lt;/policyEntry&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_reset_status_of_failed_renditions"><a class="anchor" href="#_reset_status_of_failed_renditions"></a><a class="link" href="#_reset_status_of_failed_renditions">Reset status of failed renditions</a></h5>
<div class="paragraph">
<p>The status of failed renditions can be set to RESET (-2) either by using the API method
<code>de.eitco.ecr.sdk.document.TypedDocumentServiceClient.resetFailedRenditionStatus</code> or simply by setting the value in the
database directly. A system job polls the database and will enqueue new rendition messages in ActiveMQ to re-try to
create the renditions. The interval in which the job polls the database can be configured using the parameter
<code>retry-renditions.cron-expression</code> (see <a href="#_ecr_server_messaging">configuration properties</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_dynamically_skipping_renditions"><a class="anchor" href="#_dynamically_skipping_renditions"></a><a class="link" href="#_dynamically_skipping_renditions">Dynamically skipping renditions</a></h5>
<div class="paragraph">
<p>There are cases where the decision, whether to create a rendition for a content element, can only be made at run-time. For cases like this a type can provide a method implementing that decision. This method is marked by the annotation <code>@RenditionCreationCondition</code>. Only one method of a type may have this annotation. The method</p>
</div>
<div class="ulist">
<ul>
<li>
<p>must have the return type <code>boolean</code>, <code>java.lang.Boolean</code> or <code>kotlin.Boolean</code></p>
<div class="ulist">
<ul>
<li>
<p>In case it is <code>java.lang.Boolean</code> it may not return null</p>
</li>
</ul>
</div>
</li>
<li>
<p>must not be abstract</p>
<div class="ulist">
<ul>
<li>
<p>should the defining class be an interface this means that it is either a static or a default-method</p>
<div class="ulist">
<ul>
<li>
<p>note that - should the type be defined in kotlin and the method not be static - this means it has to be compiled with <code>-Xjvm-default=all</code> or <code>-Xjvm-default=all-compatibility</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>can have up to two parameters of type <code>RenditionInfo</code></p>
<div class="ulist">
<ul>
<li>
<p>The first representing the source to render</p>
</li>
<li>
<p>And the second representing the target to render to</p>
</li>
<li>
<p>if only one parameter is given it is assumed to be the source</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If such a method exists, arveo evaluates it before posting rendition messages. If the method returns <code>false</code> the message is not posted. Such a method may be present on types that are not Documents, but will not have any effect. This might be helpful in scenarios where there are complex inheritance structures.</p>
</div>
<div class="sect5">
<h6 id="_example_1"><a class="anchor" href="#_example_1"></a><a class="link" href="#_example_1">Example 1</a></h6>
<div class="paragraph">
<p>Let&#8217;s assume a scenario where we have a document with a content element "content" that can have an arbitrary type. It is supposed to be a multi-page document, so in most cases it is a pdf-file. However, there are cases  where a document is created with the content element being an MS-word document and in some cases it is just a single page image. Even multi-page tiffs are possible and in some seldom cases the content is unclear and simply "application/octet-stream".</p>
</div>
<div class="paragraph">
<p>In this scenario there is a web viewer that is supposed to show the documents content. For the viewer, pdf files are no problem whatsoever. It is fully capable to view the images also, except multiple-page tiff files that pose a problem. It is unable to view ms-office files. And for "application/octet-stream" it can only provide a download link.</p>
</div>
<div class="paragraph">
<p>Thus is decided that the backend needs to create a pdf rendition for ms-office formats and tiff files. This could be implemented with the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT)
@ContentElement(name = "content") <i class="conum" data-value="1"></i><b>(1)</b>
@Rendition(name = "rendition", sourceElement = "content", contentType = MediaType.APPLICATION_PDF_VALUE) <i class="conum" data-value="2"></i><b>(2)</b>
public interface DocumentWithDynamicRenditionDecision {

    String getName();
    void setName(String name);

    @RenditionCreationCondition
    default boolean decideRendition( <i class="conum" data-value="3"></i><b>(3)</b>
        RenditionInfo source,
        RenditionInfo target <i class="conum" data-value="4"></i><b>(4)</b>
    ) {

        if (source.getMediaType().equals("application/msword")) { <i class="conum" data-value="5"></i><b>(5)</b>

            return true;
        }

        if (source.getMediaType().equals("application/vnd.openxmlformats-officedocument.wordprocessingml.document")) {

            return true;
        }

        if (source.getMediaType().equals("image/tiff")) {

            return true;
        }

        return false;
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A content element with the name "content" is defined.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A pdf rendition of that element is defined with the name "rendition".</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A default method "decideRendition" is created and marked with <code>@RenditionCreationCondition</code>.
<div class="ulist">
<ul>
<li>
<p>Note that:</p>
<div class="ulist">
<ul>
<li>
<p>Its return type is <code>boolean</code>.</p>
</li>
<li>
<p>as a <code>default</code> method it is not abstract</p>
</li>
<li>
<p>it hast two parameters of the type <code>RenditionInfo</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Thus, it is applicable.</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Note that the second parameter is unused. It could be omitted.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The implementation of the method is pretty simple. It checks whether the mime-type of the source element is one that we want to create a rendition for - ms-word files (old and new) or tif. If so, it returns <code>true</code> indicating that the arveo should create a rendition for the element. Otherwise, it returns <code>false</code> so that no rendition is created.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_example_2"><a class="anchor" href="#_example_2"></a><a class="link" href="#_example_2">Example 2</a></h6>
<div class="paragraph">
<p>Assume the application described in example 1. Assume further that at one point it becomes necessary to migrate some older documents to this application. An importer is written, however most of the imports fail. This is due to the fact that many of the documents are in an older msword format that the current render engine is incapable of transforming into pdf. So it is decided to not create a rendition for those elements and simply provide a download link in the applications' client.</p>
</div>
<div class="paragraph">
<p>This poses a problem in the <code>decideRendition()</code> method: Ms word documents that are created from the old source still should have created a rendition for. Thus, it is not possible to decide whether to render from the source type alone. A simple solution for this could be to add a new property <code>create_rendition</code> to the type. This nullable boolean could be set when created to imply whether to create a rendition for the content element or not. A value of <code>null</code> would activate the behaviour already implemented:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT)
@ContentElement(name = "content")
@Rendition(name = "rendition", sourceElement = "content", contentType = MediaType.APPLICATION_PDF_VALUE)
public interface DynamicRenditionExample2 {

    String getName();
    void setName(String name);

    <i class="conum" data-value="1"></i><b>(1)</b>
    Boolean getCreateRendition();
    void setCreateRendition(Boolean value);

    @RenditionCreationCondition
    default boolean decideRendition(
        RenditionInfo source <i class="conum" data-value="2"></i><b>(2)</b>
    ) {

        if (getCreateRendition() != null) { <i class="conum" data-value="3"></i><b>(3)</b>

            return getCreateRendition();
        }

        <i class="conum" data-value="4"></i><b>(4)</b>
        if (source.getMediaType().equals("application/msword")) {

            return true;
        }

        if (source.getMediaType().equals("application/vnd.openxmlformats-officedocument.wordprocessingml.document")) {

            return true;
        }

        if (source.getMediaType().equals("image/tiff")) {

            return true;
        }

        return false;
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The property <code>create_rendition</code> is defined. Note that with the type <code>java.lang.Boolean</code> it is nullable.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Note that in this case the unused parameter is omitted. This is the only change in the method signature.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>At the start of the method, it is checked, whether the new property is set, simply by calling the getter. If so the value is returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Otherwise, the code from example 1 is executed.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_text_renditions"><a class="anchor" href="#_text_renditions"></a><a class="link" href="#_text_renditions">Text renditions</a></h4>
<div class="paragraph">
<p>The rendition feature can be used to store extracted fulltext data as content elements of a document. To achieve this,
simply add a rendition content element with the content type <code>text/plain</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The content types of the source content element that can be used for text-extraction depend on the available extraction
plugins of the Document Conversion Service.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To be able to use the extracted fulltext data for searches, use the fulltext extraction feature for the SOLR integration.
See <a href="#_fulltext_extraction">SOLR</a> for details. The service will automatically use available text renditions
when the document is transferred to SOLR. If no text rendition is available, the text extraction will be performed on the
fly.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_retention_container"><a class="anchor" href="#_configure_retention_container"></a><a class="link" href="#_configure_retention_container">Configure retention container</a></h3>
<div class="sect4">
<h5 id="_configure_storage_containers_for_yearly_retention_periods"><a class="anchor" href="#_configure_storage_containers_for_yearly_retention_periods"></a><a class="link" href="#_configure_storage_containers_for_yearly_retention_periods">Configure storage containers for yearly retention periods</a></h5>
<div class="paragraph">
<p>Once you have deployed your new data type with enabled retention, all your data is stored in your default storage profile
and has a default retention of <strong>10 years</strong>.
The following example will define separate buckets containing all your objects with a retention period within one year.
Configure the buckets in the <em>ecr-service.yaml</em> of your config service in the section arveo:storage:profiles:
You can configure a new storage profile with an unlimited number of data buckets for your content.</p>
</div>
<div class="paragraph">
<p>Mandatory properties of your new bucket profile:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pluginClassName:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">must always be "de.eitco.ecr.server.storage.plugins.BucketOrganizerPlugin"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pluginSettings:bucketSelectionRules:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of rules containing filter (string)|litigationHold (boolean)|storageProfile (string)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">filter (string): Must be * to match all objects or a valid zoned date time range like 2031-01-01+01:00&#8212;&#8203;2032-01-01+01:00, the bucket selection is based on the document type property RETENTION_DATE.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">litigationHold (boolean) true= is a litigationHold bucket, false for all other regular retention buckets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">storageProfile (string): a valid storage profile name (arveo:storage:profiles:).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Find more details about selection rules in  <a href="#_bucketorganizer">Retention Bucket Selection Rules</a></p>
</div>
<div class="paragraph">
<p>If the configuration is not correct you will find more information in the startup log and will most likely find a MissingConfigurationException</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Defining storage containers in <em>arveo</em>-service.yaml and your storage system is an ongoing task for your operating team.
<em>Eitco</em> will try to create the buckets or subdirectory on your storage system but can also use already existing ones.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ecr-service.yaml example snippet for content definitions and storages. Adapt your ecr-service.yaml and replace rules, profile names and cloud storage url, etc. with your values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">arveo:
  server:
    content:
      default-definition:
        mediaType: "application/octet-stream"
        storageProfile: bucketProfile <i class="conum" data-value="1"></i><b>(1)</b>
      definitions:
        content:
          mediaType: "application/octet-stream"
          storageProfile: bucketProfile <i class="conum" data-value="1"></i><b>(1)</b>
        rendition:
          mediaType: "application/octet-stream"
          storageProfile: bucketProfile <i class="conum" data-value="1"></i><b>(1)</b>
        documentTypeA: <i class="conum" data-value="2"></i><b>(2)</b>
          mediaType: "application/octet-stream"
          storageProfile: storageProfileDocumentTypeA
        documentTypeB: <i class="conum" data-value="2"></i><b>(2)</b>
          mediaType: "application/octet-stream"
          storageProfile: storageProfileDocumentTypeB</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Assign your bucket storage profile to the content types with a retention period.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The example provides two more storage profiles for other document types (storageProfileDocumentTypeA, storageProfileDocumentTypeB). To write all content of a document type to a storage profile you must assign this content type to the document type.
The upload API will only accept content of this type for the document type.</td>
</tr>
</table>
</div>
<div id="_retention_container" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">    storage:
      profiles:
        bucketProfile:
          pluginClassName: de.eitco.ecr.server.storage.plugins.BucketOrganizerPlugin
          pluginSettings:
            bucketSelectionRules:
              - "*|true|storageProfileRetentionLitigationHold"
              - "NULL|false|storageProfileRetentionNone"
              - "2031-01-01+01:00--2032-01-01+01:00|false|storageProfileRetention2031"
              - "2032-01-01+01:00--2033-01-01+01:00|false|storageProfileRetention2032"
              - "2033-01-01+01:00--2034-01-01+01:00|false|storageProfileRetention2033"
              - "2034-01-01+01:00--2035-01-01+01:00|false|storageProfileRetention2034"
              - "2035-01-01+01:00--2036-01-01+01:00|false|storageProfileRetention2035"
              - "2036-01-01+01:00--2037-01-01+01:00|false|storageProfileRetention2036"
              - "2037-01-01+01:00--2038-01-01+01:00|false|storageProfileRetention2037"
              - "2038-01-01+01:00--2039-01-01+01:00|false|storageProfileRetention2038"
              - "2039-01-01+01:00--2030-01-01+01:00|false|storageProfileRetention2039"
              - "2030-01-01+01:00--2031-01-01+01:00|false|storageProfileRetention2030"
              - "2031-01-01+01:00--2032-01-01+01:00|false|storageProfileRetention2041"
              - "*|*|storageProfileRetention2042Plus"
        storageProfileRetentionLitigationHold: <i class="conum" data-value="1"></i><b>(1)</b>
          pluginClassName: de.eitco.ecr.storage.plugin.s3.S3Plugin
          pluginSettings:
            pathStyleAccessEnabled: true
            serviceEndpoint: "&lt;cloudstorage url&gt;"
            region: eu
            accessKey: &lt;myaccesskey&gt;
            secretAccessKey: &lt;mysecret&gt;
            bucket: LitigationHold
        storageProfileRetentionNone: <i class="conum" data-value="2"></i><b>(2)</b>
          pluginClassName: de.eitco.ecr.storage.plugin.s3.S3Plugin
          pluginSettings:
            pathStyleAccessEnabled: true
            serviceEndpoint: "&lt;cloudstorage url&gt;"
            region: eu
            accessKey: &lt;myaccesskey&gt;
            secretAccessKey: &lt;mysecret&gt;
            bucket: NoRetention
        storageProfileRetention2032Plus: <i class="conum" data-value="3"></i><b>(3)</b>
          pluginClassName: de.eitco.ecr.storage.plugin.s3.S3Plugin
          pluginSettings:
            pathStyleAccessEnabled: true
            serviceEndpoint: "&lt;cloudstorage url&gt;"
            region: eu
            accessKey: &lt;myaccesskey&gt;
            secretAccessKey: &lt;mysecret&gt;
            bucket: RetentionPeriod2032Plus
        storageProfileRetention2031: <i class="conum" data-value="4"></i><b>(4)</b>
          pluginClassName: de.eitco.ecr.storage.plugin.s3.S3Plugin
          pluginSettings:
            pathStyleAccessEnabled: true
            serviceEndpoint: "&lt;cloudstorage url&gt;"
            region: eu
            accessKey: &lt;myaccesskey&gt;
            secretAccessKey: &lt;mysecret&gt;
            bucket: RetentionPeriod2031
        storageProfileRetention2032:
          pluginClassName: de.eitco.ecr.storage.plugin.s3.S3Plugin
          pluginSettings:
            pathStyleAccessEnabled: true
            serviceEndpoint: "&lt;cloudstorage url&gt;"
            region: eu
            accessKey: &lt;myaccesskey&gt;
            secretAccessKey: &lt;mysecret&gt;
            bucket: RetentionPeriod2032
             ... <i class="conum" data-value="5"></i><b>(5)</b>
        storageProfileDocumentTypeA: <i class="conum" data-value="6"></i><b>(6)</b>
          pluginClassName: de.eitco.ecr.storage.plugin.s3.S3Plugin
          pluginSettings:
            pathStyleAccessEnabled: true
            serviceEndpoint: "&lt;cloudstorage url&gt;"
            region: eu
            accessKey: &lt;myaccesskey&gt;
            secretAccessKey: &lt;mysecret&gt;
            bucket: DocumentTypeA
        storageProfileDocumentTypeB: <i class="conum" data-value="6"></i><b>(6)</b>
          pluginClassName: de.eitco.ecr.storage.plugin.s3.S3Plugin
          pluginSettings:
            pathStyleAccessEnabled: true
            serviceEndpoint: "&lt;cloudstorage url&gt;" <i class="conum" data-value="7"></i><b>(7)</b>
            region: eu <i class="conum" data-value="7"></i><b>(7)</b>
            accessKey: &lt;myaccesskey&gt; <i class="conum" data-value="7"></i><b>(7)</b>
            secretAccessKey: &lt;mysecret&gt; <i class="conum" data-value="7"></i><b>(7)</b>
            bucket: DocumentTypeB</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>always configure a litigation hold bucket</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>you should also configure a data that has no retention &#8230;&#8203; just in case</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>fall back bucket for all content with retention period past 2041.
You can leave this bucket and get an exception if you store content which cannot be assigned to a bucket</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>One buckets for each year</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Configure as many buckets as needed for your content</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Two more storage profiles for other document types without retention.
See content types without retention above arveo:server:content:DocumentTypeA/B</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>replace the placeholders with your S3 url, region, access key and access secret.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more details on storage profiles and content types see <a href="#_types_of_content_elements">Content types</a></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to use directories instead of buckets you can configure file system storage profiles and assign a sub directory (<a href="#_file_system">File system storage profile configuration</a>)
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">        storageProfileLitigationHold:
          pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
          pluginSettings:
            storagePath: ${storage.base.directory}/storage/litigationHold
        storageProfileRetentionNone:
          pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
          pluginSettings:
            storagePath: ${storage.base.directory}/storage/retentionNone
        storageProfile2031:
          pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
          pluginSettings:
            storagePath: ${storage.base.directory}/storage/2031</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_encryption"><a class="anchor" href="#_encryption"></a><a class="link" href="#_encryption">Configure Encryption</a></h3>
<div class="paragraph">
<p><em>arveo</em> provides a transparent encryption for data stored in the profiles. The encryption can be configured individually
for each storage profile.</p>
</div>
<div class="sect3">
<h4 id="_overview"><a class="anchor" href="#_overview"></a><a class="link" href="#_overview">Overview</a></h4>
<div class="paragraph">
<p>Encrypting and decrypting is performed by configurable encryption providers. Each provider is identified by a unique
name. The available providers are described below.</p>
</div>
<div class="paragraph">
<p>The following tables give an overview of encryption settings for a storage profile.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Encryption settings</caption>
<colgroup>
<col style="width: 25%;">
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enables or disables the encryption</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">providerName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name of the encryption provider to use</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">commons-aes</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To make sure all content of a specific type definition is encrypted, make sure to limit the content types supported
by the type definition to types that use an encrypting storage profile.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the <a href="#_bucketorganizer">BucketOrganizerPlugin</a> is used, the encryption settings must be configured for each plugin referenced
by the bucket selection rules. Configuring the encryption for the BucketOrganizerPlugin itself is not supported.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_commons_aes_provider"><a class="anchor" href="#_commons_aes_provider"></a><a class="link" href="#_commons_aes_provider">Commons AES provider</a></h4>
<div class="paragraph">
<p>The <code>commons-aes</code> provider supports AES encryption with 256bit keys. When a new content element is created in an encrypted
profile, the provider generates a random cipher key for the element. The key is encrypted using a master password that is
configured in the profile&#8217;s encryption settings. It is then stored in the database, which creates an identifier for the key.
The keys are stored in individual tables for each profile called ecr_keys_&lt;profileName&gt;. After that, the content is encrypted
and stored using the profile&#8217;s storage plugin. The key-id is stored in a header together with the encrypted data. When
the data is read, the cipher key is loaded from the database using the key-id read from the header. The key is decrypted
using the master password and used to decrypt the data read by the profile&#8217;s storage plugin.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the database table containing the keys or the master password is lost, it is impossible to restore the
data stored in the profile.
When the master password for a profile is changed, it is required to re-encrypt all stored keys for the profile.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the future, there will be a way to re-encrypt keys. For now, this issue hasn&#8217;t been implemented yet.</p>
</div>
<div class="paragraph">
<p>There is a second database table for each profile called ecr_keys_assoc_&lt;profileName&gt;. This table contains mappings of
key IDs to content element IDs and is intended for system administration purposes.
The encryption feature is configured as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Configuration of encryption for a storage profile</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">storage:
  profiles:
    encryptedProfile:
      pluginClassName: "de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin"
      pluginSettings:
        storagePath: "/storage/encrypted"
      encryptionSettings:
        enabled: true
        providerName: "commons-aes"
        providerSettings:
          password: "changeme"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following tables give an overview of encryption settings for the <em>commons-aes</em> provider:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Provider specific settings for 'commons-aes'</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 30%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the master password used to encrypt the cipher keys</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rngAlgorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the algorithm used to generate secure random data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Platform specific. See docs for SecureRandom.getInstanceStrong(). If not specified, the
most secure algorithm available will be used</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_vault_aes_provider"><a class="anchor" href="#_vault_aes_provider"></a><a class="link" href="#_vault_aes_provider">Vault AES provider</a></h4>
<div class="paragraph">
<p>The <code>vault-aes</code> encryption provider uses the transit secrets engine of
<a href="https://www.vaultproject.io/docs/secrets/transit">Hashicorp Vault</a> to encrypt and decrypt a generated random cipher key.
The cipher key is generated using a configurable random data generation algorithm and then used to encrypt the content
with AES as described below. The cipher key is then encrypted by Vault and stored in a header together with the encrypted
content data. When the data is decrypted, the encrypted cipher key is read from the header, decrypted using Vault and
then used to decrypt the content. The advantage in comparison to the <code>commons-aes</code> provider is that no master key and
no stored encryption keys in the database are required. The keys required to decrypt the cipher keys (and though the
data, too) are securely stored in Vault and are never known to <em>arveo</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the Vault instance containing the keyring used to encrypt the random cipher keys is lost, it is impossible to
decrypt the content data!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following tables give an overview of encryption settings for the <code>vault-aes</code> provider:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Provider specific settings for 'commons-aes'</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keyring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name of the key ring contained in Vault&#8217;s transit secrets engine used to encrypt the cipher keys</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transitEnginePath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(optional) path of the transit engine. If null, the default path will be used.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rngAlgorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the algorithm used to generate secure random data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Platform specific. See docs for SecureRandom.getInstanceStrong(). If not specified, the
most secure algorithm available will be used</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following example shows a storage profile configuration using the <code>vault-aes</code> encryption provider.</p>
</div>
<div class="listingblock">
<div class="title">example configuration for the vault-aes provider</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">vaultEncryptedProfile:
  pluginClassName: de.eitco.ecr.storage.plugin.filesystem.FileSystemPlugin
  pluginSettings:
    storagePath: /storage/vault-encrypted
  encryptionSettings:
    enabled: true
    providerName: vault-aes
    providerSettings:
      keyring: arveo</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_details_of_aes_encryption"><a class="anchor" href="#_implementation_details_of_aes_encryption"></a><a class="link" href="#_implementation_details_of_aes_encryption">Implementation details of AES encryption</a></h4>
<div class="paragraph">
<p>The following chapter contains information about the implementation details of the AES encryption used by <em>arveo</em>.</p>
</div>
<div class="sect4">
<h5 id="_header"><a class="anchor" href="#_header"></a><a class="link" href="#_header">Header</a></h5>
<div class="paragraph">
<p>The encryption library is designed to encrypt data in such a way that it can be stored permanently in encrypted form and
possibly only decrypted after a long time. In order to guarantee decryption, all data required for this (except the key, of
course) are stored in a header together with the encrypted data. Using the data from the header, the library can thus
obtain, for example, the algorithm used and the data for key derivation, and only needs the password or the derived key
for decryption.</p>
</div>
</div>
<div class="sect4">
<h5 id="_aes"><a class="anchor" href="#_aes"></a><a class="link" href="#_aes">AES</a></h5>
<div class="paragraph">
<p>The library uses AES according to the recommendation of the Federal Office for Information Security of March 2020:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Operating mode: Galois/Counter-Mode</p>
</li>
<li>
<p>Hash function for key derivation: Argon2</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The library allows the configuration of different parameters, but offers default values according to the recommendation
of the BSI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Key length: 256 bit</p>
</li>
<li>
<p>Length of GCM checksums: 128 bit</p>
</li>
<li>
<p>Length of the initialisation vector: 96 bit</p>
</li>
<li>
<p>Length of the salt for the key derivation: 32 bit</p>
</li>
<li>
<p>Parallelism for Argon2: 1</p>
</li>
<li>
<p>Memory cost for Argon2: 4096 KB</p>
</li>
<li>
<p>Iterations for Argon2: 3</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The initialisation vector is randomly generated each time the encryption methods are called by using SecureRandom. The
salt for the key derivation is generated in the same way each time the password derivation method is called. The fact
that the initialisation vector is always regenerated ensures that the same combination of initialisation vector and key
can never be used more than once.
For both the AES algorithm and the Argon2 hash function, the implementations of the BouncyCastle library are used. For
performance and compatibility reasons, the BouncyCastle implementations are used directly and not via the JCA:</p>
</div>
<div class="listingblock">
<div class="title">Generation of the AES cipher with GCM</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">GCMBlockCipher cipher = new GCMBlockCipher(new AESEngine());</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Generation of the Argon2 hash generator</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Argon2BytesGenerator generator = new Argon2BytesGenerator();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the default implementation of the <em>CipherInputStream</em> from <em>javax.crypto</em> is not suitable for block ciphers with data
authentication, the implementations for <em>CipherInputStream</em> and <em>CipherOutputStream</em> from the <em>BouncyCastle</em> library are used.
To generate the random data for the initialisation vector and the salt, a <em>SecureRandom</em> instance created with
<em>SecureRandom.getInstanceStrong()</em> is used by default. However, the library allows you to specify a different RNG algorithm
(see <a href="#_note_on_linux">Note on Linux</a> below).</p>
</div>
</div>
<div class="sect4">
<h5 id="_header_format"><a class="anchor" href="#_header_format"></a><a class="link" href="#_header_format">Header Format</a></h5>
<div class="paragraph">
<p>The header begins with a string to identify data encrypted with the library followed by the length of the
payload data in the header. The header is divided into blocks and can be read serially.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>++&gt;~ENC~&lt;++|97|AES_GCM_ARGON2|1|256|128|10|4096|1|aWFtYW5pbml0aWFsaXphdGlvbnZlY3Rvcg==|aWFtYXNhbHQ=|bXlLZXlJZA==

Marker|length|method|header version|key length|checksum length|iteration|storage cost|parallelism|initialisation vector|salt|key ID</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_key"><a class="anchor" href="#_key"></a><a class="link" href="#_key">Key</a></h5>
<div class="paragraph">
<p>The keys used for encryption are either generated using random data or derived from any password using the Argon2 hash
function. Since deriving keys can be very computationally intensive depending on the configuration, a key ID can be
stored in the header. This makes it possible to store a key once it has been derived and to reuse it for decryption,
which avoids having to derive the key from the password again. The library is not responsible for the secure storage of
the key. Generating keys using random data is a much faster operation compared to key derivation. The disadvantage is,
that it is not possible to derive the key from a master password in case it was lost. When generated keys are used,
it is crucial to store those keys in a secure location. In this case, the header will not contain a salt but only the
ID of the stored key. When an external system like Vault is used to encrypt generated keys, the encrypted generated key
is stored in the header instead.</p>
</div>
</div>
<div class="sect4">
<h5 id="_usage"><a class="anchor" href="#_usage"></a><a class="link" href="#_usage">Usage</a></h5>
<div class="paragraph">
<p>Instantiation of the AesEncryptorAndDecryptor:</p>
</div>
<div class="listingblock">
<div class="title">Instantiation with default parameters</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">AesEncryptorAndDecryptor encryptorAndDecryptor=new AesEncryptorAndDecryptor.Builder().build();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Instantiation with customised parameters</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">AesEncryptorAndDecryptor encryptorAndDecryptor=new AesEncryptorAndDecryptor.Builder()
    .with128BitKeys()
    .withInitializationVectorLength(128)
    .withTagLength(128)
    .withIterations(5)
    .withMemoryCost(1024)
    .withParallelism(3)
    .withSaltLength(64)
    .withRngAlgorithm("SHA1PRNG")
    .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples of usage can be found in the test class <em>de.eitco.commons.crypto.AesEncryptionTest</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_note_on_linux"><a class="anchor" href="#_note_on_linux"></a><a class="link" href="#_note_on_linux">Note on Linux</a></h5>
<div class="paragraph">
<p>On Linux, Java uses the NativePRNG algorithm by default for generating random data with SecureRandom.getInstanceStrong().
This implementation uses /dev/random and may block if there is not enough data available there. This can lead to very
long waiting times for key derivation and encryption. You can then either use a weaker RNG algorithm or make sure that
<em>/dev/random</em> always contains enough data. This can be achieved with the haveged daemon, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>apt-get install haveged
update-rc.d haveged defaults
service haveged start</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_active_mq"><a class="anchor" href="#_configure_active_mq"></a><a class="link" href="#_configure_active_mq">Configure Active MQ</a></h3>
<div class="paragraph">
<p><em>arveo</em> uses Apache ActiveMQ to queue asynchronous tasks. Access to the message broker is configured in the YAML file of
the <em>arveo</em> service using the default configuration properties of the Spring ActiveMQ integration:</p>
</div>
<div class="listingblock">
<div class="title">Configuration of ActiveMQ</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  activemq:
    broker-url: "tcp://127.0.0.1:61616"
    user: "system"
    password: "manager"</code></pre>
</div>
</div>
<div class="paragraph">
<p>ActiveMQ&#8217;s OpenWire protocol is used to connect to the broker. The queues and topics used by the <em>arveo</em> can be identified
by <em>arveo</em>- name-prefix. The <em>arveo</em> uses text messages containing JSON data to make it possible to consume messages in
components not implemented in Java. The JSON data uses the same serialization mechanism as the REST API.</p>
</div>
<div class="paragraph">
<p><em>arveo</em> uses ActiveMQ&#8217;s scheduler support for features like automated deletion of entities in the recycle bin after a
configurable time. Therefore it is required to enable the scheduler in ActiveMQ by setting schedulerSupport="true" in the
broker tag in <em>activemq.xml</em>.</p>
</div>
<div class="paragraph">
<p>Some features like the automatic creation of renditions or the removal of stored data for data protection compliance
require dead letter queues in ActiveMQ. See <a href="#<em>error_handling">renditions</a> for details. The queue-specific
dead letter queues must be activated by adding the following policy entries to _activemq.xml</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;policyEntry queue="ecr-queue-create-renditions"&gt;
    &lt;deadLetterStrategy&gt;
        &lt;individualDeadLetterStrategy queuePrefix="DLQ." useQueueForQueueMessages="true"/&gt;
    &lt;/deadLetterStrategy&gt;
&lt;/policyEntry&gt;
&lt;policyEntry queue="ecr-queue-delete-audit-entries"&gt;
    &lt;deadLetterStrategy&gt;
        &lt;individualDeadLetterStrategy queuePrefix="DLQ." useQueueForQueueMessages="true"/&gt;
    &lt;/deadLetterStrategy&gt;
&lt;/policyEntry&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_arveo_user_management_as_authentication_service"><a class="anchor" href="#_configure_arveo_user_management_as_authentication_service"></a><a class="link" href="#_configure_arveo_user_management_as_authentication_service">Configure <em>arveo</em> user management as Authentication Service</a></h3>
<div class="paragraph">
<p>The User Management Service can also be used as an OAuth2.0 Authorization Server. The service can issue JSON web tokens that can be used to log in to services that are also secured with OAuth2.</p>
</div>
<div class="sect3">
<h4 id="_configuration_of_the_authorization_server"><a class="anchor" href="#_configuration_of_the_authorization_server"></a><a class="link" href="#_configuration_of_the_authorization_server">Configuration of the Authorization Server</a></h4>
<div class="paragraph">
<p>To enable the Authorization Server, the <em>user-service.authorization-server.enabled</em> setting must be
enabled and a keystore must be configured. The keystore must contain an RSA keypair under the specified alias:</p>
</div>
<div class="listingblock">
<div class="title">Excerpt from a configuration file</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">user-service:
  authorization-server:
  enabled: true
  keystore:
    file: "Pfad/zum/Keytore/keystore.jks"
    password: test
    alias: test</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_oauth_clients"><a class="anchor" href="#_oauth_clients"></a><a class="link" href="#_oauth_clients">OAuth clients</a></h4>
<div class="paragraph">
<p>To obtain a token, a client application must log on to a specific client configured in the Authorization Server. Clients can be created both by API and by configuration. At least one client must have been configured to be able to log in via OAuth. Clients are always stored in the master
tenant. In the configuration, clients can be specified as follows:</p>
</div>
<div class="listingblock">
<div class="title">Excerpt from a configuration file</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">user-service:
  config-data:
    tenants:
      - tenant-id: master
        oauth2-clients:
          - clientId: test-client
            resourceIds:
              - user-management-service
            clientSecret: my-secret
            authorizedGrantTypes:
              - password
              - client_credentials
              - refresh_token
            authorities:
              - USER_MANAGEMENT_SERVICE_USER
            accessTokenValiditySeconds: 300
            refreshTokenValiditySeconds: 600</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, a client with the ID "test-client" is configured to have access to the <em>arveo</em> User Management
Service (resourceIds and authorities) and to offer the authorization grants password, client_credentials and refresh_tokens. The grants are the same as those in the OAuth2.0 standard.</p>
</div>
<div class="paragraph">
<p>By default, the client&#8217;s configured authorities are included in the issued tokens. In addition, the user&#8217;s authorities
(= privileges) configured in the user service are entered in the tokens. To prevent the client&#8217;s authorities from
being included in the tokens, the <em>user-service.authorization-server.inherit-authorities</em> setting can be set to false.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The clients are always stored in the master tenant. For systems with multiple clients, care must be taken to specify the master tenant in the configuration.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_refreshing_tokens"><a class="anchor" href="#_refreshing_tokens"></a><a class="link" href="#_refreshing_tokens">Refreshing tokens</a></h5>
<div class="paragraph">
<p>When a new token is issued, a refresh token is also generated (except for the client_credentials grant). This refresh token can be used to renew an expiring token without requiring the user to log in again. By default, when a token refresh request is made, the user also receives a new refresh token whose validity is still that of the first refresh token. This ensures that a user cannot be issued new access tokens by the service indefinitely. If this behavior is not desired, and the refresh tokens should each have an extended validity, the <em>user-service.authorization-service.reuse-refresh-tokens</em> parameter can be set to false.</p>
</div>
</div>
<div class="sect4">
<h5 id="_client_login"><a class="anchor" href="#_client_login"></a><a class="link" href="#_client_login">Client login</a></h5>
<div class="paragraph">
<p>To get a token, the client application must send the respective client id and the client secret as HTTP Basic Auth
header in the token request. The remaining parameters are sent as form data via POST to the endpoint
<a href="https://user-management-service/oauth/token" class="bare">https://user-management-service/oauth/token</a>.
=== Configure authentication/SSO with Keycloak</p>
</div>
<div class="paragraph">
<p>The <em>arveo</em> content services support OAuth2.0 with OpenID Connect to authenticate users and services.
You can install Keycloak as your identity management and use it as OAuth2.0 authentication service instead of the _arveo user management service.
This will also allow you to enable single sign on for your web clients.</p>
</div>
<div class="paragraph">
<p>The content services take either the role of a "resource server" or the role "resource server" and a "client" if the use resources of other services.</p>
</div>
<div class="paragraph">
<p>In principle, any authentication server that supports OAuth2.0 and OpenID Connect can be used. Currently Keycloak, Active Directory are approved for use with <em>arveo</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_install_keycloak"><a class="anchor" href="#_install_keycloak"></a><a class="link" href="#_install_keycloak">Install Keycloak</a></h5>
<div class="ulist">
<ul>
<li>
<p>Download and install Keycloak: <a href="https://www.keycloak.org/downloads.html" class="bare">https://www.keycloak.org/downloads.html</a></p>
</li>
<li>
<p>Start the server. With standalone.bat -Djboss.socket.binding.port-offset=100 the used ports can be adjusted.</p>
</li>
<li>
<p>Call the configuration interface (e.g. localhost:8180) and define an administrator user for the first login.</p>
</li>
<li>
<p>Refer to Keycloak documentation to configure Keycloak on your system.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_create_keycloak_realm"><a class="anchor" href="#_create_keycloak_realm"></a><a class="link" href="#_create_keycloak_realm">Create Keycloak realm</a></h5>
<div class="ulist">
<ul>
<li>
<p>Create your own realm (e.g. "<em>arveo</em>") with keycloak configuration interface.</p>
</li>
<li>
<p>Copy the public RSA key from the realm keys tab. We will use later for the configuration of the content services.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_create_keycloak_clients"><a class="anchor" href="#_create_keycloak_clients"></a><a class="link" href="#_create_keycloak_clients">Create Keycloak clients</a></h5>
<div class="ulist">
<ul>
<li>
<p>Next, the keycloak clients for the <em>arveo</em> services are set up. Clients may access resources, resources validate access to themselves. There is also a mixed form (confidential) that accesses resources, but can also be a resource itself.<br>
All clients have set Client Protocol=openid-connect<br>
Client Authenticator must be Client Id and Secret to allow a secure OAuth2.0 flow.</p>
<div class="ulist">
<ul>
<li>
<p>Create a client <em>arveo</em>-service for the secure communication between the <em>arveo</em> services,<br>
This client behaves like a technical user for service/service calls<br>
access-type=confidential</p>
</li>
<li>
<p>Create client for your applications e.g. arveo-webclient which is public and accesses all <em>arveo</em> services<br>
This client is used for the users of your application that have logged with credentials.<br>
Client-Protocol=public<br>
Valid Redirect URIs=&lt;URI of your web client&gt;<br>
Client Protocol=openid-connect<br></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Implicit flow is no longer recommended. The standard flow should be used. Furthermore, the extension PKCE (Proof Key for Code Exchange Code) should be used (<a href=".#_authentication_code_flow_pkce">*Authentication Standard Flow with PKCE</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_configure_a_client"><a class="anchor" href="#_configure_a_client"></a><a class="link" href="#_configure_a_client">Configure a client</a></h5>
<div class="ulist">
<ul>
<li>
<p>To allow the client to access the <em>arveo</em> services, add the role arveo-service-user to the client.</p>
</li>
<li>
<p>Add token mappers to allow <em>arveo</em> to get information from the token<br></p>
<div class="ulist">
<ul>
<li>
<p>Tenant, the tenant in <em>arveo</em>. This is used to assign the user to a client.<br>
Name=Tenant<br>
Mapper-Type=User Attribute<br>
User Attribute=tenant<br>
Token Claim Name=tenant<br>
Claim JSON Type=String<br>
Multi Valued = Off<br>
Add To Id Token=On<br>
Add To Access Token=On<br>
Add To User Info=On<br></p>
</li>
<li>
<p>Audience for repository service, _arveo pays attention to access tokens from the score-client at all, the score-backend client must also be in the token as an audience<br>
Name=Audience for arveo services<br>
Mapper-Type=Audience<br>
Included Client Audience=arveo-webclient<br>
Add To ID Token=Off<br>
Add To Access Token=On</p>
</li>
<li>
<p>GUUID, important for authentication via LDAP. In the access token, the user_name attribute is set to the GUUID from the LDAP. This is largely stable, in contrast to the Keycloak internal user ID.<br>
Name=GUUID<br>
Mapper-Type=User Attribute<br>
User Attribute=LDAP_ID<br>
Token Claim Name=user_name<br>
Claim JSON Type=String<br>
Multi Valued = Off<br>
Add To Id Token=On<br>
Add To Access Token=On<br>
Add To User Info=On</p>
</li>
<li>
<p>Client ID, keycloak ClientID
Name=Client ID<br>
Mapper-Type=User Session Note<br>
User Attribute=clientid<br>
Token Claim Name=clientid<br>
Claim JSON Type=String<br>
Add To Id Token=On<br>
Add To Access Token=On</p>
</li>
<li>
<p>Client roles, is required for the _arveo services. The client needs the authority arveo-user-role to access the service. All roles from the client with the ClientID arveo-client are added to the claim authorities.
Name=client roles<br>
Mapper-Type=User Client Role<br>
User Attribute=LDAP_ID<br>
Multi Valued = On<br>
Token Claim Name=authorities<br>
Claim JSON Type=String<br>
Multi Valued = Off<br>
Add To Id Token=Off<br>
Add To Access Token=On<br>
Add To UserInfo = Off</p>
</li>
<li>
<p>Service user. is required to identify the user of the access token as a service user.
Name=Service user<br>
Mapper-Type=Script Mapper<br>
Script=exports=user.getUserName.startsWith("service-account");<br>
Multi Valued = Off<br>
Token Claim Name=technical-user<br>
Claim JSON Type=boolean<br>
Add To Id Token=On<br>
Add To Access Token=On<br>
Add To UserInfo = On</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_configure_keycloak_for_sso_with_kerberos"><a class="anchor" href="#_configure_keycloak_for_sso_with_kerberos"></a><a class="link" href="#_configure_keycloak_for_sso_with_kerberos">Configure Keycloak for SSO with Kerberos</a></h5>
<div class="ulist">
<ul>
<li>
<p>Configure Keycloak user federation for SSO with Active Directory using Kerberos</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/keycloak-ldap-mapper.png" alt="LDAP Mapper">
</div>
<div class="title">Figure 1. LDAP Mapping</div>
</div>
<div class="ulist">
<ul>
<li>
<p>2 additional LDAP mappers have to be added:</p>
<div class="ulist">
<ul>
<li>
<p>Adding the tenant to the user attributes, since the tenant does not come from the AD.<br>
Name: add-<em>arveo</em>-tenant<br>
Mapper Type: hardcoded-attribute-mapper<br>
User Model Attribute Name: tenant<br>
Attribute Value: master</p>
</li>
<li>
<p>The role so that the user is authorized to access the <em>arveo</em> services
Name: add-arveo_-user<br>
Mapper Type: hardcoded-ldap-role-mapper<br>
Role: arveo-service-user<br></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As soon as a user logs on to the _arveo web client application for the first time, the user is imported from the LDAP into Keyclaok. Users who are not in the LDAP can be created locally in the Keycloak.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configure Keycloak:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install package freeipa-client (Ubuntu)</p>
</li>
<li>
<p>Setup /etc/krb5.conf<br></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-config" data-lang="config">[libdefaults]
default_realm = &lt;your realm&gt;
# The following krb5.conf variables are only for MIT Kerberos.
kdc_timesync = 1
ccache_type = 4
forwardable = true
proxiable = true
# The following encryption type specification will be used by MIT Kerberos
# if uncommented. In general, the defaults in the MIT Kerberos code are
# correct and overriding these specifications only serves to disable new
# encryption types as they are added, creating interoperability problems.
#
# The only time when you might need to uncomment these lines and change
# the enctypes is if you have local software that will break on ticket
# caches containing ticket encryption types it doesn't know about (such as
# old versions of Sun Java).# default_tgs_enctypes = des3-hmac-sha1
# default_tkt_enctypes = des3-hmac-sha1
# permitted_enctypes = des3-hmac-sha1
# The following libdefaults parameters are only for Heimdal Kerberos.
fcc-mit-ticketflags = true
[realms]
YOURDOMAIN.COM={
kdc=yourdomaincontronler:port
}
[domain_realm]
yourdmain.com=YOURDOMAIN.COM
.yourdomain.com=YOURDOMAIN.COM</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>chown on arveo:arveo und chmod 600</p>
</li>
<li>
<p>Import the CA certificate to your Java truststore<br>
e.g. %javahome%/keytool -import -alias YourDomain.com -keystore truststore.jks -file ~/ca.pem</p>
</li>
<li>
<p>Activate Kerberos Single Sign On:<br>
To allow SSO set requirement for all Flow to ALTERNATIVE</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/keycloak-flows.png" alt="*Keycloak Flows*">
</div>
<div class="title">Figure 2. Keycloak Flows</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a non ldap test user in manage users<br>
Details:<br>
Name=TestUser<br>
User Enabled=On<br>
Attributes:<br>
LDAP_ID=&lt;new UUID&gt;<br>
Tenant=master<br>
Role Mappings=&lt;add arveo-service-user&gt;</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_authentication_between_content_services"><a class="anchor" href="#_configure_authentication_between_content_services"></a><a class="link" href="#_configure_authentication_between_content_services">Configure authentication between Content Services</a></h3>
<div class="paragraph">
<p>All <em>arveo</em> content services use <strong>Spring Security</strong> for user authentication and authorization. Spring Security supports several standardized protocols as well as custom implementations. The basic configuration is independent of the protocol used.</p>
</div>
<div class="paragraph">
<p>When configuring the service, it is important to consider the role that the service plays in the overall system. Some
services are only used by different clients and do not communicate with other services. These services only take the role of
a "resource server". Other services, such as the repository service, communicate with other services themselves and assume the
role of a "resource server" and a "client" at the same time.</p>
</div>
<div class="sect4">
<h5 id="_resource_and_client_configuration"><a class="anchor" href="#_resource_and_client_configuration"></a><a class="link" href="#_resource_and_client_configuration">Resource and client configuration</a></h5>
<div class="paragraph">
<p>The following configuration can be used to make a service an OAuth2.0 resource and/or an OAuth2.0 client in the service&#8217;s <em>application.yaml</em>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Client</th>
<th class="tableblock halign-left valign-top">Resource</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Document Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Management Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Control Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Audit Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAP Archive Link Service (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Document Conversion Service (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise User Management Service (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise Integration Service (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Federation Service (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_configure_resource"><a class="anchor" href="#_configure_resource"></a><a class="link" href="#_configure_resource">Configure resource</a></h5>
<div class="paragraph">
<p>Configure the respective <em>application.yaml</em> of the service like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">security:
  general:
    secured-ant-matchers: "/api/**"
    open-ant-matchers: "/actuator/health,/actuator/info"
    role-for-secured-access: "&lt;service - name&gt;"
    cors-configuration:
      allowed-origins: "*"
      allowed-headers: "*"
      allowed-methods: "GET,POST,PUT,PATCH,DELETE,OPTIONS"
      max-age: 3600

spring:
  security:
    oauth2:
      resourceserver:
        jwt:
# public key for user management service
#          public-key-location: "http://localhost:39002/oauth/public_key"
# public key location for keycloak
          jwk-set-uri: "http://localhost:8080/auth/realms/ecr/protocol/openid-connect/certs"</code></pre>
</div>
</div>
<div class="paragraph">
<p>(1) Generally, these parameters shouldn&#8217;t be changed.</p>
</div>
<div class="paragraph">
<p>(2) CORS defines a way in which a browser and server can interact to determine whether it is safe to allow the cross-origin request.</p>
</div>
</div>
<div class="sect4">
<h5 id="_configure_the_client"><a class="anchor" href="#_configure_the_client"></a><a class="link" href="#_configure_the_client">Configure the client</a></h5>
<div class="paragraph">
<p>Configure the respective <em>application.yaml</em> of the service like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  security:
    oauth2:
      client:
        registration:
          cmn-user-service-client-credentials:
            provider: user-service
            client-id: "arveo-service"
            client-secret: "my-secret"
            authorization-grant-type: "client_credentials"
            scope: "arveo"
        provider:
          user-service:
            authorization-uri: "http://localhost:39002/oauth/auth"
            token-uri: "http://localhost:39002/oauth/token"-----
          keycloak:
            authorization-uri: "http://localhost:8080/auth/realms/arveo/protocol/openid-connect/auth"
            token-uri: "http://localhost:8080/auth/realms/arveo/protocol/openid-connect/token"</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Parameter</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oauth2.resourceserver.jwt.public-key-location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validation key of the authentication service to validate the token. e.g. PEM or RSA Public Key. For keycloak <a href="#_create_keycloak_realm"><strong>Realm Settings Keys</strong></a>, for User management service see documentation on user-management/securing rest endpoints</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.general.role-for-secured-access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unique identifier of the service: see names of services in table below</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.security.oauth2.client.registration.cmn-user-service-client-credentials.client-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Id configured in your authentication service. In our keyckloak example: arveo-service,  <a href="#_configure_a_client"><strong>Client-ID</strong></a>, for User management service
see documentation on user management/client context/client ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.security.oauth2.client.registration.cmn-user-service-client-credentials.client-secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Your client secret of the authentication service. For keyckloak <a href="#_configure_a_client"><strong>Client Secret</strong></a>, for User management service
see documentation on user management/client context/client secret</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.security.oauth2.client.provider.user-service.authorization-uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">end point for user authorization</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.security.oauth2.client.provider.user-service.token-uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">end point to get an access token</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.security.oauth2.client.registration.cmn-user-service-client-credentials.scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope is always arveo</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>The public-key-location defines a path to a resource containing the public key of the service that issued the signed tokens. If the issuing service supports JSON Web Keys, the URL to the JWK endpoint can be set using jwk-set-uri.</p>
</li>
<li>
<p>To enable the user impersonation feature, add the following to the <em>application.yaml</em> configuration:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">    commons:
        security:
            oauth2:
                impersonation-enabled: true</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>It is possible to disable the auto configuration of the server components by setting spring.security.oauth2.resourceserver.enabled to false.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Troubleshooting some common error messages and ways to fix them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>principal cannot be null from OAuth2AuthorizeRequest: There probably was no Authentication in the application&#8217;s SecurityContext. Check if the application sets an Authentication.</p>
</li>
<li>
<p>Startup fails because no bean of type ClientRegistrationRepository was found: Check the configuration. This usually happens when the values in spring.security.oauth2.client are either missing or invalid. Check indentation!</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a><a class="link" href="#_troubleshooting">Troubleshooting</a></h4>
<div class="paragraph">
<p>Some common error messages and ways to fix them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Principal cannot be null from OAuth2AuthorizeRequest: There probably was no Authentication in the application&#8217;s SecurityContext. Check if the application sets an Authentication.</p>
</li>
<li>
<p>Startup fails because no bean of type ClientRegistrationRepository was found: Check the configuration. This usually happens when the values in spring.security.oauth2.client are either missing or invalid. Check indentation!</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_authentication-oauth2"><a class="anchor" href="#_authentication-oauth2"></a><a class="link" href="#_authentication-oauth2">OAuth2.0 Authentication</a></h3>
<div class="paragraph">
<p>All <em>arveo</em> services require authentication, ensuring that only another <em>arveo</em> service or an authenticated user can use the REST API. Authentication of a user is done by the either a authentication service like Keycloak or the <em>arveo</em> User Management Service.
The user context is passed to invoked services. Single Sign on is supported with OAuth2.0 and Open ID Connect.</p>
</div>
<div class="paragraph">
<p>The <em>arveo</em> User Management Service can also be used as an OAuth2.0 Authorization Server. The service can issue JSON web tokens that can be used to log in to services that are also secured with OAuth2.</p>
</div>
<div class="paragraph">
<p>This chapter describes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>how <em>arveo</em>'s content services act as an OAuth2.0 resource server for applications using the <em>arveo</em> REST API</p>
</li>
<li>
<p>how the <em>arveo</em> services use OAuth2.0 to authenticate to other services as a technical user.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All content services use Spring Security for user authentication and authorization. The services support OAuth2.0 with OpenID Connect.</p>
</div>
<div class="paragraph">
<p>Spring Security enables both the OAuth2.0 support for the service&#8217;s web resources and the OAuth2.0 client support. The content services retrieve a new OAuth2.0 token from the configured OAuth2.0 authorization service when a authentication is required.
This OAuth2.0 authorization service can either be the <em>arveo</em> user management service or Keycloak, Active Directory.</p>
</div>
<div class="sect3">
<h4 id="_oauth2_0_flows_grant_types"><a class="anchor" href="#_oauth2_0_flows_grant_types"></a><a class="link" href="#_oauth2_0_flows_grant_types">OAuth2.0 Flows (Grant types)</a></h4>
<div class="paragraph">
<p>OAuth2.0 defines four flows to get an access token. These flows are called grant types. <em>arveo</em> supports two flows for user authentication and service authentication.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client Credentials Flow: used for machine-to-machine content services communication.</p>
</li>
<li>
<p>Authorization Code Flow with Proof Key for Code Exchange (PKCE) technique: used by <em>arveo</em> Web Applications sand also used by mobile apps.</p>
</li>
<li>
<p>Resource Owner Password Flow: can be used by highly-trusted web apps.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following paragraphs we describe the flows. The authentication service can either be the <em>arveo</em> User Management Service or Keycloak. If you use Keycloak you must turn off <em>arveo</em> internal authentication service.</p>
</div>
</div>
<div class="sect3">
<h4 id="_client_credential_flow"><a class="anchor" href="#_client_credential_flow"></a><a class="link" href="#_client_credential_flow">Client Credential Flow</a></h4>
<div class="paragraph">
<p>Our machine-to-machine content services authenticate and authorize the app not an user. For this scenario, typical authentication schemes like username + password or social logins don&#8217;t make sense. Instead, the services use the Client Credentials Flow, in which they pass along their Client ID and Client Secret to authenticate themselves and get a token.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/auth-sequence-client-credentials.png" alt="*Credential Flow*">
</div>
<div class="title">Figure 3. Credential Flow</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>arveo</em> authenticates with Authorization Service using its Client ID and Client Secret (/oauth/token endpoint).</p>
</li>
<li>
<p>The Authorization Service validates the Client ID and Client Secret.</p>
</li>
<li>
<p>The Authorization Service responds with an Access Token.</p>
</li>
<li>
<p><em>arveo</em> can use the Access Token to call an API on behalf of itself.</p>
</li>
<li>
<p>The Service API responds with requested data.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_authentication_code_flow_pkce"><a class="anchor" href="#_authentication_code_flow_pkce"></a><a class="link" href="#_authentication_code_flow_pkce">Authentication Code Flow (PKCE)</a></h4>
<div class="paragraph">
<p>The <em>arveo</em> single-page web applications requests Access Tokens, some additional security concerns are posed that are not mitigated by the Authorization Code Flow alone. This is because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Native apps cannot securely store a Client Secret. Decompiling the app will reveal the Client Secret, which is bound to the app and is the same for all users and devices.</p>
</li>
<li>
<p>Single-page apps cannot securely store a Client Secret because their entire source is available to the browser.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Given these situations, OAuth 2.0 provides a version of the Authorization Code Flow which makes use of a Proof Key for Code Exchange (PKCE).</p>
</div>
<div class="paragraph">
<p>The PKCE-enhanced Authorization Code Flow introduces a secret created by the calling application that can be verified by the authorization server; this secret is called the Code Verifier. Additionally, the calling app creates a transform value of the Code Verifier called the Code Challenge and sends this value over HTTPS to retrieve an Authorization Code. This way, a malicious attacker can only intercept the Authorization Code, and they cannot exchange it for a token without the Code Verifier.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/auth-sequence-auth-code-pkce.png" alt="Authentication Code Flow">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The user clicks Login within the application.</p>
</li>
<li>
<p>The OAUTH2 java script SDK creates a cryptographically-random code_verifier and from this generates a code_challenge.</p>
</li>
<li>
<p>OAUTH2 java script SDK redirects the user to the authorization service (/authorize endpoint) along with the code_challenge.</p>
</li>
<li>
<p>The authorization service redirects the user to the login and authorization prompt.</p>
</li>
<li>
<p>The user authenticates using one of the configured login options and may see a consent page listing the permissions Auth0 will give to the application.</p>
</li>
<li>
<p>The authorization service stores the code_challenge and redirects the user back to the application with an authorization code, which is good for one use.</p>
</li>
<li>
<p>OAUTH2 jav script SDK sends this code and the code_verifier (created in step 2) to the Auth0 Authorization Server (/oauth/token endpoint).</p>
</li>
<li>
<p>The authorization service verifies the code_challenge and code_verifier.</p>
</li>
<li>
<p>The authorization server responds with an ID Token and Access Token (and optionally, a Refresh Token).</p>
</li>
<li>
<p>The <em>arveo</em> web application can use the Access Token to call an API to access information about the user.</p>
</li>
<li>
<p>The API responds with requested data.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_maintenance_mode_for_the_database_schema"><a class="anchor" href="#_maintenance_mode_for_the_database_schema"></a><a class="link" href="#_maintenance_mode_for_the_database_schema">Maintenance mode for the database schema</a></h4>
<div class="paragraph">
<p>This chapter documents the <em>arveo</em> parameters to start the database service, alter schema and stop the service.</p>
</div>
<div class="paragraph">
<p>The <em>arveo</em> can be started in a special mode that ensures, that this instance changes the schema and prevents other
instances from being started or have already been started. If the database schema change fails, the instance terminates
in a way that can be easily evaluated by the administrator to be able to react to this exception.</p>
</div>
<div class="paragraph">
<p>The service does not start if registry query returns other running instances. The service terminates after the liquibase
script is executed. The following two parameters are set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">system:
  terminateAfterCreation: true
  updateSchema: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>So the maintenance mode can be used to update the database schema. When the maintenance mode is enabled, the <em>arveo</em> starts,
performs necessary schema updates, and terminates once the schema was updated. Requests from clients are not processed
while the system is in maintenance mode. Clients will receive a HTTP 503 response code. Schema updates must be performed
by one single <em>arveo</em> instance to avoid race conditions. The recommended procedure for a schema update is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Shut down all <em>arveo</em> instances</p>
</li>
<li>
<p>If required: Update to a newer <em>arveo</em> version</p>
</li>
<li>
<p>Enable maintenance mode by setting system.maintenanceMode: true in the configuration</p>
</li>
<li>
<p>Start one single <em>arveo</em> instance and wait for it to shut down after the schema was updated</p>
</li>
<li>
<p>Disable maintenance mode in the configuration</p>
</li>
<li>
<p>Start all <em>arveo</em> instances.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The database schema of an existing system can be changed by adapting the type definition classes and restarting the
repository service with the setting <code>arveo.server.system.maintenance-mode=true</code>. The service will update the database
schema and shut down once the update is finished. It will not accept requests while the schema is updated.</p>
</div>
</div>
<div class="sect3">
<h4 id="_supported_schema_changes"><a class="anchor" href="#_supported_schema_changes"></a><a class="link" href="#_supported_schema_changes">Supported schema changes</a></h4>
<div class="paragraph">
<p>The following list contains the supported schema changes. Note that some changes like removing an attribute or adding
constraints might not be possible when the existing data or existing constraints might be violated by the change.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding a new attribute.</p>
</li>
<li>
<p>Removing an existing attribute. Note that the column will be dropped from the schema.</p>
</li>
<li>
<p>Adding and removing indexes as well as changing index properties.</p>
</li>
<li>
<p>Change the primary key (only for META types).</p>
</li>
<li>
<p>Adding and removing of foreign keys.</p>
</li>
<li>
<p>Add new content elements (only for DOCUMENT types).</p>
</li>
<li>
<p>Adding and removing unique constraints.</p>
</li>
<li>
<p>Adding and removing not-null constraints.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible to enable certain features on existing type definitions. Disabling the features is not supported.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enabling ACL support.</p>
</li>
<li>
<p>Enabling document filing.</p>
</li>
<li>
<p>Enabling optimistic locking.</p>
</li>
<li>
<p>Enabling the recycle bin.</p>
</li>
<li>
<p>Enabling retention support.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_checking_for_schema_changes"><a class="anchor" href="#_checking_for_schema_changes"></a><a class="link" href="#_checking_for_schema_changes">Checking for schema changes</a></h4>
<div class="paragraph">
<p>By setting the properties <code>arveo.server.system.maintenanceMode</code> and <code>arveo.server.system.logSchemaChanges</code> to true,
the system will start up, check for required schema changes, write them to a special log file, and shut down again.
The database schema will not be changed. This makes it possible to check for unsupported changes to the schema before
performing the actual schema update.</p>
</div>
<div class="paragraph">
<p>The directory used to store the schema update log can be specified using the property <code>arveo.server.system.schemaChangeLogDirectory</code>.
The default value is <code>logs</code>. The system will create one logfile for each tenant. The contents of the file will look like
the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Supported changes for attributes of type definition my_document:
	- document_name: IS_UNIQUE
	- container_id: FOREIGN_KEY, IS_UNIQUE

Unsupported changes for attributes of type definition my_document:
	- document_name: none
	- container_id: none</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, there are three supported changes for the type definition named <em>my_document</em>. A unique constraint
will be added to or removed from the attributes <em>container_id</em> and <em>document_name</em> and a foreign key will be added to or
removed from the attribute <em>container_id</em>. There are no unsupported changes, so the actual schema update should succeed.</p>
</div>
<div class="paragraph">
<p>Please note that there are some advanced schema checks that can only be done correctly when the types are actually stored
in the database. For example, the checks for the correctness of parent- and child- types of a relation type is not
possible when the schema update itself is skipped.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_audit"><a class="anchor" href="#_configure_audit"></a><a class="link" href="#_configure_audit">Configure audit</a></h3>
<div id="configure_audit" class="paragraph">
<p>A <code>@Type</code> may define to be audited. This means, that any write access i.e. any create, update and delete operation to any entity of this type will be logged into another table. This is done with the annotation <code>@Audit</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.CONTAINER)
@Audit(AuditLocation.TYPE_SPECIFIC) <i class="conum" data-value="1"></i><b>(1)</b>
public interface AuditedContainer {

    @Optional
    String getName();
    void setName(String name);

    @Optional
    Integer getInteger();
    void setInteger(Integer integer);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The annotation <code>@Audit</code> activates auditing on a type</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The name of the table to be audited to is derived from the table name of the given type, following the form <code>&lt;table-name&gt;_log</code>. You can choose to specify one audit table per entity table, or alternatively to audit to one global table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Type(ObjectType.DOCUMENT)
@Audit(
    value = AuditLocation.GLOBAL, <i class="conum" data-value="1"></i><b>(1)</b>
    indexOn = {AuditJsonField.CURRENT} <i class="conum" data-value="2"></i><b>(2)</b>
)
@Acls
public interface AuditedDocument {

    @Optional
    String getName();
    void setName(String name);

    @Optional
    Integer getInteger();
    void setInteger(Integer integer);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note a different <code>AuditLocation</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>with <code>indexOn</code> it is possible to specify on which json fields of the audit table indices should be set</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case the table to be audited to will be the <a href="https://nexus.eitco.de/repository/html-default/de.eitco.commons.audit/cmn-audit-parent/4.0.0/documentation/">audit services</a> default audit table <code>default_audit_log</code>.</p>
</div>
<div class="sect3">
<h4 id="_access_audit"><a class="anchor" href="#_access_audit"></a><a class="link" href="#_access_audit">Access audit</a></h4>
<div class="paragraph">
<p>To access the audit, the audit service provides a REST API. Access will be restricted depending on the type: If ACLs are activated on a <code>@Type</code>, only users that have read access to an entity will be allowed to audit this entity. If ACLs are deactivated on a <code>@Type</code>, only users with the <a href="#Basic functions of the user administration">authority</a> <code>AUDITOR</code> are allowed to audit the entities of this type.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solr"><a class="anchor" href="#_solr"></a><a class="link" href="#_solr">Solr</a></h3>
<div class="paragraph">
<p>In order to use Solr in connection with <em>arveo</em>, an installation of a Solr service is required. Under the
following link you can download the current versions of Solr: <a href="https://solr.apache.org/downloads.html" class="bare">https://solr.apache.org/downloads.html</a>.</p>
</div>
<div class="paragraph">
<p>The Solr service must be configured in <em>arveo</em> within the <em>application.yaml</em>. See
<a href="#_ecr_server_solr">Configuration properties</a> for details.</p>
</div>
<div class="paragraph">
<p>When a type definition is annotated with <code>@NOSql</code>, the entities stored in this type definition will be stored in
Solr, too. See <a href="#_entity_annotations_nosql_example">NOSQL Example</a> for how to enable this feature. The system
will create a special queue table in the relational database for such a type definition. The queue table will contain
the entities that have to be stored in Solr. A <a href="#_nosql_queue_job">system job</a> is used to process the
entries in the queue table.</p>
</div>
<div class="sect3">
<h4 id="_solr_deployment"><a class="anchor" href="#_solr_deployment"></a><a class="link" href="#_solr_deployment">Solr deployment</a></h4>
<div class="paragraph">
<p>A small tutorial for setting up Solr for <em>arveo</em>.</p>
</div>
<div class="sect4">
<h5 id="_arveo_yaml_configuration"><a class="anchor" href="#_arveo_yaml_configuration"></a><a class="link" href="#_arveo_yaml_configuration"><em>arveo</em> yaml configuration:</a></h5>
<div class="paragraph">
<p>In the following example you can see a minimal <em>arveo</em> yaml configuration for Solr:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">ecr:
  server:
    solr:
      defaultConfigName: "ecr-config"
      host: "http://localhost:38983/solr"
      username: "ecr-solr-user"
      password: "password"</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Collections will be created automatically from <em>arveo</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>More information you can find in the chapter <a href="#_ecr_server_solr">ecr.server.solr</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_solr_security"><a class="anchor" href="#_solr_security"></a><a class="link" href="#_solr_security">Solr security</a></h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
As default Solr has <strong>no security settings</strong> set. It is very important to add the security settings for Solr!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information for setting up the security settings for Solr you can go the chapter <a href="#_solr_security_configuration">solr security configuration</a></p>
</div>
<div class="paragraph">
<p>If you use the <em>arveo</em> acl functionallity you can setup the solr-acl-plugin. More information for the solr-acl-plugin you can find <a href="#_acl_filter_plugin">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_solr_configurations"><a class="anchor" href="#_solr_configurations"></a><a class="link" href="#_solr_configurations">Solr Configurations</a></h5>
<div class="paragraph">
<p>If you want to use solr with <em>arveo</em> you must upload a ecr-config to the Solr zookeeper. The ecr-config you can find at the following url
<a href="https://nexus.eitco.de/repository/maven-ecr-releases/de/eitco/ecr/ecr-environment-configuration/16.1.1/ecr-environment-configuration-16.1.1-solr.zip">nexus.eitco.de</a> as zip-file.<br></p>
</div>
<div class="paragraph">
<p>The zip-file you can upload to zookeeper with the following command on the command line interface.</p>
</div>
<div class="paragraph">
<p>Shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell script" data-lang="shell script">[path to zookeeper in solr]/zkcli.sh -cmd upconfig -confdir [path to solr-config from nexus.eitco.de]/solr-config -confname ecr-config -z [zookeeper host]:[zookeeper port]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Windows Shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[path to zookeeper in solr]\zkcli.bat -cmd upconfig -confdir [path to solr-config from nexus.eitco.de]\solr-config -confname ecr-config -z [zookeeper host]:[zookeeper port]</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_type_definitions"><a class="anchor" href="#_type_definitions"></a><a class="link" href="#_type_definitions">Type definitions</a></h6>
<div class="paragraph">
<p>You can annotate a type definition Class with @NOSql. If you do that every attribute in the type definition will be created as field in the Solr schema. If you want to deactivate an attribute of a type definition for Solr you can do the following:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you have a type definition which is using the annotation @NOSql you must setup a Solr instance. Otherwise, <em>arveo</em> will not start!
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@NOSql
public interface PersonSimple {
    String getFirstName();
    void setFirstName(String value);

    @NOSql(value = false)
    String getLastName();
    void setLastName(String value);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example only the firstname will be automatically created in the schema of Solr.</p>
</div>
</div>
<div class="sect5">
<h6 id="_fulltext_extraction"><a class="anchor" href="#_fulltext_extraction"></a><a class="link" href="#_fulltext_extraction">Fulltext Extraction</a></h6>
<div class="paragraph">
<p><em>arveo</em> automatically extracts the content of the type definitions which are annotated with <code>@Type(ObjectType.DOCUMENT)</code> and <code>@NOSql</code>. You must set up the documents conversion service for this functionality. At the following we describe the process of the automatic extraction of Solr:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Arveo saves the documents who are annotated with <code>@NOSql</code> in a queue table named <em>type_definition_name + _ng</em>;</p>
</li>
<li>
<p>Now a job will fetch all entry in the queue table;</p>
</li>
<li>
<p>For each entry which are annotated with <code>@Type(ObjectType.DOCUMENT)</code> arveo will call the document conversion service to extract the fulltext from the content;</p>
</li>
<li>
<p>At the end all information will be saved to Solr.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>More general information about the document service full text extraction can be found <a href="https://nexus.eitco.de/repository/html-default/de.eitco.commons/document-conversion-parent/0.0.10-SNAPSHOT/documentation/index.html#_extracting_text_from_a_pdf_file">here</a> and <a href="https://nexus.eitco.de/repository/html-default/de.eitco.commons/document-conversion-parent/0.0.10-SNAPSHOT/documentation/index.html#_fulltext_plugins">here</a>.</p>
</div>
<div class="paragraph">
<p>More general information about extracting text with arveo and Solr you can find at chapter <a href="#_fulltext_extraction_2">Fulltext extraction</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_solr_security_configuration"><a class="anchor" href="#_solr_security_configuration"></a><a class="link" href="#_solr_security_configuration">Solr security configuration</a></h4>
<div class="paragraph">
<p>By default, Solr does not use any kind of authorization or authentication. In productive systems, Solr must be secured
by enabling transport encryption, authentication and authorization.</p>
</div>
<div class="paragraph">
<p>The transport encryption can be enabled by enabling HTTPs in Solr. See the
<a href="https://solr.apache.org/guide/8_11/enabling-ssl.html">Solr documentation</a> for instructions. When SSL is enabled, the
url in the configuration property <code>ecr.server.solr.host</code> must use the <em>https</em> scheme.</p>
</div>
<div class="paragraph">
<p><em>arveo</em> can use basic authentication to authenticate requests sent to Solr. Solr provides a basic authentication
plugin that must be enabled as described in the <a href="https://solr.apache.org/guide/8_11/basic-authentication-plugin.html">documentation</a>.
Enabling authentication and authorization in Solr requires uploading a <em>security.json</em> file to Zookeeper. The following
example shows a security.json file that enables the basic auth plugin and a
<a href="https://solr.apache.org/guide/8_11/rule-based-authorization-plugin.html">rule based authorization plugin</a>.</p>
</div>
<div class="paragraph">
<p>There is a <a href="https://github.com/ansgarwiechers/solrpasswordhash">github project</a> containing a tool to generate the value
for the salt and password used in the credentials-property of the basic auth plugin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "authentication": {
    "blockUnknown": true,
    "class": "solr.BasicAuthPlugin",
    "credentials": {
      "ecr-solr-user": "qkxp6hmEeGTaqnEvSmH7f+qytLWd/JcwaUyqpdjt5rg= NERXZefDt7lXYvdZfB0hT3ZCgNFSqI4nJ7kGgbhaTWs="
    },
    "realm": "My Solr users",
    "forwardCredentials": false
  },
  "authorization": {
    "class": "solr.RuleBasedAuthorizationPlugin",
    "permissions": [
      {
        "name": "schema-edit",
        "role": "admin"
      },
      {
        "name": "update",
        "role": "admin"
      },
      {
        "name": "read",
        "role": [
          "user",
          "admin"
        ]
      }
    ],
    "user-role": {
      "ecr-solr-user": [
        "user",
        "admin"
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable basic auth support for the Solr client used by <em>arveo</em>, you have to set the following parameters in the
configuration for <em>arveo</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">ecr:
  server:
    solr:
      username: "ecr-solr-user"
      password: "password"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_acl_filter_plugin"><a class="anchor" href="#_acl_filter_plugin"></a><a class="link" href="#_acl_filter_plugin">ACL filter plugin</a></h4>
<div class="paragraph">
<p>When searching for ACL protected entities in Solr, the search result is filtered by ACL right. This is achieved by
using a custom Solr plugin, which must be installed manually by following the steps below. The Nexus repository
contains a ZIP file with the plugin and all required libraries.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the <code>cmn-user-management-access-control-solr-plugin</code> ZIP (version 7.0.0) from the <a href="https://nexus.eitco.de/repository/maven-public-releases/de/eitco/commons/cmn-user-management-access-control-solr-plugin/7.0.0/cmn-user-management-access-control-solr-plugin-7.0.0-zip.zip">nexus repository</a>.</p>
</li>
<li>
<p>Install the plugin in Solr by extracting the content of the downloaded ZIP file as described in the <a href="https://solr.apache.org/guide/8_11/solr-plugins.html#installing-plugins">Solr documentation</a>.</p>
</li>
<li>
<p>Configure the plugin in <code>solrconfig.xml</code> as shown below:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;queryParser name="aclright" class="de.eitco.commons.user.management.access.control.solr.AclRightParserPlugin"&gt;
    &lt;str name="solrAclPlugin.jdbcUrl"&gt;jdbc:postgresql://localhost:5432/mydatabase?currentSchema=mytenant&lt;/str&gt;
    &lt;str name="solrAclPlugin.jdbcUser"&gt;myuser&lt;/str&gt;
    &lt;str name="solrAclPlugin.jdbcPassword"&gt;mypassword&lt;/str&gt;
&lt;/queryParser&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin requires a JDBC connection to the relational database to load ACL rights. Do not change the name of the
query parser. Solr queries generated by arveo will contain a filter query using the <code>aclright</code> prefix to
perform the actual filtering.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Access Control Solr Plugin does not yet support multiple tenants!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, the configuration parameters for the ACL filter plugin can be set as Java system properties for the
Solr server, as environment variables, or they can be stored as secrets in Vault. To use Vault, set the following
parameters either in the <code>solrconfig.xml</code> file, as Java system properties, or as environment variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>solrAclPlugin.vaultEnabled=true</code></p>
</li>
<li>
<p><code>solrAclPlugin.vaultAddress=https://myvaultserver:port</code> (optional, the default value is "http://127.0.0.1:8200")</p>
</li>
<li>
<p><code>solrAclPlugin.vaultToken=token</code> (optional, can be a token value or the path to a token file. By default, the plugin
will try to load a token from ~/.vault-token)</p>
</li>
<li>
<p><code>solrAclPlugin.vaultSecretEnginePath=path</code> (optional, the default is "secret")</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The order in which the plugin loads configuration properties is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Vault</p>
</li>
<li>
<p>System properties</p>
</li>
<li>
<p>Environment variables</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_storing_entities_in_solr"><a class="anchor" href="#_storing_entities_in_solr"></a><a class="link" href="#_storing_entities_in_solr">Storing entities in Solr</a></h4>
<div class="paragraph">
<p>To be able to use Solr for advanced queries, the entities must be stored in Solr, too. To enable this, simply add the
<code>@NOSql</code> annotation to the attributes to be stored in Solr to the getters of your type definitions. The annotation can
be added to the class to store all attributes in Solr. <em>arveo</em> will automatically create the required fields
in the Solr schema. All entities of one tenant will be stored in a single collection in Solr. To avoid name collisions,
the names of the fields in Solr will consist of the name of the type definition and the name of the attribute, separated
by a dot. For example, an attribute called "name" in a type definition called "invoice" would be named "invoice.name".</p>
</div>
</div>
<div class="sect3">
<h4 id="_fulltext_extraction_2"><a class="anchor" href="#_fulltext_extraction_2"></a><a class="link" href="#_fulltext_extraction_2">Fulltext extraction</a></h4>
<div class="paragraph">
<p>It is also possible to store fulltext data of the content of documents in Solr. For this, set the <code>fulltextExtraction</code>
attribute of the <code>@ContentElement</code> annotation to true (see <a href="#_configure_storage_locations">Content Elements</a>). The
fulltext data of the content elements will be stored in a field called
<code>&lt;typeDefinitionName&gt;.&lt;contentElementName&gt;.fulltext</code> in Solr. This field can be used in queries
just like any other field.</p>
</div>
<div class="paragraph">
<p>The fulltext extraction is performed by the document conversion service. Which types of content are supported for
fulltext extraction depends on the active plugins of the document conversion service. The open source plugins contained
in the document conversion service project support fulltext extraction for PDFs with text content and Microsoft Office
documents. The mime type of a content element is required for the fulltext extraction. By default, the mime type is
contained in the metadata of a content element. When the content element is stored in a separate field on the
database, the mime type is not available in the metadata but it can be defined in the <code>@ContentElement</code> annotation. If
the mime type is set to the default value (application/octet-stream), the service will try to auto-detect the mime type.</p>
</div>
</div>
<div class="sect3">
<h4 id="_searching_in_solr"><a class="anchor" href="#_searching_in_solr"></a><a class="link" href="#_searching_in_solr">Searching in Solr</a></h4>
<div class="paragraph">
<p>The <em>arveo</em> API provides methods to perform queries in Solr. The methods use the EQL just like the regular
search methods that perform queries on the relational database. There are some EQL features that are not supported
when searching in Solr:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>joins and unions</p>
</li>
<li>
<p>subselects</p>
</li>
<li>
<p>exists expressions</p>
</li>
<li>
<p>toLower</p>
</li>
<li>
<p>less than</p>
</li>
<li>
<p>greater than</p>
</li>
<li>
<p>is null</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The behavior of the supported query expressions is dependent from the configuration of the field in Solr. For example,
a text field with a tokenizer that splits text by whitespaces will deliver different results for equality expressions
than a text field without such a tokenizer.</p>
</div>
<div class="paragraph">
<p>To perform a query in Solr for one specific type definition, use the <code>getNoSqlSearchService</code> method of the service client
for the type definition. In the following example, this method is used to find an entity by its ID in Solr:</p>
</div>
<div class="listingblock">
<div class="title">Searching for an entity by ID in Solr</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Optional&lt;TypedNOSqlSearchHit&lt;FieldTypeContainer&gt;&gt; optional = serviceClient.getNoSqlSearchService()
    .where().id().equalTo().value(identifier).holds().uniqueResult();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example shows how to search in the fulltext data stored in Solr.</p>
</div>
<div class="listingblock">
<div class="title">Searching for fulltext data in Solr</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">list = serviceClient.getNoSqlSearchService().where().contextReference(SimpleInvoiceNames.CONTENT_FULLTEXT)
    .contains().value("Gubergren accumsan takimata").holds().unpaged();</code></pre>
</div>
</div>
<div class="paragraph">
<p>To search for values in a specific field, the correct field name must be used in the context reference. The auto-
generated name constant classes for the type definition interfaces contain a helper method to compute the name.
The following example shows how to use this method to search in a specific field of an entity.</p>
</div>
<div class="listingblock">
<div class="title">Searching for data in Solr using a specific field</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">list = serviceClient.getNoSqlSearchService().where()
    .contextReference(FieldTypeContainerNames.noSqlName(FieldTypeContainerNames.INTEGER_FIELD))
    .equalTo().value(7).holds().unpaged();</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the <code>getNoSqlSearchService</code> method, the query performed in Solr will automatically be limited to entities
belonging to one single type definition. In this case, it is not necessary to use the helper method from the generated
name constant class to compute the name. The service is able to automatically compute the corret name. To search for
entities in multiple type definitions, the method <code>de.eitco.ecr.sdk.SearchClient.searchServiceForNoSql</code> can be used.</p>
</div>
</div>
<div class="sect3">
<h4 id="_combined_search"><a class="anchor" href="#_combined_search"></a><a class="link" href="#_combined_search">Combined search</a></h4>
<div class="paragraph">
<p><em>arveo</em> creates a special multi-valued field called <code>ecr_attributes</code> in Solr. When a getter (or an entire
interface) is annotated with <code>@NOSql(combinedSearch = true)</code>, the attribute of the getter (or all attributes of the interface)
will be copied in this field. The <code>ecr_attributes</code> field is of type string. The values of the attributes copied into
this field, will be converted automatically by Solr.</p>
</div>
<div class="paragraph">
<p>The <code>ecr_attributes</code> field can be used for a combined search of all attribute values. This makes it possible to provide
a search method where the user does not need to know the name of the attribute to search for:</p>
</div>
<div class="listingblock">
<div class="title">Performing a combined search</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Optional&lt;TypedNOSqlSearchHit&lt;SimpleInvoice&gt;&gt; hit =
    serviceClient1.getNoSqlSearchService().where().noSqlCombinedField().equalTo()
        .value(invoiceNumber).holds().uniqueResult();
Optional&lt;TypedNOSqlSearchHit&lt;SimpleInvoice&gt;&gt; hit =
    serviceClient1.getNoSqlSearchService().where().noSqlCombinedField().equalTo()
        .value(invoiceNumber).and().noSqlCombinedField().equalTo().value("29.99").holds().uniqueResult();
Optional&lt;TypedNOSqlSearchHit&lt;SimpleInvoice&gt;&gt; hit =
    serviceClient1.getNoSqlSearchService().where().noSqlCombinedField().like()
        .value("Kasd invidunt stet dolor")
        .and().contextReference(EcrQueryLanguage.COMBINED_SEARCH_FIELD).equalTo().value(invoiceNumber)
        .holds().uniqueResult();</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to copy the extracted fulltext data of content elements to the combined <code>ecr_attributes</code> field, too. To
do so, configure the respective content element as shown below:</p>
</div>
<div class="listingblock">
<div class="title">Using combined search for extracted fulltext data</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ContentElement(name = "pdf", contentType = "application/pdf", fulltextExtraction = true, textCombinedSearch = true, textCombinedSearchLimit = 200)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The relevant settings are <code>textCombinedSearch=true</code>, which enables the copying of the extracted fulltext data. The
<code>textCombinedSearchLimit</code> setting limits the number of characters to copy. This makes it possible to reduce the size of
the Solr index. A value of <code>0</code> means no limit.</p>
</div>
</div>
<div class="sect3">
<h4 id="_relations_in_solr"><a class="anchor" href="#_relations_in_solr"></a><a class="link" href="#_relations_in_solr">Relations in Solr</a></h4>
<div class="paragraph">
<p>Relations between entities can be described using relation type definitions. While those relations can be easily
resolved in the relational database, NoSQL databases like Solr are not designed to support a relational data model as
shown in the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="relation-type-model.png" alt="relation type model" width="780" height="140">
</div>
<div class="title">Figure 4. A model using a relation table</div>
</div>
<div class="paragraph">
<p>It is still possible to search for <em>Parent</em> entities by the IDs of the related <em>Child</em> entities in Solr using
arveo. To make this possible arveo stores the IDs of the <em>Child</em> entities related to a <em>Parent</em>
entity in a multi value field in Solr. To enable this feature, the type definition interface of the <em>Parent</em> type
must be annotated with <code>@NOSqlResolvedRelations</code>. The annotation requires a parameter containing the type definition
classes of the relations to store in Solr.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Only relations from the current version of the <em>Parent</em> entity to the current version of the <em>Child</em> entity can be
stored in Solr.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how to search for entities by related child IDs:</p>
</div>
<div class="listingblock">
<div class="title">Searching for relation child IDs in Solr</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">List&lt;TypedNOSqlSearchHit&lt;SimpleInvoice&gt;&gt; list = documentServiceClient.getNoSqlSearchService().where() <i class="conum" data-value="1"></i><b>(1)</b>
    .contextReference(noSqlSearchHelper.getRelationChildIdsField(SimpleInvoice.class, InvoicePersonRelation.class)) <i class="conum" data-value="2"></i><b>(2)</b>
    .contains().value(containerClient.getIdentifier()).holds().unpaged(); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtain a NoSql search service from the service client for the <em>Parent</em> entity type definition</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using an (injectable) instance of <code>NoSqlSearchHelper</code> it is possible to get the name of the field containing the
child IDs in Solr</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get the ID of the child entity to search for from the entity client of the relation child entity</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_rebuilding_the_solr_index"><a class="anchor" href="#_rebuilding_the_solr_index"></a><a class="link" href="#_rebuilding_the_solr_index">Rebuilding the Solr index</a></h4>
<div class="paragraph">
<p>Currently, there is no automated way to rebuild the Solr index. If the data in Solr was lost or corrupted, it can be
rebuilt using the NOSql queue tables of the affected type definitions.</p>
</div>
<div class="paragraph">
<p>When an entity is added or updated in a type
definition that is annotated with <code>@NOSql</code>, an entry for this entity is added to a queue table by a trigger on the
database. This queue table is named like the main table for the type definition with a <code>_nq</code> suffix. So for example,
if the main table is called <code>my_type_definition</code>, the queue table would be called <code>my_type_definition_nq</code>. It contains
a column for each attribute that is supposed to be contained in Solr and the following system fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nosql_queue_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the entry in the queue. This value is assigned automatically by the database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nosql_processing_counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A counter that is incremented each time the system has tried to store the entry in Solr. The initial value is supposed
 to be 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nosql_trigger_operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the operation that caused the entry to be added to the queue table. Could be INSERT, UPDATE or DELETE.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A system job periodically reads the entries contained in the queue table and stores them in Solr. When the entry was
successfully stored in Solr, it is deleted from the queue. If the entry could not be stored in Solr, the processing
counter is incremented and the job will try again until the maximum number of tries has been reached.</p>
</div>
<div class="paragraph">
<p>To rebuild the Solr index, the data to be stored in Solr has to be added to the queue table by copying the data
contained in the main table of the type definition. By definition, only the most recent version of each entity is
contained in Solr, so the data contained in the version table of the type definition is of no interest here. The
value of the <code>nosql_processing_counter</code> field must be set to 0. To treat the entity as a new object in Solr, set the
value of the <code>nosql_trigger_operation</code> field to <code>INSERT</code>. To perform an update on an already existing object in Solr,
set the value to <code>UPDATE</code>.</p>
</div>
<div class="paragraph">
<p>The code of the trigger function used to populate the queue table might be useful when creating the SQL script that
copies the entries. The trigger function is called like the main table of the type definition with a <code>_ntf</code> suffix.</p>
</div>
<div class="paragraph">
<p>When the type definition makes use of the <code>@NOSqlResolvedRelations</code> annotation, an additional field containing the
resolved IDs of the child entities of the relations on each entity will be contained in the queue table. This field
will be called <code>relation_&lt;type-id&gt;_child_ids</code> where <code>type-id</code> is the numeric ID of the relation type definition. This
ID can be found in the <code>ecr_types</code> table. To store the resolved child IDs in Solr, additional entries for each entity
containing the entity ID, the resolved child IDs, the update counter and the trigger operation are added to the queue
table. Note that the value for the trigger operation field must be set to <code>UPDATE</code> in this case.
The resolved child IDs can be copied from the table containing the relation. The <code>parent_id</code> field in this table will
contain the ID of the entity that is to be stored in Solr. The <code>child_id</code> field contains the IDs of the related child
entities.</p>
</div>
<div class="paragraph">
<p>The code of the trigger function used to populate the queue with the entries containing the resolved child ID might be
useful when writing the SQL script to copy these values. The trigger function will be called like the main table of
the relation type definition with a <code>_nrtf</code> suffix.</p>
</div>
<div class="sect4">
<h5 id="_example_scripts"><a class="anchor" href="#_example_scripts"></a><a class="link" href="#_example_scripts">Example scripts</a></h5>
<div class="paragraph">
<p>The following examples show how to copy data to the queue table. The main table of the type definition in the example
is called <code>test_simple_invoice</code>.</p>
</div>
<div class="listingblock">
<div class="title">copying data from the main table to the queue table</div>
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">insert
    into
    "test_simple_invoice_nq"(
        "version_number",
        "latest_version_id",
        "version_comment",
        "initial_creation_date",
        "creator_user_id",
        "retention_date",
        "modification_user_id",
        "creation_date",
        "update_counter",
        "last_delete_restore_date",
        "litigation_hold",
        "deleted",
        "parent_id",
        "modification_date",
        "id",
        "acl_id",
        "amount",
        "invoice_number",
        "nosql_processing_counter",
        "nosql_trigger_operation"
    )
select
    "version_number",
    "latest_version_id",
    "version_comment",
    "initial_creation_date",
    "creator_user_id",
    "retention_date",
    "modification_user_id",
    "creation_date",
    "update_counter",
    "last_delete_restore_date",
    "litigation_hold",
    "deleted",
    "parent_id",
    "modification_date",
    "id",
    "acl_id",
    "amount",
    "invoice_number",
    0,
    'INSERT'
from "test_simple_invoice";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">copying the resolved child IDs to the queue table</div>
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">insert
    into
    "test_simple_invoice_nq"(
        "id",
        "relation_32877_child_ids",
        "nosql_processing_counter",
        "nosql_trigger_operation"
    )
select distinct
    a."parent_id",
    array(select b."child_id" from "test_invoice_person_relation" b
        where b."parent_id" = a."parent_id" and b."parent_version_id" is null),
    0,
    'UPDATE'
from "test_invoice_person_relation" a;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_system_jobs"><a class="anchor" href="#_system_jobs"></a><a class="link" href="#_system_jobs">System jobs</a></h3>
<div class="paragraph">
<p>The <em>arveo</em> system uses several background jobs to perform essential functions. These jobs are managed by
a clustered <a href="http://www.quartz-scheduler.org/">Quartz scheduler</a> running inside the repository service and/or in a dedicated job service. The scheduler
instances are synchronized using the database. The repository service creates the jobs and initial trigger configurations
when the system is started for the first time. Afterwards, it is possible to modify the scheduled jobs manually.</p>
</div>
<div class="paragraph">
<p>By default, the scheduler embedded in the repository service is used to create and to execute the jobs. Dedicated job
service instances configured to use the same database as the repository service can be used to execute the jobs as well.
It is also possible to start the scheduler embedded in the repository service in standby mode. In standby mode, the
repository service will create the jobs (if required), but it will not execute them.</p>
</div>
<div class="paragraph">
<p>The available configuration parameters for the scheduler are listed here: <a href=".#_job-service">Job service</a></p>
</div>
<div class="paragraph">
<p>The available configuration parameters for the jobs are listed here: <a href=".#_ecr_server_jobs">Job configuration</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the jobs are executed in the external Job Service, it is required to configure the user and the password
to be used for the jobs. The user has to own the required authorities to execute the jobs: <code>ECR_PURGE_RECOVERY_TABLE</code>
and the authority configured in <em>security.general.role-for-secured-access</em> (by default <code>ECR_SERVICE_USER</code>). When the
jobs are executed in the scheduler embedded in the repository service, an internal authentication mechanism is used and
no additional configuration is required.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_clean_recovery_table_job"><a class="anchor" href="#_clean_recovery_table_job"></a><a class="link" href="#_clean_recovery_table_job">Clean recovery table job</a></h4>
<div class="paragraph">
<p>The expired entries in the recovery table (see <a href="#_recovery_log">Recovery</a>) are deleted by the
clean recovery table job. By default, the job is triggered every day at 3 a.m. The user configured to execute the system
jobs needs to have the <code>ECR_PURGE_RECOVERY_TABLE</code> authority to be able to perform this operation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_nosql_queue_job"><a class="anchor" href="#_nosql_queue_job"></a><a class="link" href="#_nosql_queue_job">NOSQL queue job</a></h4>
<div class="paragraph">
<p>Data that is supposed to be stored in the SOLR NOSQL database is stored in dedicated queue tables in the relational
database used by <em>arveo</em>. The NOSQL queue job is used to read the data from the queue tables and to write
it to SOLR. By default the job is scheduled once a second individually for every queue table in the system. It is
possible to configure the number of entries to process in one run of the job as well as the maximum number of attempts
to write the data to SOLR.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the NOSQL feature is disabled for a type definition, the queue job and the triggers for the queue job
have to be disabled or removed manually from the scheduler.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_using_external_job_service_instances"><a class="anchor" href="#_using_external_job_service_instances"></a><a class="link" href="#_using_external_job_service_instances">Using external Job Service instances</a></h4>
<div class="paragraph">
<p>It is possible to use one or more external Job Service instances to execute the scheduled system jobs. The service must
be configured to use the same tenants as the repository service. To be able to execute the system jobs,
the job implementations must be present in each of the Job Service&#8217;s class paths. The jobs are available as a ZIP
file (<em>ecr-packaging-jobs-external&lt;version&gt;.zip</em>) that contains all required libraries. Simply extract the contents of
the ZIP file to a directory (e.g. <em>libs</em>) and start the Job Service with the following parameter:
<code>-Dloader.path=libs</code>.</p>
</div>
<div class="paragraph">
<p>The configuration parameters for the jobs are already configured in the database. No further configuration parameters
for the jobs are required in the Job Service&#8217;s configuration. However, the service must be able to authenticate to
the repository service. As the jobs use a username and password to obtain an access token, the service needs OAuth
client registrations both for the <em>client_credentials</em> and for the <em>password</em> grant types. The following example shows
how to configure two client registrations for the service:</p>
</div>
<div class="listingblock">
<div class="title">OAuth client registrations</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: "http://localhost:39004"
      client:
        registration:
          autorization-service-client-credentials:
            provider: authorization-service
            client-id: "changeit"
            client-secret: "changeit"
            authorization-grant-type: "client_credentials"
          authorization-service-password:
            provider: authorization-service
            client-id: "changeit"
            client-secret: "changeit"
            authorization-grant-type: "password"
        provider:
          authorization-service:
            issuer-uri: "http://localhost:39004"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The username and password to use for the jobs can be configured using the following parameters. Note that these parameters
are added to the job configuration data stored for the triggers in the database used by the scheduler. Because these triggers
are created by the scheduler running in the Repository Service (even if this scheduler is set to standby mode), the job
authentication parameters must be configured for the Repository Service.</p>
</div>
<div class="listingblock">
<div class="title">Job user authentication</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">ecr:
  server:
    jobs:
      username: "username"
      password: "password"</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the scheduler included in the repository service instances will be used to execute the scheduled jobs, too.
When the scheduler in the repository service is started in standby mode, only the external Job Service instances will
execute the scheduled jobs. The following configuration can be used to start the repository service with a scheduler in
standby mode:</p>
</div>
<div class="listingblock">
<div class="title">Scheduler in standby mode</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">job-service:
  standbyOnlyScheduler: true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hashicorp_vault"><a class="anchor" href="#_hashicorp_vault"></a><a class="link" href="#_hashicorp_vault">Using Hashicorp Vault</a></h3>
<div class="paragraph">
<p><a href="https://www.vaultproject.io/">Hashicorp Vault</a> can be used to store sensitive configuration parameters like database
passwords or encryption master keys. Each <em>arveo</em> service tries to load configuration data from a Vault
instance at startup. To configure the location and access method for Vault, the following application arguments can
be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spring.cloud.vault.host</code>: Defines the host name of the Vault host.</p>
</li>
<li>
<p><code>spring.cloud.vault.port</code>: Sets the port used to connect to Vault.</p>
</li>
<li>
<p><code>spring.cloud.vault.scheme</code>: Either https or http</p>
</li>
<li>
<p><code>spring.cloud.vault.authentication</code>: Sets the authentication mechanism to use.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
These properties cannot be configured using the Configuration Service. Configuration data from the Configuration Service
is loaded after the connection to Vault has been established. Instead, these properties must be set as application
parameters. Example: <code>java -jar service.jar --spring.cloud.vault.port=8200</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to disable the Vault integration by setting <code>spring.cloud.vault.enabled=false</code>.</p>
</div>
<div class="paragraph">
<p>Additional information about the configuration parameters, especially the possible authentication mechanisms, can be
found in the <a href="https://docs.spring.io/spring-cloud-vault/docs/current/reference/html/#client-side-usage">Documentation</a> of
the Spring Cloud Vault project.</p>
</div>
<div class="sect3">
<h4 id="_defining_secrets"><a class="anchor" href="#_defining_secrets"></a><a class="link" href="#_defining_secrets">Defining secrets</a></h4>
<div class="paragraph">
<p>Vault features several ways to provide secrets to applications. Configuration properties for the <em>arveo</em>
services must be stored in the key value secrets engine. Each secret consists of a <em>path</em> and several <em>key-value-pairs</em>.
The path defines the scope of the property. It can either be set to <code>application</code> to store a secret for all services,
or to the name of the service just like the name of the configuration files in the Configuration Service. For example,
to configure the password of the JDBC datasource used by all services, a key-value-pair of <code>spring.datasource.password=password</code>
would be stored under the path <code>application</code>. A property for the repository service (ecr-service) would be stored
in a key-value-pair <code>property=value</code> under the path <code>ecr-service</code>. The following table contains the application names
of the different services.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Application name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repository Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">content-repository-service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Management Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user-management-service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Management Access Control Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user-management-access-control-service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise User Management Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user-management-enterprise-service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Document Conversion Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">document-conversion-service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">administration-service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Audit Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">audit-service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integration Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integration-service</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_properties"><a class="anchor" href="#_configuration_properties"></a><a class="link" href="#_configuration_properties">Configuration Properties</a></h3>
<div class="sect3">
<h4 id="_commons_cache"><a class="anchor" href="#_commons_cache"></a><a class="link" href="#_commons_cache">commons.cache</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache-settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Map&lt;java.lang.String,de.eitco.commons.spring.cache.CommonsCacheSettings&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains configuration properties for an individual cache.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messaging-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to false, the caches will not register JMS listeners and will not send any messages.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics-name-prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the name prefix for the metrics.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">commons.cache</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">record-statistics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the underlying caffeine caches will record statistics.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send-clear-messages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the caches will send clear messages.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send-evict-messages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the caches will send evict messages.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send-invalidate-messages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the caches will send invalidate messages.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_commons_security_oauth2"><a class="anchor" href="#_commons_security_oauth2"></a><a class="link" href="#_commons_security_oauth2">commons.security.oauth2</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock-skew</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the maximum acceptable clock skew used when checking the expiration time of an access- or refresh-token.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default-client-credentials-client-registration-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the default client registration ID to use for the client_credentials grant. Only relevant if there is more than one client registration for this grant type.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default-password-client-registration-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the default client registration ID to use for the password grant. Only relevant if there is more than one client registration for this grant type.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enforce-audience</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, the server will only accept tokens which contain the service&#8217;s application name in the aud claim.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-user-management.database.cache-max-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the time after which an entry in the cache is expired.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">365d</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-user-management.database.cache-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum number of entries in the cache.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-user-management.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, user information will not be loaded from the arveo user management service. All information required for a valid user authentication must be contained in the token.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-user-management.oidc.authorities-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the claim that contains the user&#8217;s authorities. Must be a JSON list of strings or a single string.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">authorities</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-user-management.oidc.email-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the claim that contains the email address of the user.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-user-management.oidc.fetch-user-info</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, the OIDC user info endpoint will be used to fetch user attributes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-user-management.oidc.user-name-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the claim that contains the name of the user.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">preferred_username</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-user-management.oidc.uuid-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the claim that contains the UUID of the user. See {@link java.util.UUID#fromString(String)}.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-user-management.user-properties-cache-max-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the time after which an entry in the cache for the external user attributes loaded using a {@link ExternalUserPropertiesResolver} will be expired.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-user-management.user-properties-cache-max-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the maximum number of entries in the cache used for the external user properties loaded using a {@link ExternalUserPropertiesResolver}.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forward-tokens</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, the OAuth2 client will forward the bearer token from the current request context for subsequent requests to other services. If no request context is available of if the request context does not contain a bearer token, the client will retrieve a new token using the configured client registration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">impersonation-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disabled the impersonation feature.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jwt-converter.scope-authority-prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The prefix that will be added to authority names when the authority was defined using an OAuth2 scope.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SCOPE_</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">original-user-token-required-for-impersonation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, impersonation is possible only when a token issued to the user to impersonate is contained in the X-User-Token header.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">refresh-tokens-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables the usage of refresh tokens to renew an expired access token.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the ID of the protected resource. The audience claim of a token must contain this ID. If not set, the name of the spring application is used instead.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_client_caching"><a class="anchor" href="#_ecr_client_caching"></a><a class="link" href="#_ecr_client_caching">ecr.client.caching</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type-definitions.expire-seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time in seconds after which an entity in the cache will be expired.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">900</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type-definitions.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of entities in the cache.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_client_stream"><a class="anchor" href="#_ecr_client_stream"></a><a class="link" href="#_ecr_client_stream">ecr.client.stream</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file.directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.io.File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The directory used to store the temporary files.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file.prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The prefix to use for the names of the temporary files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">temp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file.suffix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The suffix to use for the names of the temporary files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.dat</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file.threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size of the file in bytes from which on a temporary file will be used for buffering.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">131072</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_sdk"><a class="anchor" href="#_ecr_sdk"></a><a class="link" href="#_ecr_sdk">ecr.sdk</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type-definition-cache-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables the cache for the type definitions in the SDK.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_caching"><a class="anchor" href="#_ecr_server_caching"></a><a class="link" href="#_ecr_server_caching">ecr.server.caching</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">content-access-tokens.expire-after</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time after which an entity in the cache will be expired.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">content-access-tokens.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of entities in the cache.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default-acls.expire-after</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time after which an entity in the cache will be expired.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default-acls.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of entities in the cache.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enums.expire-after</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time after which an entity in the cache will be expired.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enums.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of entities in the cache.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type-definition-access.expire-after</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time after which an entity in the cache will be expired.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type-definition-access.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of entities in the cache.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type-definitions.expire-after</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time after which an entity in the cache will be expired.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type-definitions.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of entities in the cache.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_content-access-tokens"><a class="anchor" href="#_ecr_server_content-access-tokens"></a><a class="link" href="#_ecr_server_content-access-tokens">ecr.server.content-access-tokens</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alias</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The alias of the certificate used to sign the tokens.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key-password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the alias.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key-store-password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the keystore.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key-store-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The absolute path to the keystore that contains the certificate used to sign the tokens.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key-store-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the keystore (e.g. PKCS12, JKS&#8230;&#8203;)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max-token-lifetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum allowed lifetime of the generated tokens.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1d</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_http"><a class="anchor" href="#_ecr_server_http"></a><a class="link" href="#_ecr_server_http">ecr.server.http</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file.directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.io.File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The directory used to store the temporary files.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file.prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The prefix to use for the names of the temporary files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">temp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file.suffix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The suffix to use for the names of the temporary files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.dat</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file.threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size of the file in bytes from which on a temporary file will be used for buffering.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">131072</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_jobs"><a class="anchor" href="#_ecr_server_jobs"></a><a class="link" href="#_ecr_server_jobs">ecr.server.jobs</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clean-recovery-table.cron-expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the CRON expression used to schedule the job.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 0 3 * * ?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clean-recovery-table.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to false, the job will not be scheduled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jms-statistics.cron-expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the CRON expression used to schedule the job.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/15 * * * * ?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jms-statistics.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to false, the job will not be scheduled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jms-statistics.jms-receive-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the time the job will wait for a reply from the message broker.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no-sql-queue.batch-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the number of entries to load from the queue table in one batch.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no-sql-queue.cron-expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the CRON expression used to schedule the job.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/1 * * * * ?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no-sql-queue.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to false, the job will not be scheduled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no-sql-queue.retries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum number of attempts to write an entry in the queue to solr.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the password of the user used to run the jobs.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retention-cleanup.global-settings.asynchronous</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, content of documents will be removed from the storage asynchronously using a message queue. The database entries will not be removed but marked as deleted using the COMPLIANCE_DELETED field.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retention-cleanup.global-settings.batch-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the size of a single batch of entities processed by the job.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retention-cleanup.global-settings.max-message-queue-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum acceptable size of the message queues used by the job. Checked when the job is started. If the size of one of the queues exceeds the limit, the job is cancelled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retention-cleanup.global-settings.max-runtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum acceptable runtime for the job. When the time is exceeded, the job is cancelled.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retention-cleanup.global-settings.purge-content</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, all content elements of a document and all it&#8217;s versions will be deleted.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retry-renditions.batch-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the number of document versions to select in one run of the job.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retry-renditions.cron-expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the CRON expression used to schedule the job.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 0 3 * * ?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retry-renditions.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to false, the job will not be scheduled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the name of the user used to run the jobs.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_jobs_retention-cleanup"><a class="anchor" href="#_ecr_server_jobs_retention-cleanup"></a><a class="link" href="#_ecr_server_jobs_retention-cleanup">ecr.server.jobs.retention-cleanup</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">global-settings.asynchronous</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, content of documents will be removed from the storage asynchronously using a message queue. The database entries will not be removed but marked as deleted using the COMPLIANCE_DELETED field.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">global-settings.batch-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the size of a single batch of entities processed by the job.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">global-settings.max-message-queue-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum acceptable size of the message queues used by the job. Checked when the job is started. If the size of one of the queues exceeds the limit, the job is cancelled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">global-settings.max-runtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum acceptable runtime for the job. When the time is exceeded, the job is cancelled.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">global-settings.purge-content</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, all content elements of a document and all it&#8217;s versions will be deleted.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_liquibase"><a class="anchor" href="#_ecr_server_liquibase"></a><a class="link" href="#_ecr_server_liquibase">ecr.server.liquibase</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auto-change-log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the location used to store the auto generated changelog.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">changeLog/auto.xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">changelog-directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The directory used when generated changelogs are kept. This setting is only relevant when keepChangelogs is set to true.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">changelog</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom-change-log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the location of a custom liquibase changelog to execute on startup after the database schema was initialized. Changelogs can be loaded from the classpath by adding the 'classpath:' prefix. Files must be identified by an absolute path using the prefix 'file:/'.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keep-changelogs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, generated changelogs will be kept in separate files in the configured directory.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre-initialization-change-log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the location of a custom liquibase changelog to execute on startup before the database schema was initialized. Changelogs can be loaded from the classpath by adding the 'classpath:' prefix. Files must be identified by an absolute path using the prefix 'file:/'.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_listeners"><a class="anchor" href="#_ecr_server_listeners"></a><a class="link" href="#_ecr_server_listeners">ecr.server.listeners</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">create-renditions-listener-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the listener that is used to create renditions automatically is enabled or not. Ignored when ecr.server.system.event-listeners-enabled is set to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete-audit-entries-listener-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the listener that deletes entries from the audit table is enabled or not. Ignored when ecr.server.system.event-listeners-enabled is set to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete-recycled-entities-listener-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the listener that deletes entries from the recycle bin is enabled or not. Ignored when ecr.server.system.event-listeners-enabled is set to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">purge-content-listener-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the listener that purges content from the storage is enabled or not. Ignored when ecr.server.system.event-listeners-enabled is set to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rendition-dlq-listener-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the listener that sets the rendition status to failed is enabled or not. Ignored when ecr.server.system.event-listeners-enabled is set to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_memory"><a class="anchor" href="#_ecr_server_memory"></a><a class="link" href="#_ecr_server_memory">ecr.server.memory</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buffer-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines how many bytes of data to keep in memory when working with streams before switching to a temporary file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024000</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_messaging"><a class="anchor" href="#_ecr_server_messaging"></a><a class="link" href="#_ecr_server_messaging">ecr.server.messaging</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">json-messages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, the payload of JMS messages will be a JSON string.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queue-listener-concurrency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the number of threads used for listeners for queues (NOT topics!) via a "lower-upper" String, e.g. "5-10", or a simple upper limit String, e.g. "10" (the lower limit will be 1 in this case).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">redelivery.back-off-multiplier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number to multiply the redelivery delay with for every redelivery attempt.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">redelivery.initial-redelivery-delay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time in milliseconds to wait until a failed message will be redelivered.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">redelivery.maximum-redeliveries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of redelivery attempts for failed messages.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">redelivery.use-exponential-back-off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the time between redeliveries of a failed message will be multiplied with the backOffMultiplier for each redelivery.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_query"><a class="anchor" href="#_ecr_server_query"></a><a class="link" href="#_ecr_server_query">ecr.server.query</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">in-condition-optimization-limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the number of entries in an in clause from which in the optimized query is used. -1 disables that feature.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no-sql-query-time-warning-millis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum duration in milliseconds for the execution time of queries on the noSql database after which a warning will be logged.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">statement-execution-time-warning-millis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum duration in milliseconds for the execution time of a database statement after which a warning will be logged. This setting applies to the relational database.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_security"><a class="anchor" href="#_ecr_server_security"></a><a class="link" href="#_ecr_server_security">ecr.server.security</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type-definition-access-checks-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines whether type definition specific access checks are enabled or not.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_solr"><a class="anchor" href="#_ecr_server_solr"></a><a class="link" href="#_ecr_server_solr">ecr.server.solr</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">collection-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the collection to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ecr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">collection-replicas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default number of replicas for a new collection created by the respository service.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">collection-shards</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default number of shards for a new collection created by the respository service.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commit-within-millis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the maximum time in milliseconds after which the solr client will perform a commit.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default-config-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the default SolrConfig.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">solr-plugin-config</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the host for the connection of the Solr Client.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http-client-connection-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the connection timeout for the Solr HTTP client in milliseconds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password used for basic authorization to SOLR.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">schema-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the schema. If null, the collection name is used.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssl-key-store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path to the keystore to use for SSL communication.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssl-key-store-password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the SSL keystore.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssl-tru-ststore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The truststore to use for SSL communication.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssl-truststore-password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the SSL truststore.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">use-ssl-client-auth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use SSL client authentication.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username used for basic authorization to SOLR.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_storage"><a class="anchor" href="#_ecr_server_storage"></a><a class="link" href="#_ecr_server_storage">ecr.server.storage</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">profile-aliases</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Map&lt;java.lang.String,java.lang.String&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A mapping of alias names to storage profile names.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">profile-templates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List&lt;de.eitco.ecr.server.config.StorageProfileTemplate&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of profile templates used by the bucket selector plugin.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">profiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Map&lt;java.lang.String,de.eitco.ecr.server.config.StorageProfileSettings&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A map containing all configured storage profiles.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ecr_server_system"><a class="anchor" href="#_ecr_server_system"></a><a class="link" href="#_ecr_server_system">ecr.server.system</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">batch-operation-limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of entities allowed to be affected by one batch operation like update or delete.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">batch-update-statement-cache-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables the cache for generated batch update SQL statements.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">create-solr-changes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to false when initializing the type schema solr changes will not be executed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">event-listeners-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables the JMS event listeners used to process system events like recycle bin cleanup and the creation of renditions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fetch-jms-statistics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables or disables the regular fetching of JMS statistics from the ecr_jms_statistics table.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialize-empty-database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, the system will create the schema even if not in maintenance mode should the table ecr_types be empty.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">log-schema-changes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true together with maintenanceMode, the system will only log required changes to the database schema and shut down after the log was written.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maintenance-mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the server will update the database schema at startup and shut down after the update was finished. This is actually a combination of updateSchema = true and terminateAfterCreation = true.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">schema-change-log-directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the logfile used when checkForSchemaChanges is set to true.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">terminate-after-creation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the server will terminate after the database schema was created.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">update-schema</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to update the database schema at startup or not.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_job-service"><a class="anchor" href="#_job-service"></a><a class="link" href="#_job-service">job-service</a></h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">standby-only-scheduler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the scheduler used by the job service will be in standby mode. It will not process any jobs.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wait-for-event</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the scheduler will not start to process events until the {@link de.eitco.commons.job.service.common.StartSchedulerEvent} is sent.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring"><a class="anchor" href="#_monitoring"></a><a class="link" href="#_monitoring"><strong>Monitoring</strong></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>arveo</em> uses <a href="https://docs.spring.io/spring-boot/docs/3.2.1/reference/html/actuator.html">Spring Boot Actuator</a>
to expose a monitoring REST API that can be consumed by monitoring systems like <a href="https://prometheus.io/">Prometheus</a> or
the Administration Service. The Actuator documentation linked above contains information about the available monitoring
data, how to enable or disable specific endpoints and how to configure security.</p>
</div>
<div class="paragraph">
<p>The overview of all actuator endpoints is available at <code>/actuator</code>. Health information is available at <code>/actuator/health</code>.</p>
</div>
<div class="sect2">
<h3 id="_custom_health_indicators"><a class="anchor" href="#_custom_health_indicators"></a><a class="link" href="#_custom_health_indicators">Custom health indicators</a></h3>
<div class="paragraph">
<p>In addition to the default health indicators, <em>arveo</em> provides the following additional health indicators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>storagePlugins</code>: Checks if at least one storage profile is configured and if all storage plugins configured in the
storage profiles are able to store data.</p>
<div class="ulist">
<ul>
<li>
<p><code>FileSystemPlugin</code>: Checks if the configured storage directory exists and whether the database sequence used to
generate storage IDs is available.</p>
</li>
<li>
<p><code>S3Plugin</code>: Checks if the configured bucket exists. When the last storage operation has failed, the endpoint checks
if the S3 service is available.</p>
</li>
<li>
<p><code>SwiftV2Plugin</code>, <code>SwiftV3Plugin</code>: Checks if the configured container exists. When the last storage operation has
failed, the endpoint checks if the Swift service is available.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>typeDefinitions</code>: Checks if there is at least one registered type definition.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The custom health indicators can be disabled like any other health indicator by setting the configuration property
<code>management.health.key.enabled</code> (where key is the name of the indicator) to false.</p>
</div>
</div>
<div class="sect2">
<h3 id="_custom_endpoints"><a class="anchor" href="#_custom_endpoints"></a><a class="link" href="#_custom_endpoints">Custom endpoints</a></h3>
<div class="paragraph">
<p>In addition to the default actuator endpoints, <em>arveo</em> provides the following custom actuator endpoints.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>storageProfiles</code>: Provides a list of all storage profiles and the storage plugin used by each profile.</p>
</li>
<li>
<p><code>typeDefinitions</code>: Provides a list of all type definitions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The custom endpoints can be disabled like any other actuator endpoint by setting the property
<code>management.endpoint.key.enabled</code> (where key is the name of the endpoint) to false.</p>
</div>
</div>
<div class="sect2">
<h3 id="_custom_metrics"><a class="anchor" href="#_custom_metrics"></a><a class="link" href="#_custom_metrics">Custom metrics</a></h3>
<div class="paragraph">
<p>In addition to the default metrics, <em>arveo</em> provides additional metrics that can be used to monitor the
performance of the system.</p>
</div>
<div class="sect3">
<h4 id="_storage"><a class="anchor" href="#_storage"></a><a class="link" href="#_storage">Storage</a></h4>
<div class="paragraph">
<p>For each storage profile a metric is available that records the following statistics:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.storage.read.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of read operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.storage.write.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of write operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.storage.read.bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total amount of bytes read</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.storage.write.bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total amount of bytes written</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.storage.read.error</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of read errors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.storage.write.error</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of write errors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.storage.read.time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read times</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.storage.write.time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write times</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each metric contains a tag named <code>profile</code> with a value for each configured storage profile.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These metrics are reset each time the repository service instance is restarted.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Profiles that use the <code>BucketOrganizerPlugin</code> are not included in the metrics. Instead, a separate metric for each of
the referenced profiles used by the bucket organizer profile is available.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to disable the recording of these metrics by setting the following parameters to false. This does not
only disable the availability of the metrics but the entire recording mechanism.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">management:
  metrics:
    enable:
      ecr:
        storage: false</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_relational_database"><a class="anchor" href="#_relational_database"></a><a class="link" href="#_relational_database">Relational database</a></h4>
<div class="paragraph">
<p>The following metrics are collected for operations on the relational database:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.rdb.statement</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum and total execution time as well as the number of executed database statements</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.rdb.error.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of database errors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.rdb.time.warning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of statements that took longer than the configured threshold to execute</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each of these metrics contains a tag for the current tenant and the type of statement that was executed. The threshold
time after which an execution time warning is logged and the counter is incremented can be configured using the setting
<code>ecr.server.query.statementExecutionTimeWarningMillis</code> (in milliseconds).</p>
</div>
<div class="paragraph">
<p>The recording of these metrics can be disabled using the following configuration parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">management:
  metrics:
    enable:
      ecr:
        rdb: false</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_solr_2"><a class="anchor" href="#_solr_2"></a><a class="link" href="#_solr_2">Solr</a></h4>
<div class="paragraph">
<p>The following metrics are collected for the Solr object database:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.solr.add</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum and total time as well as a counter for add operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.solr.query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum and total time as well as a counter for query operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.solr.deletebyid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum and total time as well as a counter for delete-by-id operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.solr.error</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A counter for all Solr exceptions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.solr.time.warning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of queries that took longer than the configured threshold to execute:</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All of the above metrics contain a tag for the current tenant. The error counter contains a tag for the type of operation
that has failed. The threshold time after which an execution time warning is logged and the counter is incremented can
be configured using the setting <code>ecr.server.query.noSqlQueryTimeWarningMillis</code> (in milliseconds).</p>
</div>
<div class="paragraph">
<p>It is possible to disable the collection of these metrics using the following configuration parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">management:
  metrics:
    enable:
      ecr:
        solr: false</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jms_queues"><a class="anchor" href="#_jms_queues"></a><a class="link" href="#_jms_queues">JMS queues</a></h4>
<div class="paragraph">
<p><em>arveo</em> provides metrics to monitor the state of the JMS queues used for asynchronous operations. These
metrics rely on the <a href="https://activemq.apache.org/statisticsplugin">statistics plugin</a> of ActiveMQ to retrieve statistics.
The plugin must be activated in <code>activemq.xml</code> as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;broker...&gt;
    &lt;plugins&gt;
        &lt;statisticsBrokerPlugin/&gt;
    &lt;/plugins&gt;
&lt;/broker&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The statistics collected by the statistics plugin are polled periodically by a job running in the repository service.
The job is disabled by default. To activate it, set the following parameters in the configuration of the repository
service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">ecr:
  server:
    jobs:
      jms-statistics:
        cron-expression: "*/15 * * * * ?"
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example configuration above, the job is triggered every 15 seconds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Unlike other system jobs, this job always runs within the repository service. It cannot be offloaded to a separate job
service instance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following metrics will be available once the job was activated:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.jms.queue.size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of messages currently contained in the queue.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.jms.queue.enqueuecount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The total number of messages that have been enqueued in the queue.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.jms.queue.dequeuecount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The total number of messages that have been dequeued from the queue.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.jms.queue.averageenqueuetime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The average time a message was enqueued before it was dequeued.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each metric contains a tag called <code>queue</code> containing the name of the queue. The following queues are currently used
by the repository service:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Queue</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr-queue-content-to-purge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains messages containing IDs of content elements that have to be purged from the
  storage.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr-queue-delete-recycled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains messages with a delivery delay that will cause an entity to be deleted from the
  recycle bin once it&#8217;s recycle delay has expired.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr-queue-create-renditions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains messages of renditions that have to be created for new content elements.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DLQ.ecr-queue-create-renditions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The dead letter queue for the ecr-queue-create-renditions queue. This is used to
  set the rendition availability status to failed once all retries for the creation of a rendition have failed.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_type_definitions_2"><a class="anchor" href="#_type_definitions_2"></a><a class="link" href="#_type_definitions_2">Type definitions</a></h4>
<div class="paragraph">
<p><em>arveo</em> provides metrics for several operations for each type definition. The following metrics are available:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.read</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter and time measurements for read operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.read.error.client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for read operation errors caused by the client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.read.error.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for read operation errors caused by the server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter and time measurements for delete operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.delete.error.client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for delete operation errors caused by the client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.delete.error.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for delete operation errors caused by the server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.create</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter and time measurements for create operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.create.error.client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for create operation errors caused by the client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.create.error.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for create operation errors caused by the server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.update</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter and time measurements for update operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.update.error.cliet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for update operation errors caused by the client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.update.error.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for update operation errors caused by the server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.recycle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter and time measurements for recycle operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.recycle.error.client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for recycle operation errors caused by the client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.recycle.error.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for recycle operation errors caused by the server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.restore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter and time measurements for restore operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.restore.error.client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for restore operation errors caused by the client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.restore.error.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for restore operation errors caused by the server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.find</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter and time measurements for find operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.find.error.client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for find operation errors caused by the client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.find.error.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for find operation errors caused by the server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.batchupdate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter and time measurements for batchupdate operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.batchupdate.error.client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for batch update operation errors caused by the client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ecr.typedefinition.batchupdate.error.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for batch update operation errors caused by the server.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each of these metrics has a tag called <code>type-definition</code> containing the name of the type definition the measurement
was taken for.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prometheus"><a class="anchor" href="#_prometheus"></a><a class="link" href="#_prometheus">Prometheus</a></h3>
<div class="paragraph">
<p><em>arveo</em> provides an actuator endpoint that can be used to collect metrics data using <a href="https://prometheus.io/">Prometheus</a>.
Prometheus collects data by periodically calling configured sources ("scrapes"). The following example shows an entry
in the <code>prometheus.yml</code> file for a scrape configuration that collects data from the prometheus actuator endpoint every
15 seconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'arveo'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['localhost:39001']</code></pre>
</div>
</div>
<div class="paragraph">
<p>The metrics support of <em>arveo</em> is based on <a href="https://micrometer.io">Micrometer</a>. To support monitoring systems
like Prometheus, micrometer remembers the last maximum value of time based metrics for a configurable amount of time.
This time should be close to the scrape interval of Prometheus and can be
configured in the configuration properties of <em>arveo</em> as shown in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">management:
  metrics:
    export:
      prometheus:
        step: 15s</code></pre>
</div>
</div>
<div class="paragraph">
<p>The data collected by Prometheus can be visualized using <a href="https://grafana.com/oss/grafana/">Grafana</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_other_monitoring_systems"><a class="anchor" href="#_other_monitoring_systems"></a><a class="link" href="#_other_monitoring_systems">Other monitoring systems</a></h3>
<div class="paragraph">
<p>Support for other monitoring system then Prometheus can be enabled by adding the required library to the classpath.
The <a href="https://docs.spring.io/spring-boot/docs/3.2.1/reference/htmlsingle/#actuator.metrics.export">Spring Boot documentation</a>
contains a list of the supported monitoring systems and further information about how to configure them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_attributes_in_mdc"><a class="anchor" href="#_attributes_in_mdc"></a><a class="link" href="#_attributes_in_mdc">Attributes in MDC</a></h3>
<div class="paragraph">
<p><em>arveo</em> adds the following additional attributes to the mapped diagnostic context (MDC) of the logging framework
to make it easier to analyze the system&#8217;s behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ecr.user-id</code>: The ID of the user performing the current request, if available</p>
</li>
<li>
<p><code>ecr.tenant</code>: The tenant for which the current request is executed.</p>
</li>
<li>
<p><code>ecr.trace-id</code>: The ID of the current trace, if available. The trace-id is set by Open Telemetry (see below).</p>
</li>
<li>
<p><code>ecr.span-id</code>: The ID of the current span, if available. The span-id is set by Open Telemetry (see below).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These attributes are added using a <code>HandlerInterceptor</code> for the REST endpoints using Spring WebMVC. Note that these
attributes will not be added when <em>arveo</em> is used embedded. In this case, the application using the embedded
<em>arveo</em> instance is responsible for adding required information to the MDC.</p>
</div>
<div class="paragraph">
<p>Depending on the logger appender in use, it is possible to add these attributes to log messages. See the
<a href="https://logback.qos.ch/manual/mdc.html">documentation</a> of logback for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_open_telemetry"><a class="anchor" href="#_open_telemetry"></a><a class="link" href="#_open_telemetry">Open Telemetry</a></h3>
<div class="paragraph">
<p><em>arveo</em> supports using <a href="https://opentelemetry.io/">Open Telemetry</a> to monitor the system&#8217;s behavior. Most notably
it is possible to view traces of requests across the different services using a tracing backend like
<a href="https://www.jaegertracing.io/">Jaeger</a> or <a href="https://zipkin.io/">Zipkin</a>. The outermost span of a trace that was started by
a user&#8217;s request will contain the <code>ecr.user-id</code> and <code>ecr.tenant</code> attributes containing the user&#8217;s ID and the current
tenant. This is done by the same mechanism as described above for the <a href="#_attributes_in_mdc">MDC</a>.</p>
</div>
<div class="paragraph">
<p>Because <em>arveo</em> is based on several widely used open source libraries, the automatic instrumentation mode of
Open Telemetry can be used to record traces. This is done by the Open Telemetry java agent as described in the
<a href="https://opentelemetry.io/docs/instrumentation/java/automatic/">Open Telemetry documentation</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows the required parameters to use Open Telemetry with Jaeger for the repository service.</p>
</div>
<div class="listingblock">
<div class="title">Start parameters for Open Telemetry</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">-Dotel.traces.exporter=jaeger
-Dotel.metrics.exporter=none
-Dotel.service.name=repository-service
-javaagent:&lt;path&gt;/opentelemetry-javaagent.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The metrics export is disabled in the above example. As described in the sections above, metrics can be collected using
the actuator endpoints.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_system_tables"><a class="anchor" href="#_system_tables"></a><a class="link" href="#_system_tables"><strong>System tables</strong></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section contains information about the system tables used by <em>arveo</em>.</p>
</div>
<div class="sect2">
<h3 id="_tables_for_type_definitions"><a class="anchor" href="#_tables_for_type_definitions"></a><a class="link" href="#_tables_for_type_definitions">Tables for type definitions</a></h3>
<div class="paragraph">
<p>The system stores some information like the ID of type definitions in the database. For this, the following tables are
used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ecr-types</code>: Contains en entry for each type definition</p>
</li>
<li>
<p><code>ecr-types-content-elements</code>: Contains 1:n mappings of content elements to type definitions.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="type-system-tables.png" alt="type system tables" width="810" height="196">
</div>
<div class="title">Figure 5. ERD of type system tables</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Columns of ecr_types</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 15%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the type definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">creation_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creation date and time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">object_type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the objects in the type definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the type definition</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Columns of ecr_types_content_elements</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 15%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ce_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the content element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ce_type_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the type definition containing the content element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ce_content_type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The allowed content type of the content element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ce_profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the storage profile used by the content element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ce_store_json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the content element uses the JSON field or not</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_folder_structure_tables"><a class="anchor" href="#_folder_structure_tables"></a><a class="link" href="#_folder_structure_tables">Folder structure tables</a></h3>
<div class="paragraph">
<p>The object type FOLDER is used to create tree-like structures with parent- and child-relationships. The structure is
stored in the <em>ecr_folder_structure</em> table. The table <em>ecr_folder_structure_closure</em> contains a transitive hull of the
parent- and child-relationships to allow fast database queries in the tree.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="folder-structure-tables.png" alt="folder structure tables" width="780" height="210">
</div>
<div class="title">Figure 6. ERD of folder structure tables</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Columns of ecr_folder_structure</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 15%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">child_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the child-folder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">child_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">varchar(128)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the child-folder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the parent-folder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent_type_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the parent type definition</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Columns of ecr_folder_structure_closure</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 15%;">
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the entry in the closure table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">child_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the child-folder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">child_type_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the child type definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">depth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The distance between the child and the parent on the direct path in the tree</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the parent folder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent_type_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the parent type definition</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_recovery_table"><a class="anchor" href="#_recovery_table"></a><a class="link" href="#_recovery_table">Recovery table</a></h3>
<div class="paragraph">
<p>The recovery table <em>ecr_recovery</em> is used for the <a href=".#_recovery_log">recovery</a> feature.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="ecr-recovery-table.png" alt="ecr recovery table" width="310" height="196">
</div>
<div class="title">Figure 7. ERD of ecr_recovery</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Columns of <em>ecr_recovery</em></caption>
<colgroup>
<col style="width: 20%;">
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleted_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date and time at which the entity was deleted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jsonb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A JSON representation of the deleted entity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entity_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the entity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keep_until</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date and time until which to keep the entity in the recovery table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the type definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version ID of the deleted entity</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_keystore_tables"><a class="anchor" href="#_keystore_tables"></a><a class="link" href="#_keystore_tables">Keystore tables</a></h3>
<div class="paragraph">
<p>When the <a href="../arveo-administration#<em>encryption">encryption</a> feature is enabled for a storage profile, the generated keys are stored in
profile-specific database tables. For each encrypted profile, a table called <code>ecr_keys-&lt;profile&gt;</code> and a table called
<code>ecr_keys_assoc</em>&lt;profile&gt;</code> is created. The ecr_keys_&lt;profile&gt; table contains the generated keys, and the
ecr_keys_assoc_&lt;profile&gt; table contains the associations between content elements and keys.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="ecr-keystore-tables.png" alt="ecr keystore tables" width="720" height="154">
</div>
<div class="title">Figure 8. ERD of keystore tables</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Columns of ecr_keys_&lt;profile&gt;</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The encryption key</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Columns of ecr_keys_assoc_&lt;profile&gt;</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">content_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the content element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the key</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compatibility_list"><a class="anchor" href="#_compatibility_list"></a><a class="link" href="#_compatibility_list"><strong>Compatibility list</strong></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To operate <em>arveo</em> successfully the operator of the platform must provide and manage the following services.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/arveo-architecture.png" alt="diagram">
</div>
<div class="title">Figure 9. Architecture overview</div>
</div>
<div class="paragraph">
<p>The following table lists 3rd party services used in <em>arveo</em>.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 22. 3rd party services in <em>arveo</em></caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Supported Version</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java 17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integration tests run on Eclipse Temurin 17, but all JDKs are supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ActiveMQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ActiveMQ 5.18.3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PostgreSQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">postgres 15.1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache Solr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache Solr 9.4.0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">S3 Storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ceph 15, 16<br>
NetAPP ONTAP 9<br>
Dell Elastic Cloud Storage (ECS)<br>
AWS S3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">File System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NFS<br>
 CIFS</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux OS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu 18.04, 20.04</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tomcat 9, 10</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kubernetes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If helm deployment is used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">docker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20.10.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If helm deployment is used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grant flows:<br>
Client Credentials Flow<br>
Authorization Code Flow with PKCE<br>
Resource Owner Password Flow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak 15
Windows Server AD FS 2016</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MS Active Directory</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MS Graph</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Document Conversion with Microsoft 365, requires M365 account</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos Aiuthentication Service is MS Active Directory</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_important_terminology"><a class="anchor" href="#_important_terminology"></a><a class="link" href="#_important_terminology"><strong>Important Terminology</strong></a></h2>
<div class="sectionbody">
<div class="dlist glossary">
<dl>
<dt>ECR</dt>
<dd>
<p>Short for Enterprise Content Services; this is the collection of the <em>arveo</em> content services providing
all document and record features.</p>
</dd>
<dt>EQL</dt>
<dd>
<p>Eitco Query Language.</p>
<div class="paragraph">
<p>Used for search operations.</p>
</div>
</dd>
<dt>Entity</dt>
<dd>
<p>Object that represents a type of data structure used in <em>arveo</em>.</p>
</dd>
<dt>Document</dt>
<dd>
<p>An entity that can contain metadata and content.</p>
</dd>
<dt>Folder</dt>
<dd>
<p>An entity that contains metadata and is organized in a tree structure like in a file system.</p>
</dd>
<dt>Relation</dt>
<dd>
<p>An entity that represents a relation between two other entities.</p>
</dd>
<dt>Container</dt>
<dd>
<p>Simple folder-like object not organized in a tree structure but with relations to other objects.</p>
</dd>
<dt>Meta</dt>
<dd>
<p>An entity that contains only metadata.</p>
</dd>
<dt>Content type</dt>
<dd>
<p>A meta specification, that classifies the data.</p>
<div class="paragraph">
<p>Examples of content types are: original object, rendition, full text, text notes, XML properties, etc.</p>
</div>
</dd>
<dt>Retention</dt>
<dd>
<p>Continuous audit-proof storage of all company data for compliance or own business purposes.</p>
</dd>
<dt>Litigation hold</dt>
<dd>
<p>A flag that indicates whether a document is related to a litigation.</p>
<div class="paragraph">
<p>If the flag is set the document must never be deleted - even if the retention date has passed by.</p>
</div>
</dd>
<dt>Bucket</dt>
<dd>
<p>Object storage.</p>
</dd>
<dt>Encryption</dt>
<dd>
<p>Translating data into unreadable forms by means of electronic or digital codes
or keys.</p>
<div class="paragraph">
<p>A specific key in the form of a procedure or an algorithm is required for the reverse transformation.
Then the legitimate user can access the original data.</p>
</div>
</dd>
<dt>Annotation</dt>
<dd>
<p>A construct used on interfaces or getter-methods to specify their properties.</p>
</dd>
<dt>Storage profile</dt>
<dd>
<p>Are used to define on which storage the content elements are saved.</p>
</dd>
<dt>Storage Container</dt>
<dd>
<p>Are folders or buckets on the content storage containing documents with the same retention period (e.g. Jan-Dez 2031).</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-02-08 09:10:20 UTC
</div>
</div>
</body>
</html>